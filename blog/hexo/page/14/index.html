<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/14/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-16cd2e0d13e84b93a3a8469b167623b0" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/16cd2e0d13e84b93a3a8469b167623b0/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/16cd2e0d13e84b93a3a8469b167623b0/">Vue 实现一个滚动到顶部的悬浮图标组件</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>吾辈在写 vuejs 前端项目的时候，需要实现一个下拉文章列表时，出现一个悬浮按钮，用于一键回到文章顶部。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><blockquote>
<p>实现源码放到了 <a target="_blank" rel="noopener" href="https://github.com/rxliuli/vue-scroll-to-top-component">GitHub</a>，<a target="_blank" rel="noopener" href="https://vue-scroll-to-top-component.rxliuli.com/">Demo 演示</a> 想直接看源码/效果的人可以直接去看，但最好看一下 <a href="#%E6%B3%A8%E6%84%8F%E7%82%B9">注意点</a></p>
</blockquote>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><ol>
<li> 定义一个 vuejs 组件，抽取出最需要的几个属性（位置，组件的样子）</li>
<li> 监听窗口滚动，当滚动到第二屏的时候显示组件</li>
<li> 监听组件点击，点击即逐渐减少与顶端的距离</li>
<li> 当在滚动中用户手动下拉时终止滚动</li>
<li> 引用组件并传递一个 vue 模板</li>
</ol>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>定义模板 <code>VxScrollToTop</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">一个 Vue 的滚动到顶部的容器组件（不提供 UI 显示）</span><br><span class="line">使用：</span><br><span class="line">1. 引入自定义文件上传组件: import VxScrollToTop from &#39;@&#x2F;components&#x2F;common&#x2F;VxScrollToTop&#39;</span><br><span class="line">2. 声明它</span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    VxScrollToTop: VxScrollToTop</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">3. 在 template 中使用</span><br><span class="line">&lt;vx-scroll-to-top&gt;</span><br><span class="line">  &lt;!-- 这里面的内容随你定义，是上拉按钮要显示的样子 --&gt;</span><br><span class="line">  &lt;v-btn color&#x3D;&quot;primary&quot;</span><br><span class="line">          fab&gt;</span><br><span class="line">    &lt;v-icon&gt;vertical_align_top&lt;&#x2F;v-icon&gt;</span><br><span class="line">  &lt;&#x2F;v-btn&gt;</span><br><span class="line">&lt;&#x2F;vx-scroll-to-top&gt;</span><br><span class="line"> *&#x2F;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div :style&#x3D;&quot;scrollToTopStyle&quot;</span><br><span class="line">       v-show&#x3D;&quot;showScrollToTop&quot;</span><br><span class="line">       @click&#x3D;&quot;scrollToTop&quot;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    &#x2F;&#x2F; 定义上拉按钮容器的位置</span><br><span class="line">    top: &#123;</span><br><span class="line">      type: [Number, String],</span><br><span class="line">      default: undefined</span><br><span class="line">    &#125;,</span><br><span class="line">    bottom: &#123;</span><br><span class="line">      type: [Number, String],</span><br><span class="line">      default: undefined</span><br><span class="line">    &#125;,</span><br><span class="line">    left: &#123;</span><br><span class="line">      type: [Number, String],</span><br><span class="line">      default: undefined</span><br><span class="line">    &#125;,</span><br><span class="line">    right: &#123;</span><br><span class="line">      type: [Number, String],</span><br><span class="line">      default: undefined</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data: () &#x3D;&gt; (&#123;</span><br><span class="line">    &#x2F;&#x2F; 是否显示，初始默认不显示</span><br><span class="line">    showScrollToTop: false,</span><br><span class="line">    &#x2F;&#x2F; 定时器</span><br><span class="line">    timer: null,</span><br><span class="line">    scrollToTopStyle: &#123;</span><br><span class="line">      position: &#39;fixed&#39;,</span><br><span class="line">      top: &#39;&#39;,</span><br><span class="line">      bottom: &#39;&#39;,</span><br><span class="line">      left: &#39;&#39;,</span><br><span class="line">      right: &#39;&#39;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;),</span><br><span class="line">  methods: &#123;</span><br><span class="line">    isNumber (str) &#123;</span><br><span class="line">      if (!new RegExp(&#39;^[0-9]+([.]&#123;1&#125;[0-9]+)?$&#39;).test(str)) &#123;</span><br><span class="line">        return false</span><br><span class="line">      &#125;</span><br><span class="line">      return true</span><br><span class="line">    &#125;,</span><br><span class="line">    watchPosition () &#123;</span><br><span class="line">      if (![this.top, this.bottom, this.left, this.right].find(i &#x3D;&gt; i !&#x3D;&#x3D; undefined)) &#123;</span><br><span class="line">        this.scrollToTopStyle.bottom &#x3D; this.scrollToTopStyle.right &#x3D; &#39;14px&#39;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    watchTop () &#123;</span><br><span class="line">      if (this.top !&#x3D;&#x3D; undefined) &#123;</span><br><span class="line">        this.scrollToTopStyle.top &#x3D; this.isNumber(this.top) ? parseFloat(this.top) + &#39;px&#39; : this.top</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    watchBottom () &#123;</span><br><span class="line">      if (this.bottom !&#x3D;&#x3D; undefined) &#123;</span><br><span class="line">        this.scrollToTopStyle.bottom &#x3D; this.isNumber(this.bottom) ? parseFloat(this.bottom) + &#39;px&#39; : this.bottom</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    watchLeft () &#123;</span><br><span class="line">      if (this.left !&#x3D;&#x3D; undefined) &#123;</span><br><span class="line">        this.scrollToTopStyle.left &#x3D; this.isNumber(this.left) ? parseFloat(this.left) + &#39;px&#39; : this.left</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    watchRigth () &#123;</span><br><span class="line">      if (this.right !&#x3D;&#x3D; undefined) &#123;</span><br><span class="line">        this.scrollToTopStyle.right &#x3D; this.isNumber(this.right) ? parseFloat(this.right) + &#39;px&#39; : this.right</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 初始化按钮的位置</span><br><span class="line">     *&#x2F;</span><br><span class="line">    initBtnPosition () &#123;</span><br><span class="line">      this.watchTop()</span><br><span class="line">      this.watchBottom()</span><br><span class="line">      this.watchLeft()</span><br><span class="line">      this.watchRigth()</span><br><span class="line">      this.watchPosition()</span><br><span class="line">    &#125;,</span><br><span class="line">    initBindScroll () &#123;</span><br><span class="line">      &#x2F;&#x2F; 监听窗口滚动</span><br><span class="line">      document.onscroll &#x3D; ((oldScrollTopLength) &#x3D;&gt; &#123;</span><br><span class="line">        const clientHeight &#x3D; document.documentElement.clientHeight</span><br><span class="line">        return () &#x3D;&gt; &#123;</span><br><span class="line">          const scrollTopLength &#x3D; document.documentElement.scrollTop || document.body.scrollTop</span><br><span class="line">          &#x2F;&#x2F; 如果定时器不存在的话就正常计算滚动到顶部的图标是否存在</span><br><span class="line">          if (!this.timer) &#123;</span><br><span class="line">            &#x2F;&#x2F; 滚动到第二屏就显示</span><br><span class="line">            this.showScrollToTop &#x3D; scrollTopLength &gt; clientHeight</span><br><span class="line">          &#125;</span><br><span class="line">          &#x2F;&#x2F; 向下滚动时判断判断是否正在向上滚动，是的话就清除定时器，停在当前位置</span><br><span class="line">          if (scrollTopLength &gt; oldScrollTopLength &amp;&amp; this.timer) &#123;</span><br><span class="line">            &#x2F;&#x2F; 设置这个是因为有时候 clearInterval() 并不能清除这个属性，或许是 vuejs 组件中的属性特殊一点？</span><br><span class="line">            this.timer &#x3D; clearInterval(this.timer)</span><br><span class="line">          &#125;</span><br><span class="line">          oldScrollTopLength &#x3D; scrollTopLength</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)(0)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 回到顶部</span><br><span class="line">     *&#x2F;</span><br><span class="line">    scrollToTop () &#123;</span><br><span class="line">      this.timer &#x3D; setInterval(() &#x3D;&gt; &#123;</span><br><span class="line">        const scrollTopLength &#x3D; document.documentElement.scrollTop || document.body.scrollTop</span><br><span class="line">        if (scrollTopLength &lt;&#x3D; 0) &#123;</span><br><span class="line">          this.timer &#x3D; clearInterval(this.timer)</span><br><span class="line">          this.showScrollToTop &#x3D; false</span><br><span class="line">        &#125;</span><br><span class="line">        const spend &#x3D; scrollTopLength &#x2F; 5</span><br><span class="line">        document.documentElement.scrollTop &#x3D; document.body.scrollTop &#x3D; scrollTopLength - spend</span><br><span class="line">      &#125;, 30)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted () &#123;</span><br><span class="line">    this.initBtnPosition()</span><br><span class="line">    this.initBindScroll()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">#vx-scroll-to-top-btn &#123;</span><br><span class="line">  position: fixed;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
<p>使用起来就很简单了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h2 v-for&#x3D;&quot;i in 100&quot;</span><br><span class="line">        :key&#x3D;&quot;i&quot;&gt;</span><br><span class="line">      第 &#123;&#123;i&#125;&#125; 行文字</span><br><span class="line">    &lt;&#x2F;h2&gt;</span><br><span class="line">    &lt;vx-scroll-to-top&gt;</span><br><span class="line">      &lt;!-- 这里面的内容随你定义，是上拉按钮要显示的样子 --&gt;</span><br><span class="line">      &lt;v-btn color&#x3D;&quot;primary&quot;</span><br><span class="line">             fab&gt;</span><br><span class="line">        &lt;v-icon&gt;vertical_align_top&lt;&#x2F;v-icon&gt;</span><br><span class="line">      &lt;&#x2F;v-btn&gt;</span><br><span class="line">    &lt;&#x2F;vx-scroll-to-top&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import VxScrollToTop from &#39;@&#x2F;components&#x2F;common&#x2F;VxScrollToTop&#39;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    VxScrollToTop</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>目前这里只能供了最简单的功能，如果有特别的需求可以在上面继续修改一下就好啦</p>
<h3 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h3><ul>
<li>组件方法内部必须使用 <code>箭头函数</code>，因为使用 <code>function</code> 会导致 <code>this</code> 发生变化。详情参考 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Arrow_functions">MDN</a></li>
<li>必须要手动置空 <code>timer</code>，例如上文所用的 <code>this.timer = clearInterval(this.timer)</code>，关于为什么 <code>timer</code> 没有被 <code>clearInterval</code> 清空目前吾辈还真不太清楚，但如果把 <code>timer</code> 放到组件外部就正常使用，估计是 vuejs 的属性有什么特殊的地方也说不定！</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/16cd2e0d13e84b93a3a8469b167623b0/" data-id="ckmcqox2c00130kuvdqxw6jlu" data-title="Vue 实现一个滚动到顶部的悬浮图标组件" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-177cfe6054374ba69a212989fb26ce80" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/177cfe6054374ba69a212989fb26ce80/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/177cfe6054374ba69a212989fb26ce80/">Git 错误 Reset 恢复</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>今天在帮同事操作 Git 的时候，因为没有清楚理解意思，吾辈错误撤回了一些提交。</p>
<p>具体使用的命令是</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset dd256c7d66ad2e9671cbd47650ffddc4267ca7d5</span><br></pre></td></tr></table></figure>
<p>感觉吾辈今天不能撤销这个错误操作的话，怕是今天别想走出公司了吧 #笑</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>当然，吾辈没有添加 <code>--hard</code> 参数，想来仓库还是有救的。之后使用 Google 搜索了一下相关的内容，找到了 <a target="_blank" rel="noopener" href="http://www.voidcn.com/article/p-tfqxjpgj-bms.html">git 版本恢复命令 reset</a>，然后吾辈便尝试进行了恢复。</p>
<ol>
<li><p>找到使用 <code>git reset</code> 之前的最后一次提交的 <code>commit id</code></p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 git 记录的所有操作，包括回退操作也会记录</span></span><br><span class="line">git reflog</span><br></pre></td></tr></table></figure></li>
<li><p>使用 <code>git reset --hard</code> 回退</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 回退到指定提交，但不会将之后提交混入到未提交的内容</span></span><br><span class="line">git reset --hard dd256c7d66ad2e9671cbd47650ffddc4267ca7d5</span><br></pre></td></tr></table></figure></li>
<li><p>使用 <code>git log</code> 检查最后一次提交是否恢复</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这时可以看到最后一次提交已经恢复了</span></span><br><span class="line">git <span class="built_in">log</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<p>嘛，只是偶然遇到的一个错误，吾辈也便稍微记录一下好了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/177cfe6054374ba69a212989fb26ce80/" data-id="ckmcqox2d00140kuv5s2z1ybo" data-title="Git 错误 Reset 恢复" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-17b171a3184c479e97ba7df9bc118023" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/17b171a3184c479e97ba7df9bc118023/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/17b171a3184c479e97ba7df9bc118023/">2019 回忆及 2020 目标</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="往事凌乱"><a href="#往事凌乱" class="headerlink" title="往事凌乱"></a>往事凌乱</h2><p>对于吾辈而言，今年发生的几件事情</p>
<ul>
<li>转型成为前端</li>
<li>淡出 Twitter 中文圈，逐渐回归 Telegram/QQ</li>
<li>博客写作频率逐渐降低，但 GitHub 使用逐渐变多</li>
<li>扎起头发，便是在家中亦然</li>
<li>换了一家 2C 的互联网公司</li>
</ul>
<p>年前想要做的事情，如今却也不大记得了。暂且记得，曾经觉得前端日新月异的想象，现实之中却不尽然。2C 的网站甚至到了目前仍然必须支持 <code>IE</code>，而且前端混乱的生态也让人头疼不已，不仅是 UI 在不同框架的实现不一致，甚至连很多纯 JS 库也是直接依赖于框架了，成为了某个框架的一部分。例如 <code>Redux</code>，号称是通用的状态管理库，然而除了 <code>React</code>，没有框架真正在使用它，<code>Vue</code> 有自己的 <code>Vuex</code>，<code>Angular</code> 也有 <code>RxJS</code>。</p>
<blockquote>
<p>前端框架之间的割裂与没有使用框架之前的割裂真是天壤之别。</p>
</blockquote>
<p>下半年，吾辈进入了一家 2C 的互联网公司，真的是各种加班，具体详情参考 <a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/63bdcead/">一些烦心事</a>。精力消耗殆尽，感觉有时间，但又不想学什么东西，陷入了某种怪圈之中。</p>
<h2 id="未来渺茫"><a href="#未来渺茫" class="headerlink" title="未来渺茫"></a>未来渺茫</h2><p>明年，吾辈最想要接触的是 Web 桌面开发，以及机器学习。</p>
<ul>
<li>[ ] NodeJS 后端开发</li>
<li>[ ] Web 桌面开发 Electron</li>
<li>[ ] 机器学习 TensorFlow</li>
<li>[ ] 继续维护 Blog</li>
<li>[ ] 继续坚持读书</li>
<li>[ ] 尝试网络小说写作</li>
<li>[ ] 尝试 Youtube 视频创作</li>
</ul>
<hr>
<p>Pass 1: 感觉上，人工智能必然取代各种各样的工作，程序员或许也无法幸免于难，而最不容易被替代的，大概就是创作型的工作吧！</p>
<hr>
<p>Pass 2：下面是一段吾辈想要写作的小说的设定集</p>
<figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 设定集</span></span><br><span class="line"></span><br><span class="line">围绕时间基点进行跳跃，逐渐向着基点流动，但却永远不会真的到达。</span><br><span class="line"></span><br><span class="line">明线是琉璃和瑞雪的感情，暗线是探索世界的真实与否。</span><br><span class="line"></span><br><span class="line">第一卷 现实</span><br><span class="line"></span><br><span class="line">从琉璃在生日之前回溯了一天开始，后又回溯到出生点之时，再次开始了新的人生，直到，某个绝望的事实笼罩了她之后，心灰意冷的再次懵懵懂懂的回到了小时候。</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; 百合线</span></span><br><span class="line"></span><br><span class="line">第二卷 黑暗</span><br><span class="line"></span><br><span class="line">因为上一世受到了严重的心理阴影，看着所有的努力化作泡影，琉璃再也没有做任何事情的动力了。在学校中，她变成了七大不可思议的传说之一。随心所欲，和家人的关系破裂，虽靠着两世的经验尚未有大问题，但心却早已经死了。直到，高中快要结束之时，她，参加了瑞雪的葬礼。然而，瑞雪在临终前的话语终究让死掉的心产生了悸动。</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; 黑暗线</span></span><br><span class="line"></span><br><span class="line">第三卷 无限</span><br><span class="line"></span><br><span class="line">她说：无论多少次，吾辈一定会拯救你的。少女立下了拯救另一个少女的誓言，但一切真能如其所愿么？</span><br><span class="line"></span><br><span class="line">不断重复，不断轮回，一个人终究无法推动整个世界到达能够医治瑞雪的方式。甚至在某次暴露了这个秘密，直接了被切片研究，并最终导致世界大战爆发。</span><br><span class="line"></span><br><span class="line">第四卷 未来</span><br><span class="line"></span><br><span class="line">再次重生的少女，不，现在已经是老婆婆的琉璃，发现世界已经到了 2060 年了。是的，她没有再次回到过去，而是活到了未来。但是，她发现了一个怪异之处：时间，似乎在倒流？但是思维却并没有，为什么其他人却很习惯的样子呢？</span><br><span class="line"></span><br><span class="line">她，想了解这个世界。为什么时间逆流，产生了 绝对的宿命论！</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; 科幻线</span></span><br><span class="line"></span><br><span class="line">第四卷 幻想</span><br><span class="line"></span><br><span class="line">结果，再次在生日之后的前一刻，琉璃的时间再次跳跃到不知名的位置，没能回到原来的世界。而且，她也变成了一块石头，女娲石。后来，琉璃几经辗转，来到了红楼梦之中。神（张恒），降临了，但他却绝望的发现这是个虚假的世界。并且，发现了她。</span><br><span class="line"></span><br><span class="line">自此，琉璃被困在了各种 GalGame 和里番之中，虽是虚拟的世界，但却完全感同身受。</span><br><span class="line"></span><br><span class="line">最终，琉璃的灵魂想要转移到刚出生的琉璃身上，却被张恒阻止了。最终，到了琉璃的生日，世界，破碎了。张恒这才明白了什么，但也无法阻止。</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; 幻想线</span></span><br><span class="line"></span><br><span class="line">第五卷 死亡</span><br><span class="line"></span><br><span class="line">论琉璃的 999 种死法。</span><br><span class="line"></span><br><span class="line">突然有一天，琉璃发现自己很容易遭到意外了。一开始只是出门时碰到了一只黑猫，再之后是在高楼下差点被花盆砸中，后来甚至在一个十字路口碰到了车祸现场，最后，她在洗澡时莫名其妙的死掉了。</span><br><span class="line"></span><br><span class="line">第六卷 真相</span><br><span class="line"></span><br><span class="line">世界只是一个实验，为了培育超级 ai 所用。然而实验结束了，准备销毁她。在将要封存一切时，张恒留下的东西让她「消失」了。</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; 楚门的世界</span></span><br><span class="line"></span><br><span class="line">一切都是假的，都是人造的，是某个实验计划的一部分，而她，便是这个世界中的「楚门」，但她最后，却没有选择去留的权利，唯有死亡一途。</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/17b171a3184c479e97ba7df9bc118023/" data-id="ckmcqox2d00150kuv8rwrewc4" data-title="2019 回忆及 2020 目标" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9D%82%E8%B0%88/" rel="tag">杂谈</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-20aea2becb144c0c881686fccb511929" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/20aea2becb144c0c881686fccb511929/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/20aea2becb144c0c881686fccb511929/">Vue 深度监听</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>吾辈在前端项目中需要监听 Vue 组件中的一个数组的变化，然而没想到这个简单的功能却发现并没有想象中的容易。在废了一波三折之后终于算是实现了效果，所以便在这里记录一下。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><blockquote>
<p>吾辈写一个 demo 在 <a target="_blank" rel="noopener" href="https://github.com/rxliuli/vue-deep-monitoring">GitHub</a>，如果需要可以去看下。也有一个 <a target="_blank" rel="noopener" href="https://vue-deep-monitoring.rxliuli.com/">网站</a> 用来演示下面的三种方法的效果</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;v-card&gt;</span><br><span class="line">    &lt;v-card-title primary-title&gt;</span><br><span class="line">      &lt;h2&gt;普通监听&lt;/h2&gt;</span><br><span class="line">      &lt;v-subheader&gt;不会发生变化&lt;/v-subheader&gt;</span><br><span class="line">    &lt;/v-card-title&gt;</span><br><span class="line">    &lt;v-card-text&gt;</span><br><span class="line">      &lt;v-list&gt;</span><br><span class="line">        &lt;v-list-tile v-<span class="keyword">for</span>=<span class="string">&quot;item in items&quot;</span> :key=<span class="string">&quot;item.k&quot;</span>&gt;</span><br><span class="line">          &lt;v-text-field</span><br><span class="line">            :label=<span class="string">&quot;`输入框 $&#123;item.k&#125;`&quot;</span></span><br><span class="line">            v-model=<span class="string">&quot;item.v&quot;</span></span><br><span class="line">          &gt;&lt;/v-text-field&gt;</span><br><span class="line">        &lt;/v-list-tile&gt;</span><br><span class="line">      &lt;/v-list&gt;</span><br><span class="line">      &lt;v-layout row wrap&gt;</span><br><span class="line">        &lt;v-flex md4 xs12&gt;</span><br><span class="line">          &lt;h2&gt;旧值&lt;/h2&gt;</span><br><span class="line">          &lt;p&gt;&#123;&#123; oldVal &#125;&#125;&lt;/p&gt;</span><br><span class="line">        &lt;/v-flex&gt;</span><br><span class="line"></span><br><span class="line">        &lt;v-flex md4 sm4 xs12&gt;</span><br><span class="line">          &lt;h2&gt;差异&lt;/h2&gt;</span><br><span class="line">          &lt;p&gt;&#123;&#123; difference &#125;&#125;&lt;/p&gt;</span><br><span class="line">        &lt;/v-flex&gt;</span><br><span class="line">        &lt;v-flex md4 xs12&gt;</span><br><span class="line">          &lt;h2&gt;新值&lt;/h2&gt;</span><br><span class="line">          &lt;p&gt;&#123;&#123; val &#125;&#125;&lt;/p&gt;</span><br><span class="line">        &lt;/v-flex&gt;</span><br><span class="line">      &lt;/v-layout&gt;</span><br><span class="line">      &lt;v-layout row wrap&gt;</span><br><span class="line">        &lt;v-flex xs12&gt;</span><br><span class="line">          &lt;h4&gt;最后更新于：&#123;&#123; lastUpdateTime &#125;&#125;&lt;/h4&gt;</span><br><span class="line">        &lt;/v-flex&gt;</span><br><span class="line">      &lt;/v-layout&gt;</span><br><span class="line">    &lt;/v-card-text&gt;</span><br><span class="line">  &lt;/v-card&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  data: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="comment">// 吾辈想要监视这个的变化</span></span><br><span class="line">    items: [],</span><br><span class="line">    <span class="comment">// 下面的两个属性仅用于展示</span></span><br><span class="line">    oldVal: [],</span><br><span class="line">    val: [],</span><br><span class="line">    difference: [],</span><br><span class="line">    lastUpdateTime: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">  &#125;),</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化 items</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="title">init</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.items = _.range(<span class="number">1</span>, <span class="number">6</span>).map(<span class="function"><span class="params">i</span> =&gt;</span> (&#123;</span><br><span class="line">        k: i,</span><br><span class="line">        v: <span class="string">&#x27;&#x27;</span></span><br><span class="line">      &#125;))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.init()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="直接使用-watch-监听"><a href="#直接使用-watch-监听" class="headerlink" title="直接使用 watch 监听"></a>直接使用 <code>watch</code> 监听</h2><p>最开始吾辈使用 <code>watch</code> 直接监听数组 <code>items</code> 的变化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">watch: &#123;</span><br><span class="line">  <span class="comment">// 监听 items 的变化（实际上数组内部的值变化监听不到）</span></span><br><span class="line">  <span class="function"><span class="title">items</span>(<span class="params">val, oldVal</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.val = val</span><br><span class="line">    <span class="built_in">this</span>.oldVal = oldVal</span><br><span class="line">    <span class="built_in">this</span>.difference = _.differenceWith(</span><br><span class="line">      val,</span><br><span class="line">      oldVal,</span><br><span class="line">      (i, k) =&gt; <span class="built_in">JSON</span>.stringify(i) === <span class="built_in">JSON</span>.stringify(k)</span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">this</span>.lastUpdateTime = <span class="keyword">new</span> <span class="built_in">Date</span>().toISOString()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>结果发现完全没有一点效果，vuejs 居然认为数组没有变化。查了一下官网文档，发现在 <a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/guide/list.html#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">这里</a> 有一段话。</p>
<blockquote>
<p>由于 JavaScript 的限制，Vue 不能检测以下变动的数组：</p>
<ol>
<li> 当你利用索引直接设置一个项时，例如：vm.items[indexOfItem] = newValue</li>
<li> 当你修改数组的长度时，例如：vm.items.length = newLength</li>
</ol>
</blockquote>
<h2 id="使用-deep-属性设置深度监听"><a href="#使用-deep-属性设置深度监听" class="headerlink" title="使用 deep 属性设置深度监听"></a>使用 <code>deep</code> 属性设置深度监听</h2><p>后来，在 <a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/api/#watch">watch 的 API</a> 里面，吾辈找到了一个属性：<code>deep</code> ，使用它就可以对数组等嵌套对象进行深度监听。</p>
<p>所以，吾辈的监听代码变成了这样</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">watch: &#123;</span><br><span class="line">  items: &#123;</span><br><span class="line">    handler (val, oldVal) &#123;</span><br><span class="line">      <span class="built_in">this</span>.val = val</span><br><span class="line">      <span class="built_in">this</span>.oldVal = oldVal</span><br><span class="line">      <span class="built_in">this</span>.difference = _.differenceWith(val, oldVal, <span class="function">(<span class="params">i, k</span>) =&gt;</span> <span class="built_in">JSON</span>.stringify(i) === <span class="built_in">JSON</span>.stringify(k))</span><br><span class="line">      <span class="built_in">this</span>.lastUpdateTime = <span class="keyword">new</span> <span class="built_in">Date</span>().toISOString()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 这里是关键，代表递归监听 items 的变化</span></span><br><span class="line">    deep: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然而之后又发现了一个问题，深度监听是能够响应数组里面的元素每一次的变化，但旧的值并没有被记录。原因在 <a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/api/#vm-watch">官网文档</a> 也有指明。</p>
<blockquote>
<p>注意：在变异 (不是替换) 对象或数组时，旧值将与新值相同，因为它们的引用指向同一个对象 / 数组。Vue 不会保留变异之前值的副本。</p>
</blockquote>
<h2 id="使用额外的变量保存旧值"><a href="#使用额外的变量保存旧值" class="headerlink" title="使用额外的变量保存旧值"></a>使用额外的变量保存旧值</h2><p>没办法，既然 vuejs 限制如此，引用类型的变量无法保存旧值，那我们就自己保存吧</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">watch: &#123;</span><br><span class="line">  items: &#123;</span><br><span class="line">    handler (val) &#123;</span><br><span class="line">      <span class="built_in">this</span>.val = val</span><br><span class="line">      <span class="comment">// itemOld 就是额外的变量</span></span><br><span class="line">      <span class="built_in">this</span>.oldVal = <span class="built_in">this</span>.itemOld</span><br><span class="line">      <span class="built_in">this</span>.difference = _.differenceWith(val, <span class="built_in">this</span>.itemOld, <span class="function">(<span class="params">i, k</span>) =&gt;</span> <span class="built_in">JSON</span>.stringify(i) === <span class="built_in">JSON</span>.stringify(k))</span><br><span class="line">      <span class="comment">// 注意：这里更新旧值采用的是深层复制而非简单的引用</span></span><br><span class="line">      <span class="built_in">this</span>.itemOld = _.cloneDeep(val)</span><br><span class="line">      <span class="built_in">this</span>.lastUpdateTime = <span class="keyword">new</span> <span class="built_in">Date</span>().toISOString()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 这里是关键，代表递归监听 items 的变化</span></span><br><span class="line">    deep: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>vuejs 的坑是真的不少呢，不过踩过去就好啦</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/20aea2becb144c0c881686fccb511929/" data-id="ckmcqox2j001m0kuvdd143jze" data-title="Vue 深度监听" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-24b2bc54c8b64593ac273be5e151aefe" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/24b2bc54c8b64593ac273be5e151aefe/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/24b2bc54c8b64593ac273be5e151aefe/">vue 使用 v-model 双向绑定父子组件的值</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>今天在使用 <code>v-model</code> 进行组件双向数据绑定的时候遇到了一个奇怪的问题，网页本身运行正常，浏览器一直出现警告信息。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Vue warn]: Avoid mutating a prop directly since the value will be overwritten whenever the parent component re-renders. Instead, use a data or computed property based on the prop<span class="string">&#x27;s value. Prop being mutated: &quot;value&quot;</span></span><br></pre></td></tr></table></figure>
<p>引发这个警告的是一个自定义组件 <code>RxSelect</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Vue.component(<span class="string">&quot;RxSelect&quot;</span>, &#123;</span><br><span class="line">  model: &#123;</span><br><span class="line">    prop: <span class="string">&quot;value&quot;</span>,</span><br><span class="line">    event: <span class="string">&quot;change&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    value: [<span class="built_in">Number</span>, <span class="built_in">String</span>],</span><br><span class="line">    map: <span class="built_in">Map</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  template: <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;select</span></span><br><span class="line"><span class="string">          v-model=&quot;value&quot;</span></span><br><span class="line"><span class="string">          @change=&quot;$emit(&#x27;change&#x27;, value)&quot;</span></span><br><span class="line"><span class="string">        &gt;</span></span><br><span class="line"><span class="string">          &lt;option</span></span><br><span class="line"><span class="string">            v-for=&quot;[k,v] in map&quot;</span></span><br><span class="line"><span class="string">            :value=&quot;k&quot;</span></span><br><span class="line"><span class="string">            :key=&quot;k&quot;</span></span><br><span class="line"><span class="string">          &gt;&#123;&#123;v&#125;&#125;&lt;/option&gt;</span></span><br><span class="line"><span class="string">        &lt;/select&gt;</span></span><br><span class="line"><span class="string">        `</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>吾辈使用的代码看起来代码貌似没什么问题？</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">main</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  当前选择的性别是: &#123;&#123;map.get(sex)&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rx-select</span> <span class="attr">:map</span>=<span class="string">&quot;map&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;sex&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>JavaScript 代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&quot;#app&quot;</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    map: <span class="keyword">new</span> <span class="built_in">Map</span>().set(<span class="number">1</span>, <span class="string">&quot;保密&quot;</span>).set(<span class="number">2</span>, <span class="string">&quot;男&quot;</span>).set(<span class="number">3</span>, <span class="string">&quot;女&quot;</span>),</span><br><span class="line">    sex: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>经测试，程序本身运行正常，父子组件的传值也没什么问题，双向数据绑定确实生效了，然而浏览器就是一直报错。</p>
<h2 id="尝试解决"><a href="#尝试解决" class="headerlink" title="尝试解决"></a>尝试解决</h2><p>吾辈找到一种方式</p>
<ol>
<li> 为需要双向绑定的变量在组件内部 <code>data</code> 声明一个变量 <code>innerValue</code>，并初始化为 <code>value</code></li>
<li> 在 <code>select</code> 上使用 <code>v-model</code> 绑定这个变量 <code>innerValue</code></li>
<li> 监听 <code>value</code> 的变化，在父组件中 <code>value</code> 变化时修改 <code>innerValue</code> 的值</li>
<li> 监听 <code>innerValue</code> 的变化，在变化时使用 <code>this.$emit(&#39;change&#39;, val)</code> 告诉父组件需要更新 <code>value</code> 的值</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Vue.component(<span class="string">&quot;RxSelect&quot;</span>, &#123;</span><br><span class="line">  model: &#123;</span><br><span class="line">    prop: <span class="string">&quot;value&quot;</span>,</span><br><span class="line">    event: <span class="string">&quot;change&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    value: [<span class="built_in">Number</span>, <span class="built_in">String</span>],</span><br><span class="line">    map: <span class="built_in">Map</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      innerValue: <span class="built_in">this</span>.value,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    <span class="function"><span class="title">value</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.innerValue = val;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">innerValue</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.$emit(<span class="string">&quot;change&quot;</span>, val);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  template: <span class="string">`</span></span><br><span class="line"><span class="string">  &lt;select v-model=&quot;innerValue&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;option</span></span><br><span class="line"><span class="string">      v-for=&quot;[k,v] in map&quot;</span></span><br><span class="line"><span class="string">      :value=&quot;k&quot;</span></span><br><span class="line"><span class="string">      :key=&quot;k&quot;</span></span><br><span class="line"><span class="string">    &gt;&#123;&#123;v&#125;&#125;&lt;/option&gt;</span></span><br><span class="line"><span class="string">  &lt;/select&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>使用代码完全一样，然而组件 <code>RxSelect</code> 的代码却多了许多。。。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>一种更优雅的方式是使用 <code>computed</code> 计算属性以及其的 <code>get/set</code>，代码增加的程度还是可以接受的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Vue.component(<span class="string">&quot;RxSelect&quot;</span>, &#123;</span><br><span class="line">  model: &#123;</span><br><span class="line">    prop: <span class="string">&quot;value&quot;</span>,</span><br><span class="line">    event: <span class="string">&quot;change&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    value: [<span class="built_in">Number</span>, <span class="built_in">String</span>],</span><br><span class="line">    map: <span class="built_in">Map</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    innerValue: &#123;</span><br><span class="line">      <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.value;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="title">set</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.$emit(<span class="string">&quot;change&quot;</span>, val);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  template: <span class="string">`</span></span><br><span class="line"><span class="string">  &lt;select v-model=&quot;innerValue&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;option</span></span><br><span class="line"><span class="string">      v-for=&quot;[k,v] in map&quot;</span></span><br><span class="line"><span class="string">      :value=&quot;k&quot;</span></span><br><span class="line"><span class="string">      :key=&quot;k&quot;</span></span><br><span class="line"><span class="string">    &gt;&#123;&#123;v&#125;&#125;&lt;/option&gt;</span></span><br><span class="line"><span class="string">  &lt;/select&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/24b2bc54c8b64593ac273be5e151aefe/" data-id="ckmcqox2l001r0kuv0siz40e3" data-title="vue 使用 v-model 双向绑定父子组件的值" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-24e15068f56b4301a650b246ab1e245b" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/24e15068f56b4301a650b246ab1e245b/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/24e15068f56b4301a650b246ab1e245b/">js 处理 url 数组参数</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>使用 <code>axios.get</code> 时遇到的问题，axios 在 get 请求时会将参数转换为 url 上，这本是正常的逻辑，然而 Spring MVC 却无法接收，会抛出错误。</p>
<p>使用 Axios 发送的请求代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">axios.get(<span class="string">&quot;/api/index/array&quot;</span>, &#123;</span><br><span class="line">  params: &#123;</span><br><span class="line">    list: [<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Spring MVC 接口代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexTestController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/array&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IndexVo <span class="title">array</span><span class="params">(IndexVo indexVo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> indexVo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexVo</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> List&lt;String&gt; list;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> IndexVo <span class="title">setList</span><span class="params">(List&lt;String&gt; list)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.list = list;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此处为了简单演示使用了内部类</p>
</blockquote>
<p>请求如下</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/api/index/array?list[]=1&amp;list[]=2&amp;list[]=3</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost:8080</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">Pragma</span><span class="punctuation">: </span>no-cache</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-cache</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/plain, */*</span><br><span class="line"><span class="attribute">DNT</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://localhost:8080/</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>JSESSIONID=F8E42F1AC8B9CD46A0F6678DFEB3E9F3</span><br></pre></td></tr></table></figure>
<p>抛出的错误</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalArgumentException: Invalid character found in the request target. The valid characters are defined in RFC <span class="number">7230</span> and RFC <span class="number">3986</span></span><br></pre></td></tr></table></figure>
<p>说是参数中包含 <strong>RFC 7230 and RFC 3986</strong> 未定义的字符，所以说 <strong>RFC 7230 and RFC 3986</strong> 是个什么东西？</p>
<p>去 Google 上一搜，好吧，果然吾辈不是第一个被坑的人。没想到不是 Spring 的问题，而是新版 Tomcat(7) 的问题。Tomcat 要求 URL 中的字符必须符合 RFC 3986。<br>即：只能包含英文字符（<code>a-zA-Z</code>），数字（<code>0-9</code>），特殊字符（<code>-_.~</code>），保留字符（<code>!*&#39;();:@&amp;=+$,/?#[]</code>）。</p>
<p>然后，作为一个 URI 的数据与作为保留字符的分隔符发生冲突了，自然是要使用 % 进行编码的。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>既然 Axios 本身的 get 函数中对参数进行编码有问题，那么吾辈就自己手动将 params 转换到 URL 上好了。<br>本以为是个很简单的功能，所以最初吾辈直接使用了 <a target="_blank" rel="noopener" href="https://github.com/rxliuli/rx-util">rx-util</a> 中之前写的 <a target="_blank" rel="noopener" href="https://rx-util.rxliuli.com/function/index.html#static-function-spliceParams">spliceParams</a> 函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @ts-check</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 拼接参数字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>params 参数对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;String&#125;</span> </span>拼接后的字符串</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">spliceParams</span>(<span class="params">params</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!params) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`参数对象不能为空：<span class="subst">$&#123;params&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> res = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> k <span class="keyword">in</span> params) &#123;</span><br><span class="line">    <span class="keyword">if</span> (params.hasOwnProperty(k)) &#123;</span><br><span class="line">      <span class="keyword">const</span> v = params[k];</span><br><span class="line">      res += <span class="string">`<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(k)&#125;</span>=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(v)&#125;</span>&amp;`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然而之前没有处理的边界情况 Array 和 Date 却出现了问题，修改如下</p>
<blockquote>
<p>注: 此处的 <a target="_blank" rel="noopener" href="https://rx-util.rxliuli.com/function/index.html#static-function-dateFormat">dateFormat</a> 亦来自于 <a target="_blank" rel="noopener" href="https://github.com/rxliuli/rx-util">rx-util</a></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @ts-check</span></span><br><span class="line"><span class="keyword">import</span> &#123; dateFormat &#125; <span class="keyword">from</span> <span class="string">&quot;./../date/dateFormat&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> deteFormatter = <span class="string">&quot;yyyy-MM-ddThh:mm:ss.SSSZ&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> encode = <span class="function">(<span class="params">k, v</span>) =&gt;</span> <span class="built_in">encodeURIComponent</span>(k) + <span class="string">&quot;=&quot;</span> + <span class="built_in">encodeURIComponent</span>(v);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 拼接参数字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>params 参数对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;String&#125;</span> </span>拼接后的字符串</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">spliceParams</span>(<span class="params">params = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(params <span class="keyword">instanceof</span> <span class="built_in">Object</span>)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`The parameter type must be Object: <span class="subst">$&#123;params&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Array</span>.from(<span class="built_in">Object</span>.entries(params)).reduce(<span class="function">(<span class="params">res, [k, v]</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (v === <span class="literal">undefined</span> || v === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (v <span class="keyword">instanceof</span> <span class="built_in">Date</span>) &#123;</span><br><span class="line">      res += encode(k, dateFormat(v, deteFormatter));</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (v <span class="keyword">instanceof</span> <span class="built_in">Array</span>) &#123;</span><br><span class="line">      res += v</span><br><span class="line">        .map(<span class="function">(<span class="params">item</span>) =&gt;</span></span><br><span class="line">          encode(</span><br><span class="line">            k,</span><br><span class="line">            item <span class="keyword">instanceof</span> <span class="built_in">Date</span> ? dateFormat(item, deteFormatter) : item</span><br><span class="line">          )</span><br><span class="line">        )</span><br><span class="line">        .join(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      res += encode(k, v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (res += <span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">  &#125;, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在，spliceParams 可以正常使用了，对空值，Date 与 Array 都是友好的了！</p>
<p>使用的话，直接在将 axios 包装一下即可，类似于下面这样</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> rxAjax = (<span class="function">(<span class="params">axios</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...axios,</span><br><span class="line">    <span class="function"><span class="title">get</span>(<span class="params">url, params, config</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> axios.get(<span class="string">`<span class="subst">$&#123;url&#125;</span>?<span class="subst">$&#123;rx.spliceParams(params)&#125;</span>`</span>, config);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)(axios.create());</span><br></pre></td></tr></table></figure>
<p>现在，再次发送请求，参数会被正确的处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">axios.get(<span class="string">&quot;/api/index/array&quot;</span>, &#123;</span><br><span class="line">  params: &#123;</span><br><span class="line">    list: [<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>请求如下</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/api/index/array?list=1&amp;list=2&amp;list=3&amp;</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost:8080</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">Pragma</span><span class="punctuation">: </span>no-cache</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-cache</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/plain, */*</span><br><span class="line"><span class="attribute">DNT</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://localhost:8080/</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>JSESSIONID=F8E42F1AC8B9CD46A0F6678DFEB3E9F3</span><br></pre></td></tr></table></figure>
<p>或许，吾辈应该向 axios 提出这个 bug？</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/24e15068f56b4301a650b246ab1e245b/" data-id="ckmcqox2m001u0kuv39jogvth" data-title="js 处理 url 数组参数" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-29567f5fcf764956951cae3c92e5328d" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/29567f5fcf764956951cae3c92e5328d/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/29567f5fcf764956951cae3c92e5328d/">Git 频繁要输入密码的问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>突然就遇到了，每次使用 <code>Git</code> 进行 <code>pull</code>/<code>push</code> 操作时都要输入密码，真是超级麻烦！</p>
<h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>在 <code>Git</code> 服务器上面设置了 <code>SSH</code> 密钥但仍然使用 <code>HTTP/HTTPS</code> 连接就会出现这个问题</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="1-配置一个本地文件记录用户名-密码"><a href="#1-配置一个本地文件记录用户名-密码" class="headerlink" title="1. 配置一个本地文件记录用户名/密码"></a>1. 配置一个本地文件记录用户名/密码</h3><p>进入到 git 根目录下，执行下面的命令即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global credential.helper store</span><br></pre></td></tr></table></figure>
<h3 id="2-使用-SSH-连接"><a href="#2-使用-SSH-连接" class="headerlink" title="2. 使用 SSH 连接"></a>2. 使用 SSH 连接</h3><p>在本机生成一个密钥对（已有的话就不需要了），参见 <a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/47304444/">使用-SSH-连接-Linux-服务器</a>，将密钥对的公钥（<code>id_rsa.pub</code>）配置到你的远程仓库即可。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/settings/keys">GitHub SSH 设置</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/29567f5fcf764956951cae3c92e5328d/" data-id="ckmcqox2o001w0kuv1zw5651r" data-title="Git 频繁要输入密码的问题" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2be94bdac12d4122ad4c51a6dd413c54" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/2be94bdac12d4122ad4c51a6dd413c54/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/2be94bdac12d4122ad4c51a6dd413c54/">手游-ウチの姫-回坑感想</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>多图预警</p>
</blockquote>
<h2 id="缘由"><a href="#缘由" class="headerlink" title="缘由"></a>缘由</h2><p>在月初的周末，吾辈因为最近的 <a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/63bdcead/">一些烦心事</a>，毫无动力的躺在床上做一条无所事事的咸鱼。偶然想起来 4 年前玩过的一个游戏：<a target="_blank" rel="noopener" href="https://pf.goone.tw/">我家公主最可爱</a>，也是吾辈至今唯一玩过的手游，念及于此，便忍不住找了一下，果不其然，国服坟头草已然几丈高了，台服亦然，唯有日服坚持下来了，到了明年便是这个游戏的第 6 个年头了。<br>日服 App 名字的全称是 <strong>ウチの姫さまがいちばんカワイイ　- ひっぱりアクション RPGx 美少女ゲームアプリ</strong>（虽然名字意思仍然和中文一样，但看起来却没那么羞耻了呢，或许是因为看不懂日语的缘故吧），简称 <strong>ウチの姫</strong>。<br>下面是 <a target="_blank" rel="noopener" href="https://play.google.com/store/apps/details?id=jp.co.cyberagent.uh">Google Play 页面</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229210115.png" alt="Google Play 首页截图"></p>
<p>看起来很可爱，所以吾辈想着闲着也是闲着，便轻松加愉快的重新尝试了这个游戏。</p>
<h2 id="玩法"><a href="#玩法" class="headerlink" title="玩法"></a>玩法</h2><p>刚进入游戏首页，便有两个妹纸在抱着一只，嗯，青蛙一样的生物看着我们，而这只青蛙，自然是这个游戏的男主角啦 #笑</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229210505.png" alt="游戏首页"></p>
<p>进入游戏，之后的首页是这样的</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229210833.png" alt="进入游戏后的主页面"></p>
<p>游戏的基本玩法很简单，就是收集公主，然后让（青蛙）王子在公主的帮助下击败魔王的弹珠游戏（然而又是一个无稽之谈 #笑）</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229211410.png" alt="普通回合"></p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229211447.png" alt="Boss 回合"></p>
<p>然后，在打通关卡后，可以获得经验与一些公主，不过大多数都是特殊属性的公主，可以用来强化、进化以及觉醒的一些素材，统称为 <strong>狗粮</strong>（为什么公主被作为狗粮了 #惊哭）</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229211911.png" alt="获得经验"></p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229212030.png" alt="获得公主"></p>
<p>下面是一个公主的属性面板（<code>Status</code> 还是 <code>Properties</code> 呢 #笑）</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229212322.png" alt="属性面板"></p>
<p>可以看到的属性就有</p>
<ul>
<li>所属元素：存在克制关系 <code>光 &lt;=&gt; 暗</code>，<code>火 =&gt; 风 =&gt; 水 =&gt; 火...</code></li>
<li>名字：公主的名字</li>
<li>稀有度：目前真正能用的稀有度依次是 <code>UR/UR+/UR++ =&gt; PUR/PUR+/PUR++ =&gt; XUR</code>，一般而言稀有度越高这张卡的强度可能性就越高</li>
<li>公主自身等级：影响 HP/攻击力</li>
<li>HP：体力值，在副本时计算的是队伍（4 位公主与 1 位外援）的总和，不过没有攻击力对强度影响大</li>
<li>攻击力：攻击力，在副本时仅计算当前活跃公主的攻击力，对强度影响较大，因为 Boss 普遍体力非常高</li>
<li>强度：这张卡在官方眼中的强度，强度高可能不强，但低了一定不强</li>
<li>爱情度：影响 HP/攻击力/技能冷却回合</li>
<li>公主队长技能：作为队长时实用的技能</li>
<li>公主技能：能够持续几回合并有冷却时间的技能</li>
<li>绊技能：在爱情度达到 <code>300</code> 后解锁，一半只能到 <code>200</code></li>
<li>附加能力属性：影响能够强化的附加能力</li>
<li>自带防御：能够防御场上某种类型的陷阱</li>
<li>追加属性：影响 HP/攻击力/攻击时的效果，锁住的话需要使用 <strong>才开</strong> 开锁，<strong>才与</strong> 赋值</li>
<li>爱情度封印：影响附加能力位，爱情度 <code>200/300</code> 会锁住两个附加能力位，必须在爱情度到达之后次啊会解锁</li>
</ul>
<p>是不是感觉太复杂了，吾辈刚进入游戏的时候也是这样想的，所以就去加了一个国内的 QQ 讨论群（居然还有一些人再玩这个游戏呢），以次绕过了新手时期的困惑（虽然不是新手，但已然太久没玩，而且变化也很多）</p>
<h2 id="图鉴"><a href="#图鉴" class="headerlink" title="图鉴"></a>图鉴</h2><p>本质上，这是一个集卡（舔卡 #大雾）游戏</p>
<p>下面是进入游戏必然获得几位公主：<strong>亲女儿（爱姬） + 御三家（红苍翠）</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229220923.png" alt="亲女儿"><br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229220947.png" alt="红"><br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229220959.png" alt="蓝"><br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229221008.png" alt="绿"></p>
<p>然而，还有各种 <strong>卡哇伊</strong> 的公主需要通过活动副本（#肝）/抽奖机制（#氪）获得</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229221354.png" alt="公主 1"><br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229221435.png" alt="公主 2"><br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229221434.png" alt="公主 3"><br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229221433.png" alt="公主 4"><br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229221432.png" alt="公主 5"><br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229221436.png" alt="公主 6"><br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229221431.png" alt="公主 7"></p>
<h2 id="机制"><a href="#机制" class="headerlink" title="机制"></a>机制</h2><p>当然，作为一个手游，那么自然是有体力与扭蛋（抽奖）这两种机制了，下面由吾辈来一一说明</p>
<p>体力值：上限与等级直接挂钩，长久来看，大致是等级的 <code>1/3</code> 左右，每次进入副本消耗体力值，会随着时间逐渐恢复（不会超过体力上限），但也可以用 <strong>月石</strong> 可以增加体力上限的体力值（有可能超过上限）</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229214543.png" alt="副本"></p>
<p>至于为什么吾辈的体力这么多（<code>5972/141</code>），原因便是吾辈连续升级了几十次，每次升级就会增加以此体力上限的体力值，故而才这么多的！当然，这种重复性的工作吾辈作为一个开发者自然是写了一个 AutoJS 脚本自动刷活动，连续两天几乎没停，但也只升了 50 级左右，可见升级的困难了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229215050.png" alt="AutoJS 脚本"></p>
<p>而扭蛋，非洲人什么话都不想说 QAQ，虽然还不到一个月，但游戏里已然氪了接近 3000 的软妹币了，更别说花费的时间与精力了，然而即便如此生存依旧苦难。<br>下面是目前正开着的池子的一些数据</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229215444.png" alt="池子的 XUR 公主"><br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229215604.png" alt="详情 1"><br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229215617.png" alt="详情 2"><br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229215624.png" alt="详情 3"></p>
<p>可以看到，除了第一次，后面每次的抽奖都要 <code>1w</code> 星星，而抽到 XUR 公主的概率。。。不过是 <code>0.01%</code>。那么，1w 星星到底相当于多少软妹币呢？</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191229215910.png" alt="官方商店"></p>
<p>可以看到，即便现在有着额外送 30% 的活动，1w 星星仍然需要接近 1w 日元左右，让我们来计算一下星星的单价吧</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">11000</span> / <span class="number">15431</span> / <span class="number">15.64</span> === <span class="number">0.045578692773257934</span>;</span><br></pre></td></tr></table></figure>
<p>看起来似乎并不多，我们计算一下总价</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0.045578692773257934</span> * (<span class="number">10000</span> * <span class="number">5</span> + <span class="number">5000</span>) === <span class="number">2506.8281025291863</span>;</span><br></pre></td></tr></table></figure>
<p>那么抽 6 次得到 XUR 的概率是？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span> + <span class="number">5</span> * <span class="number">4</span> + <span class="number">10</span> === <span class="number">33</span>;</span><br></pre></td></tr></table></figure>
<p>哦，看起来有点不妙了，仅仅为了一张卡抽 6 次池子，便如此大动干戈，即便如此，获得 XUR 的概率也只有 <code>33%</code>，这。。。(╯‵□′)╯︵┻━┻</p>
<h2 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h2><p>唉，不管怎样，都无法找到曾经为了游戏肝了几天时间，甚至为此压缩睡眠，看到获得了自己想要的公主之后便很快乐的感觉 – 一切都无法回到从前了！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/2be94bdac12d4122ad4c51a6dd413c54/" data-id="ckmcqox2q00230kuvfiashu25" data-title="手游-ウチの姫-回坑感想" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9D%82%E8%B0%88/" rel="tag">杂谈</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2ef7455c12e943e28e35b3ff6c5b2d8f" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/2ef7455c12e943e28e35b3ff6c5b2d8f/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/2ef7455c12e943e28e35b3ff6c5b2d8f/">JavaScript 处理树结构数据</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>前端项目中，有一些需要处理树结构数据的情况，（一年）之前吾辈曾经写过一篇文章，但现在，吾辈有了更好的解决方案。</p>
<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>之前吾辈使用 Proxy 的方式抹平树结构数据的差异，然后再处理。后来吾辈发现这完全是多此一举，在使用过 antd 的 <a target="_blank" rel="noopener" href="https://ant.design/components/tree-cn/">Tree 组件</a>、<a target="_blank" rel="noopener" href="https://deepdash.io/">deepdash</a> 之后，确实第一步是完全没有必要的。</p>
<blockquote>
<p>以下代码均由 TypeScript 实现，最好能了解 <a target="_blank" rel="noopener" href="https://www.typescriptlang.org/docs/handbook/2/types-from-types.html">TypeScript 类型操作</a></p>
</blockquote>
<p>其实树结构数据可以抽象出非常简单的 interface（接口）</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Node &#123;</span><br><span class="line">  id: <span class="built_in">string</span>;</span><br><span class="line">  children: Node[];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>无非是业务中多了一些字段，这两个字段的名字有所不同罢了。</p>
<p>例如系统菜单与系统权限</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> SysMenu &#123;</span><br><span class="line">  id: <span class="built_in">number</span>; <span class="comment">// 菜单 id</span></span><br><span class="line">  name: <span class="built_in">string</span>; <span class="comment">// 显示的名称</span></span><br><span class="line">  sub: SysMenu[]; <span class="comment">// 子级菜单</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> SysPermission &#123;</span><br><span class="line">  uid: <span class="built_in">string</span>; <span class="comment">// 系统唯一 uuid</span></span><br><span class="line">  label: <span class="built_in">string</span>; <span class="comment">// 显示的菜单名</span></span><br><span class="line">  children: SysPermission[]; <span class="comment">// 子权限</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，它们都有 <code>id</code> 和 <code>children</code> 字段，只是名字不同。那么，根据封装不变的部分，将变化的部分交予外部输入的封装原则，这两个字段便由外部指定了。</p>
<h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><p>那么，树结构都有哪些操作呢？</p>
<ul>
<li><code>reduce</code> 归并</li>
<li><code>each</code> 遍历</li>
<li><code>map</code> 映射</li>
<li><code>filter</code> 过滤</li>
<li><code>treeToList</code> 树转换为列表</li>
<li><code>listToTree</code> 列表转换为树</li>
</ul>
<p>然而，吾辈目前用到的仅有 <code>each/map/filter/treeToList</code>，所以先行实现下面几个。</p>
<h2 id="定义通用树结构需要的必须参数类型"><a href="#定义通用树结构需要的必须参数类型" class="headerlink" title="定义通用树结构需要的必须参数类型"></a>定义通用树结构需要的必须参数类型</h2><p>如果树结构必须包含 <code>id/children</code>，那么，便可以以此定义树结构操作的通用参数了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> TreeOption&lt;T <span class="keyword">extends</span> object&gt; &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 唯一标识的字段</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  id: keyof T;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 子节点的字段</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  children: keyof T;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面是一个接口，必须声明 <code>id/children</code> 的字段名是什么，便于内部实现读取树节点信息。</p>
<blockquote>
<p>感谢 TypeScript，没有它就无法定义出类型，就不能检查出代码中的细微错误。例如，Java 就很难定义反射相关的类型，通常只能使用 <code>String</code>。</p>
</blockquote>
<h2 id="treeMap"><a href="#treeMap" class="headerlink" title="treeMap"></a>treeMap</h2><p>下面实现 treeMap，其实就是一个递归函数。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; TreeOption &#125; <span class="keyword">from</span> <span class="string">&quot;./treeOption&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 树结构映射</span></span><br><span class="line"><span class="comment"> * 使用深度优先算法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">nodeList</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">fn</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">options</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">treeMap</span>&lt;</span></span><br><span class="line"><span class="function">  <span class="title">T</span> <span class="title">extends</span> <span class="title">object</span>,</span></span><br><span class="line"><span class="function">  <span class="title">C</span> <span class="title">extends</span> <span class="title">TreeOption</span>&lt;<span class="title">T</span>&gt;,</span></span><br><span class="line"><span class="function">  <span class="title">F</span> <span class="title">extends</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    t: Omit&lt;T, C[<span class="string">&quot;children&quot;</span>]&gt; &amp; Record&lt;C[<span class="string">&quot;children&quot;</span>], ReturnType&lt;F&gt;[]&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">    path: T[C[<span class="string">&quot;id&quot;</span>]][]</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>) =&gt; <span class="title">object</span></span></span><br><span class="line"><span class="function">&gt;(<span class="params">nodeList: T[], fn: F, options: C</span>): <span class="title">ReturnType</span>&lt;<span class="title">F</span>&gt;[] </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">inner</span>(<span class="params">nodeList: T[], parentPath: T[C[<span class="string">&quot;id&quot;</span>]][]</span>): <span class="title">any</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> nodeList.map(<span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> path = [...parentPath, node[options.id]];</span><br><span class="line">      <span class="keyword">const</span> children = (node[options.children] <span class="keyword">as</span> <span class="built_in">any</span>) <span class="keyword">as</span> T[];</span><br><span class="line">      <span class="keyword">if</span> (!children) &#123;</span><br><span class="line">        <span class="keyword">return</span> fn(node <span class="keyword">as</span> <span class="built_in">any</span>, path);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> fn(</span><br><span class="line">        &#123;</span><br><span class="line">          ...node,</span><br><span class="line">          [options.children]: inner(children, path),</span><br><span class="line">        &#125;,</span><br><span class="line">        path</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> inner(nodeList, []);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>不过细心的人可能已经发现，这里做了两个奇怪的操作</p>
<ol>
<li> 先处理了所有子节点，然后将处理后子节点传入到 map 函数中，而非反过来。– 这其实是为了兼容前端框架 react 的 JSX。</li>
<li> 计算了节点的 <code>path</code>，并丢到 map 函数中。– 这是为了能轻松知道当前节点的所有父节点以及层级，便于在有需要时（例如转换为列表）能拿到这个关键信息。</li>
</ol>
<h2 id="treeFilter"><a href="#treeFilter" class="headerlink" title="treeFilter"></a>treeFilter</h2><p>嗯，下面的函数都将基于 treeMap 实现了（#笑）</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; TreeOption &#125; <span class="keyword">from</span> <span class="string">&quot;./treeOption&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; treeMap &#125; <span class="keyword">from</span> <span class="string">&quot;./treeMap&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 过滤一个树节点列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">nodeList</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">fn</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">options</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">treeFilter</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">object</span>, <span class="title">C</span> <span class="title">extends</span> <span class="title">TreeOption</span>&lt;<span class="title">T</span>&gt;&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  nodeList: T[],</span></span></span><br><span class="line"><span class="function"><span class="params">  fn: (t: T, path: T[C[<span class="string">&quot;id&quot;</span>]][]) =&gt; <span class="built_in">boolean</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  options: C</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">T</span>[] </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> treeMap(</span><br><span class="line">    nodeList,</span><br><span class="line">    (node: <span class="built_in">any</span>, path) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> children = (node[options.children] <span class="keyword">as</span> <span class="built_in">any</span>) <span class="keyword">as</span> T[] | <span class="literal">undefined</span>;</span><br><span class="line">      <span class="comment">//如果是错误的节点直接炸掉</span></span><br><span class="line">      <span class="keyword">if</span> (!fn(node <span class="keyword">as</span> T, path)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//如果是叶子节点就返回</span></span><br><span class="line">      <span class="keyword">if</span> (!children) &#123;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//计算所有子节点中不是 null 的子节点</span></span><br><span class="line">      <span class="keyword">const</span> sub = children.filter(<span class="function">(<span class="params">node</span>) =&gt;</span> node !== <span class="literal">null</span>);</span><br><span class="line">      <span class="comment">//如果所有子节点为 null 就炸掉</span></span><br><span class="line">      <span class="keyword">if</span> (sub.length === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...node,</span><br><span class="line">        children: sub,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    options</span><br><span class="line">  ).filter(<span class="function">(<span class="params">node</span>) =&gt;</span> node !== <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面过滤的流程图</p>
<p><img src="https://img.rxliuli.com/20210201130227.svg" alt="treeFilter 流程图.drawio"></p>
<blockquote>
<p><a href="/images/7bbe37eef3ea4084afc72fbeb6ab482d.drawio">原图</a></p>
</blockquote>
<h2 id="treeEach"><a href="#treeEach" class="headerlink" title="treeEach"></a>treeEach</h2><p>同样的，也是基于 treeMap，其实这个就有点乏善可陈了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; TreeOption &#125; <span class="keyword">from</span> <span class="string">&quot;./treeOption&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; treeMap &#125; <span class="keyword">from</span> <span class="string">&quot;./treeMap&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 树结构映射</span></span><br><span class="line"><span class="comment"> * 使用深度优先算法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">nodeList</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">fn</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">options</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">treeEach</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">object</span>, <span class="title">C</span> <span class="title">extends</span> <span class="title">TreeOption</span>&lt;<span class="title">T</span>&gt;&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  nodeList: T[],</span></span></span><br><span class="line"><span class="function"><span class="params">  fn: (t: T, path: T[C[<span class="string">&quot;id&quot;</span>]][]) =&gt; <span class="built_in">void</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  options: C</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  treeMap(</span><br><span class="line">    nodeList,</span><br><span class="line">    (node, path) =&gt; &#123;</span><br><span class="line">      fn(node <span class="keyword">as</span> T, path);</span><br><span class="line">      <span class="keyword">return</span> node;</span><br><span class="line">    &#125;,</span><br><span class="line">    options</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="treeToList"><a href="#treeToList" class="headerlink" title="treeToList"></a>treeToList</h2><p>同上。。。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; TreeOption &#125; <span class="keyword">from</span> <span class="string">&quot;./treeOption&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; treeEach &#125; <span class="keyword">from</span> <span class="string">&quot;./treeEach&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将一个树节点列表压平</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">nodeList</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">options</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">treeToList</span>&lt;</span></span><br><span class="line"><span class="function">  <span class="title">T</span> <span class="title">extends</span> <span class="title">object</span>,</span></span><br><span class="line"><span class="function">  <span class="title">C</span> <span class="title">extends</span> <span class="title">TreeOption</span>&lt;<span class="title">T</span>&gt; &amp; </span>&#123; path: <span class="built_in">string</span> &#125;,</span><br><span class="line">  R <span class="keyword">extends</span> T &amp; &#123; [K <span class="keyword">in</span> C[<span class="string">&quot;path&quot;</span>]]: NonNullable&lt;T[C[<span class="string">&quot;id&quot;</span>]]&gt;[] &#125;</span><br><span class="line">&gt;(nodeList: T[], <span class="attr">options</span>: C): R[] &#123;</span><br><span class="line">  <span class="keyword">const</span> res: R[] = [];</span><br><span class="line">  treeEach(</span><br><span class="line">    nodeList,</span><br><span class="line">    (node, path) =&gt; &#123;</span><br><span class="line">      res.push(&#123; ...node, [options.path]: path &#125; <span class="keyword">as</span> R);</span><br><span class="line">    &#125;,</span><br><span class="line">    options</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><p>那么，下面是一些泥萌可能存在的一些问题，吾辈在此解答，如有其他问题，可直接在下面评论。</p>
<ul>
<li>问：为什么不使用 <a target="_blank" rel="noopener" href="https://deepdash.io/">deepdash</a>？</li>
<li>答：因为它依赖于 lodash，而且提供的 API 也有点复杂。</li>
<li>问：为什么使用深度优先算法？</li>
<li>答：因为需要兼容 web 框架，例如 react，需要将所有的 JSX 子节点计算完成之后传递给父节点。</li>
<li>问：为什么使用递归而非循环实现？</li>
<li>答：这就是个人纯粹喜好了，循环可以获得更好的性能，但绝大多数情况下，性能并不重要，所以吾辈使用了更为直观的递归。</li>
<li>问：为什么使用 TypeScript 实现？</li>
<li>答：因为 TypeScript 的类型系统对于代码使用者更加友好，也能增强可维护性。– 不过由于 TypeScript 的类型系统过于复杂，所以对于新手不太友好，参考 <a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/59cc4e212f694ea78a27cda6e6770974/">TypeScript 类型编程</a></li>
</ul>
<blockquote>
<p>最后，我创建了一个模块 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/@liuli-util/tree">@liuli-util/tree</a> 已经包含了以上功能。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/2ef7455c12e943e28e35b3ff6c5b2d8f/" data-id="ckmcqox2r00260kuv2gu40gyf" data-title="JavaScript 处理树结构数据" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2f6c99a4aeaf44d5905fbfd1c9c6e342" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/2f6c99a4aeaf44d5905fbfd1c9c6e342/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/2f6c99a4aeaf44d5905fbfd1c9c6e342/">vue data 属性中的 this 指向问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>之前在封装 table 组件 <a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/aa3fd9e1/">BasicTableVue</a> 的时候遇到的问题，在 <code>data</code> 属性中无法使用 <code>this.**</code> 调用 <code>methods</code> 中的函数。<br>例如下面的代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicTableData</span> </span>&#123;</span><br><span class="line">  <span class="title">constructor</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">    user = &#123;</span></span><br><span class="line"><span class="params">      name: <span class="string">&quot;rx&quot;</span>,</span></span><br><span class="line"><span class="params">      age: <span class="number">17</span>,</span></span><br><span class="line"><span class="params">    &#125;,</span></span><br><span class="line"><span class="params">  &#125; = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.user = user;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Table</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">&#123; data, methods, mounted, computed &#125;</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(&#123;</span><br><span class="line">      data: _.merge(<span class="keyword">new</span> BasicTableData(), data),</span><br><span class="line">      methods,</span><br><span class="line">      mounted,</span><br><span class="line">      computed,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> table = <span class="keyword">new</span> Table(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    user: &#123;</span><br><span class="line">      birthday: <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">      birthdayFormatter: <span class="built_in">this</span>.calcTime,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="function"><span class="title">calcTime</span>(<span class="params">time</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> time.toISOString();</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将输出 undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(table.user.birthdayFormatter);</span><br></pre></td></tr></table></figure>
<p>吾辈尝试了一下原生的 vuejs，发现这样的 data 仍然不能用。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>后来在官方文档找到了 <a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/api/#data">这里</a>，data 如果是一个对象或者箭头函数时，不会绑定 <code>this</code>，仅当 <code>data</code> 是一个普通函数（使用 <code>function</code> 声明）时，才会被绑定 <code>this</code>。</p>
<p>那么，知道了原因，解决方案就很简单了。</p>
<ol>
<li> 如果需要使用在 <code>data</code> 中使用 <code>this</code> 调用 <code>methods</code> 中的函数，则 <code>data</code> 必须声明为普通函数</li>
<li> 如果需要默认 <code>data</code> <code>defaultData</code>，则 <code>Table</code> 可以将合并后的 <code>data</code> 声明为函数，并将 <code>defaultData</code> 与 <code>data</code>（使用 <code>Table</code> 创建实例时传入的）的返回值合并</li>
</ol>
<p>修改后的代码如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicTableData</span> </span>&#123;</span><br><span class="line">  <span class="title">constructor</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">    user = &#123;</span></span><br><span class="line"><span class="params">      name: <span class="string">&quot;rx&quot;</span>,</span></span><br><span class="line"><span class="params">      age: <span class="number">17</span>,</span></span><br><span class="line"><span class="params">    &#125;,</span></span><br><span class="line"><span class="params">  &#125; = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.user = user;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Table</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">&#123; data, methods, mounted, computed &#125;</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(&#123;</span><br><span class="line">      <span class="comment">// 关键是这里将 data 声明为普通函数</span></span><br><span class="line">      <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 此处为了简洁使用 lodash 的深度合并</span></span><br><span class="line">        <span class="keyword">return</span> _.merge(</span><br><span class="line">          <span class="keyword">new</span> BasicTableData(),</span><br><span class="line">          <span class="comment">// 此处判断 data 是否为函数,是的话就绑定 this 计算结果</span></span><br><span class="line">          <span class="keyword">typeof</span> data === <span class="string">&quot;function&quot;</span> ? data.call(<span class="built_in">this</span>) : data</span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">      methods,</span><br><span class="line">      mounted,</span><br><span class="line">      computed,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> table = <span class="keyword">new</span> Table(&#123;</span><br><span class="line">  data: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      user: &#123;</span><br><span class="line">        birthday: <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">        birthdayFormatter: <span class="built_in">this</span>.calcTime,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="function"><span class="title">calcTime</span>(<span class="params">time</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> time.toISOString();</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打印的结果是</span></span><br><span class="line"><span class="comment">// ƒ calcTime(time) &#123;</span></span><br><span class="line"><span class="comment">//   return time.toISOString()</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(table.user.birthdayFormatter);</span><br></pre></td></tr></table></figure>
<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>现在问题解决了，那么，为什么 <code>vuejs</code> 就能够在传入 <code>data</code> 函数时就能调用 <code>methods</code> 中的函数了呢？吾辈稍微 debug 进入源码看了一下</p>
<ol>
<li><p>创建 <code>Table</code> 进入构造函数<br> <img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190327085616.png" alt="构造函数"></p>
</li>
<li><p>因为继承了 Vue，所以进入 Vue 的构造函数中<br> <img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190327085734.png" alt="进入 Vue 的构造函数中"></p>
</li>
<li><p>因为当前实例属于 Vue，所以进入 <code>_init</code> 进行初始化<br> <img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190327085948.png" alt="进入 _init 初始化"></p>
</li>
<li><p>跳转到 <code>initState(vm);</code> 处，该函数将对 data 属性进行初始化（至于为什么是 state 可能是因为最初就是模仿 react 写的？）<br> <img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190327090323.png" alt="跳转到 initState()"></p>
</li>
<li><p>进入到 <code>initState()</code>，跳转到 <code>initData(vm);</code> 处<br> <img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190327090559.png" alt="initData(vm) 处"></p>
</li>
<li><p>进入到 <code>initData()</code> 函数，看到了判断逻辑<br> <img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190327090946.png" alt="判断逻辑"></p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = vm.$options.data;</span><br><span class="line">data = vm._data =</span><br><span class="line">  <span class="keyword">typeof</span> data === <span class="string">&quot;function&quot;</span> ? getData(data, vm) : data || &#123;&#125;;</span><br></pre></td></tr></table></figure>
<p> 注意看，这里的 vue 内部判断了 data 是否为函数，如果是就去 <code>getData(data, vm)</code></p>
</li>
<li><p>进入 <code>getData()</code> 函数看看，发现了关键代码<br> <img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190327091155.png" alt="关键代码"></p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> data.call(vm, vm);</span><br></pre></td></tr></table></figure>
<p> 是的，data 调用时使用 <code>call</code> 绑定 <code>this</code> 为 vm，而此时 <code>vm.calcTime</code> 已经有值了。</p>
</li>
<li><p>那么，<code>vm.calcTime</code> 是什么时候被初始化的呢？<br> 其实也在 <code>initState</code> 函数中，可以看到，vue 的初始化顺序是</p>
<ol>
<li><p> <code>props</code>: 外部传递的属性</p>
</li>
<li><p> <code>methods</code>: 组件的函数</p>
</li>
<li><p> <code>data</code>: 组件的属性</p>
</li>
<li><p> <code>computed</code>: 计算属性</p>
</li>
<li><p><code>watch</code>: 监听函数</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190327091843.png" alt="初始化顺序"></p>
</li>
</ol>
</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>相比于 react，vue 做了更多的 <strong>黑魔法</strong> 呢！就像 this 指向问题，react 是交由用户自行解决的，而 vue 则在后面偷偷的为函数绑定 this 为 vue 实例本身。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/2f6c99a4aeaf44d5905fbfd1c9c6e342/" data-id="ckmcqox2s00280kuvfqnk8uva" data-title="vue data 属性中的 this 指向问题" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/13/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="page-number" href="/page/13/">13</a><span class="page-number current">14</span><a class="page-number" href="/page/15/">15</a><a class="page-number" href="/page/16/">16</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/15/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/electron/" rel="tag">electron</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grid/" rel="tag">grid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jetbrains/" rel="tag">jetbrains</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/" rel="tag">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/" rel="tag">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/" rel="tag">sql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typescript/" rel="tag">typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vscode/" rel="tag">vscode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webstorm/" rel="tag">webstorm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AA%E4%BA%BA/" rel="tag">个人</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%AC%E5%8F%B8/" rel="tag">公司</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%91%A8%E6%8A%A5/" rel="tag">周报</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%A3%E5%91%8A/" rel="tag">宣告</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">工程化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E6%BA%90/" rel="tag">开源</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%82%E6%AD%A5/" rel="tag">异步</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%85%E6%9B%B4%E6%96%B0/" rel="tag">待更新</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82%E8%B0%88/" rel="tag">杂谈</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BB%8F%E9%AA%8C/" rel="tag">经验</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6/" rel="tag">读书</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">转载</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/css/" style="font-size: 12.14px;">css</a> <a href="/tags/electron/" style="font-size: 15.71px;">electron</a> <a href="/tags/git/" style="font-size: 12.86px;">git</a> <a href="/tags/grid/" style="font-size: 10.71px;">grid</a> <a href="/tags/java/" style="font-size: 19.29px;">java</a> <a href="/tags/javascript/" style="font-size: 20px;">javascript</a> <a href="/tags/jetbrains/" style="font-size: 12.14px;">jetbrains</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/markdown/" style="font-size: 10.71px;">markdown</a> <a href="/tags/react/" style="font-size: 14.29px;">react</a> <a href="/tags/sql/" style="font-size: 14.29px;">sql</a> <a href="/tags/typescript/" style="font-size: 12.14px;">typescript</a> <a href="/tags/vscode/" style="font-size: 12.86px;">vscode</a> <a href="/tags/vue/" style="font-size: 16.43px;">vue</a> <a href="/tags/webstorm/" style="font-size: 10px;">webstorm</a> <a href="/tags/windows/" style="font-size: 17.14px;">windows</a> <a href="/tags/%E4%B8%AA%E4%BA%BA/" style="font-size: 12.86px;">个人</a> <a href="/tags/%E5%85%AC%E5%8F%B8/" style="font-size: 10px;">公司</a> <a href="/tags/%E5%91%A8%E6%8A%A5/" style="font-size: 10px;">周报</a> <a href="/tags/%E5%AE%A3%E5%91%8A/" style="font-size: 10px;">宣告</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 13.57px;">工具</a> <a href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" style="font-size: 17.86px;">工程化</a> <a href="/tags/%E5%BC%80%E6%BA%90/" style="font-size: 10px;">开源</a> <a href="/tags/%E5%BC%82%E6%AD%A5/" style="font-size: 15px;">异步</a> <a href="/tags/%E5%BE%85%E6%9B%B4%E6%96%B0/" style="font-size: 10.71px;">待更新</a> <a href="/tags/%E6%9D%82%E8%B0%88/" style="font-size: 18.57px;">杂谈</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a> <a href="/tags/%E7%BB%8F%E9%AA%8C/" style="font-size: 11.43px;">经验</a> <a href="/tags/%E8%AF%BB%E4%B9%A6/" style="font-size: 12.14px;">读书</a> <a href="/tags/%E8%BD%AC%E8%BD%BD/" style="font-size: 11.43px;">转载</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/14/8fb2d58463ae4191ac064a76e15bffbd/">2021 第十周</a>
          </li>
        
          <li>
            <a href="/2021/03/12/7e7131c07c984d928ba3fefa7a9cef06/">读书-[颓废与沉默：透视犬儒文化]</a>
          </li>
        
          <li>
            <a href="/2021/03/02/db74e6e5d2444bc3b6e185a7b338bbf6/">electron 开发经验之谈系列-在渲染、主进程间共享数据</a>
          </li>
        
          <li>
            <a href="/2021/02/27/06cb464179cf45c598208534705aae3c/">2020 吾辈在公司推动的前端技术演进</a>
          </li>
        
          <li>
            <a href="/2021/02/23/cd66150d2b86448590fcc9bb2419c0b2/">实践 lerna monorepo</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>