<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/16/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-6b5a7a1341d14bf7bd0da7e10321f2ff" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/6b5a7a1341d14bf7bd0da7e10321f2ff/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/6b5a7a1341d14bf7bd0da7e10321f2ff/">JavaScript 使用递归异步的请求</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>之前写了个 <code>user.js</code> 脚本来抓取百度网盘的文件元信息列表，用来进行二级查看和分析,脚本放到了 <a target="_blank" rel="noopener" href="https://greasyfork.org/zh-CN/scripts/375701">GreasyFork</a>。最开始为了简化代码直接使用了 <code>async/await</code> 单线程进行异步请求，导致请求的速度十分不理想！<br>关键代码如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文件数据信息类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 构造函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>path 全路径</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>parent 父级路径</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>name 文件名</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>size 大小(b)</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>isdir 是否为文件</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;String&#125;</span> <span class="type">&#123;origin&#125;</span> </span>百度云文件信息的源对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">path, parent, name, size, isdir, origin</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.path = path;</span><br><span class="line">    <span class="built_in">this</span>.parent = parent;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.size = size;</span><br><span class="line">    <span class="built_in">this</span>.isdir = isdir;</span><br><span class="line">    <span class="built_in">this</span>.orgin = origin;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取指定文件夹下的一级文件/文件夹列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>path 绝对路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Promise&#125;</span> </span>文件/文件夹列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getDir</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> baseUrl = <span class="string">&quot;https://pan.baidu.com/api/list?&quot;</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> res = <span class="keyword">await</span> fetch(<span class="string">`<span class="subst">$&#123;baseUrl&#125;</span>dir=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(path)&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">var</span> json = <span class="keyword">await</span> res.json();</span><br><span class="line">    <span class="keyword">return</span> json.list;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`读取文件夹 <span class="subst">$&#123;path&#125;</span> 发生了错误：`</span>, err);</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将数组异步压平一层</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>arr 数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>fn 映射方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncFlatMap</span>(<span class="params">arr, fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> res = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> arr) &#123;</span><br><span class="line">    res.push(...(<span class="keyword">await</span> fn(arr[i])));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 递归获取到所有的子级文件/文件夹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>path 指定获取的文件夹路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Array&#125;</span> </span>指定文件夹下所有的文件/文件夹列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">syncList</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> fileList = <span class="keyword">await</span> getDir(path);</span><br><span class="line">  <span class="keyword">return</span> asyncFlatMap(fileList, <span class="keyword">async</span> (file) =&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> res = <span class="keyword">new</span> File(</span><br><span class="line">      file.path,</span><br><span class="line">      path,</span><br><span class="line">      file.server_filename,</span><br><span class="line">      file.size,</span><br><span class="line">      file.isdir,</span><br><span class="line">      file</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">if</span> (res.isdir !== <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> [res];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [res].concat(<span class="keyword">await</span> syncList(res.path));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，使用的方式是 <code>递归 + 单异步</code>，这就导致了脚本的效率不高，使用体验很差！</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>吾辈想要使用多异步模式，需要解决的问题有二：</p>
<ul>
<li>如何知道现在有多个异步在执行并且在数量过多时等待</li>
<li>如何知道所有的请求都执行完成了然后结束</li>
</ul>
<p>解决思路</p>
<ol>
<li>判断并限定异步的数量<ol>
<li> 添加记录正在执行的异步请求的计数器 <code>execQueue</code></li>
<li>每次请求前先检查 <code>execQueue</code> 是否到达限定值<ul>
<li>如果没有，<code>execQueue + 1</code></li>
<li>如果有，等待 <code>execQueue</code> 减小</li>
</ul>
</li>
<li> 执行请求，请求结束 <code>execQueue - 1</code></li>
</ol>
</li>
<li>判断所有请求都执行完成<ol>
<li> 添加记录正在等待的异步请求的计数器 <code>waitQueue</code></li>
<li> 在判断 <code>execQueue</code> 是否到达限定值之前 <code>waitQueue + 1</code></li>
<li> 在判断 <code>execQueue</code> 是否到达限定值之后（等待之后） <code>waitQueue - 1</code></li>
<li>请求结束后判断 <code>waitQueue</code> 和 <code>waitQueue</code> 是否均为 <code>0</code><ul>
<li>是：返回结果</li>
<li>否：什么都不做</li>
</ul>
</li>
</ol>
</li>
</ol>
<p>具体实现如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文件数据信息类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 构造函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>path 全路径</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>parent 父级路径</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>name 文件名</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>size 大小(b)</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>isdir 是否为文件</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;String&#125;</span> <span class="type">&#123;origin&#125;</span> </span>百度云文件信息的源对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">path, parent, name, size, isdir, origin</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.path = path;</span><br><span class="line">    <span class="built_in">this</span>.parent = parent;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.size = size;</span><br><span class="line">    <span class="built_in">this</span>.isdir = isdir;</span><br><span class="line">    <span class="built_in">this</span>.orgin = origin;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 等待指定的时间/等待指定表达式成立</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number|Function&#125;</span> </span>param 等待时间/等待条件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Promise&#125;</span> </span>Promise 对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wait</span>(<span class="params">param</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> param === <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(resolve, param);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> param === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (param()) &#123;</span><br><span class="line">          <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">          resolve();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="number">100</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取指定文件夹下的一级文件/文件夹列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>path 绝对路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Promise&#125;</span> </span>文件/文件夹列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getDir</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> baseUrl = <span class="string">&quot;https://pan.baidu.com/api/list?&quot;</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> res = <span class="keyword">await</span> fetch(<span class="string">`<span class="subst">$&#123;baseUrl&#125;</span>dir=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(path)&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">var</span> json = <span class="keyword">await</span> res.json();</span><br><span class="line">    <span class="keyword">return</span> json.list;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`读取文件夹 <span class="subst">$&#123;path&#125;</span> 发生了错误：`</span>, err);</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 递归获取所有文件/文件夹</span></span><br><span class="line"><span class="comment"> * 测试获取 34228 条数据</span></span><br><span class="line"><span class="comment"> * - 100 线程：156518ms</span></span><br><span class="line"><span class="comment"> * - 5   线程：220500ms</span></span><br><span class="line"><span class="comment"> * - 1   线程：超过 20min</span></span><br><span class="line"><span class="comment"> * 实现：</span></span><br><span class="line"><span class="comment"> * 1. 请求文件夹下的所有文件/文件夹</span></span><br><span class="line"><span class="comment"> * 2. 如果是文件则直接添加到结果数组中</span></span><br><span class="line"><span class="comment"> * 3. 如果是文件夹则递归调用当前方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>[path] 指定文件夹，默认为根路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>[limit] 指定限定异步数量，默认为 5</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Promise&#125;</span> </span>异步对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncList</span>(<span class="params">path = <span class="string">&quot;/&quot;</span>, limit = <span class="number">5</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> execCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> waitQueue = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 结果数组</span></span><br><span class="line">    <span class="keyword">var</span> result = [];</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">children</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">      waitQueue++;</span><br><span class="line">      <span class="keyword">await</span> wait(<span class="function">() =&gt;</span> execCount &lt; limit);</span><br><span class="line">      waitQueue--;</span><br><span class="line">      execCount++;</span><br><span class="line">      getDir(path).then(<span class="function">(<span class="params">fileList</span>) =&gt;</span> &#123;</span><br><span class="line">        fileList.forEach(<span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">var</span> res = <span class="keyword">new</span> File(</span><br><span class="line">            file.path,</span><br><span class="line">            path,</span><br><span class="line">            file.server_filename,</span><br><span class="line">            file.size,</span><br><span class="line">            file.isdir,</span><br><span class="line">            file</span><br><span class="line">          );</span><br><span class="line">          result.push(res);</span><br><span class="line">          <span class="keyword">if</span> (res.isdir === <span class="number">1</span>) &#123;</span><br><span class="line">            children(res.path);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">if</span> (--execCount === <span class="number">0</span> &amp;&amp; waitQueue === <span class="number">0</span>) &#123;</span><br><span class="line">          resolve(result);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    children(path);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>吾辈使用 <code>timing</code> 函数测试了一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试函数的执行时间</span></span><br><span class="line"><span class="comment"> * 注：如果函数返回 Promise，则该函数也会返回 Promise，否则直接返回执行时间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>需要测试的函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Number|Promise&#125;</span> </span>执行的毫秒数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timing</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> begin = performance.now();</span><br><span class="line">  <span class="keyword">var</span> result = fn();</span><br><span class="line">  <span class="keyword">if</span> (!(result <span class="keyword">instanceof</span> <span class="built_in">Promise</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> performance.now() - begin;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result.then(<span class="function">() =&gt;</span> performance.now() - begin);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请求了 <code>2028</code> 次，两个函数的性能比较如下（单位是毫秒）</p>
<ul>
<li><code>asyncList</code>：109858.80000004545</li>
<li><code>syncList</code>：451904.3000000529</li>
</ul>
<p>差距近 4.5 倍，几乎等同于默认的异步倍数了，看起来优化还是很值得呢！</p>
<blockquote>
<p>附：其实 <code>asyncList</code> 如果使用单异步的话效率反而更低，因为要做一些额外的判断导致单次请求更慢，但因为多个异步请求同时执行的缘故因此缺点被弥补了</p>
</blockquote>
<hr>
<p>那么，关于 JavaScript 使用递归异步的请求就到这里啦</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/6b5a7a1341d14bf7bd0da7e10321f2ff/" data-id="ckmcqox3n004l0kuvbddh1mce" data-title="JavaScript 使用递归异步的请求" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BC%82%E6%AD%A5/" rel="tag">异步</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-71347fe5e29a4c5d8ee8baa8d9d1bc1f" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/71347fe5e29a4c5d8ee8baa8d9d1bc1f/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/71347fe5e29a4c5d8ee8baa8d9d1bc1f/">使用 vue-cli 创建模板项目</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>吾辈曾经只是个 Java 后端开发人员，原本对前端的了解大致只有 <code>HTML/CSS/JavaScript/JQuery</code> 级别，后来接触到了 <code>nodejs</code>。不仅是工作之需，吾辈个人而言也非常想要了解现代前端技术。然而天可怜见，吾辈刚入门 <code>nodejs</code> 并没有发现什么，但发现想要构建一个项目，需要用到前端工具链实在太多了。配置文件的数量甚至远远超过后端。<br>所以为了快速开发，入门之后遇到问题再去解决，吾辈选择了使用 <code>nodejs + npm + vuejs + webpack + vscode</code> 组合，使用 <code>vue-cli</code> 快速搭建一个基于现代前端工具链前端项目。</p>
<blockquote>
<p>致那些想要了解前端但又不得其门的后端开发者，第一步的入门是最重要/最困难的。</p>
</blockquote>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><h3 id="前置要求"><a href="#前置要求" class="headerlink" title="前置要求"></a>前置要求</h3><p>想要继续向下阅读的话请务必确认你的 PC 上已经正确安装了 nodejs/npm，如果还未曾安装，请参考 <a target="_blank" rel="noopener" href="https://nodejs.org/">nodejs 官网</a> 进行安装</p>
<blockquote>
<p><code>npm</code> 已经默认包含在 <code>nodejs</code> 中了</p>
</blockquote>
<h3 id="第一步：全局安装-vue-cli"><a href="#第一步：全局安装-vue-cli" class="headerlink" title="第一步：全局安装 vue-cli"></a>第一步：全局安装 vue-cli</h3><p>打开命令行，安装 <code>vue-cli</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g @vue/cli</span><br></pre></td></tr></table></figure>
<p>安装完成后在命令行输入 <code>vue</code> 应该会有类似于以下的输出</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20181108140401.png" alt="vue-cli 安装完成验证"></p>
<h3 id="第二步：使用模板初始化一个项目"><a href="#第二步：使用模板初始化一个项目" class="headerlink" title="第二步：使用模板初始化一个项目"></a>第二步：使用模板初始化一个项目</h3><p>命令格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># option 是选项，template 是使用的模板，app-name 是要初始化项目的名字</span></span><br><span class="line">vue init [option] &lt;template&gt; &lt;app-name&gt;</span><br></pre></td></tr></table></figure>
<p>例如我们使用 <code>vue init webpack vue-webpack-example</code> 初始化一个 <code>webpack</code> 模板的项目，大部分组件我们暂时还不需要，所以选择 <code>vue-router</code> 以及使用 <code>npm</code> 进行构建。</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20181108141449.png" alt="vue-cli 初始化 webpack 模板项目"></p>
<p>初始化完成后我们在命令行进入文件夹 <em>vue-webpack-example</em> 中，现在我们可以通过 <code>npm run dev</code> 启动开发服务器模式和 <code>npm run build</code> 打包项目为静态文件</p>
<p>尝试使用 <code>npm run dev</code> 运行项目，最后应该会得到如下输出</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20181108184122.png" alt="vue 项目运行输出"></p>
<p>在浏览器打开链接 <a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20181108184257.png" alt="vue 项目模板"></p>
<h3 id="第三步：初始化模板的一些坑"><a href="#第三步：初始化模板的一些坑" class="headerlink" title="第三步：初始化模板的一些坑"></a>第三步：初始化模板的一些坑</h3><p>当你使用 <code>npm run build</code> 打包好静态文件在 <em>dist</em> 目录后，从文件管理器直接运行，却发现浏览器只有一片空白。</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20181108185531.png" alt="vue 打包出来的文件在浏览器显示的空白页面"></p>
<p>这是 <code>vue-cli</code> 默认模板的问题，具体原因与解决方案请参考 <a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/7d805fde/">Vue 打包的静态文件不能直接运行</a></p>
<p>那么，这篇使用 <code>vue-cli</code> 简单的建立项目就到这里啦，希望各位后端开发者都能尝试有趣的现代前端呢 -(๑☆‿ ☆#)ᕗ</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/71347fe5e29a4c5d8ee8baa8d9d1bc1f/" data-id="ckmcqox3p004s0kuv844a72d7" data-title="使用 vue-cli 创建模板项目" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-7f5ad4f08965426f87bc7901e174066c" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/7f5ad4f08965426f87bc7901e174066c/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/7f5ad4f08965426f87bc7901e174066c/">JavaScript 实现更多数组的高阶函数</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><blockquote>
<p>虽说人人平等，但有些人更加平等。</p>
</blockquote>
<p>为什么有了 Lodash 这种通用函数工具库，吾辈要写这篇文章呢？吾辈在 SegmentFault 上经常看到关于 JavaScript 数组的相关疑问，甚至于，相同类型的问题，只是数据变化了一些，就直接提出了一个新的问题（实际上，对自身并无帮助）。简单<a target="_blank" rel="noopener" href="https://segmentfault.com/search?q=Array&type=question">搜索了一下 Array</a>，居然有 2360+ 条的结果，足可见这类问题的频率之高。若是有一篇适合 JavaScript 萌新阅读的自己实现数组更多操作的文章，情况或许会发生一些变化。</p>
<p>下面吾辈便来实现以下几种常见的操作</p>
<ul>
<li><code>uniqueBy</code>: 去重</li>
<li><code>sortBy</code>: 排序</li>
<li><code>filterItems</code>: 过滤掉一些元素</li>
<li><code>diffBy</code>: 差异</li>
<li><code>groupBy</code>: 分组</li>
<li><code>arrayToMap</code>: Array 转换为 Map</li>
<li>递归操作</li>
</ul>
<blockquote>
<p>前言:<br>你至少需要了解 ES6 的一些特性你才能愉快的阅读</p>
</blockquote>
<h2 id="uniqueBy-去重"><a href="#uniqueBy-去重" class="headerlink" title="uniqueBy: 去重"></a><code>uniqueBy</code>: 去重</h2><p>相关问题</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000002674331">javascript 怎么实现多种数据类型的数组去重？</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000010936175">JS 有没有比较高效的数组去重的方法？</a></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * js 的数组去重方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>arr 要进行去重的数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>kFn 唯一标识元素的方法，默认使用 &#123;<span class="doctag">@link </span>returnItself&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span>进行去重操作之后得到的新的数组 (原数组并未改变)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">uniqueBy</span>(<span class="params">arr, kFn = (val) =&gt; val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>();</span><br><span class="line">  <span class="keyword">return</span> arr.filter(<span class="function">(<span class="params">v, ...args</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> k = kFn(v, ...args);</span><br><span class="line">    <span class="keyword">if</span> (set.has(k)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    set.add(k);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(uniqueBy([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>])); <span class="comment">// [ 1, 2, 3, &#x27;1&#x27;, &#x27;2&#x27; ]</span></span><br><span class="line"><span class="built_in">console</span>.log(uniqueBy([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>], <span class="function">(<span class="params">i</span>) =&gt;</span> i + <span class="string">&quot;&quot;</span>)); <span class="comment">// [ 1, 2, 3 ]</span></span><br></pre></td></tr></table></figure>
<h2 id="sortBy-排序"><a href="#sortBy-排序" class="headerlink" title="sortBy: 排序"></a><code>sortBy</code>: 排序</h2><p>相关问题</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000014304039">js 中如何对含有特殊字符的数组进行排序？</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000017141566">以下数组怎么按名称排序</a></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 快速根据指定函数对数组进行排序</span></span><br><span class="line"><span class="comment"> * 注: 使用递归实现，对于超大数组（其实前端的数组不可能特别大吧？#笑）可能造成堆栈溢出</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>arr 需要排序的数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>kFn 对数组中每个元素都产生可比较的值的函数，默认返回自身进行比较</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span>排序后的新数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sortBy</span>(<span class="params">arr, kFn = (v) =&gt; v</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// TODO 此处为了让 typedoc 能生成文档而不得不加上类型</span></span><br><span class="line">  <span class="keyword">const</span> newArr = arr.map(<span class="function">(<span class="params">v, i</span>) =&gt;</span> [v, i]);</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">_sort</span>(<span class="params">arr, fn</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 边界条件，如果传入数组的值</span></span><br><span class="line">    <span class="keyword">if</span> (arr.length &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> arr;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 根据中间值对数组分治为两个数组</span></span><br><span class="line">    <span class="keyword">const</span> medianIndex = <span class="built_in">Math</span>.floor(arr.length / <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">const</span> medianValue = arr[medianIndex];</span><br><span class="line">    <span class="keyword">const</span> left = [];</span><br><span class="line">    <span class="keyword">const</span> right = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = arr.length; i &lt; len; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (i === medianIndex) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> v = arr[i];</span><br><span class="line">      <span class="keyword">if</span> (fn(v, medianValue) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        left.push(v);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        right.push(v);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _sort(left, fn).concat([medianValue]).concat(_sort(right, fn));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> _sort(newArr, <span class="function">(<span class="params">[t1, i1], [t2, i2]</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> k1 = kFn(t1, i1, arr);</span><br><span class="line">    <span class="keyword">const</span> k2 = kFn(t2, i2, arr);</span><br><span class="line">    <span class="keyword">if</span> (k1 === k2) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (k1 &lt; k2) &#123;</span><br><span class="line">      <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).map(<span class="function">(<span class="params">[_v, i]</span>) =&gt;</span> arr[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(sortBy([<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>])); <span class="comment">// [ 1, 2, 3, 4, 5 ]</span></span><br><span class="line"><span class="built_in">console</span>.log(sortBy([<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;4&quot;</span>])); <span class="comment">// [ 1, &#x27;2&#x27;, 3, &#x27;4&#x27;, 5 ]</span></span><br><span class="line"><span class="built_in">console</span>.log(sortBy([<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;4&quot;</span>], <span class="function">(<span class="params">i</span>) =&gt;</span> -i)); <span class="comment">// [ 5, &#x27;4&#x27;, 3, &#x27;2&#x27;, 1 ]</span></span><br></pre></td></tr></table></figure>
<h2 id="filterItems-过滤掉一些元素"><a href="#filterItems-过滤掉一些元素" class="headerlink" title="filterItems: 过滤掉一些元素"></a><code>filterItems</code>: 过滤掉一些元素</h2><p>相关问题</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000009045163">过滤数组子集</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000017464256">对比两组对象数组 根据元素内某一属性是否相等过滤数组</a></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从数组中移除指定的元素</span></span><br><span class="line"><span class="comment"> * 注: 时间复杂度为 1~3On</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>arr 需要被过滤的数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>deleteItems 要过滤的元素数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>kFn 每个元素的唯一键函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filterItems</span>(<span class="params">arr, deleteItems, kFn = (v) =&gt; v</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> kSet = <span class="keyword">new</span> <span class="built_in">Set</span>(deleteItems.map(kFn));</span><br><span class="line">  <span class="keyword">return</span> arr.filter(<span class="function">(<span class="params">v, i, arr</span>) =&gt;</span> !kSet.has(kFn(v, i, arr)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(filterItems([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>])); <span class="comment">// [ 3, 4, 5 ]</span></span><br><span class="line"><span class="built_in">console</span>.log(filterItems([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], [<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>], <span class="function">(<span class="params">i</span>) =&gt;</span> i + <span class="string">&quot;&quot;</span>)); <span class="comment">// [ 3, 4, 5 ]</span></span><br></pre></td></tr></table></figure>
<h2 id="diffBy-差异"><a href="#diffBy-差异" class="headerlink" title="diffBy: 差异"></a><code>diffBy</code>: 差异</h2><p>相关问题</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000019019878">JS 求两个对象数组的差集</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000008825206">JavaScript 数组系列问题：数组差集</a></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 比较两个数组的差异</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>left 第一个数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>right 第二个数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>kFn 每个元素的唯一标识产生函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span>比较的差异结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">diffBy</span>(<span class="params">left, right, kFn = (v) =&gt; v</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 首先得到两个 kSet 集合用于过滤</span></span><br><span class="line">  <span class="keyword">const</span> kThanSet = <span class="keyword">new</span> <span class="built_in">Set</span>(left.map(kFn));</span><br><span class="line">  <span class="keyword">const</span> kThatSet = <span class="keyword">new</span> <span class="built_in">Set</span>(right.map(kFn));</span><br><span class="line">  <span class="keyword">const</span> leftUnique = left.filter(</span><br><span class="line">    (v, ...args) =&gt; !kThatSet.has(kFn(v, ...args))</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">const</span> rightUnique = right.filter(</span><br><span class="line">    (v, ...args) =&gt; !kThanSet.has(kFn(v, ...args))</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">const</span> kLeftSet = <span class="keyword">new</span> <span class="built_in">Set</span>(leftUnique.map(kFn));</span><br><span class="line">  <span class="keyword">const</span> common = left.filter(<span class="function">(<span class="params">v, ...args</span>) =&gt;</span> !kLeftSet.has(kFn(v, ...args)));</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">left</span>: leftUnique, <span class="attr">right</span>: rightUnique, common &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(diffBy([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])); <span class="comment">// &#123; left: [ 1 ], right: [ 4 ], common: [ 2, 3 ] &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(diffBy([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="string">&quot;2&quot;</span>, <span class="number">3</span>, <span class="number">4</span>])); <span class="comment">// &#123; left: [ 1, 2 ], right: [ &#x27;2&#x27;, 4 ], common: [ 3 ] &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(diffBy([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="string">&quot;2&quot;</span>, <span class="number">3</span>, <span class="number">4</span>], <span class="function">(<span class="params">i</span>) =&gt;</span> i + <span class="string">&quot;&quot;</span>)); <span class="comment">// &#123; left: [ 1 ], right: [ 4 ], common: [ 2, 3 ] &#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="groupBy-分组"><a href="#groupBy-分组" class="headerlink" title="groupBy: 分组"></a><code>groupBy</code>: 分组</h2><p>相关问题</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000004944432">求一个数组按属性分组的方法</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000008789413">js 数组分组？</a></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * js 数组按照某个条件进行分组</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>arr 要进行分组的数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>kFn 元素分组的唯一标识函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>vFn 元素分组的值处理的函数。第一个参数是累计值，第二个参数是当前正在迭代的元素，如果你使用过 &#123;<span class="doctag">@link </span>Array#reduce&#125; 函数的话应该对此很熟悉</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>init 每个分组的产生初始值的函数。类似于 reduce 的初始值，但它是一个函数，避免初始值在所有分组中进行累加。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span>元素标识 =&gt; 数组映射 Map</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">groupBy</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  arr,</span></span></span><br><span class="line"><span class="function"><span class="params">  kFn = (v) =&gt; v,</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="comment">/**</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="comment">   * 默认的值处理函数</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="comment">   * <span class="doctag">@param </span>res 最终 V 集合</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="comment">   * <span class="doctag">@param </span>item 当前迭代的元素</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="comment">   * <span class="doctag">@returns </span>将当前元素合并后的最终 V 集合</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="comment">   */</span></span></span></span><br><span class="line"><span class="function"><span class="params">  vFn = (res, item) =&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    res.push(item);</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">return</span> res;</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">  init = () =&gt; []</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 将元素按照分组条件进行分组得到一个 条件 -&gt; 数组 的对象</span></span><br><span class="line">  <span class="keyword">return</span> arr.reduce(<span class="function">(<span class="params">res, item, index, arr</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> k = kFn(item, index, arr);</span><br><span class="line">    <span class="comment">// 如果已经有这个键了就直接追加, 否则先将之初始化再追加元素</span></span><br><span class="line">    <span class="keyword">if</span> (!res.has(k)) &#123;</span><br><span class="line">      res.set(k, init());</span><br><span class="line">    &#125;</span><br><span class="line">    res.set(k, vFn(res.get(k), item, index, arr));</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;, <span class="keyword">new</span> <span class="built_in">Map</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(groupBy([<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>], <span class="function">(<span class="params">i</span>) =&gt;</span> i)); <span class="comment">// Map &#123; 1 =&gt; [ 1 ],  2 =&gt; [ 2, 2, 2 ],  4 =&gt; [ 4, 4 ],  5 =&gt; [ 5, 5 ],  6 =&gt; [ 6 ] &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(groupBy([<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>], <span class="function">(<span class="params">i</span>) =&gt;</span> i % <span class="number">2</span> === <span class="number">0</span>)); <span class="comment">// Map &#123; false =&gt; [ 1, 5, 5 ], true =&gt; [ 2, 2, 2, 4, 4, 6 ] &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">  groupBy(</span><br><span class="line">    [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>],</span><br><span class="line">    (i) =&gt; i % <span class="number">2</span> === <span class="number">0</span>,</span><br><span class="line">    (res, i) =&gt; res.add(i),</span><br><span class="line">    () =&gt; <span class="keyword">new</span> <span class="built_in">Set</span>()</span><br><span class="line">  )</span><br><span class="line">); <span class="comment">// Map &#123; false =&gt; Set &#123; 1, 5 &#125;, true =&gt; Set &#123; 2, 4, 6 &#125; &#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="arrayToMap-转换为-Map"><a href="#arrayToMap-转换为-Map" class="headerlink" title="arrayToMap: 转换为 Map"></a><code>arrayToMap</code>: 转换为 Map</h2><p>相关问题</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000019537004">js 怎么把数组下面的对象里面的两个字段取出来组成一个新的对象，key:value 形式</a></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将数组映射为 Map</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>arr 数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>k 产生 Map 元素唯一标识的函数，或者对象元素中的一个属性名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>v 产生 Map 值的函数，默认为返回数组的元素，或者对象元素中的一个属性名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span>映射产生的 map 集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">arrayToMap</span>(<span class="params">arr, k, v = (val) =&gt; val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> kFn = k <span class="keyword">instanceof</span> <span class="built_in">Function</span> ? k : <span class="function">(<span class="params">item</span>) =&gt;</span> <span class="built_in">Reflect</span>.get(item, k);</span><br><span class="line">  <span class="keyword">const</span> vFn = v <span class="keyword">instanceof</span> <span class="built_in">Function</span> ? v : <span class="function">(<span class="params">item</span>) =&gt;</span> <span class="built_in">Reflect</span>.get(item, v);</span><br><span class="line">  <span class="keyword">return</span> arr.reduce(</span><br><span class="line">    (res, item, index, arr) =&gt;</span><br><span class="line">      res.set(kFn(item, index, arr), vFn(item, index, arr)),</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> county_list = [</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="number">1</span>,</span><br><span class="line">    code: <span class="string">&quot;110101&quot;</span>,</span><br><span class="line">    name: <span class="string">&quot;东城区&quot;</span>,</span><br><span class="line">    citycode: <span class="string">&quot;110100&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="number">2</span>,</span><br><span class="line">    code: <span class="string">&quot;110102&quot;</span>,</span><br><span class="line">    name: <span class="string">&quot;西城区&quot;</span>,</span><br><span class="line">    citycode: <span class="string">&quot;110100&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="number">3</span>,</span><br><span class="line">    code: <span class="string">&quot;110103&quot;</span>,</span><br><span class="line">    name: <span class="string">&quot;崇文区&quot;</span>,</span><br><span class="line">    citycode: <span class="string">&quot;110100&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"><span class="built_in">console</span>.log(arrayToMap(county_list, <span class="string">&quot;code&quot;</span>, <span class="string">&quot;name&quot;</span>)); <span class="comment">// Map &#123; &#x27;110101&#x27; =&gt; &#x27;东城区&#x27;, &#x27;110102&#x27; =&gt; &#x27;西城区&#x27;, &#x27;110103&#x27; =&gt; &#x27;崇文区&#x27; &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">  arrayToMap(</span><br><span class="line">    county_list,</span><br><span class="line">    (&#123; code &#125;) =&gt; code,</span><br><span class="line">    (&#123; name &#125;) =&gt; name</span><br><span class="line">  )</span><br><span class="line">); <span class="comment">// Map &#123; &#x27;110101&#x27; =&gt; &#x27;东城区&#x27;, &#x27;110102&#x27; =&gt; &#x27;西城区&#x27;, &#x27;110103&#x27; =&gt; &#x27;崇文区&#x27; &#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h2><p>相关问题</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000018502694">复杂数组去重</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000000444289">JavaScript 数组中包含数组如何去重？</a></li>
</ul>
<p>以上种种操作皆是对一层数组进行操作，如果我们想对嵌套数组进行操作呢？例如上面这两个问题？其实问题是类似的，只是递归遍历数组而已。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * js 的数组递归去重方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>arr 要进行去重的数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>kFn 唯一标识元素的方法，默认使用 &#123;<span class="doctag">@link </span>returnItself&#125;，只对非数组元素生效</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span>进行去重操作之后得到的新的数组 (原数组并未改变)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepUniqueBy</span>(<span class="params">arr, kFn = (val) =&gt; val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>();</span><br><span class="line">  <span class="keyword">return</span> arr.reduce(<span class="function">(<span class="params">res, v, i, arr</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(v)) &#123;</span><br><span class="line">      res.push(deepUniqueBy(v));</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> k = kFn(v, i, arr);</span><br><span class="line">    <span class="keyword">if</span> (!set.has(k)) &#123;</span><br><span class="line">      set.add(k);</span><br><span class="line">      res.push(v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;, []);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> testArr = [</span><br><span class="line">  <span class="number">1</span>,</span><br><span class="line">  <span class="number">1</span>,</span><br><span class="line">  <span class="number">3</span>,</span><br><span class="line">  <span class="string">&quot;hello&quot;</span>,</span><br><span class="line">  [<span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="string">&quot;hello&quot;</span>, <span class="string">&quot;5&quot;</span>, [<span class="number">5</span>, <span class="number">5</span>, [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;r&quot;</span>]]],</span><br><span class="line">  &#123;</span><br><span class="line">    key: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="number">4</span>,</span><br><span class="line">  [<span class="number">3</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">];</span><br><span class="line"><span class="built_in">console</span>.log(deepUniqueBy(testArr)); <span class="comment">// [ 1,  3,  &#x27;hello&#x27;,  [ 3, 4, &#x27;hello&#x27;, &#x27;5&#x27;, [ 5, [Object] ] ],  &#123; key: &#x27;test&#x27; &#125;,  4,  [ 3, 0, 2 ] ]</span></span><br></pre></td></tr></table></figure>
<h2 id="反例"><a href="#反例" class="headerlink" title="反例"></a>反例</h2><p>事实上，目前 SegmentFault 上存在着大量低质量且重复的问题及回答，关于这点确实比不上 StackOverflow。下面是两个例子，可以看一下能否发现什么问题</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000019537004">js 怎么把数组下面的对象里面的两个字段取出来组成一个新的对象，key:value 形式</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000017490985">JS 中处理 JSON 数据重复问题，取出里面 name 字段数值相同的作为一个数组；不相同的作为一个数组？</a></li>
</ul>
<p>事实上，不管是问题还是答案，都没有突出核心 – <strong>Array 映射为 Map/Array 分组</strong>，而且这种问题和答案还层出不穷。如果对 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array">Array 的 API</a> 都没有看过一遍就来询问的话，对于帮助者来说却是太失礼了！</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>JavaScript 对函数式编程支持很好，所以习惯高阶函数于我们而言是一件好事，将问题的本质抽离出来，而不是每次都局限于某个具体的问题上。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/7f5ad4f08965426f87bc7901e174066c/" data-id="ckmcqox3x005j0kuv3fh832kq" data-title="JavaScript 实现更多数组的高阶函数" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-83aeb3c35adf4517b0e4e7643c2f7517" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/83aeb3c35adf4517b0e4e7643c2f7517/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/83aeb3c35adf4517b0e4e7643c2f7517/">FlexBox 布局入门</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>最近刚看了 flexbox，之前一直用的 UI 框架写前端，吾辈可能是个假的前端开发（好吧，其实之前吾辈前后端都写，写得最多的是 JS/TS 就是了），所以写一篇记录便于复习知识。</p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>不谈需求讲功能就是扯淡，所以吾辈先来说一下吾辈使用 <code>flex</code> 的主要场景吧</p>
<ul>
<li>水平布局: 导航栏，多栏展示，媒体元素</li>
<li>水平垂直居中: 这在 flex 之前使用 CSS 很难实现</li>
<li>避免使用浮动，行内块元素，表格进行布局</li>
</ul>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="水平布局"><a href="#水平布局" class="headerlink" title="水平布局"></a>水平布局</h3><p>使用 <code>flex</code> 可以轻而易举地实现栅格系统，这里的最下面还实现了一个常见的侧边菜单两栏布局。</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190916121534.png" alt="栅格系统"></p>
<p>实现代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>flex 水平布局<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">      * &#123;</span><br><span class="line">        margin: 0;</span><br><span class="line">        padding: 0;</span><br><span class="line">        box-sizing: border-box;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">      <span class="comment">/* #region 12 栅格布局 */</span></span></span><br><span class="line"></span><br><span class="line"><span class="css">      <span class="selector-class">.row</span> &#123;</span></span><br><span class="line">        display: flex;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-class">.col</span> &#123;</span></span><br><span class="line">        flex: 1;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-class">.col-1</span> &#123;</span></span><br><span class="line">        flex: 1;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-class">.col-2</span> &#123;</span></span><br><span class="line">        flex: 2;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-class">.col-3</span> &#123;</span></span><br><span class="line">        flex: 3;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-class">.col-4</span> &#123;</span></span><br><span class="line">        flex: 4;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-class">.col-5</span> &#123;</span></span><br><span class="line">        flex: 5;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-class">.col-6</span> &#123;</span></span><br><span class="line">        flex: 6;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-class">.col-7</span> &#123;</span></span><br><span class="line">        flex: 7;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-class">.col-8</span> &#123;</span></span><br><span class="line">        flex: 8;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-class">.col-9</span> &#123;</span></span><br><span class="line">        flex: 9;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-class">.col-10</span> &#123;</span></span><br><span class="line">        flex: 10;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-class">.col-11</span> &#123;</span></span><br><span class="line">        flex: 11;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-class">.col-12</span> &#123;</span></span><br><span class="line">        flex: 12;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">      <span class="comment">/* #endregion */</span></span></span><br><span class="line"></span><br><span class="line"><span class="css">      <span class="selector-class">.col</span> &#123;</span></span><br><span class="line">        min-width: 50px;</span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#00ffff</span>;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">border</span>: <span class="selector-tag">solid</span> 2<span class="selector-tag">px</span> <span class="selector-id">#ffffff</span>;</span></span><br><span class="line">        text-align: center;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">      <span class="selector-class">.side-menu</span> &#123;</span></span><br><span class="line">        max-width: 250px;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-1&quot;</span>&gt;</span>col-1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-1&quot;</span>&gt;</span>col-1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-1&quot;</span>&gt;</span>col-1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-1&quot;</span>&gt;</span>col-1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-1&quot;</span>&gt;</span>col-1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-1&quot;</span>&gt;</span>col-1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-1&quot;</span>&gt;</span>col-1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-1&quot;</span>&gt;</span>col-1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-1&quot;</span>&gt;</span>col-1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-1&quot;</span>&gt;</span>col-1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-1&quot;</span>&gt;</span>col-1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-1&quot;</span>&gt;</span>col-1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-2&quot;</span>&gt;</span>col-2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-2&quot;</span>&gt;</span>col-2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-2&quot;</span>&gt;</span>col-2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-2&quot;</span>&gt;</span>col-2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-2&quot;</span>&gt;</span>col-2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-2&quot;</span>&gt;</span>col-2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-3&quot;</span>&gt;</span>col-3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-3&quot;</span>&gt;</span>col-3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-3&quot;</span>&gt;</span>col-3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-3&quot;</span>&gt;</span>col-3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-4&quot;</span>&gt;</span>col-4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-4&quot;</span>&gt;</span>col-4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-4&quot;</span>&gt;</span>col-4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-6&quot;</span>&gt;</span>col-6<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-6&quot;</span>&gt;</span>col-6<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-12&quot;</span>&gt;</span>col-12<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 侧边菜单栏 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-3 side-menu&quot;</span>&gt;</span>col-3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col col-9&quot;</span>&gt;</span>col-9<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="水平垂直居中"><a href="#水平垂直居中" class="headerlink" title="水平垂直居中"></a>水平垂直居中</h2><p>在此 flex 出现之前，想要盒子水平垂直居中是一件比较困难的一件事，但至此之后，便再也不足为道了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190916121734.png" alt="水平垂直居中"></p>
<p>实现代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>使用 flex 实现水平垂直居中<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">      html,</span><br><span class="line">      body,</span><br><span class="line"><span class="css">      <span class="selector-class">.flex-container</span> &#123;</span></span><br><span class="line">        height: 100%;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">      <span class="selector-class">.flex-container</span> &#123;</span></span><br><span class="line">        display: flex;</span><br><span class="line">        justify-content: center;</span><br><span class="line">        align-items: center;</span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#2c3e50</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">      <span class="selector-class">.flex-item</span> &#123;</span></span><br><span class="line">        width: 40rem;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#ffffff</span>;</span></span><br><span class="line">        padding: 2rem;</span><br><span class="line"><span class="css">        <span class="selector-tag">box-shadow</span>: 0 0 0.5<span class="selector-tag">rem</span> <span class="selector-id">#ffffff</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;flex-container&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;flex-item&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>内境逾宽、外延逾窄<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">          我和麻省理工学院的一些博士生谈论过各种浏览器的好坏，他们不和你谈微软的</span><br><span class="line">          IE 或者 Mozilla 的火狐，而是 Unix 用户更常用的字处理器 Emacs</span><br><span class="line">          下一个很小的浏览网页的功能，这个东西不仅不好用，而且在全世界用它的网民连万分之一都不到。他们和你谈的是里面技术上谁实现的好。这些人以后可以是很好的科学家和工程师，但是很难创业。</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="对比浮动、行内盒子、表格布局"><a href="#对比浮动、行内盒子、表格布局" class="headerlink" title="对比浮动、行内盒子、表格布局"></a>对比浮动、行内盒子、表格布局</h2><ul>
<li>浮动布局: 浏览器很早就实现的一种布局方式，但浮动之后的元素脱离了标准文档流，必须特别注意清除浮动。并且，浮动也无法提供足够的布局能力，常常需要一些 hack 技巧。最后，浮动布局本身也不是为了布局而设计，浮动最适合的场景莫过于实现媒体元素的文字环绕。</li>
<li>行内盒子: 基本没有提供布局能力</li>
<li>表格布局: 实现的非常早的二维布局方式，在 Web 早期很多网站喜欢使用它进行布局，正是因为它的二维布局可以简单实现一些常规布局。但终究它的布局能力还是不足的，CSS3 中实现了更好的 <code>Grid Layout</code> 作为二维布局方式。</li>
<li><code>Grid Layout</code>: 理论上来说，能够进行二维布局的 Grid 肯定比只能一维布局的 Flex 更适合整体布局，但现实因素往往使之并不能理想化。就目前而言，Grid 的实现并不完整，当然，最新版的 Chrome/Firefox 肯定是可以的了，但 Safari/Edge 肯定还是有坑的！</li>
</ul>
<p>下面实现一个标签列表，以此便可以看出 Flex 的强大功用</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190916122712.png" alt="标签列表"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>使用 flex 实现标签组<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">      <span class="selector-class">.tags</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#c9e1f4</span>;</span></span><br><span class="line">        padding: 1rem;</span><br><span class="line">        display: flex;</span><br><span class="line">        flex-wrap: wrap;</span><br><span class="line"><span class="css">        <span class="comment">/*min-height: 500px;*/</span></span></span><br><span class="line"><span class="css">        <span class="comment">/*align-content: space-around;*/</span></span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">      <span class="selector-class">.tags</span> <span class="selector-tag">li</span> &#123;</span></span><br><span class="line">        display: inline-block;</span><br><span class="line">        margin: 0.5rem;</span><br><span class="line">        flex: 1 0 auto;</span><br><span class="line">        max-width: 10rem;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">      <span class="selector-class">.tags</span> <span class="selector-tag">li</span> <span class="selector-tag">a</span> &#123;</span></span><br><span class="line">        position: relative;</span><br><span class="line">        display: block;</span><br><span class="line">        padding: 0.25rem 0.5rem 0.25rem 0.5rem;</span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#c9e1f4</span>;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">color</span>: <span class="selector-id">#28448f</span>;</span></span><br><span class="line">        border-radius: 0 0.25rem 0.25rem 0;</span><br><span class="line">        line-height: 1.5;</span><br><span class="line">        text-decoration: none;</span><br><span class="line">        text-align: center;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">      <span class="selector-class">.tags</span> <span class="selector-tag">li</span> <span class="selector-tag">a</span><span class="selector-pseudo">::before</span> &#123;</span></span><br><span class="line">        content: &quot; &quot;;</span><br><span class="line">        position: absolute;</span><br><span class="line">        width: 0;</span><br><span class="line">        height: 0;</span><br><span class="line">        border: 1rem solid transparent;</span><br><span class="line">        border-right-width: 0.5rem;</span><br><span class="line"><span class="css">        <span class="selector-tag">border-right-color</span>: <span class="selector-id">#c9e1f4</span>;</span></span><br><span class="line">        left: -1.5rem;</span><br><span class="line">        top: 0;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;tags&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Android<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Chrome<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Cmder<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>DB<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>FTP<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>FreeNetwork<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Git<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Gradle<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Greasemonkey<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>HTML<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>IDEA<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Java<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Linux<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Markdown<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Maven<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>MongoDB<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>MonngoDB<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>MySQL<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Mybatis<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>NodeJS<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Prettier<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Promise<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>React<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Spring<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Tool<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>TypeScript<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>VSCode<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>VueJS<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Vuetify<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Web<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Windows<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>blog<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>jsdoc<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>mobile<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>npm<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>工具<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>教程<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>文章<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>杂谈<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>记录<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>读书<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>随笔<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/83aeb3c35adf4517b0e4e7643c2f7517/" data-id="ckmcqox3z005r0kuv5xgz19bi" data-title="FlexBox 布局入门" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/css/" rel="tag">css</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-8683190d5e2f4c5d85aba3b67ede2c75" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/8683190d5e2f4c5d85aba3b67ede2c75/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/8683190d5e2f4c5d85aba3b67ede2c75/">在传统项目中使用 babel 编译 ES6</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><blockquote>
<p>曾经吾辈以为 ES6 早已推广开来，然而事实上远比想象中更加复杂。传统后台的项目就是要兼容性，兼容 2 年前的浏览器，没有 babel，全程 jQuery 一把梭做到底。</p>
</blockquote>
<p>之前的项目基本上都是前后端分离的模式，最近新公司的项目却是使用的传统的模板视图的模式。<br>所以，一些东西发生了变化</p>
<ul>
<li><code>thymeleaf</code> 模板里面直接有 Java 的代码，在服务端直接编译 html 代码而非是纯粹的 API 交互</li>
<li>使用最多的库是 <code>jquery</code>，主要用于操作 <code>dom</code></li>
<li>没有现代前端工具链 <code>nodejs/npm/webpack/babel/vuejs</code></li>
</ul>
<p>所以吾辈使用 ES6 的语法就被同事诟病语法太新（还有人连 ES5 的语法都没能完全掌握），浏览器无法正常显示，所以吾辈只能尝试用 babel 来做兼容。众所周知，自 babel6 以来，模块化大行其道，由原先的使用浏览器引入脚本的方式修改为由 npm 等包管理器引入，官方也不推荐使用浏览器引入的方式。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>幸好吾辈找到了一个项目 <a target="_blank" rel="noopener" href="https://github.com/babel/babel-standalone">babel-standalone</a>，它提供了从浏览器中引入 babel 的功能。</p>
<p>使用方式很简单，只要在你含有 ES6 代码的脚本之前引入，在含有 ES6 代码的 script 标签上加上 <code>text/babel</code> 即可。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://unpkg.com/babel-standalone@6/babel.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/babel&quot;</span>&gt;</span><br><span class="line"><span class="keyword">const</span> getMessage = <span class="function">() =&gt;</span> <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&#x27;output&#x27;</span>).innerHTML = getMessage();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>以上，官方是这么说的，然而实际上，吾辈还是遇到了一些问题</p>
<ol>
<li> 使用 <code>&lt;script type=&quot;text/babel&quot;&gt;</code> 标记需要编译确实很方便，然而 babel 的编译过程是异步的，所以如果想要在后面的脚本中使用这个脚本中的内容则是不可能的</li>
<li> 某些语法仍然不能支持，例如 <code>function*</code> 生成器</li>
<li> 不能直接使用未声明的变量</li>
<li> 默认没有编译为 ES5</li>
</ol>
<p>这些问题我们下面一一解决</p>
<h3 id="异步编译"><a href="#异步编译" class="headerlink" title="异步编译"></a>异步编译</h3><p>例如有下面三个文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>index<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/babel-standalone@6/babel.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/babel&quot;</span> <span class="attr">src</span>=<span class="string">&quot;./js/common.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// common.js</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 等待指定的时间/等待指定表达式成立</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number|Function&#125;</span> </span>param 等待时间/等待条件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Promise&#125;</span> </span>Promise 对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wait</span>(<span class="params">param</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> param === <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(resolve, param);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> param === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (param()) &#123;</span><br><span class="line">          <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">          resolve();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="number">100</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line">wait(<span class="number">3000</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">document</span>.querySelector(<span class="string">&quot;#root&quot;</span>).innerHTML = <span class="string">&quot;等待 3s 结束&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>我们会得到一个错误</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Uncaught <span class="built_in">ReferenceError</span>: wait is not defined</span><br></pre></td></tr></table></figure>
<p>为什么会这样呢？原因就是加载 common.js 之后实际上还需要被 babel 编译，然而这并非同步操作，所以我们之后的脚本就无法取得全局函数 <code>wait()</code>。那么，如何解决呢？</p>
<p>我们可以将所有的 <code>script</code> 标签都加上 <code>type=&quot;text/babel&quot;</code>，所有的 script 脚本都是需要编译的，那么就不会有异步的编译的问题了。</p>
<h3 id="babel-没有完全支持"><a href="#babel-没有完全支持" class="headerlink" title="babel 没有完全支持"></a>babel 没有完全支持</h3><p>例如在 <code>common.js</code> 中添加一个函数 <code>indexGenerator()</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成一个索引序列，从 0 开始，每次递增为 1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Generator&#125;</span> </span>一个生成器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">indexGenerator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; <span class="literal">true</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">yield</span> i;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但我们只会得到一个错误</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Uncaught <span class="built_in">ReferenceError</span>: regeneratorRuntime is not defined</span><br></pre></td></tr></table></figure>
<p>这是因为 babel 基础包并没有实现所有的 ES6 的特性，所以就会出现不支持的情况。我们需要拓展包 <code>babel-polyfill</code>，在 <code>babel-standalone</code> 下引入即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://unpkg.com/babel-standalone@6/babel.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/7.2.5/polyfill.min.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="不能使用未声明变量"><a href="#不能使用未声明变量" class="headerlink" title="不能使用未声明变量"></a>不能使用未声明变量</h3><p>如果我们在标记为需要编译的 script 脚本中使用了未定义的变量，就会出现错误。例如在 <code>index.js</code> 中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username = <span class="string">&quot;rxliuli&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>错误消息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Uncaught (<span class="keyword">in</span> promise) <span class="built_in">ReferenceError</span>: username is not defined</span><br></pre></td></tr></table></figure>
<p>所以说编程规范很重要啦</p>
<h3 id="默认不支持-ES7"><a href="#默认不支持-ES7" class="headerlink" title="默认不支持 ES7"></a>默认不支持 ES7</h3><p>是的，babel 默认是不支持 ES7 的，而 <code>async/await</code> 便属于 ES7 的内容。例如我们修改 <code>index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> wait(<span class="number">3000</span>);</span><br><span class="line">  <span class="built_in">document</span>.querySelector(<span class="string">&quot;#root&quot;</span>).innerHTML = <span class="string">&quot;等待 3s 结束&quot;</span>;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>错误消息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Uncaught <span class="built_in">SyntaxError</span>: Unexpected token <span class="function"><span class="keyword">function</span></span></span><br></pre></td></tr></table></figure>
<p>我们可以使用 <code>data-presets=&quot;latest&quot;</code> 来修复这个问题，永远引入最新版的 <code>presets</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/babel&quot;</span> src=<span class="string">&quot;./js/common.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script</span><br><span class="line">  type=<span class="string">&quot;text/babel&quot;</span></span><br><span class="line">  data-presets=<span class="string">&quot;latest&quot;</span></span><br><span class="line">  src=<span class="string">&quot;./js/index.js&quot;</span></span><br><span class="line">&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="thymeleaf-不能使用模板字符串-HTML"><a href="#thymeleaf-不能使用模板字符串-HTML" class="headerlink" title="thymeleaf 不能使用模板字符串 HTML"></a>thymeleaf 不能使用模板字符串 HTML</h3><p>同时使用 <code>type=&quot;text/babel&quot; data-presets=&quot;latest&quot;</code> 和 <code>th:inline=&quot;javascript&quot;</code> 的时候，thymeleaf 将无法解析 <code>&lt;a href=&quot;#&quot;/&gt;</code> 含有 HTML 的模板字符串。</p>
<p>使用环境</p>
<ul>
<li>spring-boot 2.0.3.RELEASE</li>
<li>babel 6.26.0</li>
<li>babel-polyfill 2.6.1</li>
</ul>
<p>例如下面这种代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/babel&quot;</span> <span class="attr">data-presets</span>=<span class="string">&quot;latest&quot;</span> <span class="attr">th:inline</span>=<span class="string">&quot;javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> htmlStr = <span class="string">`&lt;a href=&quot;#&quot;/&gt;`</span>;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(<span class="string">`htmlStr: <span class="subst">$&#123;htmlStr&#125;</span>`</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>甚至于注释了也没用，只能删除掉才可以</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/babel&quot;</span> <span class="attr">data-presets</span>=<span class="string">&quot;latest&quot;</span> <span class="attr">th:inline</span>=<span class="string">&quot;javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// const htmlStr = `&lt;a href=&quot;#&quot;/&gt;`</span></span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(<span class="string">`htmlStr: <span class="subst">$&#123;htmlStr&#125;</span>`</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>目前的解决方案是分成两个 <code>script</code> 标签，分别使用 <code>type=&quot;text/babel&quot; data-presets=&quot;latest&quot;</code> 和 <code>th:inline=&quot;javascript&quot;</code> 标签</p>
<h3 id="不能使用浏览器较新的-API"><a href="#不能使用浏览器较新的-API" class="headerlink" title="不能使用浏览器较新的 API"></a>不能使用浏览器较新的 API</h3><p>使用一些浏览器较新的 API 时发现不能正常使用，<code>babel-core</code> 也没有实现。例如吾辈想要使用 <code>NodeList.forEach</code> 遍历 <code>a</code> 标签列表，然后打印出来他们的链接</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.querySelectorAll(<span class="string">&quot;a&quot;</span>).forEach(<span class="function">(<span class="params">el</span>) =&gt;</span> <span class="built_in">console</span>.log(el.href));</span><br></pre></td></tr></table></figure>
<p>会得到错误</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Uncaught <span class="built_in">TypeError</span>: <span class="built_in">document</span>.querySelectorAll(...).forEach is not a <span class="function"><span class="keyword">function</span></span></span><br></pre></td></tr></table></figure>
<p>在旧版浏览器中，<code>NodeList</code> 并没有 <code>forEach</code> 方法，后来，吾辈找到了另一个库 <a target="_blank" rel="noopener" href="https://github.com/zloirock/core-js">core-js</a>，其最新版 <code>3.x beta</code> 实现了 <code>NodeList.forEach</code> API，唯一的缺点是我们要手动构建才行。</p>
<p>引入也很简单，只要在 <code>babel-standalone</code> 之后，<code>babel-polyfill</code> 之前使用 <code>script</code> 标签引入就好了</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/core-js-bundle@3.0.0-beta.8/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>好了，下面我们可以愉快的使用新的浏览器 API 了</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>那么，有关在传统项目中使用 babel 编译 ES6/ES7 的问题就到这里了，希望有更多的人使用这些新特性，让我们早日抛弃掉 babel 吧</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/8683190d5e2f4c5d85aba3b67ede2c75/" data-id="ckmcqox41005y0kuv0epvf0pa" data-title="在传统项目中使用 babel 编译 ES6" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">工程化</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-94b435abfa5847a39a95b4f4fc180a1a" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/94b435abfa5847a39a95b4f4fc180a1a/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/94b435abfa5847a39a95b4f4fc180a1a/">IDEA 激活</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="使用本地注册码（不需要在线）的方式激活"><a href="#使用本地注册码（不需要在线）的方式激活" class="headerlink" title="使用本地注册码（不需要在线）的方式激活"></a>使用本地注册码（不需要在线）的方式激活</h2><blockquote>
<p>注: 此方法对 IDEA 2018.01-2018.02 版本无效，但对 IDEA 2018.03 EAP 是有效的</p>
</blockquote>
<ol>
<li><p>修改 <strong>hosts</strong> 文件，Windows 系统上的位置是 <strong>C:\Windows\System32\drivers\etc\hosts</strong>，将之复制到其他位置并在文件的最末尾添加一句话。</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.0.0.0 account.jetbrains.com</span><br></pre></td></tr></table></figure>
<p> 然后将 <strong>hosts</strong> 文件复制到原本的位置覆盖一下就好。</p>
<blockquote>
<p>注：该操作是必要的，因为不修改 <strong>hosts</strong> 文件的话获得的激活码是会直接提示非法的！</p>
</blockquote>
</li>
<li><p> 在 <a target="_blank" rel="noopener" href="http://idea.iteblog.com/">http://idea.iteblog.com/</a> 获得到一个注册码（用户名和 PC 用户名保持一致），将注册码用于激活 IDEA 即可。</p>
</li>
</ol>
<h2 id="使用本地-Jar-文件"><a href="#使用本地-Jar-文件" class="headerlink" title="使用本地 Jar 文件"></a>使用本地 Jar 文件</h2><blockquote>
<p>注：该方法适用于 IDEA 2018.01-2018.02，在 IDEA 2018.03 已经失效</p>
</blockquote>
<ol>
<li><p>下载破解 Jar：<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/rxliuli/blog_binary_file/master/JrebelBrainsLicenseServerforJava-1.0-SNAPSHOT-jar-with-dependencies.jar">JetbrainsCrack</a></p>
<p> 然后放到一个合适的位置（你不会随意删除的位置，推荐直接放到 IDEA 的安装目录下）</p>
</li>
<li><p>修改 IDEA 的一个配置文件（位置在 <code>$&#123;idea.home&#125;/bin/idea64.exe.vmoptions</code>），在最后一行添加：<code>-javaagent:这里是你上面下载的那个 Jar 的绝对路径</code></p>
<p> 然后在激活对话框中选 <strong>Activation code</strong> 随意输入然后点击 OK 即可。</p>
</li>
<li><p>Pass：其实下面还有一步的，不过做不做都可以，运行上面的就已经完成激活了，不过激活信息显示的不是你的名字。当然，我们可以去变成自己的名字，如果我们在 <strong>Activation code</strong> 里填写合适的 <code>json</code> 信息的话。</p>
<ol>
<li><p>首先运行刚才下载的 Jar，然后会得到一个激活信息的 <code>json</code> 字符串，大致是下面这样：</p>
 <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;licenseId&quot;</span>: <span class="string">&quot;ThisCrackLicenseId&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;licenseeName&quot;</span>: <span class="string">&quot;Rover12421&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;assigneeName&quot;</span>: <span class="string">&quot;Rover12421&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;assigneeEmail&quot;</span>: <span class="string">&quot;rover12421@163.com&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;licenseRestriction&quot;</span>: <span class="string">&quot;By Rover12421 Crack, Only Test! Please support genuine!!!&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;checkConcurrentUse&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;products&quot;</span>: [</span><br><span class="line">    &#123; <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;II&quot;</span>, <span class="attr">&quot;paidUpTo&quot;</span>: <span class="string">&quot;2099-12-31&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;DM&quot;</span>, <span class="attr">&quot;paidUpTo&quot;</span>: <span class="string">&quot;2099-12-31&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;AC&quot;</span>, <span class="attr">&quot;paidUpTo&quot;</span>: <span class="string">&quot;2099-12-31&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;RS0&quot;</span>, <span class="attr">&quot;paidUpTo&quot;</span>: <span class="string">&quot;2099-12-31&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;WS&quot;</span>, <span class="attr">&quot;paidUpTo&quot;</span>: <span class="string">&quot;2099-12-31&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;DPN&quot;</span>, <span class="attr">&quot;paidUpTo&quot;</span>: <span class="string">&quot;2099-12-31&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;RC&quot;</span>, <span class="attr">&quot;paidUpTo&quot;</span>: <span class="string">&quot;2099-12-31&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;PS&quot;</span>, <span class="attr">&quot;paidUpTo&quot;</span>: <span class="string">&quot;2099-12-31&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;DC&quot;</span>, <span class="attr">&quot;paidUpTo&quot;</span>: <span class="string">&quot;2099-12-31&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;RM&quot;</span>, <span class="attr">&quot;paidUpTo&quot;</span>: <span class="string">&quot;2099-12-31&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;CL&quot;</span>, <span class="attr">&quot;paidUpTo&quot;</span>: <span class="string">&quot;2099-12-31&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;PC&quot;</span>, <span class="attr">&quot;paidUpTo&quot;</span>: <span class="string">&quot;2099-12-31&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;DB&quot;</span>, <span class="attr">&quot;paidUpTo&quot;</span>: <span class="string">&quot;2099-12-31&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;GO&quot;</span>, <span class="attr">&quot;paidUpTo&quot;</span>: <span class="string">&quot;2099-12-31&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;RD&quot;</span>, <span class="attr">&quot;paidUpTo&quot;</span>: <span class="string">&quot;2099-12-31&quot;</span> &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;hash&quot;</span>: <span class="string">&quot;2911276/0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;gracePeriodDays&quot;</span>: <span class="number">7</span>,</span><br><span class="line">  <span class="attr">&quot;autoProlongated&quot;</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p> 修改其中的 <code>licenseeName</code>, <code>assigneeName</code>, <code>assigneeEmail</code> 为你的名字和邮箱，然后将修改后的 <code>json</code> 字符串丢到 <strong>Activation code</strong> 里面就好啦</p>
</li>
</ol>
</li>
</ol>
<h2 id="IDEA-激活服务器"><a href="#IDEA-激活服务器" class="headerlink" title="IDEA 激活服务器"></a>IDEA 激活服务器</h2><blockquote>
<p>注: 此方法随时可能失效</p>
</blockquote>
<ul>
<li>激活服务器：<a target="_blank" rel="noopener" href="http://idea.imsxm.com/">http://idea.imsxm.com/</a>，<a target="_blank" rel="noopener" href="http://idea.uri.ci/">http://idea.uri.ci</a></li>
<li>如果无法激活，请前往 <a target="_blank" rel="noopener" href="http://idea.imsxm.com/">网站</a> 查找方法。如有能力，请支持正版！</li>
</ul>
<p>使用方法</p>
<ul>
<li>在 idea 首次使用时会要求输入注册码，选择第三个选项卡，即 <strong>License Server</strong>,然后填入上面的激活服务器即可。</li>
<li>进入 idea 后，选择 Help-&gt;Register,就会弹出一个输入注册码的窗口了，以上面那种方法输入就行啦。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/94b435abfa5847a39a95b4f4fc180a1a/" data-id="ckmcqox4300680kuv2m1ndfo6" data-title="IDEA 激活" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-96f6991283754dc0acbd11633481fb5e" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/96f6991283754dc0acbd11633481fb5e/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/96f6991283754dc0acbd11633481fb5e/">Git 设置和取消代理</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="设置代理"><a href="#设置代理" class="headerlink" title="设置代理"></a>设置代理</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.proxy <span class="string">&#x27;http://127.0.0.1:1080&#x27;</span></span><br><span class="line">git config --global https.proxy <span class="string">&#x27;http://127.0.0.1:1080&#x27;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：此处设置的代理 ip 和端口号都是本地存在的（<strong>SS/SSR</strong> 默认就是）。</p>
</blockquote>
<h2 id="取消代理"><a href="#取消代理" class="headerlink" title="取消代理"></a>取消代理</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global --<span class="built_in">unset</span> http.proxy</span><br><span class="line">git config --global --<span class="built_in">unset</span> https.proxy</span><br></pre></td></tr></table></figure>
<h2 id="Git-全局配置文件位置"><a href="#Git-全局配置文件位置" class="headerlink" title="Git 全局配置文件位置"></a>Git 全局配置文件位置</h2><p>根配置文件 <code>/etc/gitconfig</code></p>
<blockquote>
<p>Windows 的话在 Git 安装目录下 <code>/mingw64/etc/gitconfig</code>，不过最好不要动这个<br>当前用户 Git 配置 <code>~/.gitconfig</code></p>
</blockquote>
<p>在配置文件里面添加以下内容也可以添加代理：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[https]</span><br><span class="line">        proxy &#x3D; socks5:&#x2F;&#x2F;127.0.0.1:1080</span><br><span class="line">[http]</span><br><span class="line">        proxy &#x3D; socks5:&#x2F;&#x2F;127.0.0.1:1080</span><br></pre></td></tr></table></figure>
<h2 id="遇到的坑"><a href="#遇到的坑" class="headerlink" title="遇到的坑"></a>遇到的坑</h2><p>设置了代理之后很容易碰到一个问题：<a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/c6b28b5a/">Git Push 提示不支持具有 Socks5 方案的代理</a></p>
<blockquote>
<p>具体 Git 相关的内容建议参考 <a target="_blank" rel="noopener" href="https://git-scm.com/book/zh/v2">Pro Git</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/96f6991283754dc0acbd11633481fb5e/" data-id="ckmcqox45006e0kuv8k9d7stm" data-title="Git 设置和取消代理" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-9a7be4762ed2447eae5198f2f6686d95" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/9a7be4762ed2447eae5198f2f6686d95/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/9a7be4762ed2447eae5198f2f6686d95/">Yarn link 链接本地项目</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>作为 JavaScript SDK 的开发者一定都知道，想要在未发布前进行测试整个包可谓是困难重重。而 <code>yarn link</code> 这个命令便是为了解决这个需求而产生的，它能让包引用并测试自身，即便包并未发布或不包含在 <code>package.json</code> 中亦然。</p>
<h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.notion.so/rxliuli/Yarn-link-45007161bbfd43b2beffac88a0bc69b0#396f98a450c445f29e6fff69202654f0">官网链接</a></p>
</blockquote>
<h3 id="链接包"><a href="#链接包" class="headerlink" title="链接包"></a>链接包</h3><p>在命令行运行即可将当前包链接安装到这个包中，即便你在 <code>package.json</code> 并不会找到显式的依赖。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn link &amp;&amp; yarn link <span class="string">&quot;&lt;package.json 中的 name 字段&gt;&quot;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：如果当前包是 <code>cli</code>，即 <code>package.json</code> 中包含 <code>bin</code> 字段，则还会被链接到 yarn 的全局脚本目录中。<br>yarn 的全局脚本目录可以通过执行 <code>yarn global bin</code> 进行查看，如果要在全局执行，则需要将该目录设置到环境变量 <code>Path</code> 中，然后就可以全局运行命令了。</p>
</blockquote>
<p>然后，便可以在项目中使用了（测试）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &lt;pkgName&gt; from <span class="string">&#x27;pkgName&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="取消链接"><a href="#取消链接" class="headerlink" title="取消链接"></a>取消链接</h3><p>如果不需要了，则也可以轻易通过 <code>unlink</code> 移除。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn unlink <span class="string">&quot;&lt;package.json 中的 name 字段&gt;&quot;</span> &amp;&amp; yarn unlink</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：同样的，如果当前包是 <code>cli</code>，则 yarn 全局 <code>bin</code> 目录中也会进行删除</p>
</blockquote>
<h3 id="通用-script"><a href="#通用-script" class="headerlink" title="通用 script"></a>通用 script</h3><p>每个项目都这样太麻烦了，可否添加一个通用 <code>script</code> 脚本呢？</p>
<p>当然是可以的，通过 <code>%npm_package_name%</code> 我们便能在 <code>srcipt</code> 中访问到项目名</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;link:add&quot;: &quot;yarn link &amp;&amp; yarn link %npm_package_name%&quot;,</span><br><span class="line">  &quot;link:remove&quot;: &quot;yarn unlink %npm_package_name% &amp;&amp; yarn unlink&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<blockquote>
<p>参考：<a target="_blank" rel="noopener" href="https://docs.npmjs.com/misc/scripts#packagejson-vars">https://docs.npmjs.com/misc/scripts#packagejson-vars</a></p>
</blockquote>
<p>以后便可以直接将命令复制到 <code>script</code> 即可直接使用了。</p>
<blockquote>
<p>注：使用 <code>%%</code> 包裹便能在 <code>script</code> 中使用，该方式在 Windows 下生效，Linux 下似乎需要添加前缀 <code>$</code>，不过吾辈并未测试（懒得折腾 Linux 桌面了）。<br>然而，问题并非不存在了，例如本地使用 Windows 构建，然而远程 CI 使用 Linux，那这个脚本就要炸了。。。所以，如果你需要上 CI 的话，还是老实改名字吧。<br>或者也可以使用 <strong>VSCode + WSL</strong>？#笑</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/9a7be4762ed2447eae5198f2f6686d95/" data-id="ckmcqox46006i0kuv28jkcruh" data-title="Yarn link 链接本地项目" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">工程化</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-9aea4154a79043e4a5eb8f0a3d8dd4dc" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/9aea4154a79043e4a5eb8f0a3d8dd4dc/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/9aea4154a79043e4a5eb8f0a3d8dd4dc/">JavaScript 防抖和节流</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>网络上已经存在了大量的有关 <strong>防抖</strong> 和 <strong>节流</strong> 的文章，为何吾辈还要再写一篇呢？事实上，防抖和节流，吾辈在使用中发现了一些奇怪的问题，并经过了数次的修改，这里主要分享一下吾辈遇到的问题以及是如何解决的。</p>
<h3 id="为什么要用防抖和节流？"><a href="#为什么要用防抖和节流？" class="headerlink" title="为什么要用防抖和节流？"></a>为什么要用防抖和节流？</h3><p>因为某些函数触发/调用的频率过快，吾辈需要手动去限制其执行的频率。例如常见的监听滚动条的事件，如果没有防抖处理的话，并且，每次函数执行花费的时间超过了触发的间隔时间的话 – 页面就会卡顿。</p>
<h2 id="演进"><a href="#演进" class="headerlink" title="演进"></a>演进</h2><h3 id="初始实现"><a href="#初始实现" class="headerlink" title="初始实现"></a>初始实现</h3><p>我们先实现一个简单的去抖函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">delay, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> tId;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (tId) <span class="built_in">clearTimeout</span>(tId);</span><br><span class="line">    tId = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      action(...args);</span><br><span class="line">    &#125;, delay);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 Promise 简单封装 setTimeout，下同</span></span><br><span class="line"><span class="keyword">const</span> wait = <span class="function">(<span class="params">ms</span>) =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(resolve, ms));</span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> num = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> add = <span class="function">() =&gt;</span> ++num;</span><br><span class="line"></span><br><span class="line">  add();</span><br><span class="line">  add();</span><br><span class="line">  <span class="built_in">console</span>.log(num); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> fn = debounce(<span class="number">10</span>, add);</span><br><span class="line">  fn();</span><br><span class="line">  fn();</span><br><span class="line">  <span class="built_in">console</span>.log(num); <span class="comment">// 2</span></span><br><span class="line">  <span class="keyword">await</span> wait(<span class="number">20</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(num); <span class="comment">// 3</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>好了，看来基本的效果是实现了的。包装过的函数 <code>fn</code> 调用了两次，却并没有立刻执行，而是等待时间间隔过去之后才最终执行了一次。</p>
<h3 id="this-怎么办？"><a href="#this-怎么办？" class="headerlink" title="this 怎么办？"></a>this 怎么办？</h3><p>然而，上面的实现有一个致命的问题，没有处理 <code>this</code>！当你用在原生的事件处理时或许还不觉得，然而，当你使用了 ES6 <code>class</code> 这类对 <code>this</code> 敏感的代码时，就一定会遇到 <code>this</code> 带来的问题。</p>
<p>例如下面使用 <code>class</code> 来声明一个计数器</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.i = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">add</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.i++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可能想在 <code>constructor</code> 中添加新的属性 <code>fn</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.i = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">this</span>.fn = debounce(<span class="number">10</span>, <span class="built_in">this</span>.add);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">add</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.i++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但很遗憾，这里的 <code>this</code> 绑定是有问题的，执行以下代码试试看</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> counter = <span class="keyword">new</span> Counter();</span><br><span class="line">counter.fn(); <span class="comment">// Cannot read property &#x27;i&#x27; of undefined</span></span><br></pre></td></tr></table></figure>
<p>会抛出异常 <code>Cannot read property &#39;i&#39; of undefined</code>，究其原因就是 <code>this</code> 没有绑定，我们可以手动绑定 this <code>.bind(this)</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.i = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">this</span>.fn = debounce(<span class="number">10</span>, <span class="built_in">this</span>.add.bind(<span class="built_in">this</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">add</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.i++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但更好的方式是修改 <code>debounce</code>，使其能够自动绑定 <code>this</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">delay, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> tId;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (tId) <span class="built_in">clearTimeout</span>(tId);</span><br><span class="line">    tId = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      action.apply(<span class="built_in">this</span>, args);</span><br><span class="line">    &#125;, delay);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，代码将如同预期的运行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.i = <span class="number">0</span>;</span><br><span class="line">      <span class="built_in">this</span>.fn = debounce(<span class="number">10</span>, <span class="built_in">this</span>.add);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">add</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.i++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> counter = <span class="keyword">new</span> Counter();</span><br><span class="line">  counter.add();</span><br><span class="line">  counter.add();</span><br><span class="line">  <span class="built_in">console</span>.log(counter.i); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">  counter.fn();</span><br><span class="line">  counter.fn();</span><br><span class="line">  <span class="built_in">console</span>.log(counter.i); <span class="comment">// 2</span></span><br><span class="line">  <span class="keyword">await</span> wait(<span class="number">20</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(counter.i); <span class="comment">// 3</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<h3 id="返回值呢？"><a href="#返回值呢？" class="headerlink" title="返回值呢？"></a>返回值呢？</h3><p>不知道你有没有发现，现在使用 <code>debounce</code> 包装的函数都没有返回值，是完全只有副作用的函数。然而，吾辈还是遇到了需要返回值的场景。<br>例如：<em>输入停止后，使用 Ajax 请求后台数据判断是否已存在相同的数据。</em></p>
<p>修改 <code>debounce</code> 成会缓存上一次执行结果并且有初始结果参数的实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">delay, action, init = <span class="literal">undefined</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> flag;</span><br><span class="line">  <span class="keyword">let</span> result = init;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (flag) <span class="built_in">clearTimeout</span>(flag);</span><br><span class="line">    flag = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      result = action.apply(<span class="built_in">this</span>, args);</span><br><span class="line">    &#125;, delay);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用代码变成了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.i = <span class="number">0</span>;</span><br><span class="line">      <span class="built_in">this</span>.fn = debounce(<span class="number">10</span>, <span class="built_in">this</span>.add, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">add</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> ++<span class="built_in">this</span>.i;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> counter = <span class="keyword">new</span> Counter();</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(counter.add()); <span class="comment">// 1</span></span><br><span class="line">  <span class="built_in">console</span>.log(counter.add()); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(counter.fn()); <span class="comment">// 0</span></span><br><span class="line">  <span class="built_in">console</span>.log(counter.fn()); <span class="comment">// 0</span></span><br><span class="line">  <span class="keyword">await</span> wait(<span class="number">20</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(counter.fn()); <span class="comment">// 3</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>看起来很完美？然而，没有考虑到异步函数是个大失败！</p>
<p>尝试以下测试代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> get = <span class="keyword">async</span> (i) =&gt; i;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">await</span> get(<span class="number">1</span>));</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">await</span> get(<span class="number">2</span>));</span><br><span class="line">  <span class="keyword">const</span> fn = debounce(<span class="number">10</span>, get, <span class="number">0</span>);</span><br><span class="line">  fn(<span class="number">3</span>).then(<span class="function">(<span class="params">i</span>) =&gt;</span> <span class="built_in">console</span>.log(i)); <span class="comment">// fn(...).then is not a function</span></span><br><span class="line">  fn(<span class="number">4</span>).then(<span class="function">(<span class="params">i</span>) =&gt;</span> <span class="built_in">console</span>.log(i));</span><br><span class="line">  <span class="keyword">await</span> wait(<span class="number">20</span>);</span><br><span class="line">  fn(<span class="number">5</span>).then(<span class="function">(<span class="params">i</span>) =&gt;</span> <span class="built_in">console</span>.log(i));</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>会抛出异常 <code>fn(...).then is not a function</code>，因为我们包装过后的函数是同步的，第一次返回的值并不是 <code>Promise</code> 类型。</p>
<p>除非我们修改默认值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> get = <span class="keyword">async</span> (i) =&gt; i;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">await</span> get(<span class="number">1</span>));</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">await</span> get(<span class="number">2</span>));</span><br><span class="line">  <span class="comment">// 注意，修改默认值为 Promise</span></span><br><span class="line">  <span class="keyword">const</span> fn = debounce(<span class="number">10</span>, get, <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> resolve(<span class="number">0</span>)));</span><br><span class="line">  fn(<span class="number">3</span>).then(<span class="function">(<span class="params">i</span>) =&gt;</span> <span class="built_in">console</span>.log(i)); <span class="comment">// 0</span></span><br><span class="line">  fn(<span class="number">4</span>).then(<span class="function">(<span class="params">i</span>) =&gt;</span> <span class="built_in">console</span>.log(i)); <span class="comment">// 0</span></span><br><span class="line">  <span class="keyword">await</span> wait(<span class="number">20</span>);</span><br><span class="line">  fn(<span class="number">5</span>).then(<span class="function">(<span class="params">i</span>) =&gt;</span> <span class="built_in">console</span>.log(i)); <span class="comment">// 4</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<h3 id="支持有返回值的异步函数"><a href="#支持有返回值的异步函数" class="headerlink" title="支持有返回值的异步函数"></a>支持有返回值的异步函数</h3><p>支持异步有两种思路</p>
<ol>
<li> 将异步函数包装为同步函数</li>
<li> 将包装后的函数异步化</li>
</ol>
<p>第一种思路实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">delay, action, init = <span class="literal">undefined</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> flag;</span><br><span class="line">  <span class="keyword">let</span> result = init;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (flag) <span class="built_in">clearTimeout</span>(flag);</span><br><span class="line">    flag = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> temp = action.apply(<span class="built_in">this</span>, args);</span><br><span class="line">      <span class="keyword">if</span> (temp <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) &#123;</span><br><span class="line">        temp.then(<span class="function">(<span class="params">res</span>) =&gt;</span> (result = res));</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        result = temp;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, delay);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用方式和同步函数完全一样，当然，是支持异步函数的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> get = <span class="keyword">async</span> (i) =&gt; i;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">await</span> get(<span class="number">1</span>));</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">await</span> get(<span class="number">2</span>));</span><br><span class="line">  <span class="comment">// 注意，修改默认值为 Promise</span></span><br><span class="line">  <span class="keyword">const</span> fn = debounce(<span class="number">10</span>, get, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(fn(<span class="number">3</span>)); <span class="comment">// 0</span></span><br><span class="line">  <span class="built_in">console</span>.log(fn(<span class="number">4</span>)); <span class="comment">// 0</span></span><br><span class="line">  <span class="keyword">await</span> wait(<span class="number">20</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(fn(<span class="number">5</span>)); <span class="comment">// 4</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>第二种思路实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> debounce = <span class="function">(<span class="params">delay, action, init = <span class="literal">undefined</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> flag;</span><br><span class="line">  <span class="keyword">let</span> result = init;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (flag) <span class="built_in">clearTimeout</span>(flag);</span><br><span class="line">      flag = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        result = action.apply(<span class="built_in">this</span>, args);</span><br><span class="line">        resolve(result);</span><br><span class="line">      &#125;, delay);</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        resolve(result);</span><br><span class="line">      &#125;, delay);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>调用方式支持异步的方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> get = <span class="keyword">async</span> (i) =&gt; i;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">await</span> get(<span class="number">1</span>));</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">await</span> get(<span class="number">2</span>));</span><br><span class="line">  <span class="comment">// 注意，修改默认值为 Promise</span></span><br><span class="line">  <span class="keyword">const</span> fn = debounce(<span class="number">10</span>, get, <span class="number">0</span>);</span><br><span class="line">  fn(<span class="number">3</span>).then(<span class="function">(<span class="params">i</span>) =&gt;</span> <span class="built_in">console</span>.log(i)); <span class="comment">// 0</span></span><br><span class="line">  fn(<span class="number">4</span>).then(<span class="function">(<span class="params">i</span>) =&gt;</span> <span class="built_in">console</span>.log(i)); <span class="comment">// 4</span></span><br><span class="line">  <span class="keyword">await</span> wait(<span class="number">20</span>);</span><br><span class="line">  fn(<span class="number">5</span>).then(<span class="function">(<span class="params">i</span>) =&gt;</span> <span class="built_in">console</span>.log(i)); <span class="comment">// 5</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>可以看到，第一种思路带来的问题是返回值永远会是 <strong>旧的</strong> 返回值，第二种思路主要问题是将同步函数也给包装成了异步。利弊权衡之下，吾辈觉得第二种思路更加正确一些，毕竟使用场景本身不太可能必须是同步的操作。而且，原本 <code>setTimeout</code> 也是异步的，只是不需要返回值的时候并未意识到这点。</p>
<h3 id="避免原函数信息丢失"><a href="#避免原函数信息丢失" class="headerlink" title="避免原函数信息丢失"></a>避免原函数信息丢失</h3><p>后来，有人提出了一个问题，如果函数上面携带其他信息，例如类似于 <code>jQuery</code> 的 <code>$</code>，既是一个函数，但也同时含有其他属性，如果使用 <code>debounce</code> 就找不到了呀</p>
<p>一开始吾辈立刻想到了复制函数上面的所有可遍历属性，然后想起了 ES6 的 <code>Proxy</code> 特性 – 这实在是太<strong>魔法</strong>了。使用 Proxy 解决这个问题将异常的简单 – 因为除了调用函数，其他的一切操作仍然指向原函数！</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> debounce = <span class="function">(<span class="params">delay, action, init = <span class="literal">undefined</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> flag;</span><br><span class="line">  <span class="keyword">let</span> result = init;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Proxy</span>(action, &#123;</span><br><span class="line">    <span class="function"><span class="title">apply</span>(<span class="params">target, thisArg, args</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (flag) <span class="built_in">clearTimeout</span>(flag);</span><br><span class="line">        flag = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          resolve((result = <span class="built_in">Reflect</span>.apply(target, thisArg, args)));</span><br><span class="line">        &#125;, delay);</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          resolve(result);</span><br><span class="line">        &#125;, delay);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>测试一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> get = <span class="keyword">async</span> (i) =&gt; i;</span><br><span class="line">  get.rx = <span class="string">&quot;rx&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(get.rx); <span class="comment">// rx</span></span><br><span class="line">  <span class="keyword">const</span> fn = debounce(<span class="number">10</span>, get, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(fn.rx); <span class="comment">// rx</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<h3 id="实现节流"><a href="#实现节流" class="headerlink" title="实现节流"></a>实现节流</h3><p>以这种思路实现一个节流函数 <code>throttle</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 函数节流</span></span><br><span class="line"><span class="comment"> * 节流 (throttle) 让一个函数不要执行的太频繁，减少执行过快的调用，叫节流</span></span><br><span class="line"><span class="comment"> * 类似于上面而又不同于上面的函数去抖, 包装后函数在上一次操作执行过去了最小间隔时间后会直接执行, 否则会忽略该次操作</span></span><br><span class="line"><span class="comment"> * 与上面函数去抖的明显区别在连续操作时会按照最小间隔时间循环执行操作, 而非仅执行最后一次操作</span></span><br><span class="line"><span class="comment"> * 注: 该函数第一次调用一定会执行，不需要担心第一次拿不到缓存值，后面的连续调用都会拿到上一次的缓存值</span></span><br><span class="line"><span class="comment"> * 注: 返回函数结果的高阶函数需要使用 &#123;<span class="doctag">@link </span>Proxy&#125; 实现，以避免原函数原型链上的信息丢失</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>delay 最小间隔时间，单位为 ms</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>action 真正需要执行的操作</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Function&#125;</span> </span>包装后有节流功能的函数。该函数是异步的，与需要包装的函数 &#123;<span class="doctag">@link </span>action&#125; 是否异步没有太大关联</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> throttle = <span class="function">(<span class="params">delay, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> last = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> result;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Proxy</span>(action, &#123;</span><br><span class="line">    <span class="function"><span class="title">apply</span>(<span class="params">target, thisArg, args</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> curr = <span class="built_in">Date</span>.now();</span><br><span class="line">        <span class="keyword">if</span> (curr - last &gt; delay) &#123;</span><br><span class="line">          result = <span class="built_in">Reflect</span>.apply(target, thisArg, args);</span><br><span class="line">          last = curr;</span><br><span class="line">          resolve(result);</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        resolve(result);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>嘛，实际上这里的防抖和节流仍然是简单的实现，其他的像 <strong>取消防抖</strong>/<strong>强制刷新缓存</strong> 等功能尚未实现。当然，对于吾辈而言功能已然足够了，也被放到了公共的函数库 <a target="_blank" rel="noopener" href="https://rx-util.rxliuli.com/">rx-util</a> 中。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/9aea4154a79043e4a5eb8f0a3d8dd4dc/" data-id="ckmcqox47006k0kuv0e5mck5v" data-title="JavaScript 防抖和节流" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BC%82%E6%AD%A5/" rel="tag">异步</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-9c03bac44b51450c92565baf2cacd67e" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/9c03bac44b51450c92565baf2cacd67e/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/9c03bac44b51450c92565baf2cacd67e/">let 与 var 在 for 循环中的区别</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>今天遇到的一个很有趣的问题，下面两段 js 代码执行的结果是什么？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(i), <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>和</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(i), <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>嗯，乍看之下好像没什么区别，只有声明方式 <code>let</code> 和 <code>var</code> 不一样而已。</p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>这里先说一下吾辈两个关于 js 的认知</p>
<ol>
<li> js 里 <code>setTimeout</code> 如果延迟时间为 0 应该会立刻执行</li>
<li> js 里的 for 循环和 java 应该差不多，for 循环内部是单独的作用域</li>
</ol>
<p>图解如下</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20181227214410.png" alt="js for 循环和 setTimeout 理解"></p>
<p>那么答案只有一个，两段代码执行的结果应该都是 <code>0 1 2</code> 才对！Ｏ(≧▽≦)Ｏ</p>
<p>然而当吾辈执行后的结果却是</p>
<ul>
<li><code>let</code>: <code>0 1 2</code></li>
<li><code>var</code>: <code>3 3 3</code></li>
</ul>
<p>发生了什么？吾辈表示很无语。。。┐(￣ヮ￣)┌</p>
<h2 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h2><p>然而，上面的两个认知全错了！</p>
<h3 id="其一：js-里-setTimeout-如果延迟时间为-0-应该会立刻执行"><a href="#其一：js-里-setTimeout-如果延迟时间为-0-应该会立刻执行" class="headerlink" title="其一：js 里 setTimeout 如果延迟时间为 0 应该会立刻执行"></a>其一：js 里 <code>setTimeout</code> 如果延迟时间为 0 应该会立刻执行</h3><p>好吧，异步没有 <em>立刻执行</em> 这个说法，js 中异步函数实际上是被 <strong>事件队列</strong> 所管理的。当使用 <code>setTimeout</code> 函数时，即便延迟为 0，函数 <code>() =&gt; console.log(i)</code> 也不会立刻执行，而是会被放到 <strong>事件队列</strong> 中去，然后等待浏览器空闲之后执行。</p>
<p>在 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop#%E9%9B%B6%E5%BB%B6%E8%BF%9F">MDN</a> 上有一段关于零延迟的描述</p>
<blockquote>
<p>零延迟</p>
<p>零延迟并不意味着回调会立即执行。以 0 为第二参数调用 <code>setTimeout</code> 并不表示在 <code>0</code> 毫秒后就立即调用回调函数。<br>其等待的时间取决于队列里待处理的消息数量。在下面的例子中，”this is just a message” 将会在回调获得处理之前输出到控制台，这是因为延迟参数是运行时处理请求所需的最小等待时间，但并不保证是准确的等待时间。<br>基本上，<code>setTimeout</code> 需要等待当前队列中所有的消息都处理完毕之后才能执行，即使已经超出了由第二参数所指定的时间。</p>
</blockquote>
<p>所以 <code>setTimeout</code> 实际上并没有立刻执行，而是等到整个 <code>for</code> 循环结束之后才执行的。</p>
<h3 id="其二：js-里的-for-循环和-java-应该差不多，for-循环内部是单独的作用域"><a href="#其二：js-里的-for-循环和-java-应该差不多，for-循环内部是单独的作用域" class="headerlink" title="其二：js 里的 for 循环和 java 应该差不多，for 循环内部是单独的作用域"></a>其二：js 里的 for 循环和 java 应该差不多，for 循环内部是单独的作用域</h3><p>好吧，这个认知更是错的一塌糊涂，for 循环居然没有块级作用域？i 和 k 都是可以直接访问的，犹如直接声明到 for 循环外一样。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">var</span> k = <span class="number">10</span> - i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`i: <span class="subst">$&#123;i&#125;</span>, k: <span class="subst">$&#123;k&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果：</span></span><br><span class="line"><span class="comment">// i: 3, k: 8</span></span><br></pre></td></tr></table></figure>
<p>相当于</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> k;</span><br><span class="line"><span class="keyword">for</span> (; i &lt; <span class="number">3</span>; ) &#123;</span><br><span class="line">  k = <span class="number">10</span> - i;</span><br><span class="line">  i++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果换成 let 则两者都无法访问</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">let</span> k = <span class="number">10</span> - i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`i: <span class="subst">$&#123;i&#125;</span>, k: <span class="subst">$&#123;k&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果：</span></span><br><span class="line"><span class="comment">// Uncaught ReferenceError: i is not defined</span></span><br></pre></td></tr></table></figure>
<p>甚至还有一个更有趣的情况，在 for 的表达式和块中可以声明相同的变量，这只说明了一件事，let 声明的变量和循环内部声明的变量不在同一个作用域中！</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; <span class="built_in">console</span>.log(<span class="string">&quot;in for expression&quot;</span>, i), i++) &#123;</span><br><span class="line">  <span class="keyword">let</span> i;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;in for block&quot;</span>, i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果：</span></span><br><span class="line"><span class="comment">// in for block undefined</span></span><br><span class="line"><span class="comment">// in for expression 0</span></span><br><span class="line"><span class="comment">// in for block undefined</span></span><br><span class="line"><span class="comment">// in for expression 1</span></span><br><span class="line"><span class="comment">// in for block undefined</span></span><br><span class="line"><span class="comment">// in for expression 2</span></span><br></pre></td></tr></table></figure>
<p>或许，i 只是加了新的作用域，就像下面这样，如此，循环外面就访问不到内部的值，循环内部和 for 的表达式也同样不在一个作用域了，每次循环结束就更新这个值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  (<span class="function">(<span class="params">i</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(i), <span class="number">0</span>);</span><br><span class="line">  &#125;)(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>附：这里吾辈是根据 babel 编译的结果修改而来。而且 babel 真的很聪明，当迭代变量 i 没有更新时，就不会使用 <code>_i</code> 进行区分呢！</p>
</blockquote>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>重新建立了自己的认知之后，可以再对 <code>let/var</code> 在 for 循环进行分析了。</p>
<p>首先是 <code>let + for</code></p>
<h3 id="let-for"><a href="#let-for" class="headerlink" title="let + for"></a>let + for</h3><p>再看下面这段代码，可以对其进行分解</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(i), <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li> 创建 for 循环，表达式中存在 let 变量，for 将会创建一个块级作用域（ES6 let 专用）</li>
<li> 每次迭代时，会创建一个子块级作用域，迭代变量 i 也会重新生成</li>
<li> 对 i 的任何操作，都会被记住并赋值给下一次的迭代</li>
</ol>
<blockquote>
<p>块级作用域只对 let 有效，var 声明的变量仍然能在 for 循环外使用，证明 for 循环并不是像函数作用域那样是连 var 都能封闭的作用域。</p>
</blockquote>
<p>图解如下</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20181227212650.png" alt="let + for 图解"></p>
<h3 id="var-for"><a href="#var-for" class="headerlink" title="var + for"></a>var + for</h3><p>分析一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(i), <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li> 进入 for 循环</li>
<li> 在这里创建了迭代变量 i，因为是函数作用域变量所以在 for 循环外可以访问，被提升到了函数作用域顶部声明</li>
<li> setTimeout 函数执行，闭包绑定函数作用域外部变量 i，在循环结束输出 i 的值 3</li>
<li> 继续迭代</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20181227213014.png" alt="var + for 图解"></p>
<hr>
<p>所以以后如果可能，还是要拥抱这些新特性呢！那么，关于 <code>let/var</code> 在 <code>for</code> 循环中的区别就到这里啦</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/9c03bac44b51450c92565baf2cacd67e/" data-id="ckmcqox48006o0kuv1s9kc52w" data-title="let 与 var 在 for 循环中的区别" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/15/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="page-number" href="/page/15/">15</a><span class="page-number current">16</span><a class="page-number" href="/page/17/">17</a><a class="page-number" href="/page/18/">18</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/17/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/electron/" rel="tag">electron</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grid/" rel="tag">grid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jetbrains/" rel="tag">jetbrains</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/" rel="tag">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/" rel="tag">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/" rel="tag">sql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typescript/" rel="tag">typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vscode/" rel="tag">vscode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webstorm/" rel="tag">webstorm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AA%E4%BA%BA/" rel="tag">个人</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%AC%E5%8F%B8/" rel="tag">公司</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%91%A8%E6%8A%A5/" rel="tag">周报</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%A3%E5%91%8A/" rel="tag">宣告</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">工程化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E6%BA%90/" rel="tag">开源</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%82%E6%AD%A5/" rel="tag">异步</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%85%E6%9B%B4%E6%96%B0/" rel="tag">待更新</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82%E8%B0%88/" rel="tag">杂谈</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BB%8F%E9%AA%8C/" rel="tag">经验</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6/" rel="tag">读书</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">转载</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/css/" style="font-size: 12.14px;">css</a> <a href="/tags/electron/" style="font-size: 15.71px;">electron</a> <a href="/tags/git/" style="font-size: 12.86px;">git</a> <a href="/tags/grid/" style="font-size: 10.71px;">grid</a> <a href="/tags/java/" style="font-size: 19.29px;">java</a> <a href="/tags/javascript/" style="font-size: 20px;">javascript</a> <a href="/tags/jetbrains/" style="font-size: 12.14px;">jetbrains</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/markdown/" style="font-size: 10.71px;">markdown</a> <a href="/tags/react/" style="font-size: 14.29px;">react</a> <a href="/tags/sql/" style="font-size: 14.29px;">sql</a> <a href="/tags/typescript/" style="font-size: 12.14px;">typescript</a> <a href="/tags/vscode/" style="font-size: 12.86px;">vscode</a> <a href="/tags/vue/" style="font-size: 16.43px;">vue</a> <a href="/tags/webstorm/" style="font-size: 10px;">webstorm</a> <a href="/tags/windows/" style="font-size: 17.14px;">windows</a> <a href="/tags/%E4%B8%AA%E4%BA%BA/" style="font-size: 12.86px;">个人</a> <a href="/tags/%E5%85%AC%E5%8F%B8/" style="font-size: 10px;">公司</a> <a href="/tags/%E5%91%A8%E6%8A%A5/" style="font-size: 10px;">周报</a> <a href="/tags/%E5%AE%A3%E5%91%8A/" style="font-size: 10px;">宣告</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 13.57px;">工具</a> <a href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" style="font-size: 17.86px;">工程化</a> <a href="/tags/%E5%BC%80%E6%BA%90/" style="font-size: 10px;">开源</a> <a href="/tags/%E5%BC%82%E6%AD%A5/" style="font-size: 15px;">异步</a> <a href="/tags/%E5%BE%85%E6%9B%B4%E6%96%B0/" style="font-size: 10.71px;">待更新</a> <a href="/tags/%E6%9D%82%E8%B0%88/" style="font-size: 18.57px;">杂谈</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a> <a href="/tags/%E7%BB%8F%E9%AA%8C/" style="font-size: 11.43px;">经验</a> <a href="/tags/%E8%AF%BB%E4%B9%A6/" style="font-size: 12.14px;">读书</a> <a href="/tags/%E8%BD%AC%E8%BD%BD/" style="font-size: 11.43px;">转载</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/14/8fb2d58463ae4191ac064a76e15bffbd/">2021 第十周</a>
          </li>
        
          <li>
            <a href="/2021/03/12/7e7131c07c984d928ba3fefa7a9cef06/">读书-[颓废与沉默：透视犬儒文化]</a>
          </li>
        
          <li>
            <a href="/2021/03/02/db74e6e5d2444bc3b6e185a7b338bbf6/">electron 开发经验之谈系列-在渲染、主进程间共享数据</a>
          </li>
        
          <li>
            <a href="/2021/02/27/06cb464179cf45c598208534705aae3c/">2020 吾辈在公司推动的前端技术演进</a>
          </li>
        
          <li>
            <a href="/2021/02/23/cd66150d2b86448590fcc9bb2419c0b2/">实践 lerna monorepo</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>