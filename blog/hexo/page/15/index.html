<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/15/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-31d1f0aba5b748ed921b331de61bdf8a" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/31d1f0aba5b748ed921b331de61bdf8a/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/31d1f0aba5b748ed921b331de61bdf8a/">JavaScript 微任务/宏任务踩坑</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000019181961">SegmentFault</a></p>
</blockquote>
<p>在使用 <code>async-await</code> 时，吾辈总是习惯把它们当作同步，终于，现在踩到坑里去了。<br>使用 <code>setTimeout</code> 和 <code>setInterval</code> 实现的基于 <code>Promise</code> 的 <code>wait</code> 函数，然而测试边界情况的时候却发现了一些问题！</p>
<p>实现代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 等待指定的时间/等待指定表达式成立</span></span><br><span class="line"><span class="comment"> * 如果未指定等待条件则立刻执行</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number|Function&#125;</span> </span>[param] 等待时间/等待条件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Promise&#125;</span> </span>Promise 对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> wait = <span class="function">(<span class="params">param</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> param === <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(resolve, param);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> param === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (param()) &#123;</span><br><span class="line">          <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">          resolve();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="number">100</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>测试代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="comment">// 标识当前是否有异步函数 add 在运行了</span></span><br><span class="line">  <span class="keyword">let</span> taskIsRun = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> add = <span class="keyword">async</span> (_v, i) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 如果已经有运行的 add 函数，则等待</span></span><br><span class="line">    <span class="keyword">if</span> (taskIsRun) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(i + <span class="string">&quot; 判断前: &quot;</span>);</span><br><span class="line">      <span class="keyword">await</span> wait(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> !taskIsRun;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="built_in">console</span>.log(i + <span class="string">&quot; 判断后: &quot;</span> + taskIsRun);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      taskIsRun = <span class="literal">true</span>;</span><br><span class="line">      <span class="built_in">console</span>.log(i + <span class="string">&quot; 执行前: &quot;</span> + taskIsRun);</span><br><span class="line">      <span class="keyword">await</span> wait(<span class="number">100</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(i + <span class="string">&quot; 执行后: &quot;</span>);</span><br><span class="line">      taskIsRun = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> start = <span class="built_in">Date</span>.now();</span><br><span class="line">  <span class="keyword">await</span> <span class="built_in">Promise</span>.all(<span class="built_in">Array</span>(<span class="number">10</span>).fill(<span class="number">0</span>).map(add));</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">Date</span>.now() - start);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>那么，先不要往下看，猜一下最后打印的大概会是多少呢？</p>
<p>实际执行结果</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">0 执行前: <span class="literal">true</span> ​​​​​at ​​​i + <span class="string">&#x27; 执行前: &#x27;</span> + taskIsRun​​​ ​src/module/<span class="keyword">function</span>/wait.js:37:6​</span><br><span class="line"></span><br><span class="line">1 判断前:  ​​​​​at ​​​i + <span class="string">&#x27; 判断前: &#x27;</span>​​​ ​src/module/<span class="keyword">function</span>/wait.js:29:6​</span><br><span class="line"></span><br><span class="line">2 判断前:  ​​​​​at ​​​i + <span class="string">&#x27; 判断前: &#x27;</span>​​​ ​src/module/<span class="keyword">function</span>/wait.js:29:6​</span><br><span class="line"></span><br><span class="line">3 判断前:  ​​​​​at ​​​i + <span class="string">&#x27; 判断前: &#x27;</span>​​​ ​src/module/<span class="keyword">function</span>/wait.js:29:6​</span><br><span class="line"></span><br><span class="line">4 判断前:  ​​​​​at ​​​i + <span class="string">&#x27; 判断前: &#x27;</span>​​​ ​src/module/<span class="keyword">function</span>/wait.js:29:6​</span><br><span class="line"></span><br><span class="line">5 判断前:  ​​​​​at ​​​i + <span class="string">&#x27; 判断前: &#x27;</span>​​​ ​src/module/<span class="keyword">function</span>/wait.js:29:6​</span><br><span class="line"></span><br><span class="line">6 判断前:  ​​​​​at ​​​i + <span class="string">&#x27; 判断前: &#x27;</span>​​​ ​src/module/<span class="keyword">function</span>/wait.js:29:6​</span><br><span class="line"></span><br><span class="line">7 判断前:  ​​​​​at ​​​i + <span class="string">&#x27; 判断前: &#x27;</span>​​​ ​src/module/<span class="keyword">function</span>/wait.js:29:6​</span><br><span class="line"></span><br><span class="line">8 判断前:  ​​​​​at ​​​i + <span class="string">&#x27; 判断前: &#x27;</span>​​​ ​src/module/<span class="keyword">function</span>/wait.js:29:6​</span><br><span class="line"></span><br><span class="line">9 判断前:  ​​​​​at ​​​i + <span class="string">&#x27; 判断前: &#x27;</span>​​​ ​src/module/<span class="keyword">function</span>/wait.js:29:6​</span><br><span class="line"></span><br><span class="line">0 执行后:  ​​​​​at ​​​i + <span class="string">&#x27; 执行后: &#x27;</span>​​​ ​src/module/<span class="keyword">function</span>/wait.js:40:6​</span><br><span class="line"></span><br><span class="line">1 判断后: <span class="literal">false</span> ​​​​​at ​​​i + <span class="string">&#x27; 判断后: &#x27;</span> + taskIsRun​​​ ​src/module/<span class="keyword">function</span>/wait.js:33:6​</span><br><span class="line"></span><br><span class="line">1 执行前: <span class="literal">true</span> ​​​​​at ​​​i + <span class="string">&#x27; 执行前: &#x27;</span> + taskIsRun​​​ ​src/module/<span class="keyword">function</span>/wait.js:37:6​</span><br><span class="line"></span><br><span class="line">// 这儿的 1 执行前，结果 2 就已经判断通过并准备执行了？？？发生了什么？</span><br><span class="line"></span><br><span class="line">2 判断后: <span class="literal">true</span> ​​​​​at ​​​i + <span class="string">&#x27; 判断后: &#x27;</span> + taskIsRun​​​ ​src/module/<span class="keyword">function</span>/wait.js:33:6​</span><br><span class="line"></span><br><span class="line">2 执行前: <span class="literal">true</span> ​​​​​at ​​​i + <span class="string">&#x27; 执行前: &#x27;</span> + taskIsRun​​​ ​src/module/<span class="keyword">function</span>/wait.js:37:6​</span><br><span class="line"></span><br><span class="line">3 判断后: <span class="literal">true</span> ​​​​​at ​​​i + <span class="string">&#x27; 判断后: &#x27;</span> + taskIsRun​​​ ​src/module/<span class="keyword">function</span>/wait.js:33:6​</span><br><span class="line"></span><br><span class="line">3 执行前: <span class="literal">true</span> ​​​​​at ​​​i + <span class="string">&#x27; 执行前: &#x27;</span> + taskIsRun​​​ ​src/module/<span class="keyword">function</span>/wait.js:37:6​</span><br><span class="line"></span><br><span class="line">4 判断后: <span class="literal">true</span> ​​​​​at ​​​i + <span class="string">&#x27; 判断后: &#x27;</span> + taskIsRun​​​ ​src/module/<span class="keyword">function</span>/wait.js:33:6​</span><br><span class="line"></span><br><span class="line">4 执行前: <span class="literal">true</span> ​​​​​at ​​​i + <span class="string">&#x27; 执行前: &#x27;</span> + taskIsRun​​​ ​src/module/<span class="keyword">function</span>/wait.js:37:6​</span><br><span class="line"></span><br><span class="line">5 判断后: <span class="literal">true</span> ​​​​​at ​​​i + <span class="string">&#x27; 判断后: &#x27;</span> + taskIsRun​​​ ​src/module/<span class="keyword">function</span>/wait.js:33:6​</span><br><span class="line"></span><br><span class="line">5 执行前: <span class="literal">true</span> ​​​​​at ​​​i + <span class="string">&#x27; 执行前: &#x27;</span> + taskIsRun​​​ ​src/module/<span class="keyword">function</span>/wait.js:37:6​</span><br><span class="line"></span><br><span class="line">6 判断后: <span class="literal">true</span> ​​​​​at ​​​i + <span class="string">&#x27; 判断后: &#x27;</span> + taskIsRun​​​ ​src/module/<span class="keyword">function</span>/wait.js:33:6​</span><br><span class="line"></span><br><span class="line">6 执行前: <span class="literal">true</span> ​​​​​at ​​​i + <span class="string">&#x27; 执行前: &#x27;</span> + taskIsRun​​​ ​src/module/<span class="keyword">function</span>/wait.js:37:6​</span><br><span class="line"></span><br><span class="line">7 判断后: <span class="literal">true</span> ​​​​​at ​​​i + <span class="string">&#x27; 判断后: &#x27;</span> + taskIsRun​​​ ​src/module/<span class="keyword">function</span>/wait.js:33:6​</span><br><span class="line"></span><br><span class="line">7 执行前: <span class="literal">true</span> ​​​​​at ​​​i + <span class="string">&#x27; 执行前: &#x27;</span> + taskIsRun​​​ ​src/module/<span class="keyword">function</span>/wait.js:37:6​</span><br><span class="line"></span><br><span class="line">8 判断后: <span class="literal">true</span> ​​​​​at ​​​i + <span class="string">&#x27; 判断后: &#x27;</span> + taskIsRun​​​ ​src/module/<span class="keyword">function</span>/wait.js:33:6​</span><br><span class="line"></span><br><span class="line">8 执行前: <span class="literal">true</span> ​​​​​at ​​​i + <span class="string">&#x27; 执行前: &#x27;</span> + taskIsRun​​​ ​src/module/<span class="keyword">function</span>/wait.js:37:6​</span><br><span class="line"></span><br><span class="line">9 判断后: <span class="literal">true</span> ​​​​​at ​​​i + <span class="string">&#x27; 判断后: &#x27;</span> + taskIsRun​​​ ​src/module/<span class="keyword">function</span>/wait.js:33:6​</span><br><span class="line"></span><br><span class="line">9 执行前: <span class="literal">true</span> ​​​​​at ​​​i + <span class="string">&#x27; 执行前: &#x27;</span> + taskIsRun​​​ ​src/module/<span class="keyword">function</span>/wait.js:37:6​</span><br><span class="line"></span><br><span class="line">1 执行后:  ​​​​​at ​​​i + <span class="string">&#x27; 执行后: &#x27;</span>​​​ ​src/module/<span class="keyword">function</span>/wait.js:40:6​</span><br><span class="line"></span><br><span class="line">2 执行后:  ​​​​​at ​​​i + <span class="string">&#x27; 执行后: &#x27;</span>​​​ ​src/module/<span class="keyword">function</span>/wait.js:40:6​</span><br><span class="line"></span><br><span class="line">3 执行后:  ​​​​​at ​​​i + <span class="string">&#x27; 执行后: &#x27;</span>​​​ ​src/module/<span class="keyword">function</span>/wait.js:40:6​</span><br><span class="line"></span><br><span class="line">4 执行后:  ​​​​​at ​​​i + <span class="string">&#x27; 执行后: &#x27;</span>​​​ ​src/module/<span class="keyword">function</span>/wait.js:40:6​</span><br><span class="line"></span><br><span class="line">5 执行后:  ​​​​​at ​​​i + <span class="string">&#x27; 执行后: &#x27;</span>​​​ ​src/module/<span class="keyword">function</span>/wait.js:40:6​</span><br><span class="line"></span><br><span class="line">6 执行后:  ​​​​​at ​​​i + <span class="string">&#x27; 执行后: &#x27;</span>​​​ ​src/module/<span class="keyword">function</span>/wait.js:40:6​</span><br><span class="line"></span><br><span class="line">7 执行后:  ​​​​​at ​​​i + <span class="string">&#x27; 执行后: &#x27;</span>​​​ ​src/module/<span class="keyword">function</span>/wait.js:40:6​</span><br><span class="line"></span><br><span class="line">8 执行后:  ​​​​​at ​​​i + <span class="string">&#x27; 执行后: &#x27;</span>​​​ ​src/module/<span class="keyword">function</span>/wait.js:40:6​</span><br><span class="line"></span><br><span class="line">9 执行后:  ​​​​​at ​​​i + <span class="string">&#x27; 执行后: &#x27;</span>​​​ ​src/module/<span class="keyword">function</span>/wait.js:40:6​</span><br><span class="line"></span><br><span class="line">307 ​​​​​at ​​​Date.now() - start​​​ ​src/module/<span class="keyword">function</span>/wait.js:52:2​</span><br></pre></td></tr></table></figure>
<p>可以看到，很神奇的是 <em>判断后 =&gt; 执行前 =&gt; 判断后…=&gt; 执行后…_，并不是预想中的 _判断后 =&gt; 执行前 =&gt; 执行后…</em> 的循环，所以，到底发生了什么呢？</p>
<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>这个问题卡了吾辈两天之久，直到吾辈在 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/56126223/js-asynchronous-concurrent-locks-are-not-in-effect?noredirect=1#comment98896413_56126223">StackOverflow</a> 提出的另一个相关的问题被外国友人回答了，瞬间吾辈就想起了 – <strong>async-await 本质上还是异步</strong>。</p>
<p>是的，为什么会出现 <code>wait</code> 一直在执行而后面的 <code>taskIsRun = true</code> 却并没有执行？因为 JavaScript 中的 <code>async-await</code> 虽然可以写出来很像同步代码的异步代码，但实际上还是异步的，原理还是基于 <code>Promise</code>。</p>
<p>我们改造一下代码，将之使用原生 <code>Promise</code> 实现一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 等待指定的时间/等待指定表达式成立</span></span><br><span class="line"><span class="comment"> * 如果未指定等待条件则立刻执行</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number|Function&#125;</span> </span>[param] 等待时间/等待条件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Promise&#125;</span> </span>Promise 对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> wait = <span class="function">(<span class="params">param</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> param === <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(resolve, param);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> param === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (param()) &#123;</span><br><span class="line">          <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">          resolve();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="number">100</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 标识当前是否有异步函数 add 在运行了</span></span><br><span class="line">  <span class="keyword">let</span> taskIsRun = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> add = <span class="function">(<span class="params">_v, i</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 如果已经有运行的 add 函数，则等待</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve()</span><br><span class="line">      .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (taskIsRun) &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(i + <span class="string">&quot; 判断前: &quot;</span>);</span><br><span class="line">          <span class="comment">// 关键在于这里，实际上执行完成之后并不会到下一个 then，而是继续另一个 wait 的判断</span></span><br><span class="line">          <span class="keyword">return</span> wait(<span class="function">() =&gt;</span> !taskIsRun).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(i + <span class="string">&quot; 判断后: &quot;</span> + taskIsRun);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        taskIsRun = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(i + <span class="string">&quot; 执行前: &quot;</span> + taskIsRun);</span><br><span class="line">        <span class="keyword">return</span> wait(<span class="number">100</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line">      .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i + <span class="string">&quot; 执行后: &quot;</span>);</span><br><span class="line">        taskIsRun = <span class="literal">false</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> start = <span class="built_in">Date</span>.now();</span><br><span class="line">  <span class="built_in">Promise</span>.all(<span class="built_in">Array</span>(<span class="number">10</span>).fill(<span class="number">0</span>).map(add)).then(<span class="function">() =&gt;</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">Date</span>.now() - start)</span><br><span class="line">  );</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>这个时候就可以看出来了，判断逻辑是处在一个 <code>then</code> 后继里面的。那么，执行完 <code>console.log(i + &#39; 判断后: &#39; + taskIsRun)</code> 之后，就一定会继续执行下面的 <code>then</code> 函数么？并不，这时候 <code>wait</code> 函数内部实现中的 <code>setInterval</code> 还在运转，实际上 <code>nodejs</code> 并不会优先继续 <code>then</code> 这种 <code>microtask</code>（微任务），而是会继续进行 <code>setInterval</code> 这种 <code>macrotask</code>（宏任务）。这是 nodejs 与浏览器实现不一致的地方，吾辈将这些代码复制到浏览器上，确实可以正常执行并得到预期的结果。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://juejin.im/entry/58d4df3b5c497d0057eb99ff">微任务与宏任务参考</a></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (taskIsRun) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i + <span class="string">&quot; 判断前: &quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> wait(<span class="function">() =&gt;</span> !taskIsRun).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i + <span class="string">&quot; 判断后: &quot;</span> + taskIsRun);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>当然，nodejs 11 修复了这个问题，参考 <a target="_blank" rel="noopener" href="https://github.com/nodejs/node/pull/22842">https://github.com/nodejs/node/pull/22842</a>。然而目前 NodeJS LTS 为 10，最新版本为 12，这个问题可能还要持续一段时间。</p>
</blockquote>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>那么，难道吾辈就必须等到 NodeJS LTS 最新版之后才能用 wait 么？或者说，吾辈就必须依赖于浏览器的 <code>microtask/macrotask</code> 么？并不，吾辈对之手动进行了处理即可！</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 等待指定的时间/等待指定表达式成立</span></span><br><span class="line"><span class="comment"> * 如果未指定等待条件则立刻执行</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number|Function&#125;</span> </span>[param] 等待时间/等待条件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Promise&#125;</span> </span>Promise 对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> wait = <span class="function">(<span class="params">param</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> param === <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(resolve, param);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> param === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (param()) &#123;</span><br><span class="line">          <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">          resolve();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="number">100</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="comment">// 标识当前是否有异步函数 add 在运行了</span></span><br><span class="line">  <span class="keyword">let</span> taskIsRun = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> add = <span class="keyword">async</span> (_v, i) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 如果已经有运行的 add 函数，则等待</span></span><br><span class="line">    <span class="keyword">if</span> (taskIsRun) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(i + <span class="string">&quot; 判断前: &quot;</span>);</span><br><span class="line">      <span class="keyword">await</span> wait(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> result = !taskIsRun;</span><br><span class="line">        <span class="comment">// 关键在于这里</span></span><br><span class="line">        <span class="keyword">if</span> (result) &#123;</span><br><span class="line">          taskIsRun = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="built_in">console</span>.log(i + <span class="string">&quot; 判断后: &quot;</span> + taskIsRun);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      taskIsRun = <span class="literal">true</span>;</span><br><span class="line">      <span class="built_in">console</span>.log(i + <span class="string">&quot; 执行前: &quot;</span> + taskIsRun);</span><br><span class="line">      <span class="keyword">await</span> wait(<span class="number">100</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(i + <span class="string">&quot; 执行后: &quot;</span>);</span><br><span class="line">      taskIsRun = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> start = <span class="built_in">Date</span>.now();</span><br><span class="line">  <span class="keyword">await</span> <span class="built_in">Promise</span>.all(<span class="built_in">Array</span>(<span class="number">10</span>).fill(<span class="number">0</span>).map(add));</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">Date</span>.now() - start);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>吾辈在 <code>wait</code> 函数中，即 <code>setInterval</code> 循环调用的函数中对 <code>taskIsRun</code> 进行了修改，而不是在 <code>wait</code> 后面，即 <code>then</code> 之后的 <code>microtask</code> 中进行修改，结果便一切如同吾辈所期待的一样了！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/31d1f0aba5b748ed921b331de61bdf8a/" data-id="ckmcqox2s002b0kuv974s25bj" data-title="JavaScript 微任务/宏任务踩坑" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BC%82%E6%AD%A5/" rel="tag">异步</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-31ea5091fcf94d89b62a26aaf1e1e3ce" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/31ea5091fcf94d89b62a26aaf1e1e3ce/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/31ea5091fcf94d89b62a26aaf1e1e3ce/">为什么吾辈不对百度做 SEO 优化</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="闲言碎语"><a href="#闲言碎语" class="headerlink" title="闲言碎语"></a>闲言碎语</h2><p>任何事情都要有目标，而吾辈个人觉得，任何一位开发者，如果还只会用百度的话，那么终究有所不足。或许有人说这是崇洋媚外？然而事实上百度不仅在搜索质量上远不如 Google，而且还发生过多次不好的事件。正如一句话所言：<strong>谷歌一直在挑战人类智力的上限，百度却在挑战人类道德的下限！</strong></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/22447908">知乎：百度和 Google 的搜索技术是一个量级吗？</a></p>
</blockquote>
<p>综上所述，吾辈的目标用户便是能够翻墙（这件事本身并不是特别麻烦），能够使用 Google，使用 GitHub 的开发者。</p>
<h2 id="实名认证"><a href="#实名认证" class="headerlink" title="实名认证"></a>实名认证</h2><p>好吧，其实以上说的都不是真正的原因。对于吾辈而言，别人用什么工具，与吾辈并没有什么关系。根本原因是百度要求的信息实在太多太多了。看看，<strong>手机/邮箱/QQ/微信</strong> 一个不拉，调查户口么？呵呵，吾辈随便了，百度找不到就找不到，宁愿不要这些用户了也不想给你这些信息。</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20191026130601.png" alt="提交 sitemap 必填信息"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/31ea5091fcf94d89b62a26aaf1e1e3ce/" data-id="ckmcqox2u002g0kuva7kl71yh" data-title="为什么吾辈不对百度做 SEO 优化" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9D%82%E8%B0%88/" rel="tag">杂谈</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-3450e7cae37a4543b82e6abfbfc2bc8a" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/3450e7cae37a4543b82e6abfbfc2bc8a/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/3450e7cae37a4543b82e6abfbfc2bc8a/">在 JavaScript 定义类</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>在一个新的项目时，需要在 JavaScript 中编写与后端对应的实体类时，因为不想使用下面的方法定义类了，感觉实在不够灵活…</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> User = &#123;</span><br><span class="line">  <span class="comment">//more field and function</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">User</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//more field and function</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><blockquote>
<p>目前 ES6 已经完全普及开来，所以如果需要定义类的话，请使用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Classes">ES6 class 关键字</a> 定义类而非下面这几种方式（需要支持 IE 浏览器的读者可以继续往下看）。</p>
</blockquote>
<p>所以去 Google 了一下，大致发现了三种方法：</p>
<ol>
<li><p>构造函数法<br> 经典方法，基本上是 JavaScript 书籍上都会说的方法。使用构造函数模拟 <code>class</code>，在其内部使用 <code>this</code> 关键字指代实例对象。</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">User</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//注：这里所有的 property/function 都是对象级别（没错连方法都是。。。）。所以，toJSON() 方法在每个实例中都有一份，比较浪费内存，可以新建两 个 User 对象 user1,user2，然后使用 user1.toJSON === user2.toJSON 验证一下，你会发现为 false...(2333)</span></span><br><span class="line">  <span class="built_in">this</span>.name = <span class="string">&quot;rxliuli&quot;</span>;</span><br><span class="line">  <span class="built_in">this</span>.toJSON = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(<span class="built_in">this</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//想要定义所有对象都公用的 property/function，需要使用 Object.prototype 属性（原型），例如下面定义一个公用的 toJSON() 方法</span></span><br><span class="line">User.prototype.toJSON = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(<span class="built_in">this</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p> 这种方法的缺陷很明显了，定义起来实在太过麻烦，使用 Object.prototype 让对象的定义实在很不直观。</p>
</li>
<li><p>Object.create() 法<br> 为了解决 “构造函数法” 的缺点，更方便地生成对象，Javascript 的国际标准 ECMAScript 第五版（目前通行的是第五版），提出了一个新的方法 Object.create()。</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> User = &#123;</span><br><span class="line">  <span class="comment">//注：这里所有的 property/function 都是继承得到的（类似于上面的 Object.prototype），所以没有改变的 property/function 只会有一份</span></span><br><span class="line">  name: <span class="string">&quot;rxliuli&quot;</span>,</span><br><span class="line">  toJSON: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(<span class="built_in">this</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p> 调用的话直接使用 <code>Object.create()</code> 生成实例，并不需要使用 <code>new</code>。</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> user = <span class="built_in">Object</span>.create(User);</span><br><span class="line">user.name = <span class="string">&quot;琉璃&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(user.toJSON());</span><br></pre></td></tr></table></figure>
<p> 这种方法看起来简洁很多，但不能实现私有属性和私有方法，实例之间没有共享数据，对于模拟 <code>class</code> 而言并不是很好。</p>
</li>
<li><p>极简主义法<br> 据说是比 Object.create() 更好的方法，此方法不使用 <code>this</code> 和 <code>property</code>，代码部署起来也比较简单。</p>
<ul>
<li><p>封装<br><code>js var User = &#123; createNew: function () &#123; var user = &#123;&#125;; user.name = &#39;rxliuli&#39;; user.toJSON = function () &#123; return JSON.stringify(this); &#125;; return user; &#125; &#125;</code><br>使用时调用 <code>User.createNew()</code> 即可。<br><code>js var user = User.createNew(); user.name = &#39;琉璃&#39;; console.log(name);</code><br>不知道你有没有发现，这里使用 createNew() 创建的对象的方法又是对象级别的了。但这种方法定义好处是，可以实现私有属性/私有方法，能够实现继承，能够在 <code>class</code> 之间共享数据，同时允许在构造对象时传入参数。</p>
</li>
<li><p>继承<br>通过第三种方法可以很容易实现，只要子类在创建对象时调用父类的 <code>createNew()</code> 方法即可！<br>例如下面的 <code>Person</code> 和 <code>Student</code> 类。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> User = &#123;</span><br><span class="line">  createNew: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> user = &#123;&#125;;</span><br><span class="line">    user.name = <span class="string">&quot;rxliuli&quot;</span>;</span><br><span class="line">    user.toJSON = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(<span class="built_in">this</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Student = &#123;</span><br><span class="line">  createNew: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> student = User.createNew();</span><br><span class="line">    <span class="comment">/*这里只定义 Student 特有的方法属性和方法即可*/</span></span><br><span class="line">    student.grade = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> student;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
<li><p>私有属性和私有方法</p>
<p>在 <code>createNew()</code> 方法中，只要不是定义在 user 对象上的 property/function，就都是私有的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> User = &#123;</span><br><span class="line">    createNew: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> user = &#123;&#125;;</span><br><span class="line">        user.name = <span class="string">&#x27;rxliuli&#x27;</span>;</span><br><span class="line">        <span class="comment">/*私有属性（最好不要问女人的年龄哦）*/</span></span><br><span class="line">        <span class="keyword">var</span> age = <span class="number">17</span>;</span><br><span class="line">        <span class="comment">/*这里的变量 age 对于外部而言就是无法读取的，只有通过 user 的公有方*/</span>法 showAge() 读取</span><br><span class="line">        user.showAge = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            alert(age);</span><br><span class="line">        &#125;</span><br><span class="line">        user.toJSON = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(<span class="built_in">this</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>数据共享<br>有时候我们需要所有的实例对象都共享一项数据（其实就类似于静态变量/方法啦）。这种情况数据封装到类对象的里面，<code>createNew()</code> 方法的外面就好了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> User = &#123;</span><br><span class="line">  createNew: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> user = &#123;&#125;;</span><br><span class="line">    user.name = <span class="string">&quot;rxliuli&quot;</span>;</span><br><span class="line">    user.showAge = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      alert(age);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 这个方法便是所有 User 对象公用的方法啦</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;string&#125;</span></span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  toJSON: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(<span class="built_in">this</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>然后生成两个实例对象，这两个实例对象的 <code>toJSON()</code> 方法是同一个，如果有个实例对象修改了，那其他所有的对象都会受到影响。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> user = User.createNew();</span><br><span class="line"><span class="keyword">var</span> user2 = User.createNew();</span><br><span class="line"><span class="built_in">console</span>.log(user.toJSON === user2.toJSON);</span><br></pre></td></tr></table></figure>
<p>还记得上面提出的发现方法 3 的一个问题么？</p>
<blockquote>
<p>不知道你有没有发现，这里使用 createNew() 创建的对象的方法又是对象级别的了</p>
</blockquote>
<p>这里其实可以解决一部分的，当然，前提是你的数据不需要修改，然而需要修改的数据也不该使用共享数据了。</p>
</li>
</ul>
</li>
</ol>
<hr>
<p>其实也可以直接不使用类来构建对象的，使用 <code>&#123;&#125;</code> 也能直接进行构建对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> user = &#123;</span><br><span class="line">  name: <span class="string">&quot;rxliuli&quot;</span>,</span><br><span class="line">  <span class="comment">//注：这里所有的 property/function 都是对象级别（没错连方法都是。。。）。所以，toJSON() 方法在每个实例中都有一份，比较浪费内存</span></span><br><span class="line">  toJSON: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(<span class="built_in">this</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>好了，一个 <code>user</code> 对象就构建好了，可以立即使用了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user.name = <span class="string">&quot;琉璃&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(name);</span><br></pre></td></tr></table></figure>
<p>这种方法快速构建对象对于 function 参数而言很有帮助，然而同样缺陷极大，不适用于大量构造对象（因为每一次构建都要写这么多。。。），而且对象之间没有明显的关联。</p>
<p>那么，关于 JavaScript 定义类就到这里啦 (〜￣ ▽ ￣)〜</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/3450e7cae37a4543b82e6abfbfc2bc8a/" data-id="ckmcqox2y002q0kuvgxht12i4" data-title="在 JavaScript 定义类" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-3ad58690ff3f4aa695cb6ac6a7dbc0d7" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/3ad58690ff3f4aa695cb6ac6a7dbc0d7/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/3ad58690ff3f4aa695cb6ac6a7dbc0d7/">Vue 表格封装 BasicTableVue</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>后台项目中大量使用表格，我们使用的 <code>element-ui</code> 中的表格并不足以满足吾辈的需求，而且使用起来重复的代码实在太多，所以吾辈便对数据表格进行了二次封装。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="API-列表"><a href="#API-列表" class="headerlink" title="API 列表"></a>API 列表</h3><ul>
<li><code>[el]</code>: 绑定的选择器。默认为 <code>&#39;#app&#39;</code></li>
<li><code>data</code>: 数据对象<ul>
<li><code>form</code>: 搜索表单绑定对象</li>
<li><code>columns</code>: 表格的列数组。每个列定义参考 <code>TableColumn</code></li>
<li><code>[formShow]</code>: 是否显示搜索表单</li>
<li><code>[page]</code>: 分页信息，包含分页的数据。具体参考 <code>Page</code></li>
<li><code>[selectedIdList]</code>: 选中项的 <code>id</code> 列表</li>
<li><code>[fileSelectorShow]</code>: 是否显示导入 <code>Excel</code> 的文件选择器</li>
</ul>
</li>
<li><code>methods</code>: 绑定的函数<ul>
<li><code>createForm</code>: 初始化 <code>form</code> 表单，主要是为了自定义初始化逻辑</li>
<li><code>getPage</code>: 获取分页信息</li>
<li><code>exportFile</code>: 导出文件</li>
<li><code>importFile</code>: 导入文件</li>
<li><code>deleteData</code>: 删除选择的数据</li>
<li><code>[init]</code>: 初始化函数，如果可能请使用该函数而非重写 <code>mounted</code> 生命周期函数，该函数会在 <code>mounted</code> 中调用</li>
<li><code>[resetFile]</code>: 重置导入选择的文件，必须为 <code>input:file</code> 绑定属性 <code>ref=&quot;fileInput&quot;</code></li>
<li><code>[searchPage]</code>: 搜索分页信息</li>
<li><code>[resetPage]</code>: 重置分页信息</li>
<li><code>[toggle]</code>: 切换搜索表单显示</li>
<li><code>[selection]</code>: 选择的 <code>id</code></li>
<li><code>[changeSize]</code>: 改变一页的大小</li>
<li><code>[goto]</code>: 跳转到指定页数</li>
<li><code>[deleteSelected]</code>: 删除选择的数据项</li>
<li><code>[showFileSelector]</code>: 是否显示导入文件选择器</li>
<li><code>[initCommon]</code>: 初始化功能，如果重写了 <code>mounted</code> 生命周期函数，请务必调用它！</li>
</ul>
</li>
</ul>
<h3 id="自定义表格组件"><a href="#自定义表格组件" class="headerlink" title="自定义表格组件"></a>自定义表格组件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义表格组件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Vue.component(<span class="string">&quot;my-table&quot;</span>, &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 列</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  props: &#123;</span><br><span class="line">    columns: &#123;</span><br><span class="line">      type: <span class="built_in">Array</span>,</span><br><span class="line">      <span class="keyword">default</span>: [],</span><br><span class="line">    &#125;,</span><br><span class="line">    data: &#123;</span><br><span class="line">      type: <span class="built_in">Array</span>,</span><br><span class="line">      <span class="keyword">default</span>: [],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  template: <span class="string">`&lt;el-table</span></span><br><span class="line"><span class="string">  :data=&quot;data&quot;</span></span><br><span class="line"><span class="string">  tooltip-effect=&quot;dark&quot;</span></span><br><span class="line"><span class="string">  style=&quot;width: 100%&quot;</span></span><br><span class="line"><span class="string">  border</span></span><br><span class="line"><span class="string">  @selection-change=&quot;handleSelectionChange&quot;</span></span><br><span class="line"><span class="string">&gt;</span></span><br><span class="line"><span class="string">  &lt;template v-for=&quot;column in columns&quot;&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;el-table-column</span></span><br><span class="line"><span class="string">      :type=&quot;column.type&quot;</span></span><br><span class="line"><span class="string">      :prop=&quot;column.prop&quot;</span></span><br><span class="line"><span class="string">      :label=&quot;column.title&quot;</span></span><br><span class="line"><span class="string">      :align=&quot;column.align&quot;</span></span><br><span class="line"><span class="string">      :sortable=&quot;column.sortable&quot;</span></span><br><span class="line"><span class="string">      :width=&quot;column.width&quot;</span></span><br><span class="line"><span class="string">      :formatter=&quot;column.formatter&quot;</span></span><br><span class="line"><span class="string">      v-if=&quot;column.customComponent&quot;</span></span><br><span class="line"><span class="string">    &gt;</span></span><br><span class="line"><span class="string">      &lt;!--suppress HtmlUnknownAttribute --&gt;</span></span><br><span class="line"><span class="string">      &lt;template #default=&quot;scope&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;!--这里将传递给模板当前行的数据--&gt;</span></span><br><span class="line"><span class="string">        &lt;slot :name=&quot;humpToLine(column.prop)&quot; :row=&quot;scope.row&quot;&gt;&lt;/slot&gt;</span></span><br><span class="line"><span class="string">      &lt;/template&gt;</span></span><br><span class="line"><span class="string">    &lt;/el-table-column&gt;</span></span><br><span class="line"><span class="string">    &lt;el-table-column</span></span><br><span class="line"><span class="string">      :type=&quot;column.type&quot;</span></span><br><span class="line"><span class="string">      :prop=&quot;column.prop&quot;</span></span><br><span class="line"><span class="string">      :label=&quot;column.title&quot;</span></span><br><span class="line"><span class="string">      :align=&quot;column.align&quot;</span></span><br><span class="line"><span class="string">      :sortable=&quot;column.sortable&quot;</span></span><br><span class="line"><span class="string">      :width=&quot;column.width&quot;</span></span><br><span class="line"><span class="string">      :formatter=&quot;column.formatter&quot;</span></span><br><span class="line"><span class="string">      v-else</span></span><br><span class="line"><span class="string">    &gt;</span></span><br><span class="line"><span class="string">    &lt;/el-table-column&gt;</span></span><br><span class="line"><span class="string">  &lt;/template&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;/el-table&gt;`</span>,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="function"><span class="title">handleSelectionChange</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.$emit(<span class="string">&quot;handle-selection-change&quot;</span>, val);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">humpToLine</span>(<span class="params">data</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> toLine(data);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="定义一些公共的实体"><a href="#定义一些公共的实体" class="headerlink" title="定义一些公共的实体"></a>定义一些公共的实体</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页信息，多次使用到所以定义一个公共的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Page</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 构造函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>current 当前页数，从 1 开始</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>size 每页的数量</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>total 数据总条数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>pages 数据总页数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>records 一页的数据记录</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;...Object&#125;</span> </span>[args] 其他的参数项，这里只是为了避免遗漏</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;Page&#125;</span> </span>分页对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title">constructor</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">    current = <span class="number">1</span>,</span></span><br><span class="line"><span class="params">    size = <span class="number">10</span>,</span></span><br><span class="line"><span class="params">    total = <span class="number">0</span>,</span></span><br><span class="line"><span class="params">    pages = <span class="number">0</span>,</span></span><br><span class="line"><span class="params">    records = [],</span></span><br><span class="line"><span class="params">    ...args</span></span><br><span class="line"><span class="params">  &#125; = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.current = current;</span><br><span class="line">    <span class="built_in">this</span>.size = size;</span><br><span class="line">    <span class="built_in">this</span>.total = total;</span><br><span class="line">    <span class="built_in">this</span>.pages = pages;</span><br><span class="line">    <span class="built_in">this</span>.records = records;</span><br><span class="line">    <span class="built_in">Object</span>.assign(<span class="built_in">this</span>, args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 表格的列</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TableColumn</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 格式化日期事件</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>value 字段的值</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;String|*&#125;</span> </span>格式化得到的日期时间字符串 TableColumn.datetimeFormat()</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">datetimeFormat</span>(<span class="params">_row, _column, value, _index</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> !value ? <span class="string">&quot;&quot;</span> : rx.dateFormat(<span class="keyword">new</span> <span class="built_in">Date</span>(value), <span class="string">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 构造函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>[prop] 字段名</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>[title] 标题</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;&#x27;selection&#x27;&#125;</span> </span>[type] 列类型，可以设置为选择列</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Boolean&#125;</span> </span>[sortable=true] 排序方式</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>[width] 宽度</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;&#x27;center&#x27;&#125;</span> </span>[align=&#x27;center&#x27;] 水平对齐方式</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>[formatter] 格式化列</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Boolean&#125;</span> </span>[customComponent] 是否自定义组件</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;...Object&#125;</span> </span>[args] 其他的参数项，这里只是为了避免遗漏</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title">constructor</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">    prop,</span></span><br><span class="line"><span class="params">    type,</span></span><br><span class="line"><span class="params">    width,</span></span><br><span class="line"><span class="params">    title,</span></span><br><span class="line"><span class="params">    sortable = <span class="literal">true</span>,</span></span><br><span class="line"><span class="params">    align = <span class="string">&quot;center&quot;</span>,</span></span><br><span class="line"><span class="params">    formatter,</span></span><br><span class="line"><span class="params">    customComponent,</span></span><br><span class="line"><span class="params">    ...args</span></span><br><span class="line"><span class="params">  &#125; = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.prop = prop;</span><br><span class="line">    <span class="built_in">this</span>.type = type;</span><br><span class="line">    <span class="built_in">this</span>.width = width;</span><br><span class="line">    <span class="built_in">this</span>.align = align;</span><br><span class="line">    <span class="built_in">this</span>.title = title;</span><br><span class="line">    <span class="built_in">this</span>.sortable = sortable;</span><br><span class="line">    <span class="built_in">this</span>.align = align;</span><br><span class="line">    <span class="built_in">this</span>.formatter = formatter;</span><br><span class="line">    <span class="built_in">this</span>.customComponent = customComponent;</span><br><span class="line">    <span class="built_in">Object</span>.assign(<span class="built_in">this</span>, args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="定义一个-BasicTableVue-继承-Vue"><a href="#定义一个-BasicTableVue-继承-Vue" class="headerlink" title="定义一个 BasicTableVue 继承 Vue"></a>定义一个 BasicTableVue 继承 Vue</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 基本的表格数据配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicTableData</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 构造函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>[form=&#123;&#125;] 搜索表单，子类一般需要覆盖（不覆盖的话可能在 html 中没有提示）</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Array&lt;TableColumn&gt;&#125;</span> </span>[columns=[]] 列信息列表，子类必须覆盖</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Boolean&#125;</span> </span>[formShow=false] 是否显示搜索表单</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Page&#125;</span> </span>[page=new Page()] 分页信息，包含数据列表</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>[selectedIdList=[]] 选择的列表 id</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Boolean&#125;</span> </span>[fileSelectorShow=false] 导入文件选择器是否需要</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title">constructor</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">    form = &#123;&#125;,</span></span><br><span class="line"><span class="params">    columns = [],</span></span><br><span class="line"><span class="params">    formShow = <span class="literal">false</span>,</span></span><br><span class="line"><span class="params">    page = <span class="keyword">new</span> Page(),</span></span><br><span class="line"><span class="params">    selectedIdList = [],</span></span><br><span class="line"><span class="params">    fileSelectorShow = <span class="literal">false</span>,</span></span><br><span class="line"><span class="params">  &#125; = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.form = form;</span><br><span class="line">    <span class="built_in">this</span>.columns = columns;</span><br><span class="line">    <span class="built_in">this</span>.formShow = formShow;</span><br><span class="line">    <span class="built_in">this</span>.page = page;</span><br><span class="line">    <span class="built_in">this</span>.selectedIdList = selectedIdList;</span><br><span class="line">    <span class="built_in">this</span>.fileSelectorShow = fileSelectorShow;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 基本的表格方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicTableMethods</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 构造函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>createForm 初始化 form 表单，主要是为了自定义初始化逻辑</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>getPage 获取分页信息，需要覆盖</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>exportFile 导出文件，需要覆盖</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>importFile 导入文件，需要覆盖</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>deleteData 删除选择的数据，需要覆盖</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>init 初始化函数，如果可能请使用该函数而非重写 mounted 生命周期函数，该函数会在 mounted 中调用</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>[resetFile] 重置导入选择的文件，必须为 input:file 绑定属性 ref=&quot;fileInput&quot;</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>[searchPage] 搜索分页信息</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>[resetPage] 重置分页信息</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>[toggle] 切换搜索表单显示</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>[selection] 选择的 id</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>[changeSize] 改变一页的大小</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>[goto] 跳转到指定页数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>[deleteSelected] 删除选择的数据项</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>[showFileSelector] 是否显示导入文件选择器</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>[initCommon] 初始化功能，如果重写了 mounted 生命周期函数，请务必调用它！</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title">constructor</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">    createForm = <span class="keyword">function</span> () &#123;</span></span><br><span class="line"><span class="params">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;如果需要搜索条件，请重写 initForm() 方法&quot;</span>);</span></span><br><span class="line"><span class="params">    &#125;,</span></span><br><span class="line"><span class="params">    getPage = <span class="keyword">async</span> <span class="keyword">function</span> (page, entity) &#123;</span></span><br><span class="line"><span class="params">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;如果需要自动分页，请重写 getPage() 方法&quot;</span>);</span></span><br><span class="line"><span class="params">    &#125;,</span></span><br><span class="line"><span class="params">    exportFile = <span class="keyword">async</span> <span class="keyword">function</span> () &#123;</span></span><br><span class="line"><span class="params">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;如果需要导出数据，请重写 exportFile() 方法&quot;</span>);</span></span><br><span class="line"><span class="params">    &#125;,</span></span><br><span class="line"><span class="params">    importFile = <span class="keyword">function</span> () &#123;</span></span><br><span class="line"><span class="params">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;如果需要导入数据，请重写 importFile() 方法&quot;</span>);</span></span><br><span class="line"><span class="params">    &#125;,</span></span><br><span class="line"><span class="params">    deleteData = <span class="keyword">async</span> <span class="keyword">function</span> (idList) &#123;</span></span><br><span class="line"><span class="params">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;如果需要删除数据，请重写 deleteData 方法&quot;</span>);</span></span><br><span class="line"><span class="params">    &#125;,</span></span><br><span class="line"><span class="params">    init = <span class="keyword">async</span> <span class="keyword">function</span> () &#123;&#125;,</span></span><br><span class="line"><span class="params">    resetFile = <span class="keyword">function</span> () &#123;</span></span><br><span class="line"><span class="params">      <span class="keyword">const</span> $el = <span class="built_in">this</span>.$refs[<span class="string">&quot;fileInput&quot;</span>];</span></span><br><span class="line"><span class="params">      <span class="keyword">if</span> (!$el) &#123;</span></span><br><span class="line"><span class="params">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span></span><br><span class="line"><span class="params">          <span class="string">&quot;如果需要清空选择文件，请为 input:file 绑定属性 ref 的值为 fileInput&quot;</span></span></span><br><span class="line"><span class="params">        );</span></span><br><span class="line"><span class="params">      &#125;</span></span><br><span class="line"><span class="params">      $el.value = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="params">    &#125;,</span></span><br><span class="line"><span class="params">    searchPage = <span class="keyword">async</span> <span class="keyword">function</span> () &#123;</span></span><br><span class="line"><span class="params">      <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="params">        <span class="built_in">this</span>.page = <span class="keyword">await</span> <span class="built_in">this</span>.getPage(<span class="built_in">this</span>.page, <span class="built_in">this</span>.form);</span></span><br><span class="line"><span class="params">      &#125; <span class="keyword">catch</span> (e) &#123;</span></span><br><span class="line"><span class="params">        <span class="built_in">console</span>.error(e);</span></span><br><span class="line"><span class="params">        <span class="keyword">await</span> rxPrompt.dangerMsg(<span class="string">&quot;查询数据失败，请刷新页面&quot;</span>);</span></span><br><span class="line"><span class="params">      &#125;</span></span><br><span class="line"><span class="params">    &#125;,</span></span><br><span class="line"><span class="params">    resetPage = <span class="keyword">async</span> <span class="keyword">function</span> () &#123;</span></span><br><span class="line"><span class="params">      <span class="built_in">this</span>.form = <span class="built_in">this</span>.createForm();</span></span><br><span class="line"><span class="params">      <span class="keyword">await</span> <span class="built_in">this</span>.searchPage();</span></span><br><span class="line"><span class="params">    &#125;,</span></span><br><span class="line"><span class="params">    toggle = <span class="keyword">function</span> () &#123;</span></span><br><span class="line"><span class="params">      <span class="built_in">this</span>.formShow = !<span class="built_in">this</span>.formShow;</span></span><br><span class="line"><span class="params">    &#125;,</span></span><br><span class="line"><span class="params">    selection = <span class="keyword">function</span> (data) &#123;</span></span><br><span class="line"><span class="params">      <span class="built_in">this</span>.selectedIdList = data.map((&#123; id &#125;) =&gt; id);</span></span><br><span class="line"><span class="params">    &#125;,</span></span><br><span class="line"><span class="params">    changeSize = <span class="keyword">function</span> (size) &#123;</span></span><br><span class="line"><span class="params">      <span class="built_in">this</span>.page.current = <span class="number">1</span>;</span></span><br><span class="line"><span class="params">      <span class="built_in">this</span>.page.size = size;</span></span><br><span class="line"><span class="params">      <span class="built_in">this</span>.searchPage();</span></span><br><span class="line"><span class="params">    &#125;,</span></span><br><span class="line"><span class="params">    goto = <span class="keyword">function</span> (current) &#123;</span></span><br><span class="line"><span class="params">      <span class="keyword">if</span> (!current) &#123;</span></span><br><span class="line"><span class="params">        current = <span class="built_in">this</span>.page.current;</span></span><br><span class="line"><span class="params">      &#125;</span></span><br><span class="line"><span class="params">      <span class="keyword">if</span> (current &lt; <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="params">        <span class="keyword">return</span>;</span></span><br><span class="line"><span class="params">      &#125;</span></span><br><span class="line"><span class="params">      <span class="keyword">if</span> (current &gt; <span class="built_in">this</span>.page.pages) &#123;</span></span><br><span class="line"><span class="params">        <span class="keyword">return</span>;</span></span><br><span class="line"><span class="params">      &#125;</span></span><br><span class="line"><span class="params">      <span class="built_in">this</span>.page.current = current;</span></span><br><span class="line"><span class="params">      <span class="built_in">this</span>.searchPage();</span></span><br><span class="line"><span class="params">    &#125;,</span></span><br><span class="line"><span class="params">    deleteSelected = <span class="keyword">async</span> <span class="keyword">function</span> () &#123;</span></span><br><span class="line"><span class="params">      <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="built_in">this</span>.deleteData(<span class="built_in">this</span>.selectedIdList);</span></span><br><span class="line"><span class="params">      <span class="keyword">if</span> (result.code !== <span class="number">200</span> || !result.data) &#123;</span></span><br><span class="line"><span class="params">        <span class="keyword">await</span> rxPrompt.msg(<span class="string">&quot;&quot;</span>);</span></span><br><span class="line"><span class="params">        <span class="keyword">return</span>;</span></span><br><span class="line"><span class="params">      &#125;</span></span><br><span class="line"><span class="params">      <span class="regexp">//</span> noinspection JSIgnoredPromiseFromCall</span></span><br><span class="line"><span class="params">      rxPrompt.msg(<span class="string">&quot;删除成功&quot;</span>);</span></span><br><span class="line"><span class="params">      <span class="built_in">this</span>.page.current = <span class="number">1</span>;</span></span><br><span class="line"><span class="params">      <span class="keyword">await</span> <span class="built_in">this</span>.searchPage();</span></span><br><span class="line"><span class="params">    &#125;,</span></span><br><span class="line"><span class="params">    showFileSelector = <span class="keyword">function</span> () &#123;</span></span><br><span class="line"><span class="params">      <span class="built_in">this</span>.fileSelectorShow = !<span class="built_in">this</span>.fileSelectorShow;</span></span><br><span class="line"><span class="params">    &#125;,</span></span><br><span class="line"><span class="params">    initCommon = <span class="keyword">async</span> <span class="keyword">function</span> () &#123;</span></span><br><span class="line"><span class="params">      <span class="built_in">this</span>.form = <span class="built_in">this</span>.createForm();</span></span><br><span class="line"><span class="params">      <span class="built_in">this</span>.searchPage();</span></span><br><span class="line"><span class="params">    &#125;,</span></span><br><span class="line"><span class="params">  &#125; = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.createForm = createForm;</span><br><span class="line">    <span class="built_in">this</span>.getPage = getPage;</span><br><span class="line">    <span class="built_in">this</span>.searchPage = searchPage;</span><br><span class="line">    <span class="built_in">this</span>.resetPage = resetPage;</span><br><span class="line">    <span class="built_in">this</span>.toggle = toggle;</span><br><span class="line">    <span class="built_in">this</span>.selection = selection;</span><br><span class="line">    <span class="built_in">this</span>.changeSize = changeSize;</span><br><span class="line">    <span class="built_in">this</span>.goto = goto;</span><br><span class="line">    <span class="built_in">this</span>.exportFile = exportFile;</span><br><span class="line">    <span class="built_in">this</span>.importFile = importFile;</span><br><span class="line">    <span class="built_in">this</span>.resetFile = resetFile;</span><br><span class="line">    <span class="built_in">this</span>.deleteData = deleteData;</span><br><span class="line">    <span class="built_in">this</span>.init = init;</span><br><span class="line">    <span class="built_in">this</span>.deleteSelected = deleteSelected;</span><br><span class="line">    <span class="built_in">this</span>.showFileSelector = showFileSelector;</span><br><span class="line">    <span class="built_in">this</span>.initCommon = initCommon;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 基本的 vue 表格配置信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicTableOption</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 构造函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>[el=&#x27;#app&#x27;] 标签选择器</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;BasicTableData&#125;</span> </span>data 数据</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;BasicTableMethods&#125;</span> </span>methods 方法</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>mounted 初始化方法</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title">constructor</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">    el = <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="params">    data = <span class="keyword">new</span> BasicTableData(),</span></span><br><span class="line"><span class="params">    methods = <span class="keyword">new</span> BasicTableMethods(),</span></span><br><span class="line"><span class="params">    mounted = <span class="keyword">async</span> <span class="keyword">function</span> () &#123;</span></span><br><span class="line"><span class="params">      <span class="keyword">await</span> <span class="built_in">this</span>.initCommon();</span></span><br><span class="line"><span class="params">      <span class="keyword">await</span> <span class="built_in">this</span>.init();</span></span><br><span class="line"><span class="params">    &#125;,</span></span><br><span class="line"><span class="params">  &#125; = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.el = el;</span><br><span class="line">    <span class="built_in">this</span>.data = data;</span><br><span class="line">    <span class="built_in">this</span>.methods = methods;</span><br><span class="line">    <span class="built_in">this</span>.mounted = mounted;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 基本的表格 vue 类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicTableVue</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 构造函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;BasicTableOption&#125;</span> </span>option 初始化选项</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;BasicTableData|Function&#125;</span> </span>option.data vue 的 data 数据，如果是 &#123;<span class="doctag">@link </span>Function&#125; 类型，则必须返回 &#123;<span class="doctag">@link </span>BasicTableData&#125; 的结构</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;BasicTableMethods&#125;</span> </span>option.methods vue 中的 methods 属性</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>option.mounted 初始化方法，如果覆盖则必须手动初始化表格</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">&#123; data, methods, mounted, ...args &#125; = &#123;&#125;</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//注：这里为了应对 data 既有可能是对象，又有可能是函数的情况</span></span><br><span class="line">    <span class="built_in">super</span>(</span><br><span class="line">      _.merge(<span class="keyword">new</span> BasicTableOption(), &#123;</span><br><span class="line">        data: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> _.merge(</span><br><span class="line">            <span class="keyword">new</span> BasicTableData(),</span><br><span class="line">            <span class="keyword">typeof</span> data === <span class="string">&quot;function&quot;</span> ? data.call(<span class="built_in">this</span>) : data</span><br><span class="line">          );</span><br><span class="line">        &#125;,</span><br><span class="line">        methods,</span><br><span class="line">        mounted,</span><br><span class="line">        ...args,</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：这里分开这么多的类是因为便于 IDE 进行提示</p>
</blockquote>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>下面简单的使用一下 <code>BasicTableVue</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>用户列表<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 使用内置函数 toggle 切换表单是否显示 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;toggle&quot;</span>&gt;</span>高级搜索<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 使用 formShow 属性控制表单是否显示 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">form</span> <span class="attr">v-show</span>=<span class="string">&quot;formShow&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;name&quot;</span>&gt;</span>名字：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;form.name&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;age&quot;</span>&gt;</span>年龄：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;form.age&quot;</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 使用 searchPage 查询 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;searchPage&quot;</span>&gt;</span>查询<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 使用 resetPage 重置条件并搜索 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;resetPage&quot;</span>&gt;</span>重置<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">          分页数据绑定 page 对象的 records 属性</span></span><br><span class="line"><span class="comment">          表格的列绑定 columns 属性（需要自定义覆盖）</span></span><br><span class="line"><span class="comment">          选中的项需要将 selection 属性绑定到 @handle-selection-change 事件</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        &lt;my-table</span><br><span class="line">          :data=&quot;page.records&quot;</span><br><span class="line">          :columns=&quot;columns&quot;</span><br><span class="line">          @handle-selection-change=&quot;selection&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">            定义自定义操作列</span></span><br><span class="line"><span class="comment">            scope 指代当前行的信息</span></span><br><span class="line"><span class="comment">           --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">template</span> #<span class="attr">operating</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="comment">&lt;!-- 将自定义的函数绑定到 @click.stop.prevent 上 --&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click.stop.prevent</span>=<span class="string">&quot;() =&gt; viewInfo(scope.row)&quot;</span>&gt;</span></span><br><span class="line">                查看信息</span><br><span class="line">              <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">my-table</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">          分页组件</span></span><br><span class="line"><span class="comment">          将内置的属性或函数绑定到 el-pagination 组件上</span></span><br><span class="line"><span class="comment">          changeSize(): 改变一页数据大小的函数</span></span><br><span class="line"><span class="comment">          goto(): 跳转指定页的函数</span></span><br><span class="line"><span class="comment">          page: 具体参考 Page 对象</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        &lt;el-pagination</span><br><span class="line">          background</span><br><span class="line">          @size-change=&quot;changeSize&quot;</span><br><span class="line">          @current-change=&quot;goto&quot;</span><br><span class="line">          :current-page=&quot;page.current&quot;</span><br><span class="line">          :page-sizes=&quot;[10, 20, 30]&quot;</span><br><span class="line">          :page-size=&quot;page.size&quot;</span><br><span class="line">          layout=&quot;total, sizes, prev, pager, next, jumper&quot;</span><br><span class="line">          :total=&quot;page.total&quot;</span><br><span class="line">        &gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-pagination</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/user-info.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>JavaScript 部分</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">&#123; id, name, age, ...args &#125;</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.id = id;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.age = age;</span><br><span class="line">    <span class="built_in">Object</span>.assign(<span class="built_in">this</span>, args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> BasicTableVue(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    columns: [</span><br><span class="line">      <span class="keyword">new</span> TableColumn(&#123; <span class="attr">width</span>: <span class="number">30</span>, <span class="attr">type</span>: <span class="string">&quot;selection&quot;</span> &#125;),</span><br><span class="line">      <span class="keyword">new</span> TableColumn(&#123; <span class="attr">prop</span>: <span class="string">&quot;name&quot;</span>, <span class="attr">title</span>: <span class="string">&quot;姓名&quot;</span> &#125;),</span><br><span class="line">      <span class="keyword">new</span> TableColumn(&#123; <span class="attr">prop</span>: <span class="string">&quot;age&quot;</span>, <span class="attr">title</span>: <span class="string">&quot;年龄&quot;</span> &#125;),</span><br><span class="line">      <span class="keyword">new</span> TableColumn(&#123;</span><br><span class="line">        prop: <span class="string">&quot;operating&quot;</span>,</span><br><span class="line">        title: <span class="string">&quot;操作&quot;</span>,</span><br><span class="line">        customComponent: <span class="literal">true</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="function"><span class="title">createForm</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> UserInfo();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getPage</span>(<span class="params">page, entity</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">await</span> baseUserInfoApi.page(page, entity);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">deleteData</span>(<span class="params">idList</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> baseCustomerApi.delete(idList);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">viewInfo</span>(<span class="params">row</span>)</span> &#123;</span><br><span class="line">      forward(<span class="string">&quot;/user_info_detail&quot;</span>, row);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">init</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;这里想做一些自定义的初始化操作&quot;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里需要注意一些要点</p>
<ol>
<li> 如果需要在 <code>data</code> 中调用 <code>methods</code> 中的函数，则 <code>data</code> 必须是一个函数并返回对象</li>
<li> 不要直接重写 <code>mounted()</code> 生命周期函数，而是在重写的 <code>init()</code> 中进行自定义操作</li>
<li> 任何实体都需要有 <code>...args</code> 属性以避免一些没有声明的属性找不到</li>
</ol>
</blockquote>
<hr>
<p>那么，关于 <code>BasicTableVue</code> 的封装便到此结束了。这是一个相当简陋的封装，如果有什么更好的方式，后面也会更新。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/3ad58690ff3f4aa695cb6ac6a7dbc0d7/" data-id="ckmcqox30002x0kuv0hsdgvcz" data-title="Vue 表格封装 BasicTableVue" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-3e64e55b47d744b69223180d6e17df89" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/3e64e55b47d744b69223180d6e17df89/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/3e64e55b47d744b69223180d6e17df89/">Windows 下 Git 中文乱码</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>在公司的电脑上碰到了 Git 中文乱码的问题，例如想要查看一下仓库的状态，中文全部变成了 <code> umber</code> 的形式。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up to date with <span class="string">&#x27;origin/master&#x27;</span>.</span><br><span class="line"></span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line"></span><br><span class="line">        modified:   <span class="string">&quot;source/_posts/JavaScript/\345\234\250\344\274\240\347\273\237\351\241\271\347\233\256\344\270\255\344\275\277\347\224\250-babel-\347\274\226\350\257\221-ES6.md&quot;</span></span><br><span class="line">        modified:   <span class="string">&quot;source/_posts/Tool/IDEA/IDEA \344\275\277\347\224\250\346\212\200\345\267\247.md&quot;</span></span><br><span class="line">        modified:   <span class="built_in">test</span>/test.html</span><br><span class="line">        modified:   <span class="built_in">test</span>/test.js</span><br><span class="line"></span><br><span class="line">no changes added to commit (use <span class="string">&quot;git add&quot;</span> and/or <span class="string">&quot;git commit -a&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><blockquote>
<p>该方案摘抄自 <a target="_blank" rel="noopener" href="https://gist.github.com/nightire/5069597">解决 Git 在 windows 下中文乱码的问题</a></p>
</blockquote>
<p>配置一下这些内容即可</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git config --global core.quotepath <span class="literal">false</span> <span class="comment"># 显示 status 编码</span></span><br><span class="line">git config --global gui.encoding utf-8 <span class="comment"># 图形界面编码</span></span><br><span class="line">git config --global i18n.commit.encoding utf-8 <span class="comment"># 提交信息编码</span></span><br><span class="line">git config --global i18n.logoutputencoding utf-8 <span class="comment"># 输出 log 编码</span></span><br><span class="line"><span class="built_in">export</span> LESSCHARSET=utf-8 <span class="comment"># 最后一条命令是因为 git log 默认使用 less 分页，所以需要 bash 对 less 命令进行 utf-8 编码</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/3e64e55b47d744b69223180d6e17df89/" data-id="ckmcqox3200350kuv6mfd13c6" data-title="Windows 下 Git 中文乱码" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/windows/" rel="tag">windows</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-4c63d8622cc0492da461caec1e99dc5e" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/4c63d8622cc0492da461caec1e99dc5e/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/4c63d8622cc0492da461caec1e99dc5e/">JavaScript 自定义解析字符串为 Date 对象</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>这两天在 JavaScript 遇到需要根据自定义的格式创建 <code>Date</code> 对象的情况，所以就没多想写个了解析方法。</p>
<p>基本思路是将非标准的日期字符串转换为标准的日期字符串，然后再创建对象。</p>
<p>具体的步骤如下：</p>
<ol>
<li> 接收两个字符串参数，分别代表要进行解析的字符串 <code>dateStr</code>，以及该字符串需要的自定义日期字符串格式 <code>fmt</code>。</li>
<li> 先解析 <code>fmt</code>，获取其中的代表 <code>year, method, day, hour, minute, second, milliSecond</code> 的部分得到一个数组（并且记录不同部分的 <code>index</code>）<code>dateUnits</code>，对 <code>fmt</code> 的代表日期的不同部分进行替换.</li>
<li> 使用替换过的 <code>fmt</code> 创建正则验证 <code>dateStr</code> 是否合法，非法直接返回 <code>null</code>。</li>
<li> 对 <code>dateUnits</code> 根据 <code>index</code> 进行排序，得到一个按照原本的 <code>fmt</code> 的不同日期部分的顺序的数组。</li>
<li> 遍历 <code>dateUnits</code> 获取到不同的部分，然后拼接成一个标准的(<code>yyyy-MM-ddThh:mm:ss.SSS</code>)日期字符串 <code>date</code>。</li>
<li> 使用 new Date(date) 并且返回。</li>
</ol>
<p>全部代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解析字符串为 Date 对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>dateStr 日期字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>fmt 日期字符串的格式</span></span><br><span class="line"><span class="comment"> * 目前仅支持使用 y(年),M(月),d(日),h(时),m(分),s(秒),S(毫秒)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">Date</span>.of = <span class="function"><span class="keyword">function</span> (<span class="params">dateStr, fmt</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!dateStr) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;传入的日期字符串不能为空！&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!fmt) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;传入的日期字符串的自定义格式不能为空！&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 日期格式化对象</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>name 日期格式的名称</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>format 日期的格式值</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>value 格式化得到的值</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@constructor</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">DateFormat</span>(<span class="params">name, format, value, index</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.format = format;</span><br><span class="line">    <span class="built_in">this</span>.value = value;</span><br><span class="line">    <span class="built_in">this</span>.index = index;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//日期时间的正则表达式</span></span><br><span class="line">  <span class="keyword">const</span> dateFormats = &#123;</span><br><span class="line">    year: <span class="string">&quot;y&#123;1,4&#125;&quot;</span>,</span><br><span class="line">    month: <span class="string">&quot;M&#123;1,2&#125;&quot;</span>,</span><br><span class="line">    day: <span class="string">&quot;d&#123;1,2&#125;&quot;</span>,</span><br><span class="line">    hour: <span class="string">&quot;h&#123;1,2&#125;&quot;</span>,</span><br><span class="line">    minute: <span class="string">&quot;m&#123;1,2&#125;&quot;</span>,</span><br><span class="line">    second: <span class="string">&quot;s&#123;1,2&#125;&quot;</span>,</span><br><span class="line">    milliSecond: <span class="string">&quot;S&#123;1,3&#125;&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//如果没有格式化某项的话则设置为默认时间</span></span><br><span class="line">  <span class="keyword">const</span> defaultDateValues = &#123;</span><br><span class="line">    year: <span class="string">&quot;2001&quot;</span>,</span><br><span class="line">    month: <span class="string">&quot;01&quot;</span>,</span><br><span class="line">    day: <span class="string">&quot;01&quot;</span>,</span><br><span class="line">    hour: <span class="string">&quot;00&quot;</span>,</span><br><span class="line">    minute: <span class="string">&quot;00&quot;</span>,</span><br><span class="line">    second: <span class="string">&quot;00&quot;</span>,</span><br><span class="line">    milliSecond: <span class="string">&quot;000&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//保存对传入的日期字符串进行格式化的全部信息数组列表</span></span><br><span class="line">  <span class="keyword">const</span> dateUnits = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> fmtName <span class="keyword">in</span> dateFormats) &#123;</span><br><span class="line">    <span class="keyword">const</span> regExp = <span class="keyword">new</span> <span class="built_in">RegExp</span>(dateFormats[fmtName]);</span><br><span class="line">    <span class="keyword">if</span> (regExp.test(fmt)) &#123;</span><br><span class="line">      <span class="keyword">const</span> matchStr = regExp.exec(fmt)[<span class="number">0</span>];</span><br><span class="line">      <span class="keyword">const</span> regexStr = <span class="built_in">String</span>.fill(<span class="string">&quot;`&quot;</span>, matchStr.length);</span><br><span class="line">      <span class="keyword">const</span> index = fmt.indexOf(matchStr);</span><br><span class="line">      fmt = fmt.replaceAll(matchStr, regexStr);</span><br><span class="line">      dateUnits.push(</span><br><span class="line">        <span class="keyword">new</span> DateFormat(</span><br><span class="line">          fmtName,</span><br><span class="line">          <span class="built_in">String</span>.fill(<span class="string">&quot;\\d&quot;</span>, matchStr.length),</span><br><span class="line">          <span class="literal">null</span>,</span><br><span class="line">          index</span><br><span class="line">        )</span><br><span class="line">      );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      dateUnits.push(</span><br><span class="line">        <span class="keyword">new</span> DateFormat(fmtName, <span class="literal">null</span>, defaultDateValues[fmtName], -<span class="number">1</span>)</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//进行验证是否真的是符合传入格式的字符串</span></span><br><span class="line">  fmt = fmt.replaceAll(<span class="string">&quot;`&quot;</span>, <span class="string">&quot;d&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">new</span> <span class="built_in">RegExp</span>(fmt).test(dateStr)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//进行一次排序, 依次对字符串进行截取</span></span><br><span class="line">  dateUnits.sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.index - b.index;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, length = dateUnits.length; i &lt; length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> format = dateUnits[i].format;</span><br><span class="line">    <span class="keyword">if</span> (format == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> matchDateUnit = <span class="keyword">new</span> <span class="built_in">RegExp</span>(format).exec(dateStr);</span><br><span class="line">    <span class="keyword">if</span> (matchDateUnit !== <span class="literal">null</span> &amp;&amp; matchDateUnit.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      dateStr = dateStr.replace(matchDateUnit[<span class="number">0</span>], <span class="string">&quot;&quot;</span>);</span><br><span class="line">      dateUnits[i].value = matchDateUnit[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//将截取完成的信息封装成对象并格式化标准的日期字符串</span></span><br><span class="line">  <span class="keyword">const</span> obj = dateUnits.toObject(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      key: item.name,</span><br><span class="line">      value: item.value,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> date = <span class="string">&quot;&#123;year&#125;-&#123;month&#125;-&#123;day&#125;T&#123;hour&#125;:&#123;minute&#125;:&#123;second&#125;.&#123;milliSecond&#125;&quot;</span>.format(</span><br><span class="line">    obj</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(date);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//下面是上面的 Date.of() 使用的一些辅助方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 替换所有匹配exp的字符串为指定字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>exp 被替换部分的正则</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>newStr 替换成的字符串</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">String</span>.prototype.replaceAll = <span class="function"><span class="keyword">function</span> (<span class="params">exp, newStr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(exp, <span class="string">&quot;gm&quot;</span>), newStr);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 原型：字符串格式化</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>args 格式化参数值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">String</span>.prototype.format = <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = <span class="built_in">this</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &lt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> data = <span class="built_in">arguments</span>; <span class="comment">// 如果模板参数是数组</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">arguments</span>.length === <span class="number">1</span> &amp;&amp; <span class="keyword">typeof</span> args === <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果模板参数是对象</span></span><br><span class="line">    data = args;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> data) &#123;</span><br><span class="line">    <span class="keyword">var</span> value = data[key];</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">undefined</span> !== value) &#123;</span><br><span class="line">      result = result.replaceAll(<span class="string">&quot;\\&#123;&quot;</span> + key + <span class="string">&quot;\\&#125;&quot;</span>, value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 为 js 的 String 添加填充字符串的静态方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>item 填充的元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>length 填充的长度</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;string&#125;</span> </span>填充得到的字符串</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">String</span>.fill = <span class="function"><span class="keyword">function</span> (<span class="params">item, length</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">    result += item;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * js 数组转换为一个 Object 对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>fn 转换方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;&#123;&#125;</span></span>&#125; 得到的 Object 对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.toObject = <span class="function"><span class="keyword">function</span> (<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line">  <span class="built_in">this</span>.map(fn).forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">    obj[item.key] = item.value;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Code Gist：<a target="_blank" rel="noopener" href="https://gist.github.com/rxliuli/a81f058d03a99cbd08d6ca6095b2c7cb">https://gist.github.com/rxliuli/a81f058d03a99cbd08d6ca6095b2c7cb</a></p>
<p>那么，关于 <code>JavaScript</code> 中的字符串解析为 <code>Date</code> 对象就到这里啦，如果有什么错误/更好的建议都可以提出来呢</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/4c63d8622cc0492da461caec1e99dc5e/" data-id="ckmcqox39003m0kuv6jzn80h5" data-title="JavaScript 自定义解析字符串为 Date 对象" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-54792a3f54a5427a810dcdc81a65be06" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/54792a3f54a5427a810dcdc81a65be06/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/54792a3f54a5427a810dcdc81a65be06/">react 受控表单必须初始化</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>这些天在学习 <code>React</code> 的时候遇到了一个奇怪的问题，明明受控表单的双向绑定已经成功了，然而控制台还是会出现 react 的警告：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Warning: A component is changing an uncontrolled input of <span class="built_in">type</span> undefined to be controlled. Input elements should not switch from uncontrolled to controlled (or vice versa). Decide between using a controlled or uncontrolled input element <span class="keyword">for</span> the lifetime of the component.</span><br></pre></td></tr></table></figure>
<p>代码很简单，仅仅只是一个登录表单</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">&#123; username, password &#125; = &#123;&#125;</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.username = username;</span><br><span class="line">    <span class="built_in">this</span>.password = password;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; User &#125; <span class="keyword">from</span> <span class="string">&quot;./User&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      user: <span class="keyword">new</span> User(),</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  change = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> el = e.target;</span><br><span class="line">    <span class="keyword">const</span> k = el.name;</span><br><span class="line">    <span class="keyword">const</span> v = el.value;</span><br><span class="line">    <span class="keyword">const</span> user = &#123; ...this.state.user &#125;;</span><br><span class="line">    user[k] = v;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      user,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  submit = <span class="function">() =&gt;</span> &#123;&#125;;</span><br><span class="line">  reset = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      user: <span class="keyword">new</span> User(),</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; username, password &#125; = <span class="built_in">this</span>.state.user;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;label htmlFor=<span class="string">&quot;username&quot;</span>&gt;用户名: &lt;/label&gt;</span><br><span class="line">          &lt;input name=<span class="string">&quot;username&quot;</span> value=&#123;username&#125; onChange=&#123;<span class="built_in">this</span>.change&#125; /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;label htmlFor=<span class="string">&quot;password&quot;</span>&gt;密码: &lt;/label&gt;</span><br><span class="line">          &lt;input name=<span class="string">&quot;password&quot;</span> value=&#123;password&#125; onChange=&#123;<span class="built_in">this</span>.change&#125; /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;button onClick=&#123;<span class="built_in">this</span>.submit&#125;&gt;登录&lt;/button&gt;</span><br><span class="line">          &lt;button onClick=&#123;<span class="built_in">this</span>.reset&#125;&gt;重置&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p>在 App 组件的 <code>constructor</code> 中明明已经通过 <code>new User()</code> 初始化了 <code>user</code> 属性，然而在输入的时候，还是会出现警告。</p>
<blockquote>
<p>注：此时在输入框中输入值，确实会影响到 react state 中的 user 属性，反之亦然。只有一点，当重置表单，即使用 <code>this.setState(&#123;user: new User()&#125;)</code> 重置 user 对象无法影响到页面上输入框的值。</p>
</blockquote>
<p>此处出现了两个问题</p>
<ol>
<li> 为什么在输入的时候会出现警告</li>
<li> 为什么重置之后输入框的值没有变化</li>
</ol>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>最终，吾辈在 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/37427508">StackOverflow</a> 上找到了答案。<br>很重要的一句话：<strong>对于要控制的输入，其值必须与状态变量的值相对应。</strong><br>最初并未满足这个条件，值为 <code>null</code> 的 <code>state</code> 属性会被 <code>react</code> 视为未定义，导致表单最初是不受控制的。但是，当 <code>onChange</code> 第一次被触发的时候，<code>this.state.user.username</code> 就被设置了。此时，满足了条件，从非受控表单转换为了受控表单并导致了控制台的警告。<br>同理，当使用 <code>this.setState(&#123;user: new User()&#125;)</code> 重置的时候，又变成了非受控表单，所以这里的绑定再次失效了。</p>
<blockquote>
<p>注: react 使用 <code>==</code> 而非 <code>===</code> 比较是否为 <code>null</code>，而 <code>null == undefined</code> 的值为 <code>true</code>，所以。。。</p>
</blockquote>
<p>那么，知道问题了之后，我们只要保证初始值 <code>val != null</code> 即可。<br>例如上面的代码可以修改 <code>User.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">&#123; username = <span class="string">&quot;&quot;</span>, password = <span class="string">&quot;&quot;</span> &#125; = &#123;&#125;</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.username = username;</span><br><span class="line">    <span class="built_in">this</span>.password = password;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么，关于 react 中的受控表单初始化的问题便到此为止了。可想而知，react 的坑还有很多没有踩完呢</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/54792a3f54a5427a810dcdc81a65be06/" data-id="ckmcqox3d003t0kuv69qocaw5" data-title="react 受控表单必须初始化" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react/" rel="tag">react</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-5b11af8492fe498483c9132787e04f45" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/5b11af8492fe498483c9132787e04f45/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/5b11af8492fe498483c9132787e04f45/">Vue 实现一个简单的瀑布流组件</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>在用 Vue 写前端的时候，需要实现无限滚动翻页的功能。因为用到的地方很多，于是便想着抽出一个通用组件。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><blockquote>
<p>实现源码放到了 <a target="_blank" rel="noopener" href="https://github.com/rxliuli/vue-waterfalls-flow">GitHub</a>，<a target="_blank" rel="noopener" href="https://vue-waterfalls-flow.rxliuli.com/">Demo 演示</a> 想直接看源码/效果的人可以直接去看</p>
</blockquote>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><ol>
<li> 定义一个 vuejs 容器组件</li>
<li> 抽离出公共的属性（加载一页数据的函数/每个元素的模板）</li>
<li> 在父容器中遍历每个元素并绑定到传入的模板上</li>
<li> 监听滚动事件，如果不是最后一页就加载下一页</li>
<li> 重新渲染集合元素</li>
</ol>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>定义模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">自定义瀑布流组件</span><br><span class="line">使用方法如下：</span><br><span class="line">&lt;rx-waterfalls-flow :load&#x3D;&quot;load&quot;&gt;</span><br><span class="line">    &lt;!-- 这里 slotProps 绑定的便是子组件的数据，通过 slotProps 可以访问到子组件绑定到模板上的数据，当然，更简单的方法是使用 ES6 的解构 --&gt;</span><br><span class="line">    &lt;template slot-scope&#x3D;&quot;&#123;item&#125;&quot;&gt;</span><br><span class="line">  &lt;!-- 在模板里面便可以使用集合中的元素 item 了 --&gt;</span><br><span class="line">  &lt;li :key&#x3D;&quot;item.id&quot;&gt;</span><br><span class="line">    &#123;&#123;item.text&#125;&#125;</span><br><span class="line">  &lt;&#x2F;li&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">  &lt;&#x2F;rx-waterfalls-flow&gt;</span><br><span class="line"> *&#x2F;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id&#x3D;&quot;rx-waterfalls-flow-container&quot;&gt;</span><br><span class="line">    &lt;slot</span><br><span class="line">      v-for&#x3D;&quot;item in items&quot;</span><br><span class="line">      :item&#x3D;&quot;item&quot;</span><br><span class="line">    &#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    load: &#123;</span><br><span class="line">      type: Function,</span><br><span class="line">      default: function () &#123;</span><br><span class="line">        throw new Error(&#39;你需要为 RxWaterfallsFlow 组件定义分页加载的参数&#39;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data: () &#x3D;&gt; (&#123;</span><br><span class="line">    items: [],</span><br><span class="line">    page: &#123;</span><br><span class="line">      total: 0,</span><br><span class="line">      size: 10,</span><br><span class="line">      pages: 10,</span><br><span class="line">      current: 1,</span><br><span class="line">      records: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;),</span><br><span class="line">  methods: &#123;</span><br><span class="line">    async loadPage (current, size) &#123;</span><br><span class="line">      this.page &#x3D; await this.load(current, size)</span><br><span class="line">      this.items.push(...this.page.records)</span><br><span class="line">      this.page.records &#x3D; []</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 初始化方法，加载第一页的数据，加载监听器</span><br><span class="line">     *&#x2F;</span><br><span class="line">    async init () &#123;</span><br><span class="line">      this.loadPage()</span><br><span class="line">      &#x2F;&#x2F; 绑定窗口滚动事件</span><br><span class="line">      &#x2F;&#x2F; 获得文档高度和滚动高度</span><br><span class="line">      &#x2F;&#x2F; 计算是否已经到底了</span><br><span class="line">      &#x2F;&#x2F; 到底的话就加载下一页的数据，否则忽略</span><br><span class="line">      const otherOnscrollFn &#x3D; document.onscroll ? document.onscroll : function () &#123; &#125;</span><br><span class="line">      document.onscroll &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">        otherOnscrollFn()</span><br><span class="line">        const scrollTop &#x3D; document.documentElement.scrollTop || document.body.scrollTop</span><br><span class="line">        const clientHeight &#x3D; document.documentElement.clientHeight</span><br><span class="line">        const scrollHeight &#x3D; document.documentElement.scrollHeight</span><br><span class="line">        &#x2F;&#x2F; console.log(&#96;已滚动的高度：$&#123;scrollTop&#125;, 滚动条高度：$&#123;scrollHeight&#125;, $&#123;clientHeight&#125;&#96;)</span><br><span class="line">        &#x2F;&#x2F; 向下滚动时判断判断是否正在向上滚动，是的话就清除定时器，停在当前位置</span><br><span class="line">        if (scrollHeight - scrollTop - clientHeight &lt;&#x3D; 0 &amp;&amp; this.page.current &lt; this.page.pages) &#123;</span><br><span class="line">          this.loadPage(this.page.current + 1, this.page.size)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted () &#123;</span><br><span class="line">    this.init()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&#x2F;* 容器宽度要占 100% *&#x2F;</span><br><span class="line">#rx-waterfalls-flow-container &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>使用起来就很简单了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;rx-waterfalls-flow :load&#x3D;&quot;load&quot;&gt;</span><br><span class="line">    &lt;!-- 这里 slotProps 绑定的便是子组件的数据，通过 slotProps 可以访问到子组件绑定到模板上的数据，当然，更简单的方法是使用 ES6 的解构 --&gt;</span><br><span class="line">    &lt;!-- 这里面的是你自定义每个元素显示的内容 --&gt;</span><br><span class="line">    &lt;template slot-scope&#x3D;&quot;&#123;item&#125;&quot;&gt;</span><br><span class="line">      &lt;!-- 在模板里面便可以使用集合中的元素 item 了 --&gt;</span><br><span class="line">      &lt;li</span><br><span class="line">        class&#x3D;&quot;item-style&quot;</span><br><span class="line">        :key&#x3D;&quot;item.id&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;&#123;item.text&#125;&#125;</span><br><span class="line">      &lt;&#x2F;li&gt;</span><br><span class="line">    &lt;&#x2F;template&gt;</span><br><span class="line">  &lt;&#x2F;rx-waterfalls-flow&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">&#x2F;&#x2F; 引入瀑布流组件</span><br><span class="line">import RxWaterfallsFlow from &#39;@&#x2F;components&#x2F;common&#x2F;RxWaterfallsFlow&#39;</span><br><span class="line">import _ from &#39;lodash&#39;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    RxWaterfallsFlow</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    &#x2F;&#x2F; 使用 Promise 封装 setTimeout，模拟 ajax 的异步造成的延迟</span><br><span class="line">    await: ms &#x3D;&gt; new Promise(resolve &#x3D;&gt; setTimeout(resolve, ms)),</span><br><span class="line">    load: (page &#x3D;&gt; &#123;</span><br><span class="line">      &#x2F;&#x2F; 该方法用于模拟 ajax 数据加载</span><br><span class="line">      return async function () &#123;</span><br><span class="line">        await this.await(1000)</span><br><span class="line">        console.log(&#96;加载了第 $&#123;page.current&#125; 页，共 $&#123;page.pages&#125; 页&#96;)</span><br><span class="line">        &#x2F;&#x2F; 使用 lodash 模拟数据</span><br><span class="line">        page.records &#x3D; _.range(</span><br><span class="line">          (page.current - 1) * page.size + 1,</span><br><span class="line">          (++page.current - 1) * page.size + 1</span><br><span class="line">        )</span><br><span class="line">          .map(i &#x3D;&gt; (&#123;</span><br><span class="line">            id: i,</span><br><span class="line">            text: &#96;第 $&#123;i&#125; 行内容&#96;</span><br><span class="line">          &#125;))</span><br><span class="line">        return page</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)(&#123;</span><br><span class="line">      current: 1,</span><br><span class="line">      size: 10,</span><br><span class="line">      pages: 100,</span><br><span class="line">      total: this.current * this.pages,</span><br><span class="line">      records: []</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">li &#123;</span><br><span class="line">  width: 500px;</span><br><span class="line">  height: 200px;</span><br><span class="line">  line-height: 200px;</span><br><span class="line">  background-color: aqua;</span><br><span class="line">  margin: 10px auto;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
<h3 id="缺陷"><a href="#缺陷" class="headerlink" title="缺陷"></a>缺陷</h3><p>目前这个简单的瀑布流公用组件还有着相当多的缺陷，却是要等到后面再进行改进了呢</p>
<ul>
<li>没有 DOM 回收机制，会造成 DOM 树越来越大，网页就会变得越来越卡（Twitter 就是这样）</li>
<li>没有一键回到顶部的功能，毕竟翻了太久的话回到顶部很麻烦呢</li>
<li>自定义属性还是不够，例如一页的数据的条数，最大页数什么的</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/5b11af8492fe498483c9132787e04f45/" data-id="ckmcqox3f003y0kuv2vhj9ezg" data-title="Vue 实现一个简单的瀑布流组件" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-5e539807d8a64f1193dc38d64ae7fcd2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/5e539807d8a64f1193dc38d64ae7fcd2/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/5e539807d8a64f1193dc38d64ae7fcd2/">layui-layer load 弹窗自动关闭的问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>项目中的 Ajax 加载时的 loading 框有时候会关闭了弹窗之后很久页面上的数据才加载出来，而且这个问题是随机出现的，有些页面存在，有些页面则正常。</p>
<p>最小复现代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/rx-util@1.6.3/dist/rx-util.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/jquery@3.4.0/dist/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/layui-layer@1.0.9/dist/layer.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">      /**</span><br><span class="line">       * 加载遮罩框</span><br><span class="line">       *</span><br><span class="line"><span class="javascript">       * @returns &#123;<span class="built_in">Function</span>&#125; 一个关闭遮罩框的函数</span></span><br><span class="line">       */</span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">load</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> id = layer.load(<span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line">          layer.close(id);</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">      /**</span><br><span class="line">       * 模拟 ajax 异步请求</span><br><span class="line">       */</span><br><span class="line"><span class="javascript">      <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">time</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> close = load();</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;request start: &quot;</span>, time);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">await</span> rx.wait(time);</span></span><br><span class="line">        close();</span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;request end: &quot;</span>, time);</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      (<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        request(<span class="number">5000</span>).then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;第二个请求加载完成了&quot;</span>));</span></span><br><span class="line"><span class="javascript">        request(<span class="number">1000</span>).then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;第一个请求加载完成了&quot;</span>));</span></span><br><span class="line">      &#125;)();</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>控制台打印</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">request start:  5000</span><br><span class="line">request start:  1000</span><br><span class="line">request end:  1000</span><br><span class="line">第一个请求加载完成了</span><br><span class="line">request end:  5000</span><br><span class="line">第二个请求加载完成了</span><br></pre></td></tr></table></figure>
<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>本来吾辈猜测是 vuejs 页面渲染的锅，认为 vuejs 的生命周期函数 <code>mouted</code> 执行时 DOM 还没加载完全的缘故。<br>所以把 <code>load</code> 异步化，等待 document 加载完毕才会真正执行。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/rx-util@1.6.3/dist/rx-util.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/jquery@3.4.0/dist/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/layui-layer@1.0.9/dist/layer.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">      /**</span><br><span class="line">       * 加载遮罩框</span><br><span class="line">       *</span><br><span class="line"><span class="javascript">       * @returns &#123;<span class="built_in">Function</span>&#125; 一个关闭遮罩框的函数</span></span><br><span class="line">       */</span><br><span class="line"><span class="javascript">      <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">load</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">await</span> rx.wait(<span class="function">() =&gt;</span> <span class="built_in">document</span>.readyState === <span class="string">&quot;complete&quot;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> id = layer.load(<span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="keyword">async</span> () =&gt; &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">await</span> rx.wait(<span class="function">() =&gt;</span> <span class="built_in">document</span>.readyState === <span class="string">&quot;complete&quot;</span>);</span></span><br><span class="line">          layer.close(id);</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">      /**</span><br><span class="line">       * 模拟 ajax 异步请求</span><br><span class="line">       */</span><br><span class="line"><span class="javascript">      <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">time</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> close = <span class="keyword">await</span> load();</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;request start: &quot;</span>, time);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">await</span> rx.wait(time);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">await</span> close();</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;request end: &quot;</span>, time);</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      (<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        request(<span class="number">5000</span>).then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;第二个请求加载完成了&quot;</span>));</span></span><br><span class="line"><span class="javascript">        request(<span class="number">1000</span>).then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;第一个请求加载完成了&quot;</span>));</span></span><br><span class="line">      &#125;)();</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>控制台打印</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">request start:  5000</span><br><span class="line">request start:  1000</span><br><span class="line">request end:  1000</span><br><span class="line">第一个请求加载完成了</span><br><span class="line">request end:  5000</span><br><span class="line">第二个请求加载完成了</span><br></pre></td></tr></table></figure>
<p>然而实际上却并不是这个问题。。。</p>
<p>经过某位网友提醒，layer 源码中默认只允许一个活动的 <code>load</code> 弹窗。瞬间吾辈都不知道要怎么吐槽了，单例模式避免无谓的内存浪费是正常的，然而新的 <code>load</code> 函数却会关闭之前的 <code>load</code> 这种操作真的是很厉害了呢</p>
<p>例如下面这段代码，无论调用多少次 <code>layer.close(id1)</code>，页面上的 <code>loading</code> 都不会关闭。。。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> id1 = layer.load();</span><br><span class="line"><span class="keyword">const</span> id2 = layer.load();</span><br><span class="line">layer.close(id1);</span><br><span class="line">layer.close(id1);</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">layer.close(id1);</span><br><span class="line">layer.close(id1);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里吾辈可以想象到，layer 认为先加载的 <code>load()</code> 就应该先被 <code>close()</code>，而没有考虑到复杂异步的情况。</p>
</blockquote>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>既然 layer 的 <code>load</code> 本身存在缺陷，那么却是只能自己对 <code>load</code> 和 <code>close</code> 功能做控制了<br>基本思路</p>
<ol>
<li> <code>layer.load</code> 每次都会关闭掉之前的弹窗，那么就记录最后一次的弹窗 id，在真正需要关闭的时候 close 掉就好了</li>
<li> <code>layer.load</code> 关闭是直接关闭弹窗，如果是最后一个就会出现弹窗消失但数据没加载完全的问题，那么关闭这儿要判断当前是否还有活动的弹窗，只有在没有的情况下才真正关闭</li>
</ol>
<p>修改后的代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/rx-util@1.6.3/dist/rx-util.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/jquery@3.4.0/dist/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/layui-layer@1.0.9/dist/layer.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">      /**</span><br><span class="line">       * 加载遮罩框</span><br><span class="line">       *</span><br><span class="line"><span class="javascript">       * @returns &#123;<span class="built_in">Function</span>&#125; 一个关闭遮罩框的函数</span></span><br><span class="line">       */</span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> load = (<span class="function">(<span class="params">num, lastId</span>) =&gt;</span> <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line">        lastId = layer.load(1);</span><br><span class="line">        num++;</span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line">          num--;</span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (num &lt; <span class="number">0</span>) &#123;</span></span><br><span class="line">            num = 0;</span><br><span class="line">          &#125;</span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (num &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&quot;弹窗没有真正关闭哦&quot;</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span>;</span></span><br><span class="line">          &#125;</span><br><span class="line">          layer.close(lastId);</span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="string">&quot;弹窗真的关闭啦&quot;</span>);</span></span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;)(0);</span><br><span class="line"></span><br><span class="line">      /**</span><br><span class="line">       * 模拟 ajax 异步请求</span><br><span class="line">       */</span><br><span class="line"><span class="javascript">      <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">time</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> close = <span class="keyword">await</span> load();</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;request start: &quot;</span>, time);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">await</span> rx.wait(time);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">await</span> close();</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;request end: &quot;</span>, time);</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      (<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        request(<span class="number">5000</span>).then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;第二个请求加载完成了&quot;</span>));</span></span><br><span class="line"><span class="javascript">        request(<span class="number">1000</span>).then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;第一个请求加载完成了&quot;</span>));</span></span><br><span class="line">      &#125;)();</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>控制台打印</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">request start:  5000</span><br><span class="line">request start:  1000</span><br><span class="line">弹窗没有真正关闭哦</span><br><span class="line">request end:  1000</span><br><span class="line">第一个请求加载完成了</span><br><span class="line">弹窗真的关闭啦</span><br><span class="line">request end:  5000</span><br><span class="line">第二个请求加载完成了</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/5e539807d8a64f1193dc38d64ae7fcd2/" data-id="ckmcqox3g00430kuvcvt7avcc" data-title="layui-layer load 弹窗自动关闭的问题" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-62e40a56577346a4b993bd6b814ce110" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/62e40a56577346a4b993bd6b814ce110/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/62e40a56577346a4b993bd6b814ce110/">使用 SSH 连接 Linux 服务器</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="首先我们要在客户端（本机）生成密钥对"><a href="#首先我们要在客户端（本机）生成密钥对" class="headerlink" title="首先我们要在客户端（本机）生成密钥对"></a>首先我们要在客户端（本机）生成密钥对</h2><blockquote>
<p>这里的密钥对是 <code>Public key</code>，具体请参考 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh/%E5%85%AC%E5%BC%80%E5%AF%86%E9%92%A5%E5%8A%A0%E5%AF%86">公开密钥加密</a></p>
</blockquote>
<p>使用命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>
<p>接下来会提示让你输入一个路径来保存密钥对，默认在 <code>~/.ssh/id_rsa</code> 下面生成 <code>id_rsa</code>（私钥）和 <code>id_rsa.pub</code>（公钥），如果没什么特殊需求就直接默认就好。</p>
<p>然后提示你输入密码（即本机使用 <code>SSH</code> 连接时的密码 #和服务器密码无关），也是直接回车默认为空即可。</p>
<h2 id="将公钥上传到服务器上"><a href="#将公钥上传到服务器上" class="headerlink" title="将公钥上传到服务器上"></a>将公钥上传到服务器上</h2><p>这里以使用 <code>SCP</code> 为例，上传公钥 <code>id_rsa.pub</code> 到服务器上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp ~/.ssh/id_rsa.pub root@139.59.22.131:~</span><br></pre></td></tr></table></figure>
<h2 id="将公钥追加到服务器的认证密钥中"><a href="#将公钥追加到服务器的认证密钥中" class="headerlink" title="将公钥追加到服务器的认证密钥中"></a>将公钥追加到服务器的认证密钥中</h2><p>将上传到服务器上的 <code>id_rsa.pub</code> 公钥追加到 <code>authorized_keys</code> 文件中，命令是</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat ~/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>
<h2 id="修改服务器的配置以启用公钥认证"><a href="#修改服务器的配置以启用公钥认证" class="headerlink" title="修改服务器的配置以启用公钥认证"></a>修改服务器的配置以启用公钥认证</h2><p>修改 <code>vi /etc/ssh/sshd_config</code> 配置文件（如果有的话就进行修改，没有的话就添加进来）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RSAAuthentication yes        # 启用 RSA 认证（默认是注释掉的，将注释去掉，如果不是 yes，改为 yes）</span><br><span class="line">PubkeyAuthentication yes     # 启用公钥认证（默认是注释掉的，将注释去掉，如果不是 yes，改为 yes）</span><br><span class="line">PasswordAuthentication no    # 禁止密码认证 (改为 no, 默认为 yes 是用密码认证)</span><br><span class="line">StrictModes no               # 修改为 no, 默认为 yes. 如果不修改用 key 登陆是出现 server refused our key(如果 StrictModes 为 yes 必需保证存放公钥的文件夹的拥有与登陆用户名是相同的.“StrictModes” 设置 ssh 在接收登录请求之前是否检查用户家目录和 rhosts 文件的权限和所有权。这通常是必要的，因为新手经常会把自己的目录和文件设成任何人都有写权限。)</span><br></pre></td></tr></table></figure>
<h2 id="重启-SSH-服务"><a href="#重启-SSH-服务" class="headerlink" title="重启 SSH 服务"></a>重启 <code>SSH</code> 服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service sshd restart</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">/etc/init.d/ssh restart</span><br></pre></td></tr></table></figure>
<h2 id="最后验证一下"><a href="#最后验证一下" class="headerlink" title="最后验证一下"></a>最后验证一下</h2><p>连接服务器，这里以 <code>SSH</code> 客户端为例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@139.59.22.131</span><br></pre></td></tr></table></figure>
<p>然后，就直接连上了，不需要输入密码了呢 Ｏ(≧▽≦)Ｏ</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/62e40a56577346a4b993bd6b814ce110/" data-id="ckmcqox3j004d0kuvgnt1eamp" data-title="使用 SSH 连接 Linux 服务器" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/14/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="page-number" href="/page/14/">14</a><span class="page-number current">15</span><a class="page-number" href="/page/16/">16</a><a class="page-number" href="/page/17/">17</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/16/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/electron/" rel="tag">electron</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grid/" rel="tag">grid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jetbrains/" rel="tag">jetbrains</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/" rel="tag">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/" rel="tag">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/" rel="tag">sql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typescript/" rel="tag">typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vscode/" rel="tag">vscode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webstorm/" rel="tag">webstorm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AA%E4%BA%BA/" rel="tag">个人</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%AC%E5%8F%B8/" rel="tag">公司</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%91%A8%E6%8A%A5/" rel="tag">周报</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%A3%E5%91%8A/" rel="tag">宣告</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">工程化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E6%BA%90/" rel="tag">开源</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%82%E6%AD%A5/" rel="tag">异步</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%85%E6%9B%B4%E6%96%B0/" rel="tag">待更新</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82%E8%B0%88/" rel="tag">杂谈</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BB%8F%E9%AA%8C/" rel="tag">经验</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6/" rel="tag">读书</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">转载</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/css/" style="font-size: 12.14px;">css</a> <a href="/tags/electron/" style="font-size: 15.71px;">electron</a> <a href="/tags/git/" style="font-size: 12.86px;">git</a> <a href="/tags/grid/" style="font-size: 10.71px;">grid</a> <a href="/tags/java/" style="font-size: 19.29px;">java</a> <a href="/tags/javascript/" style="font-size: 20px;">javascript</a> <a href="/tags/jetbrains/" style="font-size: 12.14px;">jetbrains</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/markdown/" style="font-size: 10.71px;">markdown</a> <a href="/tags/react/" style="font-size: 14.29px;">react</a> <a href="/tags/sql/" style="font-size: 14.29px;">sql</a> <a href="/tags/typescript/" style="font-size: 12.14px;">typescript</a> <a href="/tags/vscode/" style="font-size: 12.86px;">vscode</a> <a href="/tags/vue/" style="font-size: 16.43px;">vue</a> <a href="/tags/webstorm/" style="font-size: 10px;">webstorm</a> <a href="/tags/windows/" style="font-size: 17.14px;">windows</a> <a href="/tags/%E4%B8%AA%E4%BA%BA/" style="font-size: 12.86px;">个人</a> <a href="/tags/%E5%85%AC%E5%8F%B8/" style="font-size: 10px;">公司</a> <a href="/tags/%E5%91%A8%E6%8A%A5/" style="font-size: 10px;">周报</a> <a href="/tags/%E5%AE%A3%E5%91%8A/" style="font-size: 10px;">宣告</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 13.57px;">工具</a> <a href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" style="font-size: 17.86px;">工程化</a> <a href="/tags/%E5%BC%80%E6%BA%90/" style="font-size: 10px;">开源</a> <a href="/tags/%E5%BC%82%E6%AD%A5/" style="font-size: 15px;">异步</a> <a href="/tags/%E5%BE%85%E6%9B%B4%E6%96%B0/" style="font-size: 10.71px;">待更新</a> <a href="/tags/%E6%9D%82%E8%B0%88/" style="font-size: 18.57px;">杂谈</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a> <a href="/tags/%E7%BB%8F%E9%AA%8C/" style="font-size: 11.43px;">经验</a> <a href="/tags/%E8%AF%BB%E4%B9%A6/" style="font-size: 12.14px;">读书</a> <a href="/tags/%E8%BD%AC%E8%BD%BD/" style="font-size: 11.43px;">转载</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/14/8fb2d58463ae4191ac064a76e15bffbd/">2021 第十周</a>
          </li>
        
          <li>
            <a href="/2021/03/12/7e7131c07c984d928ba3fefa7a9cef06/">读书-[颓废与沉默：透视犬儒文化]</a>
          </li>
        
          <li>
            <a href="/2021/03/02/db74e6e5d2444bc3b6e185a7b338bbf6/">electron 开发经验之谈系列-在渲染、主进程间共享数据</a>
          </li>
        
          <li>
            <a href="/2021/02/27/06cb464179cf45c598208534705aae3c/">2020 吾辈在公司推动的前端技术演进</a>
          </li>
        
          <li>
            <a href="/2021/02/23/cd66150d2b86448590fcc9bb2419c0b2/">实践 lerna monorepo</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>