<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/19/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-1342b132059a48f4a822bcd182d8bfe1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/1342b132059a48f4a822bcd182d8bfe1/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/1342b132059a48f4a822bcd182d8bfe1/">浅谈 Vue SPA 网站 URL 保存数据实践</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><blockquote>
<p>该功能吾辈已经封装成 NPM 库 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/vue-url-persist">vue-url-persist</a></p>
</blockquote>
<p>在使用 Vue SPA 开发面向普通用户的网站时，吾辈也遇到了一些之前未被重视，但却实实在在存在的问题，这次便浅谈一下 SPA 网站将所有数据都存储到内存中导致数据很容易丢失以及吾辈思考并尝试的解决方案。</p>
<blockquote>
<p>参考：SPA 全称 <code>single page application</code>，意为 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%8D%95%E9%A1%B5%E5%BA%94%E7%94%A8">单页应用</a>，不是泥萌想的那样！#笑哭</p>
</blockquote>
<p>思维导图</p>
<iframe id="embed_dom" name="embed_dom" frameborder="0" style="display:block;width:525px; height:245px;" src="https://www.processon.com/embed/5e1e5d93e4b0c3908f881d64"></iframe>

<p>首先列出为什么遇到这个问题，具体场景及解决的问题是什么？</p>
<p>想要解决的一些问题</p>
<ol>
<li> 刷新页面数据不丢失：因为数据都保存在内存中，所以刷新之后自然不存在了</li>
<li> URL 复制给其他人数据不丢失：因为数据没有持久化到 URL 上，也没有根据 URL 上的数据进行初始化，所以复制给别人的 URL 当然会丢失数据（搜索条件之类）</li>
<li> 页面返回数据不丢失：因为数据都保存在内存中，所以跳转到其他路由再跳转回来数据当然不会存在了</li>
</ol>
<p>那么，先谈一下每个问题的解决方案</p>
<ol>
<li>刷新页面数据不丢失<ul>
<li>将数据序列化到本地，例如 <code>localStorage</code> 中，然后在刷新后获取一次<ul>
<li>注：这方面已经有先行者了，例如 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/vuex-persist">vuex-persist</a> 和 <a target="_blank" rel="noopener" href="https://github.com/robinvdvleuten/vuex-persistedstate">vuex-persistedstate</a></li>
</ul>
</li>
<li>将数据序列化到 URL 上，每次加载都从 URL 上获取数据</li>
</ul>
</li>
<li>URL 复制给其他人数据不丢失<ul>
<li>只能将数据序列化到 URL 上</li>
</ul>
</li>
<li>页面返回数据不丢失<ul>
<li>将数据放到 vuex 中，并且在 URL 上使用 <code>key</code> 进行标识<ul>
<li>注：这方面已经有先行者了，例如 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/vue-navigation">vue-navigation</a> 和 <a target="_blank" rel="noopener" href="https://github.com/vuejs/vuex-router-sync">vuex-router-sync</a></li>
</ul>
</li>
<li>将数据序列化到 URL 上，并且不新增路由记录</li>
<li>使用 vue-router 的缓存 <code>keep-alive</code></li>
</ul>
</li>
</ol>
<p>在了解了这么多的解决方案之后，吾辈最终选择了兼容性最好的 URL 保存数据，它能同时解决 3 个问题。然而，很遗憾的是，这似乎并没有很多人讨论这个问题，或许，这个问题本应该是默认就需要解决的，亦或是 SPA 网站真的很少关心这些了。</p>
<blockquote>
<p>虽说如此，吾辈还是找到了一些讨论的 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/42226479">StackOverflow: How to hold URL query params in Vue with Vue-Router</a></p>
</blockquote>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>一个基本的思路是能够确定的</p>
<ol>
<li> 在组件创建时，从 URL 获取数据并为需要的数据进行初始化</li>
<li> 在这些数据变化时，及时将数据序列化到 URL 上</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20200105012847.png" alt="思路图"></p>
<p>然后，再次出现了一个分歧点，到底要不要绑定 Vue？</p>
<ol>
<li>不绑定 vue 手动监听对象变化并将对象的变化响应到 URL 上<br> <img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20200105012848.png" alt="不绑定 vue"></li>
<li>绑定 vue 并使用它的生命周期 <code>created, beforeRouteUpdate</code> 与监听器 <code>watch</code><br> <img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20200105012846.png" alt="绑定 vue"></li>
</ol>
<p>那么，两者有什么区别呢？</p>
<table>
<thead>
<tr>
<th>思路</th>
<th>不绑定 vue</th>
<th>绑定 vue</th>
</tr>
</thead>
<tbody><tr>
<td>优点</td>
<td>非框架强相关，理论上可以通用 <code>Vue/React</code></td>
<td>不需要手动实现 URL 的几种序列化模式，可以预见至少有两种：<code>HTML 5 History/Hash</code></td>
</tr>
<tr>
<td></td>
<td>没有 vue/vue-router 的历史包袱</td>
<td>不需要手动实现数据监听/响应（虽然现在已然不算难了）</td>
</tr>
<tr>
<td></td>
<td>可以不管 vue-router 实现 URL 动态设置，可以自动优雅降级</td>
<td>灵活性很强，实现比较好的封装之后使用成本很低</td>
</tr>
<tr>
<td>缺点</td>
<td>没有包袱，但同时没有基础，序列化/数据监听都需要手动实现</td>
<td>存在历史包袱，vue/vue-router 的怪癖一点都绕不过去</td>
</tr>
<tr>
<td></td>
<td>灵活性不足，只能初始化一次，需要/不需要序列化的数据分割也相当有挑战</td>
<td>依赖 vue/vue-router，在其更新之时也必须跟着更新</td>
</tr>
<tr>
<td></td>
<td>不绑定 vue 意味着与 vue 不可能完美契合</td>
<td>无法通用，在任何一个其他框架（React）上还要再写一套</td>
</tr>
</tbody></table>
<p>最终，在这个十字路口反复踌躇之后，吾辈选择了更加灵活、成本更低的第二种解决方案。</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="已解决"><a href="#已解决" class="headerlink" title="已解决"></a>已解决</h3><ul>
<li>序列化数据到 URL 上导致路由记录会随着改变增加</li>
<li>即时序列化数据到 URL 上不现实<blockquote>
<p>这里吾辈对 <a target="_blank" rel="noopener" href="https://yarnpkg.com/">yarn</a> 进行了考察发现其也是异步更新 URL</p>
</blockquote>
</li>
<li>序列化到 URL 上时导致的死循环，<code>序列化数据到 URL 上 =&gt; 路由更新触发 =&gt; 初始化数据到 URL 上 =&gt; 触发数据改变 =&gt; 序列化数据到 URL 上。。。</code></li>
<li>同一个路由携带不同的查询参数的 URL 直接在地址栏输入回车一次不会触发页面数据更新</li>
<li>URL 最大保存数据 IE 最多支持 <code>2083</code> 长度的 URL，换算为中文即为 <code>231</code> 个，所以不能作为一种通用方式进行</li>
<li>Vue 插件不能动态混入，而是在各个生命周期中判断是否要处理的</li>
</ul>
<h3 id="仍遗留"><a href="#仍遗留" class="headerlink" title="仍遗留"></a>仍遗留</h3><ul>
<li>JSON 序列化的数据长度较 query param 更大</li>
</ul>
<blockquote>
<p>下面是具体实现及代码，不喜欢的话可以直接跳到最下面的 <a href="#%E6%80%BB%E7%BB%93">总结</a>。</p>
</blockquote>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/rxliuli/example/tree/linter_vue_example/vue_url_persist_vue_example">GitHub</a></p>
</blockquote>
<h3 id="基本尝试"><a href="#基本尝试" class="headerlink" title="基本尝试"></a>基本尝试</h3><p>首先，尝试不使用任何封装，直接在 <code>created</code> 生命周期中初始化并绑定 <code>$watch</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;form1&quot;</span>&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;label <span class="keyword">for</span>=<span class="string">&quot;keyword&quot;</span>&gt;搜索名:&lt;/label&gt;</span><br><span class="line">      &lt;input type=<span class="string">&quot;text&quot;</span> v-model=<span class="string">&quot;form.keyword&quot;</span> id=<span class="string">&quot;keyword&quot;</span> /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;input</span><br><span class="line">        type=<span class="string">&quot;checkbox&quot;</span></span><br><span class="line">        v-model=<span class="string">&quot;form.hobbyList&quot;</span></span><br><span class="line">        id=<span class="string">&quot;anime&quot;</span></span><br><span class="line">        value=<span class="string">&quot;anime&quot;</span></span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;label <span class="keyword">for</span>=<span class="string">&quot;anime&quot;</span>&gt;动画&lt;/label&gt;</span><br><span class="line">      &lt;input type=<span class="string">&quot;checkbox&quot;</span> v-model=<span class="string">&quot;form.hobbyList&quot;</span> id=<span class="string">&quot;game&quot;</span> value=<span class="string">&quot;game&quot;</span> /&gt;</span><br><span class="line">      &lt;label <span class="keyword">for</span>=<span class="string">&quot;game&quot;</span>&gt;游戏&lt;/label&gt;</span><br><span class="line">      &lt;input</span><br><span class="line">        type=<span class="string">&quot;checkbox&quot;</span></span><br><span class="line">        v-model=<span class="string">&quot;form.hobbyList&quot;</span></span><br><span class="line">        id=<span class="string">&quot;movie&quot;</span></span><br><span class="line">        value=<span class="string">&quot;movie&quot;</span></span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;label <span class="keyword">for</span>=<span class="string">&quot;movie&quot;</span>&gt;电影&lt;/label&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">      &#123;&#123; form &#125;&#125;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;Form1&#x27;</span>,</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      form: &#123;</span><br><span class="line">        keyword: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        hobbyList: [],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> key = <span class="string">&#x27;qb&#x27;</span></span><br><span class="line">    <span class="keyword">const</span> urlData = <span class="built_in">JSON</span>.parse(<span class="built_in">this</span>.$route.query[key] || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">    <span class="built_in">Object</span>.assign(<span class="built_in">this</span>.form, urlData.form)</span><br><span class="line">    <span class="built_in">this</span>.$watch(</span><br><span class="line">      <span class="string">&#x27;form&#x27;</span>,</span><br><span class="line">      <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">        urlData.form = val</span><br><span class="line">        <span class="built_in">this</span>.$router.replace(&#123;</span><br><span class="line">          query: &#123;</span><br><span class="line">            ...this.$route.query,</span><br><span class="line">            [key]: <span class="built_in">JSON</span>.stringify(urlData),</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        deep: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    )</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="分离通用性函数"><a href="#分离通用性函数" class="headerlink" title="分离通用性函数"></a>分离通用性函数</h3><p>然后，便是将之分离为单独的函数，方便在所有组件中进行复用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化一些数据需要序列化/反序列化到 url data 上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initUrlData</span>(<span class="params">exps</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> key = <span class="string">&quot;qb&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> urlData = <span class="built_in">JSON</span>.parse(<span class="built_in">this</span>.$route.query[key] || <span class="string">&quot;&#123;&#125;&quot;</span>);</span><br><span class="line">  exps.forEach(<span class="function">(<span class="params">exp</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">Object</span>.assign(<span class="built_in">this</span>[exp], urlData[exp]);</span><br><span class="line">    <span class="built_in">this</span>.$watch(</span><br><span class="line">      exp,</span><br><span class="line">      <span class="function"><span class="keyword">function</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">        urlData[exp] = val;</span><br><span class="line">        <span class="built_in">this</span>.$router.replace(&#123;</span><br><span class="line">          query: &#123;</span><br><span class="line">            ...this.$route.query,</span><br><span class="line">            [key]: <span class="built_in">JSON</span>.stringify(urlData),</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        deep: <span class="literal">true</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用起来需要在 <code>created</code> 生命中调用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    initUrlData.call(<span class="built_in">this</span>, [<span class="string">&quot;form&quot;</span>]);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="处理深层监听"><a href="#处理深层监听" class="headerlink" title="处理深层监听"></a>处理深层监听</h3><p>如果需要监听的值不是 data 下的顶级字段，而是深层字段的话，便不能直接使用 <code>[]</code> 进行取值和赋值了，而是需要实现支持深层取值/赋值的 <code>get/set</code>。而且，深层监听也意味着一般不会是对象，所以也不能采用 <code>Object.assign</code> 进行合并。</p>
<p>例如需要监听 <code>page</code> 对象中的 <code>offset, size</code> 两字段</p>
<p>首先，需要编写通用的 <code>get/set</code> 函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解析字段字符串为数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>str 字段字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span>字符串数组，数组的 `[]` 取法会被解析为数组的一个元素</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseFieldStr</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str</span><br><span class="line">    .split(<span class="regexp">/[\\.\\[]/</span>)</span><br><span class="line">    .map(<span class="function">(<span class="params">k</span>) =&gt;</span> (<span class="regexp">/\]$/</span>.test(k) ? k.slice(<span class="number">0</span>, k.length - <span class="number">1</span>) : k));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 安全的深度获取对象的字段</span></span><br><span class="line"><span class="comment"> * 注: 只要获取字段的值为 &#123;<span class="doctag">@type </span>null|undefined&#125;，就会直接返回 &#123;<span class="doctag">@param </span>defVal&#125;</span></span><br><span class="line"><span class="comment"> * 类似于 ES2019 的可选调用链特性: https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/%E5%8F%AF%E9%80%89%E9%93%BE</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>obj 获取的对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>fields 字段字符串或数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>[defVal] 取不到值时的默认值，默认为 null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">obj, fields, defVal = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> fields === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    fields = parseFieldStr(fields);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> res = obj;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> field <span class="keyword">of</span> fields) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      res = <span class="built_in">Reflect</span>.get(res, field);</span><br><span class="line">      <span class="keyword">if</span> (res === <span class="literal">undefined</span> || res === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> defVal;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> defVal;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 安全的深度设置对象的字段</span></span><br><span class="line"><span class="comment"> * 注: 只要设置字段的值为 &#123;<span class="doctag">@type </span>null|undefined&#125;，就会直接返回 &#123;<span class="doctag">@param </span>defVal&#125;</span></span><br><span class="line"><span class="comment"> * 类似于 ES2019 的可选调用链特性: https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/%E5%8F%AF%E9%80%89%E9%93%BE</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>obj 设置的对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>fields 字段字符串或数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>[val] 设置字段的值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params">obj, fields, val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> fields === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    fields = parseFieldStr(fields);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> res = obj;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = fields.length; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> field = fields[i];</span><br><span class="line">    <span class="built_in">console</span>.log(i, res, field, res[field]);</span><br><span class="line">    <span class="keyword">if</span> (i === len - <span class="number">1</span>) &#123;</span><br><span class="line">      res[field] = val;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    res = res[field];</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;res: &quot;</span>, res);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> res !== <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，是替换赋值操作，将之修改为一个专门的函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 为 vue 实例上的字段进行深度赋值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setInitData</span>(<span class="params">vm, exp, urlData</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> oldVal = get(vm, exp, <span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> newVal = urlData[exp];</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> oldVal === <span class="string">&quot;object&quot;</span> &amp;&amp; newVal !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="built_in">Object</span>.assign(get(vm, exp), newVal);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    set(vm, exp, newVal);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化一些数据需要序列化/反序列化到 url data 上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initUrlData</span>(<span class="params">exps</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> key = <span class="string">&quot;qb&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> urlData = <span class="built_in">JSON</span>.parse(<span class="built_in">this</span>.$route.query[key] || <span class="string">&quot;&#123;&#125;&quot;</span>);</span><br><span class="line">  exps.forEach(<span class="function">(<span class="params">exp</span>) =&gt;</span> &#123;</span><br><span class="line">    setInitData(<span class="built_in">this</span>, exp, urlData);</span><br><span class="line">    <span class="built_in">this</span>.$watch(</span><br><span class="line">      exp,</span><br><span class="line">      <span class="function"><span class="keyword">function</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">        urlData[exp] = val;</span><br><span class="line">        <span class="built_in">this</span>.$router.replace(&#123;</span><br><span class="line">          query: &#123;</span><br><span class="line">            ...this.$route.query,</span><br><span class="line">            [key]: <span class="built_in">JSON</span>.stringify(urlData),</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        deep: <span class="literal">true</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样，便能单独监听对象中的某个字段了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">initUrlData.call(<span class="built_in">this</span>, [<span class="string">&quot;form.keyword&quot;</span>]);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>参考：lodash 的函数 <a target="_blank" rel="noopener" href="https://lodash.com/docs/4.17.15#get">get</a>/<a target="_blank" rel="noopener" href="https://lodash.com/docs/4.17.15#set">set</a></p>
</blockquote>
<h3 id="使用防抖避免触发过快"><a href="#使用防抖避免触发过快" class="headerlink" title="使用防抖避免触发过快"></a>使用防抖避免触发过快</h3><p>但目前而言每次同步都是即时的，在数据量较大时，可能会存在一些问题，所以使用防抖避免每次数据更新都即时同步到 URL 上。</p>
<p>首先，实现一个简单的防抖函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 函数去抖</span></span><br><span class="line"><span class="comment"> * 去抖 (debounce) 去抖就是对于一定时间段的连续的函数调用，只让其执行一次</span></span><br><span class="line"><span class="comment"> * 注: 包装后的函数如果两次操作间隔小于 delay 则不会被执行, 如果一直在操作就会一直不执行, 直到操作停止的时间大于 delay 最小间隔时间才会执行一次, 不管任何时间调用都需要停止操作等待最小延迟时间</span></span><br><span class="line"><span class="comment"> * 应用场景主要在那些连续的操作, 例如页面滚动监听, 包装后的函数只会执行最后一次</span></span><br><span class="line"><span class="comment"> * 注: 该函数第一次调用一定不会执行，第一次一定拿不到缓存值，后面的连续调用都会拿到上一次的缓存值。如果需要在第一次调用获取到的缓存值，则需要传入第三个参数 &#123;<span class="doctag">@param </span>init&#125;，默认为 &#123;<span class="doctag">@code </span>undefined&#125; 的可选参数</span></span><br><span class="line"><span class="comment"> * 注: 返回函数结果的高阶函数需要使用 &#123;<span class="doctag">@see </span>Proxy&#125; 实现，以避免原函数原型链上的信息丢失</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>action 真正需要执行的操作</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>delay 最小延迟时间，单位为 ms</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>init 初始的缓存值，不填默认为 &#123;<span class="doctag">@see </span>undefined&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return </span>function(...[*]=): Promise&lt;any&gt; &#123;<span class="doctag">@see </span>action&#125; 是否异步没有太大关联</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">action, delay, init = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> flag;</span><br><span class="line">  <span class="keyword">let</span> result = init;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (flag) <span class="built_in">clearTimeout</span>(flag);</span><br><span class="line">      flag = <span class="built_in">setTimeout</span>(</span><br><span class="line">        () =&gt; resolve((result = action.apply(<span class="built_in">this</span>, args))),</span><br><span class="line">        delay</span><br><span class="line">      );</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> resolve(result), delay);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将 <code>$watch</code> 中的函数用 <code>debounce</code> 进行包装</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化一些数据需要序列化/反序列化到 url data 上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initUrlData</span>(<span class="params">exps</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> key = <span class="string">&quot;qb&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> urlData = <span class="built_in">JSON</span>.parse(<span class="built_in">this</span>.$route.query[key] || <span class="string">&quot;&#123;&#125;&quot;</span>);</span><br><span class="line">  exps.forEach(<span class="function">(<span class="params">exp</span>) =&gt;</span> &#123;</span><br><span class="line">    setInitData(<span class="built_in">this</span>, exp, urlData);</span><br><span class="line">    <span class="built_in">this</span>.$watch(</span><br><span class="line">      exp,</span><br><span class="line">      debounce(<span class="function"><span class="keyword">function</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">        urlData[exp] = val;</span><br><span class="line">        <span class="built_in">this</span>.$router.replace(&#123;</span><br><span class="line">          query: &#123;</span><br><span class="line">            ...this.$route.query,</span><br><span class="line">            [key]: <span class="built_in">JSON</span>.stringify(urlData),</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;, <span class="number">1000</span>),</span><br><span class="line">      &#123;</span><br><span class="line">        deep: <span class="literal">true</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>引用：<a target="_blank" rel="noopener" href="https://juejin.im/post/5b8de829f265da43623c4261">掘金：7 分钟理解 JS 的节流、防抖及使用场景</a><br>参考：lodash 的函数 <a target="_blank" rel="noopener" href="https://lodash.com/docs/4.17.15#debounce">debounce</a></p>
</blockquote>
<h3 id="处理路由不变但-query-修改的问题"><a href="#处理路由不变但-query-修改的问题" class="headerlink" title="处理路由不变但 query 修改的问题"></a>处理路由不变但 query 修改的问题</h3><p>接下来，就需要处理一种小众，但确实存在的场景了。</p>
<ul>
<li>同一个组件被多个路由复用，这些路由仅仅只是一个 path param 改变了。例如 <a target="_blank" rel="noopener" href="https://ant.design/components/tabs-cn/">标签页</a></li>
<li>用户复制 URL 之后，发现其中的查询关键字错了，于是修改了关键字之后又复制了一次，而粘贴两次路由相同 query param 不同的 URL 是不会重新创建组件的</li>
</ul>
<p>首先确定基本的思路：在路由改变但组件没有重新创建时将 URL 上的数据为需要的数据进行初始化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在组件被 vue-router 路由复用时，单独进行初始化数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>route 将要改变的路由对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initUrlDataByRouteUpdate</span>(<span class="params">exps, route</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> urlData = <span class="built_in">JSON</span>.parse(route.query[key] || <span class="string">&quot;&#123;&#125;&quot;</span>);</span><br><span class="line">  exps.forEach(<span class="function">(<span class="params">exp</span>) =&gt;</span> &#123;</span><br><span class="line">    setInitData(<span class="built_in">this</span>, exp, urlData);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 vue 实例的生命周期 <code>beforeRouteUpdate, beforeRouteEnter</code> 重新初始化 <code>data</code> 中的数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">beforeRouteUpdate</span>(<span class="params">to, <span class="keyword">from</span>, next</span>)</span> &#123;</span><br><span class="line">    initUrlDataByRouteUpdate.call(<span class="built_in">this</span>, [<span class="string">&quot;form&quot;</span>], to);</span><br><span class="line">    next();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">beforeRouteEnter</span>(<span class="params">to, <span class="keyword">from</span>, next</span>)</span> &#123;</span><br><span class="line">    next(<span class="function">(<span class="params">vm</span>) =&gt;</span> initUrlDataByRouteUpdate.call(vm, [<span class="string">&quot;form&quot;</span>], to));</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>真的以为问题都解决了么？并不然，打开控制台你会发现一些 vue router 的警告</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue-router.esm.js?8c4f:2051 Uncaught (<span class="keyword">in</span> promise) NavigationDuplicated &#123;_name: <span class="string">&quot;NavigationDuplicated&quot;</span>, name: <span class="string">&quot;NavigationDuplicated&quot;</span>, message: <span class="string">&quot;Navigating to current location (&quot;</span>/form1/?qb=%7B%22…,%22movie%22,%22game%22%5D%7D%7D<span class="string">&quot;) is not allowed&quot;</span>, stack: <span class="string">&quot;Error↵    at new NavigationDuplicated (webpack-int…/views/Form1.vue?vue&amp;type=script&amp;lang=js&amp;:222:40)&quot;</span>&#125;</span><br></pre></td></tr></table></figure>
<p>其实是因为循环触发导致的：<code>序列化数据到 URL 上 =&gt; 路由更新触发 =&gt; 初始化数据到 URL 上 =&gt; 触发数据改变 =&gt; 序列化数据到 URL 上。。。</code>，目前可行的解决方案是在 <code>$watch</code> 中判断数据是否与原来的相同，相同就不进行赋值，避免再次触发 vue-router 的 <code>beforeRouteUpdate</code> 生命周期。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化一些数据需要序列化/反序列化到 url data 上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initUrlData</span>(<span class="params">exps</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> urlData = <span class="built_in">JSON</span>.parse(<span class="built_in">this</span>.$route.query[key] || <span class="string">&quot;&#123;&#125;&quot;</span>);</span><br><span class="line">  exps.forEach(<span class="function">(<span class="params">exp</span>) =&gt;</span> &#123;</span><br><span class="line">    setInitData(<span class="built_in">this</span>, exp, urlData);</span><br><span class="line">    <span class="built_in">this</span>.$watch(</span><br><span class="line">      exp,</span><br><span class="line">      debounce(<span class="function"><span class="keyword">function</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">        urlData[exp] = val;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.$route.query[key] === <span class="built_in">JSON</span>.stringify(urlData)) &#123;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.$router.replace(&#123;</span><br><span class="line">          query: &#123;</span><br><span class="line">            ...this.$route.query,</span><br><span class="line">            [key]: <span class="built_in">JSON</span>.stringify(urlData),</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;, <span class="number">1000</span>),</span><br><span class="line">      &#123;</span><br><span class="line">        deep: <span class="literal">true</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在，控制台不会再有警告了。</p>
<h3 id="封装起来"><a href="#封装起来" class="headerlink" title="封装起来"></a>封装起来</h3><h4 id="使用-Vue-插件"><a href="#使用-Vue-插件" class="headerlink" title="使用 Vue 插件"></a>使用 Vue 插件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; debounce, get, set &#125; <span class="keyword">from</span> <span class="string">&quot;./common&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VueUrlPersist</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 一些选项</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.expListName = <span class="string">&quot;exps&quot;</span>;</span><br><span class="line">    <span class="built_in">this</span>.urlPersistName = <span class="string">&quot;qb&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 将 URL 上的数据初始化到 data 上</span></span><br><span class="line"><span class="comment">   * 此处存在一个谬误</span></span><br><span class="line"><span class="comment">   * 1. 如果对象不使用合并而是赋值，则处理 [干净] 的 URL 就会很棘手，因为无法感知到初始值是什么</span></span><br><span class="line"><span class="comment">   * 2. 如果对象使用合并，则手动输入的相同路由不同参数的 URL 就无法处理</span></span><br><span class="line"><span class="comment">   *    注：该问题已经通过在 watch 中判断值是否变化而解决，但总感觉还有莫名其妙的坑在前面等着。。。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="variable">vm</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="variable">expOrFn</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="variable">urlData</span></span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">initVueData</span>(<span class="params">vm, expOrFn, urlData</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> oldVal = get(vm, expOrFn, <span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">const</span> newVal = urlData[expOrFn];</span><br><span class="line">    <span class="keyword">if</span> (oldVal === <span class="literal">undefined</span> || oldVal === <span class="literal">null</span>) &#123;</span><br><span class="line">      set(vm, expOrFn, newVal);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> oldVal === <span class="string">&quot;object&quot;</span> &amp;&amp; newVal !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="built_in">Object</span>.assign(get(vm, expOrFn), newVal);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 在组件被 vue-router 路由复用时，单独进行初始化数据</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="variable">vm</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="variable">expOrFnList</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="variable">route</span></span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">initNextUrlData</span>(<span class="params">vm, expOrFnList, route</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> urlData = <span class="built_in">JSON</span>.parse(route.query[<span class="built_in">this</span>.urlPersistName] || <span class="string">&quot;&#123;&#125;&quot;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;urlData: &quot;</span>, urlData);</span><br><span class="line">    expOrFnList.forEach(<span class="function">(<span class="params">expOrFn</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.initVueData(vm, expOrFn, urlData);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 在组件被 vue 创建后初始化数据并监听之，在发生变化时自动序列化到 URL 上</span></span><br><span class="line"><span class="comment">   * 注：需要序列化到 URL 上的数据必须能被 JSON.stringfy 序列化</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="variable">vm</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="variable">expOrFnList</span></span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">initUrlData</span>(<span class="params">vm, expOrFnList</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> urlData = <span class="built_in">JSON</span>.parse(vm.$route.query[<span class="built_in">this</span>.urlPersistName] || <span class="string">&quot;&#123;&#125;&quot;</span>);</span><br><span class="line">    expOrFnList.forEach(<span class="function">(<span class="params">expOrFn</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.initVueData(vm, expOrFn, urlData);</span><br><span class="line"></span><br><span class="line">      vm.$watch(</span><br><span class="line">        expOrFn,</span><br><span class="line">        debounce(<span class="number">1000</span>, <span class="keyword">async</span> (val) =&gt; &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&quot;val 变化了: &quot;</span>, val);</span><br><span class="line">          urlData[expOrFn] = val;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (</span><br><span class="line">            vm.$route.query[<span class="built_in">this</span>.urlPersistName] === <span class="built_in">JSON</span>.stringify(urlData)</span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">await</span> vm.$router.replace(&#123;</span><br><span class="line">            query: &#123;</span><br><span class="line">              ...vm.$route.query,</span><br><span class="line">              [<span class="built_in">this</span>.urlPersistName]: <span class="built_in">JSON</span>.stringify(urlData),</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;),</span><br><span class="line">        &#123;</span><br><span class="line">          deep: <span class="literal">true</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">install</span>(<span class="params">Vue, options = &#123;&#125;</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> _this = <span class="built_in">this</span>;</span><br><span class="line">    <span class="keyword">if</span> (options.expListName) &#123;</span><br><span class="line">      <span class="built_in">this</span>.expListName = options.expListName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (options.urlPersistName) &#123;</span><br><span class="line">      <span class="built_in">this</span>.urlPersistName = options.urlPersistName;</span><br><span class="line">    &#125;</span><br><span class="line">    Vue.prototype.$urlPersist = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">initDataByRouteUpdate</span>(<span class="params">to</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> expList = <span class="built_in">this</span>[_this.expListName];</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(expList)) &#123;</span><br><span class="line">        <span class="built_in">this</span>.$urlPersist.initNextUrlData(<span class="built_in">this</span>, expList, to);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Vue.mixin(&#123;</span><br><span class="line">      <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> expList = <span class="built_in">this</span>[_this.expListName];</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(expList)) &#123;</span><br><span class="line">          <span class="built_in">this</span>.$urlPersist.initUrlData(<span class="built_in">this</span>, expList);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="title">beforeRouteUpdate</span>(<span class="params">to, <span class="keyword">from</span>, next</span>)</span> &#123;</span><br><span class="line">        initDataByRouteUpdate.call(<span class="built_in">this</span>, to);</span><br><span class="line">        next();</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="title">beforeRouteEnter</span>(<span class="params">to, <span class="keyword">from</span>, next</span>)</span> &#123;</span><br><span class="line">        next(<span class="function">(<span class="params">vm</span>) =&gt;</span> initDataByRouteUpdate.call(vm, to));</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> VueUrlPersist;</span><br></pre></td></tr></table></figure>
<p>使用起来和其他的插件没什么差别</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> VueUrlPersist <span class="keyword">from</span> <span class="string">&quot;./views/js/VueUrlPersist&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vueUrlPersist = <span class="keyword">new</span> VueUrlPersist();</span><br><span class="line">Vue.use(vueUrlPersist);</span><br></pre></td></tr></table></figure>
<p>在需要使用的组件中只要声明这个属性就好了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&quot;Form2Tab&quot;</span>,</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      form: &#123;</span><br><span class="line">        keyword: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        sex: <span class="number">0</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      exps: [<span class="string">&quot;form&quot;</span>],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>然而，使用 vue 插件有个致命的缺陷：无论是否需要，都会为每个组件中都混入三个生命周期函数，吾辈没有找到一种可以根据实例中是否包含某个值而决定是否混入的方式。</p>
<h4 id="使用高阶函数"><a href="#使用高阶函数" class="headerlink" title="使用高阶函数"></a>使用高阶函数</h4><p>所以，我们使用 <code>高阶函数</code> + <code>mixin</code> 的形式看看。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; debounce, get, set &#125; <span class="keyword">from</span> <span class="string">&quot;./common&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VueUrlPersist</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 一些选项</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">&#123; key = <span class="string">&quot;qb&quot;</span> &#125; = &#123;&#125;</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.key = key;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 为 vue 实例上的字段进行深度赋值</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">setInitData</span>(<span class="params">vm, exp, urlData</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> oldVal = get(vm, exp, <span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">const</span> newVal = urlData[exp];</span><br><span class="line">    <span class="comment">//如果原值是对象且新值也是对象，则进行浅合并</span></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      oldVal === <span class="literal">undefined</span> ||</span><br><span class="line">      oldVal === <span class="literal">null</span> ||</span><br><span class="line">      <span class="keyword">typeof</span> oldVal === <span class="string">&quot;string&quot;</span> ||</span><br><span class="line">      <span class="keyword">typeof</span> oldVal === <span class="string">&quot;number&quot;</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      set(vm, exp, newVal);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> oldVal === <span class="string">&quot;object&quot;</span> &amp;&amp; <span class="keyword">typeof</span> newVal === <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">      <span class="built_in">Object</span>.assign(get(vm, exp), newVal);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 初始化一些数据需要序列化/反序列化到 url data 上</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>vm vue 实例</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">initUrlDataByCreated</span>(<span class="params">vm, exps</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> key = <span class="built_in">this</span>.key;</span><br><span class="line">    <span class="keyword">const</span> urlData = <span class="built_in">JSON</span>.parse(vm.$route.query[key] || <span class="string">&quot;&#123;&#125;&quot;</span>);</span><br><span class="line">    exps.forEach(<span class="function">(<span class="params">exp</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.setInitData(vm, exp, urlData);</span><br><span class="line">      vm.$watch(</span><br><span class="line">        exp,</span><br><span class="line">        debounce(<span class="function"><span class="keyword">function</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">          urlData[exp] = val;</span><br><span class="line">          <span class="keyword">if</span> (vm.$route.query[key] === <span class="built_in">JSON</span>.stringify(urlData)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          vm.$router.replace(&#123;</span><br><span class="line">            query: &#123;</span><br><span class="line">              ...vm.$route.query,</span><br><span class="line">              [key]: <span class="built_in">JSON</span>.stringify(urlData),</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;, <span class="number">1000</span>),</span><br><span class="line">        &#123;</span><br><span class="line">          deep: <span class="literal">true</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 在组件被 vue-router 路由复用时，单独进行初始化数据</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>vm vue 实例</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>route 将要改变的路由对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">initUrlDataByRouteUpdate</span>(<span class="params">vm, exps, route</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> urlData = <span class="built_in">JSON</span>.parse(route.query[<span class="built_in">this</span>.key] || <span class="string">&quot;&#123;&#125;&quot;</span>);</span><br><span class="line">    exps.forEach(<span class="function">(<span class="params">exp</span>) =&gt;</span> <span class="built_in">this</span>.setInitData(vm, exp, urlData));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生成可以 mixin 到 vue 实例的对象</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;&#123;created(): void, beforeRouteEnter(*=, *, *): void, beforeRouteUpdate(*=, *, *): void&#125;</span></span>&#125;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">generateInitUrlData</span>(<span class="params">...exps</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> _this = <span class="built_in">this</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        _this.initUrlDataByCreated(<span class="built_in">this</span>, exps);</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="title">beforeRouteUpdate</span>(<span class="params">to, <span class="keyword">from</span>, next</span>)</span> &#123;</span><br><span class="line">        _this.initUrlDataByRouteUpdate(<span class="built_in">this</span>, exps, to);</span><br><span class="line">        next();</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="title">beforeRouteEnter</span>(<span class="params">to, <span class="keyword">from</span>, next</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;beforeRouteEnter&quot;</span>);</span><br><span class="line">        next(<span class="function">(<span class="params">vm</span>) =&gt;</span> _this.initUrlDataByRouteUpdate(vm, exps, to));</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 修改一些配置</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>options 配置项</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">config</span>(<span class="params">options</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">Object</span>.assign(<span class="built_in">this</span>, options);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> vueUrlPersist = <span class="keyword">new</span> VueUrlPersist();</span><br><span class="line"><span class="keyword">const</span> generateInitUrlData = vueUrlPersist.generateInitUrlData.bind(</span><br><span class="line">  vueUrlPersist</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; vueUrlPersist, generateInitUrlData, VueUrlPersist &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> vueUrlPersist;</span><br></pre></td></tr></table></figure>
<p>使用起来几乎一样简单</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; generateInitUrlData &#125; <span class="keyword">from</span> <span class="string">&quot;./js/VueUrlPersist&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&quot;Form1&quot;</span>,</span><br><span class="line">  mixins: [generateInitUrlData(<span class="string">&quot;form&quot;</span>)],</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      form: &#123;</span><br><span class="line">        keyword: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        hobbyList: [],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>看起来，使用高阶函数也没有比 Vue 插件麻烦太多。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总的来说，虽然路途坎坷，不过这个问题还是很有趣的，而且确实能解决实际的问题，所以还是有研究价值的。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/1342b132059a48f4a822bcd182d8bfe1/" data-id="ckmcqox5j00bm0kuv7m0e8he9" data-title="浅谈 Vue SPA 网站 URL 保存数据实践" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">工程化</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-1f0ca923689549cca19517e74071e0ed" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/1f0ca923689549cca19517e74071e0ed/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/1f0ca923689549cca19517e74071e0ed/">面相 vue 开发者的 react 入坑指南</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><ul>
<li>问：为什么吾辈要使用 React？</li>
<li>答：React 拥有更加庞大的生态，以及对 TypeScript 的更好支持。<br>前者让需求实现变得更加简单，例如目前使用 Vue 做的后台管理系统使用了 Ant Design Vue 这个 UI 库，而它的上游 Ant Design 实际上官方维护的是 React 版本，而 Vue 并不是 <strong>亲儿子</strong>，导致一些问题并不像官方那么快解决。<br>后者强大的类型系统能降低维护成本，虽然开发时代码添加类型会稍加工作量，但可以降低维护成本，便于后续的修改、重构，同时 IDE 对其支持是 JavaScript 无法相提并论的。</li>
<li>问：那 React 相比于 Vue 而言有什么区别？</li>
<li>答：更强大、复杂、酷，对于没有现代前端开发经验的人而言可能非常困难，但一旦熟悉，则会非常喜欢它。组件化（<code>React Component/JSX</code>）、函数式（<code>React Hooks</code>）、不可变（<code>immutable</code>）都是非常有趣的思想，理解之后确实都能发现具体使用场景。<blockquote>
<p>Vue 作者说 <strong>React + Mobx 就是更复杂的 Vue</strong>，这句话确实有道理，下面在 <a href="#%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86">状态管理</a> 那里也进行了说明，但同时，相比于 <code>Vue + Vuex</code>，避免引入 Redux 的 <code>React + Mobx</code> 将是更简单的。</p>
</blockquote>
</li>
<li>问：有大公司在用么？</li>
<li>答：作为能够支撑 Facebook 这种级别公司的 Web 产品的基础，显然它拥有相当多的生产环境实践。</li>
</ul>
<h2 id="工程与周边生态"><a href="#工程与周边生态" class="headerlink" title="工程与周边生态"></a>工程与周边生态</h2><p>以下皆基于 <code>cra(create-react-app)</code> 创建的 <code>ts + react + mobx + react-router + immer</code> 技术栈进行说明，虽然完全不了解以上内容亦可，但最好了解一下它们是做什么的，下面第一次提及时也会简单说明一下。</p>
<h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><p>使用 create-react-app 创建 react 项目，但和 vue-cli 有一点明显区别：不提供很多配置，只是简单的项目生成。</p>
<h3 id="状态管理"><a href="#状态管理" class="headerlink" title="状态管理"></a>状态管理</h3><p>此处使用 mobx 对标，mobx 是一个状态管理库，以响应式、可变、简单方便为最大卖点。本质上可以认为为每个页面（页面内的所有组件）提供了一个全局对象，并实现了 vue 中的 <code>computed</code> 和 <code>watch</code>，所以 vue 的作者说 vue 是更简单的 react + mobx 确实有些道理，实际上这两个加起来能做到的事情不比原生 vue 多多少。</p>
<p>但它们之间也有几点不同</p>
<ul>
<li>vue 基于组件级别实现的 <code>computed</code> 和 <code>watch</code>，而 mobx 则是全局的</li>
<li>vue 是基于组件级别自动初始化和销毁，而 mobx 则是手动的</li>
<li>vue 基于组件但也受限于组件级别，全局状态仍要使用 vuex 这种 <strong>大炮</strong>，而 mobx 此时则是统一的</li>
<li>不使用 vuex 的情况下一些组件很难进行拆分，因为拆分后各组件的一些数据仍然需要共享和修改，这种时候单用 vue 的 <code>data/props</code> 就显得有些力不从心</li>
</ul>
<p>是否需要支持 es5？</p>
<ul>
<li>是：高阶函数</li>
<li>否：装饰器</li>
</ul>
<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><ul>
<li>递归菜单栏</li>
<li>使用高阶组件包装路由组件 <code>withRouter()</code></li>
<li>获取当前路由信息：<code>this.props.match</code></li>
<li>使用编程式的路由导航：<code>this.props.history</code><ul>
<li>注意 props 的类型变化</li>
</ul>
</li>
</ul>
<p>异步组件和 vue 稍微有点差别，虽然也是需要 <code>import()</code> 语法，但却需要使用高阶组件。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AsyncRoute</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  importComponent: () =&gt; PromiseLike&lt;&#123; <span class="keyword">default</span>: any &#125;&gt; | &#123; <span class="keyword">default</span>: any &#125;</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">AsyncComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span>&lt;<span class="title">any</span>, <span class="title">any</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">props: any</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">super</span>(props);</span><br><span class="line">      <span class="built_in">this</span>.state = &#123;</span><br><span class="line">        component: <span class="literal">null</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">default</span>: component &#125; = <span class="keyword">await</span> importComponent();</span><br><span class="line">      <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">        component: component,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> C = <span class="built_in">this</span>.state.component;</span><br><span class="line">      <span class="keyword">return</span> C ? <span class="xml"><span class="tag">&lt;<span class="name">C</span> &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></span> : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> AsyncComponent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> AsyncRoute;</span><br></pre></td></tr></table></figure>
<p>然后使用高阶组件包装即可</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route</span><br><span class="line">  path=&#123;<span class="string">&quot;/system/task&quot;</span>&#125;</span><br><span class="line">  component=&#123;AsyncRoute(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;../../index/HelloWorld&quot;</span>))&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：高阶组件和高阶函数类似，指的是接收一个组件/返回一个组件的组件。</p>
</blockquote>
<h3 id="代码组织"><a href="#代码组织" class="headerlink" title="代码组织"></a>代码组织</h3><ul>
<li>导出：tsx/jsx 使用默认导出，避免需要高阶函数包装的场景</li>
<li>优先使用函数式组件</li>
<li>src<ul>
<li>pages：页面级的组件<ul>
<li>component：页面级组件</li>
</ul>
</li>
<li>components：非页面相关的通用组件</li>
<li>assets：静态资源</li>
</ul>
</li>
</ul>
<h3 id="命名规范"><a href="#命名规范" class="headerlink" title="命名规范"></a>命名规范</h3><ul>
<li>React<ul>
<li>组件：必须使用大写驼峰，包括使用组件亦然</li>
<li>store<ul>
<li>必须使用 .store 后缀以区分普通 ts 文件</li>
<li>组件级 store 必须与组件名保持一致，例如 <code>Login</code> 组件对应的即为 <code>Login.store.ts</code></li>
</ul>
</li>
</ul>
</li>
<li>CSS<ul>
<li>css 中的 class 必须使用小写驼峰命名法，避免 css module 找不到（cra 不会自动处理转换）</li>
<li>优先使用 <code>.module.css</code> 而非 <code>.css</code>，避免全局样式污染</li>
<li>页面级 css 必须与组件名保持一致，例如 <code>Login</code> 组件对应的即为 <code>Login.module.css</code></li>
<li>非 css module 的代码必须使用 <code>&quot;&quot;</code> 而非 <code>&#123;&#39;&#39;&#125;</code></li>
</ul>
</li>
</ul>
<h3 id="修改默认配置"><a href="#修改默认配置" class="headerlink" title="修改默认配置"></a>修改默认配置</h3><p>cra 默认提供了脚本命令 <code>reject</code>，用于将 cra 封装的配置全部解压出来 – 当然，此操作是不可逆的！但除了这种破坏性的方式之外，也有人找到了和 vue-cli 中类似的方式，不过需要第三方包 <code>react-app-rewired</code> 的支持。</p>
<p>并在根目录添加配置文件 <code>config-overrides.js</code>，里面暴露出一个函数，即可修改 cra 的默认配置了。</p>
<p>下面是一个简单的示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> WorkerPlugin = <span class="built_in">require</span>(<span class="string">&quot;worker-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* config-overrides.js */</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">override</span>(<span class="params">config, env</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//region WebWorker 配置</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//do stuff with the webpack config...</span></span><br><span class="line">  config.output.globalObject = <span class="string">&quot;this&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (!config.plugins) &#123;</span><br><span class="line">    config.plugins = [];</span><br><span class="line">  &#125;</span><br><span class="line">  config.plugins.push(<span class="keyword">new</span> WorkerPlugin());</span><br><span class="line"></span><br><span class="line">  <span class="comment">//endregion</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="使用-parcel-js-进行项目打包"><a href="#使用-parcel-js-进行项目打包" class="headerlink" title="使用 parcel.js 进行项目打包"></a>使用 parcel.js 进行项目打包</h3><p>parcel 是一个新的打包工具，目的是提供开箱即用的零配置打包方案，和 webpack 大不相同的一点就是其不需要接触很多的概念，通过直接指定 html 文件为入口即可引入其他资源，包括但不限于 <code>vue/react/typescript/less</code> 之类的第三方资源，从逻辑上来讲对用户更加友好。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://parceljs.org/">官网</a>, <a target="_blank" rel="noopener" href="https://github.com/parcel-bundler/parcel">GitHub</a></p>
</blockquote>
<p>使用 parcel 打包和启动多入口项目非常简单，这是一个基本的多入口打包 <a target="_blank" rel="noopener" href="https://github.com/rxliuli/example/tree/master/antd_reactive_example">demo</a> 项目，允许将 App/Web 上类似的功能放在同一个项目中，并且支持集成其他有趣的功能。</p>
<h2 id="重点"><a href="#重点" class="headerlink" title="重点"></a>重点</h2><h3 id="this-的值"><a href="#this-的值" class="headerlink" title="this 的值"></a>this 的值</h3><p>在 <code>class</code> 中使用箭头函数以直接绑定当前组件的实例，尽量不要使用 <code>function</code>，否则 <code>this</code> 可能是不明确的。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  logMsg = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;msg&quot;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;hello world&lt;/h1&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="built_in">this</span>.logMsg&#125;&gt;打印&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> HelloWorld;</span><br></pre></td></tr></table></figure>
<h3 id="CSS-样式隔离"><a href="#CSS-样式隔离" class="headerlink" title="CSS 样式隔离"></a>CSS 样式隔离</h3><p>cra 创建的项目默认支持 css module，是 react 项目流行的一种 CSS 隔离方案。</p>
<p>使用步骤</p>
<ol>
<li> 为需要的 css 文件使用 <code>.module.css</code> 后缀名</li>
<li> 通过 <code>import styles from &#39;*.module.css&#39;</code> 在 <code>tsx</code> 中引入</li>
<li> 在 <code>className=&#123;styles.*&#125;</code> 使用 class 样式</li>
</ol>
<p>示例</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.helloWorld</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&quot;HelloWorld.module.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">HelloWorld</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.helloWorld&#125;</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注：</p>
<ul>
<li>此处的 <code>import styles from &#39;*.module.css&#39;</code> 不支持命名导入</li>
<li>此处实现的逻辑和 Vue 是一致的，只要使用了其中一个样式 <code>class</code>，则整个文件都会引入</li>
<li>CSS 只要被引入了，就不会被删除，即便组件被销毁了亦然，所以页面内的 CSS 只会增加，不会减少</li>
</ul>
<p>如何添加多个，默认使用 cra 创建的项目支持使用模板字符串</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">className=&#123;<span class="string">`<span class="subst">$&#123;styles.className1&#125;</span> <span class="subst">$&#123;styles.className2&#125;</span>`</span>&#125;</span><br></pre></td></tr></table></figure>
<p>看起来很丑？可以试试 <a target="_blank" rel="noopener" href="https://github.com/JedWatson/classnames">classnames</a></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> classNames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"></span><br><span class="line">className=&#123;classNames(globalStyles.global, globalStyles.margin)&#125;</span><br></pre></td></tr></table></figure>
<p>但仍然很丑，正如 Sindre Sorhus 所说：<a target="_blank" rel="noopener" href="https://twitter.com/sindresorhus/status/1001355913930858502">React 把简单的事情变复杂，复杂的事情变简单</a></p>
<p>另一种个 API 是 <code>classNames.bind</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> classNames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"><span class="keyword">const</span> cx=&#123;classNames.bind(globalStyles)&#125;</span><br><span class="line">className=&#123;cx(<span class="string">&#x27;global&#x27;</span>, <span class="string">&#x27;margin&#x27;</span>)&#125;</span><br></pre></td></tr></table></figure>
<p>但这会让 WebStorm 损失所有的 CSS 关联，影响了包括代码提示/跳转/重构等功能，考虑到维护成本实在得不偿失。</p>
<p>还有人提出了 typed css module，为所有的 <code>.module.css</code> 生成 <code>.d.ts</code> 类型定义，但这会和 css in js 一样丧失 css 预处理器的优势 —- 并且，所有的工具链都需要重新支持这种关联，将之认为是 css。</p>
<blockquote>
<p>参考</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.javascriptstuff.com/css-modules-by-example/">Css Modules by Example</a></li>
<li><a target="_blank" rel="noopener" href="https://create-react-app.dev/docs/adding-a-css-modules-stylesheet/">添加 CSS 模块样式表</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/gajus/babel-plugin-react-css-modules">babel-plugin-react-css-modules</a></li>
</ul>
</blockquote>
<h3 id="引入图片"><a href="#引入图片" class="headerlink" title="引入图片"></a>引入图片</h3><p>在任何一个项目中，都少不了引入图片的需求。而 React 中，并未像 Vue 对 <code>img, audio, video</code> 这些标签进行特殊处理，以支持直接使用路径即可将对应的媒体文件打包进来，React 需要使用 <code>import img from &#39;*&#39;</code> 的<strong>原始</strong>形式让 webpack <strong>知道</strong>这是一个需要打包的资源。</p>
<p>例如</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> img <span class="keyword">from</span> <span class="string">&quot;img.png&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  reutrn(<span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;img&#125;</span> <span class="attr">alt</span>=<span class="string">&quot;img&quot;</span> /&gt;</span></span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而对于 SVG 类型的图片，React 支持使用组件的形式引入。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ReactComponent <span class="keyword">as</span> IconAudio &#125; <span class="keyword">from</span> <span class="string">&quot;../../assets/icon/icon-audio.svg&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  reutrn(<span class="xml"><span class="tag">&lt;<span class="name">IconAudio</span> /&gt;</span></span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="slot"><a href="#slot" class="headerlink" title="slot"></a>slot</h3><p>两种方案</p>
<ol>
<li> 使用 <code>&#123;props.children&#125;</code>，和 vue 的 <code>slot:default</code> 几乎一样，只是不能通过子组件传递参数。</li>
<li> 如果需要传递多个命名 <code>slot</code>，则可以直接为 <code>props</code> 属性赋值为组件。例如 <code>title=&#123;&lt;div&gt;hello world&lt;/div&gt;&#125;</code></li>
<li> 如果需要使用子组件传参的话需要使用函数式组件的形式。例如 <code>title=&#123;value =&gt; &lt;div&gt;&#123;value&#125;&lt;/div&gt;&#125;</code></li>
</ol>
<blockquote>
<p>吐槽：函数式已经是政治正确了。</p>
</blockquote>
<p>使用函数式的 <code>slot</code> 时必须检查函数是否存在，如果不存在则不要调用，不像是 vue 中的 <code>slot</code> 是自动处理这一步的。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">this</span>.props.tableOperate &amp;&amp; <span class="built_in">this</span>.props.tableOperate(<span class="built_in">this</span>.state.innerValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="watch-监听-props"><a href="#watch-监听-props" class="headerlink" title="watch 监听 props"></a>watch 监听 props</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">componentDidUpdate</span>(<span class="params">prevProps: PropsType</span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 典型用法（不要忘记比较 props）：</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.props.value !== prevProps.value) &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      innerValue: <span class="built_in">this</span>.props.value,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><p>相比于 Vue 的生命周期，React 显然更加<strong>复杂</strong>与<strong>混乱</strong>，而且，老实说有时候真的很难用。</p>
<p>例如非常常见的生命周期 <code>componentWillUpdate</code>，它承担的责任实在是太多了，不仅 <code>watch</code> <code>state/props</code> 中的数据要用这个，连 React Router 的路由变化同样依赖于此。</p>
<p>下面列出最常用的一些生命周期以及典型用例</p>
<ul>
<li><p><code>render</code>：只要 state 变化就会触发重新渲染，等价于 vue 中渲染模板 HTML 中的内容</p>
</li>
<li><p><code>shouldComponentUpdate</code>：state 或者 props <strong>变化前</strong>就会执行，时机上早于 <code>render</code>。等价于 vue <code>beforeUpdate</code>，但可以在这个方法内 <code>return false</code> 阻止视图更新。</p>
</li>
<li><p><code>componentDidUpdate</code>：state 或者 props <strong>变化后</strong>就会执行，时机上晚于 <code>render</code>。等价于 vue <code>updated</code>。<br>多用于监听一些数据变化执行一些副作用操作，但包含的种类可能会非常多。</p>
<blockquote>
<p>注：此处 vue 中将之分为 <code>updated/watch/beforeRouteUpdate</code>，而在 React 中，全部由 <code>componentDidMount</code> 承担这个责任。</p>
</blockquote>
</li>
<li><p><code>componentDidMount</code>：当组件渲染<strong>完成后</strong>就会执行，时机上晚于 <code>render</code>，等价于 vue <code>mounted</code>。<br>多用于执行一些初始化操作，除非逻辑特别简单，否则不要在这个函数里放具体执行逻辑代码，而是专门写初始化函数在这里调用。</p>
</li>
<li><p><code>UNSAFE_componentWillMount</code>：在组件渲染<strong>完成前</strong>就会执行，等价于 vue <code>beforeMount</code>，但被废弃了，替代解决方案参考 <a href="#%E6%80%8E%E4%B9%88%E5%9C%A8%E6%B2%A1%E6%9C%89-created-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%B9%B6%E4%BF%9D%E8%AF%81%E7%94%A8%E6%88%B7%E7%9C%8B%E4%B8%8D%E5%88%B0%E9%BB%98%E8%AE%A4%E7%A9%BA%E6%95%B0%E6%8D%AE">怎么在没有 <code>created</code> 生命周期的情况下初始化数据并保证用户看不到默认空数据</a>。</p>
</li>
<li><p><code>componentWillUnmount</code>: 组件即将被销毁前调用，等价于 vue <code>beforeDestroy</code>。</p>
</li>
</ul>
<h3 id="简化-state-修改"><a href="#简化-state-修改" class="headerlink" title="简化 state 修改"></a>简化 state 修改</h3><p>使用 <code>setState</code> 很烦的一点是当你需要深度为某个属性赋值的时候，要为该属性上面所有的对象全部使用 <code>...</code> 或者其他方式拷贝一遍。</p>
<p>例如</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.setState(&#123;</span><br><span class="line">  user: &#123;</span><br><span class="line">    ...this.state.user,</span><br><span class="line">    address: &#123;</span><br><span class="line">      ...this.state.user.address,</span><br><span class="line">      city: newCity,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当有多个属性需要赋值时就尤其的繁琐，而 <a target="_blank" rel="noopener" href="https://github.com/immerjs/immer">immerjs</a> 正好可以解决这种痛点</p>
<p>使用 immer 重构之后</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.setState(produce(<span class="built_in">this</span>.state, <span class="function"><span class="params">draft</span> =&gt;</span> &#123;</span><br><span class="line">  draft.user.address.city = newCity</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>代码变得很简单了，虽然看起来是直接赋值，不过 immer 使用了 <code>Proxy</code> 和 <code>Object.freeze</code> 实现了对使用者友好的不可变数据修改，具体参考 。</p>
<h3 id="React-Hooks"><a href="#React-Hooks" class="headerlink" title="React Hooks"></a>React Hooks</h3><p>React Hooks 是在 React 16.8 之后添加的一项新特性，一如既往，很多人又是吹的天花乱坠。老实说最开始 React Hooks 流行并且在各个地方大肆宣传时，吾辈非常讨厌它，因为它又向函数式靠近了一步—-函数式政治正确真的很讨厌！所以，自正式学习 React 以来，吾辈都没有接触过 React Hooks，都是用 Class Component 实现组件。<br>但现在，架不住好奇心和一些朋友的推荐，吾辈稍微看了一下这个新特性。</p>
<p>它提供了两个主要的 API：</p>
<ul>
<li><code>useState</code>：声明一些可变状态</li>
<li><code>useEffect</code>：声明一些副作用代码</li>
</ul>
<p>使用看起来很简单</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useRef, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> HelloHooks: React.FC = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//region 计数器</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">const</span> [list, setList] = useState&lt;string[]&gt;([])</span><br><span class="line">  <span class="keyword">const</span> countAdd = <span class="function">() =&gt;</span> setCount(count + <span class="number">1</span>)</span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;count changed: &#x27;</span>, count)</span><br><span class="line">    setList(</span><br><span class="line">      <span class="built_in">Array</span>(count)</span><br><span class="line">        .fill(<span class="number">0</span>)</span><br><span class="line">        .map(<span class="function">(<span class="params">_, i</span>) =&gt;</span> <span class="string">`第 <span class="subst">$&#123;i + <span class="number">1</span>&#125;</span> 个元素`</span>),</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">//监听 count 变化</span></span><br><span class="line">  &#125;, [count])</span><br><span class="line"></span><br><span class="line">  <span class="comment">//endregion</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//region 自动聚焦输入框</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> inputRef = useRef&lt;HTMLInputElement&gt;(<span class="literal">null</span> <span class="keyword">as</span> any)</span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    inputRef.current.focus()</span><br><span class="line">    <span class="comment">//不监听任何值变化，只在第一次渲染运行</span></span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="comment">//endregion</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          ref=&#123;inputRef&#125;</span><br><span class="line">          value=&#123;count&#125;</span><br><span class="line">          type=<span class="string">&quot;number&quot;</span></span><br><span class="line">          onChange=&#123;<span class="function"><span class="params">e</span> =&gt;</span> setCount(<span class="built_in">parseInt</span>(e.target.value))&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;button onClick=&#123;countAdd&#125;&gt;增加&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">        &#123;list.map(<span class="function">(<span class="params">v, i</span>) =&gt;</span> (</span><br><span class="line">          &lt;li key=&#123;i&#125;&gt;&#123;v&#125;&lt;/li&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> HelloHooks</span><br></pre></td></tr></table></figure>
<p>可以看到，上面用 <code>useState/useEffect</code> 两个函数实现了一些常见的功能：<code>state, componentDidMount, componentDidUpdate</code>，<code>useEffect</code> 甚至默认支持类似 vue <code>watch</code> 的使用方式。</p>
<p>同时，使用 Hooks 可以轻易地封装出 <code>useModel</code>, vue 中的 <code>watch/computed</code> 甚至原生自带了！</p>
<ul>
<li><code>useMemo</code>：当依赖变化时计算属性</li>
<li><code>useCallback</code>：当依赖变化时执行回调</li>
</ul>
<p>然而，Hooks 终究不是万能。</p>
<ul>
<li>使用 Hooks 封装控制 DOM 相关的代码做不到，例如使用高阶组件实现的根据某些条件控制组件是否加载。</li>
<li>使用 Hooks 无法实现全部的生命周期，例如 <code>shouldComponentUpdate</code>。</li>
<li>Hooks <code>useEffect</code> 中调用的外部函数，无法即时获取到所有最新的 <code>state</code>，即便它们与 <code>useEffect</code> 同级（需要使用 <code>useCallback</code> 包装）</li>
<li>使用 Hooks 会让函数变得很大，对开发人员的要求比之前更高（与 vue 3 的函数式 API 一样，都是由开发者自己完全控制代码块的分割）</li>
</ul>
<blockquote>
<p>更多有关 React Hooks 的介绍，请参考：<a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/hooks-intro.html">https://zh-hans.reactjs.org/docs/hooks-intro.html</a> 以及 <a target="_blank" rel="noopener" href="https://vue-composition-api-rfc.netlify.com/#comparison-with-react-hooks">Vue Composition API 与 React Hooks 的对比</a>。</p>
</blockquote>
<!-- ### React Props

React props 基本上能传递任何东西，所以承担了 vue 中的多个特性。

- `props` 传递参数
- `$emit` 传递事件
- `slot` 传递组件

从这点来看，React 真是 **少即是多** 的范例。 -->

<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="React-有什么缺点"><a href="#React-有什么缺点" class="headerlink" title="React 有什么缺点"></a>React 有什么缺点</h3><ul>
<li>CSS 局部化有很多方案，但没有一统天下的</li>
<li>vue 在组件创建/销毁时会自动初始化/销毁状态及监听器，而 mobx 会一直保留需要手动初始化/清理<ul>
<li>注: 这点还未找到解决方案</li>
<li>更新：可以使用 context 部分解决这个问题</li>
</ul>
</li>
<li>使用 AntD 时可能遇到样式覆盖不了的问题，需要混合使用 <code>className, style</code> 两个属性。</li>
<li>react 会在开发阶段报错比较多，主要是一些低级错误，尤其是加上 ts 之后尤其如此</li>
</ul>
<h3 id="怎么在没有-created-生命周期的情况下初始化数据并保证用户看不到默认空数据"><a href="#怎么在没有-created-生命周期的情况下初始化数据并保证用户看不到默认空数据" class="headerlink" title="怎么在没有 created 生命周期的情况下初始化数据并保证用户看不到默认空数据"></a>怎么在没有 <code>created</code> 生命周期的情况下初始化数据并保证用户看不到默认空数据</h3><p>在 vue 中，吾辈经常在 created 生命周期中加载数据，避免用户看到默认的空数据，然而，React 中却没有这个生命周期，所以需要额外的处理。</p>
<blockquote>
<p>注：其实 vue 中用户也有可能看到空数据，但因为 Ajax 请求数据的速度也比较快，所以默认可以不用处理。</p>
</blockquote>
<p>一个可能解决方案是在指定元素外面包一层，在页面数据未加载之前，在元素上方添加一个 Loading 遮罩层提示<strong>正在加载中</strong>，等到数据加载完成后删除浮层。</p>
<p>下面是一个简单的实现</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ComponentLoading.module.css */</span></span><br><span class="line"><span class="selector-class">.componentLoadingDialog</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">10</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ComponentLoading.tsx</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Spin &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./ComponentLoading.module.css&#x27;</span></span><br><span class="line"></span><br><span class="line">type PropsType = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 是否显示 loading?</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  isLoading: boolean</span><br><span class="line">  tip?: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 控制 Ajax 请求未完成前某个区域不展示默认数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">props</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@constructor</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> ComponentLoading: React.FC&lt;PropsType&gt; = <span class="function"><span class="keyword">function</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; isLoading, tip = <span class="string">&#x27;正在加载中。。。&#x27;</span> &#125; = props</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div style=&#123;&#123; <span class="attr">position</span>: <span class="string">&#x27;relative&#x27;</span> &#125;&#125;&gt;</span><br><span class="line">      &#123;isLoading &amp;&amp; (</span><br><span class="line">        &lt;div className=&#123;styles.componentLoadingDialog&#125;&gt;</span><br><span class="line">          &lt;Spin tip=&#123;tip&#125; /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      )&#125;</span><br><span class="line"></span><br><span class="line">      &#123;<span class="comment">/*注：默认会渲染 children 组件*/</span>&#125;</span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ComponentLoading</span><br></pre></td></tr></table></figure>
<h3 id="React-和-vue-3-的对比"><a href="#React-和-vue-3-的对比" class="headerlink" title="React 和 vue 3 的对比"></a>React 和 vue 3 的对比</h3><p>vue 3 新增了 <code>Function-base</code> 的组件，看起来很像 React Hooks，但目前仍然无法在生产中实用。</p>
<p>目前看来有以下缺点</p>
<ol>
<li> IDE 支持不好</li>
<li> TS 不能解决 Vue 中的一些问题，尤其是对于模板层面简直无能为力</li>
<li> Vue 3 函数式组件没有覆盖之前所有的功能</li>
<li> 周边生态目前没有早期支持的迹象</li>
</ol>
<p>关于第二和第三点，吾辈认为这是 Vue 使用模板带来的一些天然的问题，几乎不可能解决。</p>
<p>而 React 和 TS 结合比 Vue 要完善很多，包括类型校验完全使用 TS 而非自定义运行时校验机制。</p>
<blockquote>
<p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://vue-composition-api-rfc.netlify.com/#comparison-with-react-hooks">Vue composition api comparison with React Hooks</a></li>
<li><a target="_blank" rel="noopener" href="https://aweiu.com/%E8%B0%81%E8%83%BD%E5%A4%A7%E8%87%B4%E8%AF%B4%E4%B8%8Bvue%E5%92%8Creact%E7%9A%84%E6%9C%80%E5%A4%A7%E5%8C%BA%E5%88%AB%E4%B9%8B%E5%A4%84%EF%BC%9F/">谁能大致说下 vue 和 react 的最大区别之处？</a></li>
</ul>
</blockquote>
<h3 id="开发环境代理"><a href="#开发环境代理" class="headerlink" title="开发环境代理"></a>开发环境代理</h3><p>开发环境配置代理几乎是必用功能。</p>
<p>简单的情况直接在 <code>package.json</code> 中使用 <code>proxy</code> 字段即可</p>
<blockquote>
<p>参考：<a target="_blank" rel="noopener" href="https://create-react-app.dev/docs/proxying-api-requests-in-development">Proxying API Requests in Development</a></p>
</blockquote>
<p>复杂的情况相比于 vue-cli 将全部配置统一在 <code>vue.config.js</code> 中，cra 看起来仍是分散式的。</p>
<p>步骤</p>
<ol>
<li><p> 安装中间件 <code>yarn add -D http-proxy-middleware @types/</code></p>
</li>
<li><p> 创建文件 <code>src/setupProxy.ts</code></p>
</li>
<li><p>编写配置</p>
 <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> proxy <span class="keyword">from</span> <span class="string">&quot;http-proxy-middleware&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs-extra&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 开发环境代理</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">app</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;string|*&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">app: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> proxyConfig: proxy.Config = &#123;</span><br><span class="line">    target: <span class="string">&quot;https://localhost:8000&quot;</span>,</span><br><span class="line">    changeOrigin: <span class="literal">true</span>,</span><br><span class="line">    secure: <span class="literal">false</span>,</span><br><span class="line">    ws: <span class="literal">true</span>,</span><br><span class="line">    <span class="function"><span class="title">pathRewrite</span>(<span class="params">api: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> mockApiList = fs.readJSONSync(</span><br><span class="line">        path.resolve(__dirname, <span class="string">&quot;./config/mockApiList.json&quot;</span>)</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        api +</span><br><span class="line">        (mockApiList.some(<span class="function">(<span class="params">mockApi: <span class="built_in">string</span></span>) =&gt;</span> api.includes(mockApi))</span><br><span class="line">          ? <span class="string">&quot;?mock=default&amp;errCode=200&quot;</span></span><br><span class="line">          : <span class="string">&quot;&quot;</span>)</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  app.use(proxy(<span class="string">&quot;/api&quot;</span>, proxyConfig));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/chimurai/http-proxy-middleware">http-proxy-middleware</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5bd13c5ce51d457a203cebf4">一篇读懂 http-proxy-middleware</a></li>
</ul>
</blockquote>
</li>
</ol>
<h3 id="怎么打包成不依赖于部署路径的-dist"><a href="#怎么打包成不依赖于部署路径的-dist" class="headerlink" title="怎么打包成不依赖于部署路径的 dist"></a>怎么打包成不依赖于部署路径的 dist</h3><ol>
<li><p> 修改 <code>package.json</code> 中字段 <code>homepage</code> 的值为 <code>.</code></p>
</li>
<li><p>使用 react router 中的 hash mode，具体而言就是修改 <em>index.tsx</em> 中使用如下代码，关键是 <code>HashRouter</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line">import &#123; HashRouter &#125; from &quot;react-router-dom&quot;;</span><br><span class="line">import App from &quot;.&#x2F;App.tsx&quot;;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;React.StrictMode&gt;</span><br><span class="line">    &lt;HashRouter&gt;</span><br><span class="line">      &lt;App &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;HashRouter&gt;</span><br><span class="line">  &lt;&#x2F;React.StrictMode&gt;,</span><br><span class="line">  document.getElementById(&quot;app&quot;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="为什么-react-hooks-总是有奇怪的问题"><a href="#为什么-react-hooks-总是有奇怪的问题" class="headerlink" title="为什么 react hooks 总是有奇怪的问题"></a>为什么 react hooks 总是有奇怪的问题</h3></li>
</ol>
<p>根源在于 react 的 render 函数是多次执行，导致如果没有正确的声明依赖项或者顺序，就会导致出现奇怪的问题。</p>
<p>典型的依赖声明问题</p>
<blockquote>
<p>参考: <a target="_blank" rel="noopener" href="https://codesandbox.io/s/react-hooks-useeffect-bixuzhengquedeshengmingyilaibaoguaqineibudiaoyongdeqitahanshudeyilaixiang-4iy1x">https://codesandbox.io/s/react-hooks-useeffect-bixuzhengquedeshengmingyilaibaoguaqineibudiaoyongdeqitahanshudeyilaixiang-4iy1x</a></p>
</blockquote>
<p>典型的顺序问题</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/1f0ca923689549cca19517e74071e0ed/" data-id="ckmcqox5j00bo0kuv4hwa67ac" data-title="面相 vue 开发者的 react 入坑指南" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react/" rel="tag">react</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-81cc1bbf5d8c4eb28224f752550189f7" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/81cc1bbf5d8c4eb28224f752550189f7/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/81cc1bbf5d8c4eb28224f752550189f7/">前端使用工具强制实行代码规范（Vue）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/rxliuli/example/tree/master/linter_vue_example">GitHub Demo</a></p>
</blockquote>
<p>非强制性的规范都不会成为真正的规范。在之前，我们也会在团队内编写一些开发规范文档，却总是不能真正有效的执行下去，原因何在？</p>
<ul>
<li>其一，人是健忘的，就算真正看完了规范文档，也不可能记住每一条规范，并且在代码中正确实践。</li>
<li>其二，人是懒惰的，即便有着规范，但只要写代码的时候没有强制性，那总是不会在意的。</li>
</ul>
<p>那么，使用自动化的工具是为首选，而前端恰好有了一些可用的工具来帮助我们。</p>
<h2 id="ESLint"><a href="#ESLint" class="headerlink" title="ESLint"></a>ESLint</h2><p>ESLint 是一个对 JS 低级错误进行修复的工具，甚至于，现在连 TypeScript 官方也抛弃 TSLint 转向这个工具了，因为它的生态更大，实现的规则数量远远多于 TSLint，能把 JS 中的大部分低级错误检测出来，并能自动修复其中一部分。</p>
<p>安装依赖</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -D eslint babel-eslint eslint-plugin-vue @vue/cli-plugin-eslint</span><br></pre></td></tr></table></figure>
<blockquote>
<p>依赖解释</p>
<ul>
<li><code>eslint</code>: 本体包</li>
<li><code>babel-eslint</code>: eslint 与 babel 整合包</li>
<li><code>eslint-plugin-vue @vue/cli-plugin-eslint</code>: eslint 与 vue 整合包</li>
</ul>
</blockquote>
<p>进行配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .eslintrc.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  root: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">//环境</span></span><br><span class="line">  env: &#123;</span><br><span class="line">    browser: <span class="literal">true</span>,</span><br><span class="line">    commonjs: <span class="literal">true</span>,</span><br><span class="line">    es6: <span class="literal">true</span>,</span><br><span class="line">    node: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">extends</span>: [</span><br><span class="line">    <span class="comment">//继承 vue 的标准特性</span></span><br><span class="line">    <span class="string">&quot;plugin:vue/essential&quot;</span>,</span><br><span class="line">    <span class="string">&quot;eslint:recommended&quot;</span>,</span><br><span class="line">  ],</span><br><span class="line">  rules: &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 禁止不需要的括号，例如 const i = (1 + 1)，但该规则存在的问题是会认为类两侧的圆括号也是不合法的</span></span><br><span class="line"><span class="comment">     * 例如: billId =&gt; (StringValidator.isBlank(billId) ? &#x27;否&#x27; : &#x27;是&#x27;)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// &#x27;no-extra-parens&#x27;: &#x27;error&#x27;,</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 禁止魔法值，该规则的主要问题是很多误报</span></span><br><span class="line"><span class="comment">     * 例如: offset / size + (offset % size === 0 ? 0 : 1)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="string">&quot;no-magic-numbers&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//禁止使用 var，强制要求使用 const/let</span></span><br><span class="line">    <span class="string">&quot;no-var&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="comment">//不使用未定义的变量</span></span><br><span class="line">    <span class="string">&quot;no-use-before-define&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="comment">//不允许在循环中使用 await，请使用 Promise.all</span></span><br><span class="line">    <span class="string">&quot;no-await-in-loop&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="comment">//不允许使用 return await，直接返回 Promise 就好</span></span><br><span class="line">    <span class="string">&quot;no-return-await&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="comment">//不允许使用 console 对象，因为会打印到控制台上</span></span><br><span class="line">    <span class="string">&quot;no-console&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="comment">//使用 class 中的方法必须使用 this. 前缀</span></span><br><span class="line">    <span class="comment">// &#x27;class-methods-use-this&#x27;: &#x27;error&#x27;,</span></span><br><span class="line">    <span class="comment">//禁止使用 alert, confirm, prompt，该 API 会阻断所有其他操作，但该规则存在的问题是有可能需要之后用上方便统一调用呢？</span></span><br><span class="line">    <span class="string">&quot;no-alert&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="comment">//禁止使用 eval，该操作是危险的</span></span><br><span class="line">    <span class="string">&quot;no-eval&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="string">&quot;no-implied-eval&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="comment">//禁止使用 new Function 创建函数</span></span><br><span class="line">    <span class="string">&quot;no-new-func&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="comment">//禁止使用包装类 String, Number, Boolean</span></span><br><span class="line">    <span class="string">&quot;no-new-wrappers&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="comment">//禁止把语句作为计算结果返回，请使用两条语句</span></span><br><span class="line">    <span class="string">&quot;no-return-assign&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="comment">//禁止使用不应该的 concat 连接，字符串请使用 + 连接，数组则可以使用 [...arr1, ...arr2]</span></span><br><span class="line">    <span class="string">&quot;no-useless-concat&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="comment">//禁止 yoda 比较，不要用 1 === i 而是用 i === 1 更加自然</span></span><br><span class="line">    yoda: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="comment">//禁止没有用的三元运算符，就算是 ⑨ 也知道这样做有问题 answer === 1 ? true : false</span></span><br><span class="line">    <span class="string">&quot;no-unneeded-ternary&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="comment">//禁止无用的计算属性 const obj = &#123; [&#x27;1&#x27;]: 1 &#125;</span></span><br><span class="line">    <span class="string">&quot;no-useless-computed-key&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="comment">//如果可以使用解构，那就进行警告，例如 const name = user.name 就应该被替换为 const &#123; name &#125; = user，避免了重复声明，也能进行默认赋值等操作</span></span><br><span class="line">    <span class="string">&quot;prefer-destructuring&quot;</span>: <span class="string">&quot;warn&quot;</span>,</span><br><span class="line">    <span class="comment">//使用 rest 不定参数代替全局变量 arguments</span></span><br><span class="line">    <span class="string">&quot;prefer-rest-params&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="comment">//使用扩展运算符代替 apply 调用</span></span><br><span class="line">    <span class="string">&quot;prefer-spread&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="comment">//使用 Symbol 必须使用描述说明它要做什么</span></span><br><span class="line">    <span class="string">&quot;symbol-description&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="comment">//如果可以使用反射，那就是用反射调用，Reflect 代替 delete 关键字删除对象属性</span></span><br><span class="line">    <span class="string">&quot;prefer-reflect&quot;</span>: <span class="string">&quot;warn&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    <span class="comment">//使用 babel 解析语法</span></span><br><span class="line">    parser: <span class="string">&quot;babel-eslint&quot;</span>,</span><br><span class="line">    <span class="comment">//使用 es2017 的语法</span></span><br><span class="line">    ecmaVersion: <span class="number">2017</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>如果有需要忽略的文件也可以在 <em>.eslintignore</em> 文件中进行配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; .eslintignore</span><br><span class="line">&#96;&#x2F;&#x2F; 忽略掉 TypeScript 类型定义文件</span><br><span class="line">*&#x2F;**&#x2F;*.d.ts&#96;</span><br></pre></td></tr></table></figure>
<p>添加脚本</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 其他配置。。。</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;lint:js&quot;</span>: <span class="string">&quot;vue-cli-service lint&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;fix:js&quot;</span>: <span class="string">&quot;vue-cli-service lint --fix&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 其他配置。。。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run lint:js</span><br></pre></td></tr></table></figure>
<p>现在，你可以检测到代码中的问题，并修复它了。</p>
<p>相关链接</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://eslint.org/">ESLint 官网</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/vuejs/vue-cli/tree/dev/packages/%40vue/cli-plugin-eslint">vue eslint 整合包</a></li>
</ul>
<blockquote>
<p>WebStorm 配置 ESLint 即时检查:<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190926114439.png" alt="WebStorm 使用 ESLint"><br>参考: <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/28808857">https://stackoverflow.com/questions/28808857</a></p>
</blockquote>
<h2 id="StyleLint"><a href="#StyleLint" class="headerlink" title="StyleLint"></a>StyleLint</h2><p>StyleLint 是一个用来对 CSS 进行校验/修复的工具，和 ESLint 类似，但却针对 CSS 方面。我们使用它用来避免一些不好的 CSS 写法，也能避免 code review 时被其他人吐槽。。。</p>
<p>安装依赖</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -D stylelint stylelint-config-standard stylelint-order stylelint-scss</span><br></pre></td></tr></table></figure>
<blockquote>
<p>依赖解释</p>
<ul>
<li><code>stylelint</code>: 本体包</li>
<li><code>stylelint-config-standard</code>: stylelint 标准配置</li>
<li><code>stylelint-scss</code>: stylelint scss 支持插件包</li>
<li><code>stylelint-order</code>: stylelint 属性排序插件</li>
</ul>
</blockquote>
<p>进行配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// stylelint.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [<span class="string">&quot;stylelint-scss&quot;</span>, <span class="string">&quot;stylelint-order&quot;</span>],</span><br><span class="line">  <span class="keyword">extends</span>: [<span class="string">&quot;stylelint-config-standard&quot;</span>],</span><br><span class="line">  rules: &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关键问题在于是否要忽略空检查</span></span><br><span class="line"><span class="comment">     * 下面两种都会被判断为错误</span></span><br><span class="line"><span class="comment">     * &lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span></span><br><span class="line"><span class="comment">     * a &#123;&#125;</span></span><br><span class="line"><span class="comment">     * 上面一种是很常见的</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// &#x27;no-empty-source&#x27;: null,</span></span><br><span class="line">    <span class="comment">//禁止注释两侧出现空白（IDEA 默认就没有空白）</span></span><br><span class="line">    <span class="string">&quot;comment-whitespace-inside&quot;</span>: <span class="string">&quot;never&quot;</span>,</span><br><span class="line">    <span class="comment">//scss 的特定符号将被 css 检查时忽略而在 scss 检查时才会生效</span></span><br><span class="line">    <span class="string">&quot;at-rule-no-unknown&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">&quot;scss/at-rule-no-unknown&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//CSS 声明定义顺序，自定义 class 放在默认元素上面</span></span><br><span class="line">    <span class="string">&quot;order/order&quot;</span>: [<span class="string">&quot;custom-properties&quot;</span>, <span class="string">&quot;declarations&quot;</span>],</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * CSS 属性顺序</span></span><br><span class="line"><span class="comment">     * 1. 控制外部属性</span></span><br><span class="line"><span class="comment">     * 2. 盒模型</span></span><br><span class="line"><span class="comment">     * 3. 视觉</span></span><br><span class="line"><span class="comment">     * 4. 其他</span></span><br><span class="line"><span class="comment">     * 5. 未定义</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="string">&quot;order/properties-order&quot;</span>: [</span><br><span class="line">      [</span><br><span class="line">        <span class="comment">//指令</span></span><br><span class="line">        <span class="string">&quot;composes&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@import&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@extend&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@mixin&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@at-root&quot;</span>,</span><br><span class="line">        <span class="comment">//盒模型相关</span></span><br><span class="line">        <span class="string">&quot;display&quot;</span>,</span><br><span class="line">        <span class="string">&quot;flex&quot;</span>,</span><br><span class="line">        <span class="string">&quot;flex-basis&quot;</span>,</span><br><span class="line">        <span class="string">&quot;flex-direction&quot;</span>,</span><br><span class="line">        <span class="string">&quot;flex-flow&quot;</span>,</span><br><span class="line">        <span class="string">&quot;flex-grow&quot;</span>,</span><br><span class="line">        <span class="string">&quot;flex-shrink&quot;</span>,</span><br><span class="line">        <span class="string">&quot;flex-wrap&quot;</span>,</span><br><span class="line">        <span class="string">&quot;grid&quot;</span>,</span><br><span class="line">        <span class="string">&quot;grid-area&quot;</span>,</span><br><span class="line">        <span class="string">&quot;grid-auto-rows&quot;</span>,</span><br><span class="line">        <span class="string">&quot;grid-auto-columns&quot;</span>,</span><br><span class="line">        <span class="string">&quot;grid-auto-flow&quot;</span>,</span><br><span class="line">        <span class="string">&quot;grid-gap&quot;</span>,</span><br><span class="line">        <span class="string">&quot;grid-row&quot;</span>,</span><br><span class="line">        <span class="string">&quot;grid-row-start&quot;</span>,</span><br><span class="line">        <span class="string">&quot;grid-row-end&quot;</span>,</span><br><span class="line">        <span class="string">&quot;grid-row-gap&quot;</span>,</span><br><span class="line">        <span class="string">&quot;grid-column&quot;</span>,</span><br><span class="line">        <span class="string">&quot;grid-column-start&quot;</span>,</span><br><span class="line">        <span class="string">&quot;grid-column-end&quot;</span>,</span><br><span class="line">        <span class="string">&quot;grid-column-gap&quot;</span>,</span><br><span class="line">        <span class="string">&quot;grid-template&quot;</span>,</span><br><span class="line">        <span class="string">&quot;grid-template-areas&quot;</span>,</span><br><span class="line">        <span class="string">&quot;grid-template-rows&quot;</span>,</span><br><span class="line">        <span class="string">&quot;grid-template-columns&quot;</span>,</span><br><span class="line">        <span class="string">&quot;gap&quot;</span>,</span><br><span class="line">        <span class="string">&quot;align-content&quot;</span>,</span><br><span class="line">        <span class="string">&quot;align-items&quot;</span>,</span><br><span class="line">        <span class="string">&quot;align-self&quot;</span>,</span><br><span class="line">        <span class="string">&quot;justify-content&quot;</span>,</span><br><span class="line">        <span class="string">&quot;justify-items&quot;</span>,</span><br><span class="line">        <span class="string">&quot;justify-self&quot;</span>,</span><br><span class="line">        <span class="string">&quot;order&quot;</span>,</span><br><span class="line">        <span class="string">&quot;float&quot;</span>,</span><br><span class="line">        <span class="string">&quot;clear&quot;</span>,</span><br><span class="line">        <span class="string">&quot;box-sizing&quot;</span>,</span><br><span class="line">        <span class="string">&quot;width&quot;</span>,</span><br><span class="line">        <span class="string">&quot;min-width&quot;</span>,</span><br><span class="line">        <span class="string">&quot;max-width&quot;</span>,</span><br><span class="line">        <span class="string">&quot;height&quot;</span>,</span><br><span class="line">        <span class="string">&quot;min-height&quot;</span>,</span><br><span class="line">        <span class="string">&quot;max-height&quot;</span>,</span><br><span class="line">        <span class="string">&quot;margin&quot;</span>,</span><br><span class="line">        <span class="string">&quot;margin-top&quot;</span>,</span><br><span class="line">        <span class="string">&quot;margin-right&quot;</span>,</span><br><span class="line">        <span class="string">&quot;margin-bottom&quot;</span>,</span><br><span class="line">        <span class="string">&quot;margin-left&quot;</span>,</span><br><span class="line">        <span class="string">&quot;padding&quot;</span>,</span><br><span class="line">        <span class="string">&quot;padding-top&quot;</span>,</span><br><span class="line">        <span class="string">&quot;padding-right&quot;</span>,</span><br><span class="line">        <span class="string">&quot;padding-bottom&quot;</span>,</span><br><span class="line">        <span class="string">&quot;padding-left&quot;</span>,</span><br><span class="line">        <span class="comment">//定位相关</span></span><br><span class="line">        <span class="string">&quot;position&quot;</span>,</span><br><span class="line">        <span class="string">&quot;top&quot;</span>,</span><br><span class="line">        <span class="string">&quot;right&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bottom&quot;</span>,</span><br><span class="line">        <span class="string">&quot;left&quot;</span>,</span><br><span class="line">        <span class="string">&quot;z-index&quot;</span>,</span><br><span class="line">        <span class="comment">//边框</span></span><br><span class="line">        <span class="string">&quot;border&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-color&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-style&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-width&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-top&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-top-color&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-top-width&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-top-style&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-right&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-right-color&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-right-width&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-right-style&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-bottom&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-bottom-color&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-bottom-width&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-bottom-style&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-left&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-left-color&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-left-width&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-left-style&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-radius&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-top-left-radius&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-top-right-radius&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-bottom-right-radius&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-bottom-left-radius&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-image&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-image-source&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-image-slice&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-image-width&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-image-outset&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-image-repeat&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-collapse&quot;</span>,</span><br><span class="line">        <span class="string">&quot;border-spacing&quot;</span>,</span><br><span class="line">        <span class="comment">//溢出</span></span><br><span class="line">        <span class="string">&quot;object-fit&quot;</span>,</span><br><span class="line">        <span class="string">&quot;object-position&quot;</span>,</span><br><span class="line">        <span class="string">&quot;overflow&quot;</span>,</span><br><span class="line">        <span class="string">&quot;overflow-x&quot;</span>,</span><br><span class="line">        <span class="string">&quot;overflow-y&quot;</span>,</span><br><span class="line">        <span class="comment">//版式</span></span><br><span class="line">        <span class="string">&quot;color&quot;</span>,</span><br><span class="line">        <span class="string">&quot;font&quot;</span>,</span><br><span class="line">        <span class="string">&quot;font-weight&quot;</span>,</span><br><span class="line">        <span class="string">&quot;font-size&quot;</span>,</span><br><span class="line">        <span class="string">&quot;font-family&quot;</span>,</span><br><span class="line">        <span class="string">&quot;font-style&quot;</span>,</span><br><span class="line">        <span class="string">&quot;font-variant&quot;</span>,</span><br><span class="line">        <span class="string">&quot;font-size-adjust&quot;</span>,</span><br><span class="line">        <span class="string">&quot;font-stretch&quot;</span>,</span><br><span class="line">        <span class="string">&quot;font-effect&quot;</span>,</span><br><span class="line">        <span class="string">&quot;font-emphasize&quot;</span>,</span><br><span class="line">        <span class="string">&quot;font-emphasize-position&quot;</span>,</span><br><span class="line">        <span class="string">&quot;font-emphasize-style&quot;</span>,</span><br><span class="line">        <span class="string">&quot;font-smooth&quot;</span>,</span><br><span class="line">        <span class="string">&quot;line-height&quot;</span>,</span><br><span class="line">        <span class="string">&quot;direction&quot;</span>,</span><br><span class="line">        <span class="string">&quot;letter-spacing&quot;</span>,</span><br><span class="line">        <span class="string">&quot;white-space&quot;</span>,</span><br><span class="line">        <span class="string">&quot;text-align&quot;</span>,</span><br><span class="line">        <span class="string">&quot;text-align-last&quot;</span>,</span><br><span class="line">        <span class="string">&quot;text-transform&quot;</span>,</span><br><span class="line">        <span class="string">&quot;text-decoration&quot;</span>,</span><br><span class="line">        <span class="string">&quot;text-emphasis&quot;</span>,</span><br><span class="line">        <span class="string">&quot;text-emphasis-color&quot;</span>,</span><br><span class="line">        <span class="string">&quot;text-emphasis-style&quot;</span>,</span><br><span class="line">        <span class="string">&quot;text-emphasis-position&quot;</span>,</span><br><span class="line">        <span class="string">&quot;text-indent&quot;</span>,</span><br><span class="line">        <span class="string">&quot;text-justify&quot;</span>,</span><br><span class="line">        <span class="string">&quot;text-outline&quot;</span>,</span><br><span class="line">        <span class="string">&quot;text-wrap&quot;</span>,</span><br><span class="line">        <span class="string">&quot;text-overflow&quot;</span>,</span><br><span class="line">        <span class="string">&quot;text-overflow-ellipsis&quot;</span>,</span><br><span class="line">        <span class="string">&quot;text-overflow-mode&quot;</span>,</span><br><span class="line">        <span class="string">&quot;text-orientation&quot;</span>,</span><br><span class="line">        <span class="string">&quot;text-shadow&quot;</span>,</span><br><span class="line">        <span class="string">&quot;vertical-align&quot;</span>,</span><br><span class="line">        <span class="string">&quot;word-wrap&quot;</span>,</span><br><span class="line">        <span class="string">&quot;word-break&quot;</span>,</span><br><span class="line">        <span class="string">&quot;word-spacing&quot;</span>,</span><br><span class="line">        <span class="string">&quot;overflow-wrap&quot;</span>,</span><br><span class="line">        <span class="string">&quot;tab-size&quot;</span>,</span><br><span class="line">        <span class="string">&quot;hyphens&quot;</span>,</span><br><span class="line">        <span class="string">&quot;unicode-bidi&quot;</span>,</span><br><span class="line">        <span class="string">&quot;columns&quot;</span>,</span><br><span class="line">        <span class="string">&quot;column-count&quot;</span>,</span><br><span class="line">        <span class="string">&quot;column-fill&quot;</span>,</span><br><span class="line">        <span class="string">&quot;column-gap&quot;</span>,</span><br><span class="line">        <span class="string">&quot;column-rule&quot;</span>,</span><br><span class="line">        <span class="string">&quot;column-rule-color&quot;</span>,</span><br><span class="line">        <span class="string">&quot;column-rule-style&quot;</span>,</span><br><span class="line">        <span class="string">&quot;column-rule-width&quot;</span>,</span><br><span class="line">        <span class="string">&quot;column-span&quot;</span>,</span><br><span class="line">        <span class="string">&quot;column-width&quot;</span>,</span><br><span class="line">        <span class="string">&quot;page-break-after&quot;</span>,</span><br><span class="line">        <span class="string">&quot;page-break-before&quot;</span>,</span><br><span class="line">        <span class="string">&quot;page-break-inside&quot;</span>,</span><br><span class="line">        <span class="string">&quot;src&quot;</span>,</span><br><span class="line">        <span class="comment">//视觉</span></span><br><span class="line">        <span class="string">&quot;list-style&quot;</span>,</span><br><span class="line">        <span class="string">&quot;list-style-position&quot;</span>,</span><br><span class="line">        <span class="string">&quot;list-style-type&quot;</span>,</span><br><span class="line">        <span class="string">&quot;list-style-image&quot;</span>,</span><br><span class="line">        <span class="string">&quot;table-layout&quot;</span>,</span><br><span class="line">        <span class="string">&quot;empty-cells&quot;</span>,</span><br><span class="line">        <span class="string">&quot;caption-side&quot;</span>,</span><br><span class="line">        <span class="string">&quot;background&quot;</span>,</span><br><span class="line">        <span class="string">&quot;background-color&quot;</span>,</span><br><span class="line">        <span class="string">&quot;background-image&quot;</span>,</span><br><span class="line">        <span class="string">&quot;background-repeat&quot;</span>,</span><br><span class="line">        <span class="string">&quot;background-position&quot;</span>,</span><br><span class="line">        <span class="string">&quot;background-position-x&quot;</span>,</span><br><span class="line">        <span class="string">&quot;background-position-y&quot;</span>,</span><br><span class="line">        <span class="string">&quot;background-size&quot;</span>,</span><br><span class="line">        <span class="string">&quot;background-clip&quot;</span>,</span><br><span class="line">        <span class="string">&quot;background-origin&quot;</span>,</span><br><span class="line">        <span class="string">&quot;background-attachment&quot;</span>,</span><br><span class="line">        <span class="string">&quot;background-blend-mode&quot;</span>,</span><br><span class="line">        <span class="comment">//动画</span></span><br><span class="line">        <span class="string">&quot;transition&quot;</span>,</span><br><span class="line">        <span class="string">&quot;transition-delay&quot;</span>,</span><br><span class="line">        <span class="string">&quot;transition-timing-function&quot;</span>,</span><br><span class="line">        <span class="string">&quot;transition-duration&quot;</span>,</span><br><span class="line">        <span class="string">&quot;transition-property&quot;</span>,</span><br><span class="line">        <span class="string">&quot;animation&quot;</span>,</span><br><span class="line">        <span class="string">&quot;animation-name&quot;</span>,</span><br><span class="line">        <span class="string">&quot;animation-duration&quot;</span>,</span><br><span class="line">        <span class="string">&quot;animation-play-state&quot;</span>,</span><br><span class="line">        <span class="string">&quot;animation-timing-function&quot;</span>,</span><br><span class="line">        <span class="string">&quot;animation-delay&quot;</span>,</span><br><span class="line">        <span class="string">&quot;animation-iteration-count&quot;</span>,</span><br><span class="line">        <span class="string">&quot;animation-direction&quot;</span>,</span><br><span class="line">        <span class="string">&quot;animation-fill-mode&quot;</span>,</span><br><span class="line">        <span class="comment">//其他</span></span><br><span class="line">        <span class="string">&quot;appearance&quot;</span>,</span><br><span class="line">        <span class="string">&quot;content&quot;</span>,</span><br><span class="line">        <span class="string">&quot;clip&quot;</span>,</span><br><span class="line">        <span class="string">&quot;clip-path&quot;</span>,</span><br><span class="line">        <span class="string">&quot;counter-reset&quot;</span>,</span><br><span class="line">        <span class="string">&quot;counter-increment&quot;</span>,</span><br><span class="line">        <span class="string">&quot;resize&quot;</span>,</span><br><span class="line">        <span class="string">&quot;user-select&quot;</span>,</span><br><span class="line">        <span class="string">&quot;nav-index&quot;</span>,</span><br><span class="line">        <span class="string">&quot;nav-up&quot;</span>,</span><br><span class="line">        <span class="string">&quot;nav-right&quot;</span>,</span><br><span class="line">        <span class="string">&quot;nav-down&quot;</span>,</span><br><span class="line">        <span class="string">&quot;nav-left&quot;</span>,</span><br><span class="line">        <span class="string">&quot;pointer-events&quot;</span>,</span><br><span class="line">        <span class="string">&quot;quotes&quot;</span>,</span><br><span class="line">        <span class="string">&quot;touch-action&quot;</span>,</span><br><span class="line">        <span class="string">&quot;will-change&quot;</span>,</span><br><span class="line">        <span class="string">&quot;zoom&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fill&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fill-rule&quot;</span>,</span><br><span class="line">        <span class="string">&quot;clip-rule&quot;</span>,</span><br><span class="line">        <span class="string">&quot;stroke&quot;</span>,</span><br><span class="line">      ],</span><br><span class="line">      &#123;</span><br><span class="line">        unspecified: <span class="string">&quot;bottom&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//CSS 属性值顺序</span></span><br><span class="line">    <span class="comment">// &#x27;order/properties-alphabetical-order&#x27;: [],</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>添加脚本</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 其他配置。。。</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;lint:css&quot;</span>: <span class="string">&quot;stylelint src/**/*.&#123;vue,html,css,scss,sass&#125;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;fix:css&quot;</span>: <span class="string">&quot;stylelint --fix src/**/*.&#123;vue,html,css,scss,sass&#125;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 其他配置。。。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run lint:css</span><br></pre></td></tr></table></figure>
<p>相关链接</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://stylelint.io/">StyleLint 官网</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/54304313/stylelint-fix-in-webstorm">如何在 WebStorm 中使用 StyleLint 自动修复</a></li>
</ul>
<blockquote>
<p>WebStorm 使用<br>WebStorm 配置 StyleLint 即时检查:<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190926113520.png" alt="WebStorm 配置即时检查"><br>参考 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/54304313/">https://stackoverflow.com/questions/54304313/</a></p>
<p>添加外部工具以进行快速修复<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190926113953.png" alt="添加外部工具以进行快速修复"><br>然后添加一个快捷键即可</p>
</blockquote>
<h2 id="Prettier"><a href="#Prettier" class="headerlink" title="Prettier"></a>Prettier</h2><p>Prettier 是一个代码格式化工具，但并非针对一种语言，对 <code>HTML/CSS/JavaScript/Vue/SCSS</code> 都有效果。可以通过配置文件在不同项目间统一代码格式化，以修正不同编辑器/IDE 之间格式化不同的问题。</p>
<p>安装依赖</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -D prettier eslint-plugin-prettier eslint-config-prettier prettier-eslint-cli stylelint-config-prettier stylelint-prettier</span><br></pre></td></tr></table></figure>
<blockquote>
<p>依赖解释</p>
<ul>
<li><code>prettier</code>: 本体包</li>
<li><code>eslint-plugin-prettier eslint-config-prettier prettier-eslint-cli</code>: prettier 与 eslint 整合包</li>
<li><code>stylelint-config-prettier stylelint-prettier</code>: prettier 与 stylelint 整合包</li>
</ul>
</blockquote>
<p>进行配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .prettierrc.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// 缩进宽度</span></span><br><span class="line">  tabWidth: <span class="number">4</span>,</span><br><span class="line">  <span class="comment">// 单行最大宽度</span></span><br><span class="line">  printWidth: <span class="number">120</span>,</span><br><span class="line">  <span class="comment">// 去掉代码结尾的分号</span></span><br><span class="line">  semi: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// 使用单引号替代双引号</span></span><br><span class="line">  singleQuote: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 尽量在所有地方都添加尾逗号</span></span><br><span class="line">  trailingComma: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">  <span class="comment">// 换行符</span></span><br><span class="line">  endOfLine: <span class="string">&quot;crlf&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>还需要修改 eslint 与 stylelint 的一些配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .eslintrc.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// 其他配置。。。</span></span><br><span class="line">  <span class="keyword">extends</span>: [</span><br><span class="line">    <span class="comment">//继承 vue 的标准特性</span></span><br><span class="line">    <span class="string">&quot;plugin:vue/essential&quot;</span>,</span><br><span class="line">    <span class="string">&quot;eslint:recommended&quot;</span>,</span><br><span class="line">    <span class="comment">//避免与 prettier 冲突</span></span><br><span class="line">    <span class="string">&quot;plugin:prettier/recommended&quot;</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 其他配置。。。</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// stylelint.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// 其他配置。。。</span></span><br><span class="line">  <span class="keyword">extends</span>: [<span class="string">&quot;stylelint-config-standard&quot;</span>, <span class="string">&quot;stylelint-config-prettier&quot;</span>],</span><br><span class="line">  <span class="comment">// 其他配置。。。</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>添加脚本</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 其他配置。。。</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;format&quot;</span>: <span class="string">&quot;prettier-eslint --write \&quot;src/**/*.&#123;js,vue,html,scss,css&#125;\&quot;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 其他配置。。。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run format</span><br></pre></td></tr></table></figure>
<p>相关链接</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://prettier.io/">prettier 官网</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jetbrains.com/help/webstorm/prettier.html">WebStorm 使用 Prettier 官方文档</a></li>
</ul>
<blockquote>
<p>WebStorm 配置使用 Prettier 快速格式化:<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190926115309.png" alt="WebStorm 配置使用 Prettier 快速格式化"><br>建议修改为全局使用 Prettier 格式化，避免记忆两个格式化快捷键</p>
</blockquote>
<h2 id="husky-与-lint-staged"><a href="#husky-与-lint-staged" class="headerlink" title="husky 与 lint-staged"></a>husky 与 lint-staged</h2><p>强制使用 linter 检查代码，不通过检查则无法提交代码，以使 linter 真正得到有效执行。</p>
<p>安装依赖</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -D husky lint-staged</span><br></pre></td></tr></table></figure>
<blockquote>
<p>依赖解释</p>
<ul>
<li><code>husky</code>: 在项目中添加 git 钩子，在 git 各个生命周期（姑且这样称呼吧）中执行一些自定义操作。我们这里主要是用在 git 提交之前执行 linter 操作，不通过则提交无效。</li>
<li><code>lint-staged</code>: 简而言之，就是只针对 git 提交的文件进行一些操作，而非整个项目的所有文件。我们这里主要是用在 git 提交之前进行 linter 时只针对提交的文件，以进行渐进式的重构。</li>
</ul>
</blockquote>
<p>进行配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .huskyrc.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  hooks: &#123;</span><br><span class="line">    <span class="comment">// git commit 前的钩子</span></span><br><span class="line">    <span class="string">&quot;pre-commit&quot;</span>: <span class="string">&quot;lint-staged&quot;</span>,</span><br><span class="line">    <span class="comment">// 修复 IDEA 的一些奇怪问题 &lt;https://youtrack.jetbrains.com/issue/IDEA-135454&gt;</span></span><br><span class="line">    <span class="string">&quot;post-commit&quot;</span>: <span class="string">&quot;git update-index --again&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// lint-staged.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="string">&quot;src/**/*.&#123;js,vue&#125;&quot;</span>: [<span class="string">&quot;eslint --fix&quot;</span>, <span class="string">&quot;git add&quot;</span>],</span><br><span class="line">  <span class="string">&quot;src/**/*.&#123;vue,html,css,scss,sass&#125;&quot;</span>: [<span class="string">&quot;stylelint --fix&quot;</span>, <span class="string">&quot;git add&quot;</span>],</span><br><span class="line">  <span class="string">&quot;src/**/*.&#123;js,vue,html,css,scss,sass&#125;&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;prettier-eslint --write&quot;</span>,</span><br><span class="line">    <span class="string">&quot;git add&quot;</span>,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>有人说 <strong>lint-staged</strong> 并行运行多个命令可能会有问题，因为 nodejs 本身在写入文件时不会加锁，导致多线程下可能存在问题（吾辈目前还没遇到过.JPG）</p>
</blockquote>
<p>之后，在我们使用 <code>git commit</code> 时就会触发 lint 操作了！</p>
<p>相关链接</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/typicode/husky">husky GitHub</a></li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>基本上，这些工具初次配置起来还是非常麻烦的，但这是一件一劳永逸的事情，所以还是值得花时间去做的。</p>
<blockquote>
<p>注:<br>目前还存在的问题是:<br>ESLint 检测出来的部分错误能使用 <strong>A-Enter</strong> 修复<br>Prettier 与 WebStorm 自身格式化不能共存（自动切换）<br>Prettier 在 WebStorm 中无法直接配置导致上面问题存在的必要性<br>StyleLint 不能使用 <strong>A-Enter</strong> 修复且不能与 WebStorm 共存<br>可能的解决方案是找一下是否有一种方式能够让 WebStorm 一个快捷键执行多条命令，或者，写一个可用的插件。</p>
</blockquote>
<blockquote>
<p>参考</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5c67fcaae51d457fcb4078c9">eslint+husky+prettier+lint-staged 提升前端应用质量</a></li>
</ul>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/81cc1bbf5d8c4eb28224f752550189f7/" data-id="ckmcqox5l00bv0kuv37eh3jjn" data-title="前端使用工具强制实行代码规范（Vue）" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">工程化</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-95819eb091ac4dfbadbec0aa3eb5ad42" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/95819eb091ac4dfbadbec0aa3eb5ad42/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/95819eb091ac4dfbadbec0aa3eb5ad42/">JavaScript 规范整理</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><blockquote>
<p>圣人走过的道路，荆棘遍布，火焰片片焚烧……</p>
</blockquote>
<p>日常 <code>review</code> 代码时看到一些奇怪的代码，这里记录一下重构方案以及原因。</p>
<h2 id="命名规范"><a href="#命名规范" class="headerlink" title="命名规范"></a>命名规范</h2><h3 id="不要使用拼音命名"><a href="#不要使用拼音命名" class="headerlink" title="不要使用拼音命名"></a>不要使用拼音命名</h3><p>如果不熟悉英语，可以使用 <a target="_blank" rel="noopener" href="https://unbug.github.io/codelf/">Codelf</a> 或者 <a target="_blank" rel="noopener" href="https://translate.google.com/">Google 翻译</a>，避免使用拼音命名。</p>
<p>错误示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里是用户状态</span></span><br><span class="line"><span class="keyword">const</span> yongHuZhuangTai = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>正确示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userStatus = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<h3 id="函数中的变量"><a href="#函数中的变量" class="headerlink" title="函数中的变量"></a>函数中的变量</h3><p>js 中普通变量使用 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Camel_case">小写开头驼峰命名法</a>，而非不区分大小写，或使用下划线命名等等。</p>
<p>错误示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户操作日志备注</span></span><br><span class="line"><span class="keyword">const</span> useroperatinglogremark = <span class="string">&quot;新增用户&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>正确示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userOperatingLogRemark = <span class="string">&quot;新增用户&quot;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="内部变量"><a href="#内部变量" class="headerlink" title="内部变量"></a>内部变量</h3><p>如果需要不想让使用者使用的属性（能够看到），需要使用下划线开头。例如 <code>_value</code>，代表内部的值，外部不应该直接访问（实际上可以做到）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DateFormat</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">fmt</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 不想让外部使用</span></span><br><span class="line">    <span class="built_in">this</span>._fmt = fmt;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">format</span>(<span class="params">date</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 具体格式化代码</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">parse</span>(<span class="params">str</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 具体解析代码</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="不要使用无意义的前缀命名"><a href="#不要使用无意义的前缀命名" class="headerlink" title="不要使用无意义的前缀命名"></a>不要使用无意义的前缀命名</h3><p>如果一个对象的变量名已经很好的标识了该对象，那么内部的属性就不能使用对象名作为前缀！</p>
<p>错误示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 活跃的日志信息</span></span><br><span class="line"><span class="keyword">const</span> activeLog = &#123;</span><br><span class="line">  activeUserId: <span class="string">&quot;rx&quot;</span>,</span><br><span class="line">  activeTime: <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>正确示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> activeLog = &#123;</span><br><span class="line">  userId: <span class="string">&quot;rx&quot;</span>,</span><br><span class="line">  time: <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="ES6"><a href="#ES6" class="headerlink" title="ES6"></a>ES6</h2><h3 id="优先使用-const-let"><a href="#优先使用-const-let" class="headerlink" title="优先使用 const/let"></a>优先使用 const/let</h3><p>一般情况下，使用 <code>const/let</code> 声明变量，而不是使用 <code>var</code>。因为使用 <code>var</code> 声明的变量会存在变量提升。</p>
<p>示例代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 使用 var 声明的变量（初始值为 undefined）</span></span><br><span class="line">  <span class="built_in">console</span>.log(i);</span><br><span class="line">  i = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(i);</span><br><span class="line">  <span class="comment">// 此时使用 var 声明的变量 i 相当于在 function 顶部声明，然后在此处进行了赋值操作</span></span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用 const 声明的变量（抛出异常 k is not defined）</span></span><br><span class="line">  <span class="comment">// console.log(k)</span></span><br><span class="line">  k = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">const</span> k = <span class="number">0</span>;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>关于可以参考 <a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/acfc2875/">let 与 var 在 for 循环中的区别</a></p>
<h3 id="使用新的函数声明方式"><a href="#使用新的函数声明方式" class="headerlink" title="使用新的函数声明方式"></a>使用新的函数声明方式</h3><p>ES6 推出了一种更简洁的函数声明方式，不需要在写 <code>function</code>，只要 <strong>名字 + ()</strong> 即可在 <code>class</code> 或 <code>Object</code> 中声明函数。</p>
<p>错误示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  name: <span class="string">&quot;rx&quot;</span>,</span><br><span class="line">  hello: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;hello&quot;</span> + <span class="built_in">this</span>.name);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>正确示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  name: <span class="string">&quot;rx&quot;</span>,</span><br><span class="line">  <span class="function"><span class="title">hello</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;hello&quot;</span> + <span class="built_in">this</span>.name);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="优先使用箭头函数而非-function"><a href="#优先使用箭头函数而非-function" class="headerlink" title="优先使用箭头函数而非 function"></a>优先使用箭头函数而非 function</h3><p>优先使用 <strong>箭头函数</strong> 而不是使用传统的函数，尤其是使用 <strong>匿名函数</strong> 时，更应如此。</p>
<p>错误示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sum = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">  <span class="comment">// 过滤出偶数</span></span><br><span class="line">  .filter(<span class="function"><span class="keyword">function</span> (<span class="params">i</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> i % <span class="number">2</span> === <span class="number">0</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 将偶数翻倍</span></span><br><span class="line">  .map(<span class="function"><span class="keyword">function</span> (<span class="params">i</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> i * <span class="number">2</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 计算总和</span></span><br><span class="line">  .reduce(<span class="function"><span class="keyword">function</span> (<span class="params">res, i</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (res += i);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(sum);</span><br></pre></td></tr></table></figure>
<p>正确示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sum = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">  <span class="comment">// 过滤出偶数</span></span><br><span class="line">  .filter(<span class="function">(<span class="params">i</span>) =&gt;</span> i % <span class="number">2</span> === <span class="number">0</span>)</span><br><span class="line">  <span class="comment">// 将偶数翻倍</span></span><br><span class="line">  .map(<span class="function">(<span class="params">i</span>) =&gt;</span> i * <span class="number">2</span>)</span><br><span class="line">  <span class="comment">// 计算总和</span></span><br><span class="line">  .reduce(<span class="function">(<span class="params">res, i</span>) =&gt;</span> (res += i));</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(sum);</span><br></pre></td></tr></table></figure>
<h3 id="不要使用-if-判断再赋予默认值"><a href="#不要使用-if-判断再赋予默认值" class="headerlink" title="不要使用 if 判断再赋予默认值"></a>不要使用 if 判断再赋予默认值</h3><p>如果函数需要对参数做默认值处理，请不要使用 <code>if</code> 判空之后再修改参数，而是使用 ES6 的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Default_parameters">默认参数</a> 和 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">解构赋值</a>。</p>
<p>主要优点</p>
<ul>
<li>减少代码，JavaScript 是动态语言，维护起来较为麻烦，代码越少，错误越少</li>
<li>清晰明了，可以让人一眼就能看出这个参数的默认值，而不需要关心函数内部的逻辑</li>
<li>IDE 大多对此进行了支持，代码提示时便会告诉我们参数是可选的并且有默认值</li>
</ul>
<p>错误示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 格式化日期</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Date&#125;</span> </span>[date] 日期对象。默认为当前时间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;String&#125;</span> </span>格式化日期字符串</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatDate</span>(<span class="params">date</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (date === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;date.getFullYear()&#125;</span>-<span class="subst">$&#123;date.getMonth() + <span class="number">1</span>&#125;</span>-<span class="subst">$&#123;date.getDate()&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>正确示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatDate</span>(<span class="params">date = <span class="keyword">new</span> <span class="built_in">Date</span>()</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;date.getFullYear()&#125;</span>-<span class="subst">$&#123;date.getMonth() + <span class="number">1</span>&#125;</span>-<span class="subst">$&#123;date.getDate()&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里如果展开来讲实在太多，请参考 <a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/5985b64e/">JavaScript 善用解构赋值</a></p>
<h3 id="优先使用-Map-做键值对映射而非传统的对象"><a href="#优先使用-Map-做键值对映射而非传统的对象" class="headerlink" title="优先使用 Map 做键值对映射而非传统的对象"></a>优先使用 Map 做键值对映射而非传统的对象</h3><p>如果需要 <strong>键值映射</strong>，不要使用一般的对象，而是用 ES6 的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Map">Map</a>。它不仅可以使用 <strong>任意类型的键</strong>，另外 Map 本身也是 <strong>有序</strong> 的哦</p>
<p>错误示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="number">2</span>: <span class="string">&quot;琉璃&quot;</span>,</span><br><span class="line">  <span class="number">1</span>: <span class="string">&quot;rx&quot;</span>,</span><br><span class="line">  <span class="number">1</span>: <span class="string">&quot;liuli&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 结果为 true，因为属性 1 实际上会被转换为 &#x27;1&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(obj[<span class="number">1</span>] === obj[<span class="string">&quot;1&quot;</span>]);</span><br><span class="line"><span class="comment">// 结果为 [ &#x27;1&#x27;, &#x27;2&#x27;]，因为是按照属性字符串排序的</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(obj));</span><br></pre></td></tr></table></figure>
<p>正确示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>().set(<span class="number">2</span>, <span class="string">&quot;琉璃&quot;</span>).set(<span class="number">1</span>, <span class="string">&quot;rx&quot;</span>).set(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;liuli&quot;</span>);</span><br><span class="line"><span class="comment">// 结果为 false</span></span><br><span class="line"><span class="built_in">console</span>.log(map.get(<span class="number">1</span>) === map.get(<span class="string">&quot;1&quot;</span>));</span><br><span class="line"><span class="comment">// 结果为 [ 2, 1, &#x27;1&#x27; ]，因为是按照插入顺序排序的</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Array</span>.from(map.keys()));</span><br></pre></td></tr></table></figure>
<h3 id="优先使用模板字符串拼接多个字符串变量"><a href="#优先使用模板字符串拼接多个字符串变量" class="headerlink" title="优先使用模板字符串拼接多个字符串变量"></a>优先使用模板字符串拼接多个字符串变量</h3><p>如果需要拼接多个对象以及字符串时，不要使用 <code>+</code> 进行拼接，使用 es6 的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/template_strings">模板字符串</a> 会更好一点。一般而言，如果需要拼接的变量超过 3 个，那么就应该使用模板字符串了。</p>
<p>错误示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">name, age, sex</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;name: &quot;</span> + name + <span class="string">&quot;, age: &quot;</span> + age + <span class="string">&quot;, sex: &quot;</span> + sex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>正确示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">name, age, sex</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`name: <span class="subst">$&#123;name&#125;</span>, age: <span class="subst">$&#123;age&#125;</span>, sex: <span class="subst">$&#123;sex&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="当独立参数超过-3-个时使用对象参数并解构"><a href="#当独立参数超过-3-个时使用对象参数并解构" class="headerlink" title="当独立参数超过 3 个时使用对象参数并解构"></a>当独立参数超过 3 个时使用对象参数并解构</h3><p>错误示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">name, age, sex</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`name: <span class="subst">$&#123;name&#125;</span>, age: <span class="subst">$&#123;age&#125;</span>, sex: <span class="subst">$&#123;sex&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>正确示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">&#123; name, age, sex &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`name: <span class="subst">$&#123;name&#125;</span>, age: <span class="subst">$&#123;age&#125;</span>, sex: <span class="subst">$&#123;sex&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="不要写多余的-await"><a href="#不要写多余的-await" class="headerlink" title="不要写多余的 await"></a>不要写多余的 await</h3><p>如果 <code>await</code> 是不必要的（在返回语句时，那么就不要用 <code>async</code> 标识函数），这是没有必要的 – 除非，你需要在这个函数内异步操作完成后有其他操作。</p>
<p>错误示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> login = <span class="keyword">async</span> (&#123; username, password &#125;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!useranme) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;用户名不能为空&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!password) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;密码不能为空&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 真正发起登录请求</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> userApi.login(user);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>正确示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> login = <span class="function">(<span class="params">&#123; username, password &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!useranme) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;用户名不能为空&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!password) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;密码不能为空&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 真正发起登录请求</span></span><br><span class="line">  <span class="keyword">return</span> userApi.login(user);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="不要使用-进行比较"><a href="#不要使用-进行比较" class="headerlink" title="不要使用 == 进行比较"></a>不要使用 == 进行比较</h3><p>在 js 中使用 <code>==</code> 比较相当危险，你永远不知道 js 到底是按照什么类型比较的，因为 js 会做各种隐式转换。而如果使用 <code>===</code> 比较，则会同时比较 <strong>值</strong> 和 <strong>类型</strong> 是否都相同，避免了各种不确定的问题。</p>
<p>错误示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span> == <span class="literal">true</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span> == <span class="string">&quot;1&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;1&quot;</span> == <span class="literal">true</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;0&quot;</span> == <span class="literal">true</span>); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log([] == []); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>扪心自问，你真的知道上面为什么会出现这种结果么？即便知道，对于其他人而言仍然是难以预测的，所以抛弃掉 <code>==</code> 吧，学会使用更好的 <code>===</code> 最好</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span> == <span class="literal">true</span>); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span> == <span class="string">&quot;1&quot;</span>); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;1&quot;</span> == <span class="literal">true</span>); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;0&quot;</span> == <span class="literal">true</span>); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log([] == []); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h3 id="使用计算属性名替代使用方括号表示法赋值"><a href="#使用计算属性名替代使用方括号表示法赋值" class="headerlink" title="使用计算属性名替代使用方括号表示法赋值"></a>使用计算属性名替代使用方括号表示法赋值</h3><p>目前而言已经有了 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Object_initializer#%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7%E5%90%8D">计算属性名</a> 用以在初始化时计算属性名，所以不需要再先声明对象再使用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Property_Accessors#%E6%96%B9%E6%8B%AC%E5%8F%B7%E8%A1%A8%E7%A4%BA%E6%B3%95">方括号表示法</a> 进行赋值了。</p>
<p>ES5 写法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="string">&quot;user.username&quot;</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">state[<span class="built_in">Date</span>.now()] = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(state);</span><br></pre></td></tr></table></figure>
<p>ES6 写法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="string">&quot;user.username&quot;</span>() &#123;&#125;,</span><br><span class="line">  [<span class="built_in">Date</span>.now()]: <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(state);</span><br></pre></td></tr></table></figure>
<h3 id="简单的选项列表优先使用-Map-而非数组"><a href="#简单的选项列表优先使用-Map-而非数组" class="headerlink" title="简单的选项列表优先使用 Map 而非数组"></a>简单的选项列表优先使用 Map 而非数组</h3><p>对于复选框，想必很多人相当熟悉。下面使用 js 模拟一个复选框</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> item = &#123;</span><br><span class="line">  id: <span class="number">1</span>,</span><br><span class="line">  role: [<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>],</span><br><span class="line">  name: <span class="string">&quot;&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> options = [</span><br><span class="line">  &#123;</span><br><span class="line">    roleid: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    label: <span class="string">&quot;黄金糕&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    roleid: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">    label: <span class="string">&quot;双皮奶&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    roleid: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">    label: <span class="string">&quot;蚵仔煎&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>现在的需求是根据 <code>role</code> 计算显示值 <code>name</code> 的值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">item.name = item.role</span><br><span class="line">  .map(<span class="function">(<span class="params">role</span>) =&gt;</span> options.find(<span class="function">(<span class="params">op</span>) =&gt;</span> op.roleid === role))</span><br><span class="line">  .filter(<span class="function">(<span class="params">s</span>) =&gt;</span> s)</span><br><span class="line">  .join(<span class="string">&quot;,&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>但实际上这里应该使用 <code>Map</code> 替代数组，因为数组的 <code>find</code> 其实非常低效，也需要进行遍历，使用 <code>Map</code> 的实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> item = &#123;</span><br><span class="line">  id: <span class="number">1</span>,</span><br><span class="line">  role: [<span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">  name: <span class="string">&quot;&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> options = <span class="keyword">new</span> <span class="built_in">Map</span>().set(<span class="number">1</span>, <span class="string">&quot;黄金糕&quot;</span>).set(<span class="number">2</span>, <span class="string">&quot;双皮奶&quot;</span>).set(<span class="number">3</span>, <span class="string">&quot;蚵仔煎&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calcName</span>(<span class="params">role</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> role</span><br><span class="line">    .map(<span class="function">(<span class="params">k</span>) =&gt;</span> options.get(k))</span><br><span class="line">    .filter(<span class="function">(<span class="params">s</span>) =&gt;</span> s)</span><br><span class="line">    .join(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">item.name = calcName(item.role);</span><br></pre></td></tr></table></figure>
<p>可以看到，获取时使用了 <code>Map#get</code>，在效率上应该是极好的。</p>
<blockquote>
<p>附: 该问题来自 <a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000019426996">https://segmentfault.com/q/1010000019426996</a></p>
</blockquote>
<h3 id="存放-id-标识列表使用-Set-而非数组"><a href="#存放-id-标识列表使用-Set-而非数组" class="headerlink" title="存放 id 标识列表使用 Set 而非数组"></a>存放 id 标识列表使用 Set 而非数组</h3><p>还是上面的例子，当你需要存取当前选中复选框的值 <code>role</code> 使用数组时，有可能遇到 id 重复的问题，实际上导致每次添加前需要使用 <code>Array#includes</code> 判断是否已存在。这里可以使用 <code>Set</code> 从数据结构层面避免掉可能重复的问题。</p>
<p>修改后的实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> item = &#123;</span><br><span class="line">  id: <span class="number">1</span>,</span><br><span class="line">  role: <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>]),</span><br><span class="line">  name: <span class="string">&quot;&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> options = <span class="keyword">new</span> <span class="built_in">Map</span>().set(<span class="number">1</span>, <span class="string">&quot;黄金糕&quot;</span>).set(<span class="number">2</span>, <span class="string">&quot;双皮奶&quot;</span>).set(<span class="number">3</span>, <span class="string">&quot;蚵仔煎&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calcName</span>(<span class="params">role</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Array</span>.from(role)</span><br><span class="line">    .map(<span class="function">(<span class="params">k</span>) =&gt;</span> options.get(k))</span><br><span class="line">    .filter(<span class="function">(<span class="params">s</span>) =&gt;</span> s)</span><br><span class="line">    .join(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">item.name = calcName(item.role);</span><br></pre></td></tr></table></figure>
<p>先判断是否存在执行某些操作也非常方便，可以使用 <code>Set#has</code> 进行判断，当然时间复杂度时 O1。</p>
<h2 id="逻辑代码"><a href="#逻辑代码" class="headerlink" title="逻辑代码"></a>逻辑代码</h2><h3 id="不要判断一个-Boolean-值并以此返回-Boolean-值"><a href="#不要判断一个-Boolean-值并以此返回-Boolean-值" class="headerlink" title="不要判断一个 Boolean 值并以此返回 Boolean 值"></a>不要判断一个 Boolean 值并以此返回 Boolean 值</h3><p>不要在得到一个 <code>Boolean</code> 的值后使用 <code>if-else</code> 进行判断，然后根据结果返回 <code>true</code> 或 <code>false</code>，这真的显得非常非常蠢！</p>
<p>错误示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模拟登录异步请求</span></span><br><span class="line"><span class="keyword">const</span> login = <span class="keyword">async</span> (&#123; username, password &#125;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> res = username === <span class="string">&quot;rx&quot;</span> &amp;&amp; password === <span class="string">&quot;rx&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (res) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>正确示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模拟登录异步请求</span></span><br><span class="line"><span class="keyword">const</span> login = <span class="keyword">async</span> (&#123; username, password &#125;) =&gt;</span><br><span class="line">  username === <span class="string">&quot;rx&quot;</span> &amp;&amp; password === <span class="string">&quot;rx&quot;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="不要使用多余的变量"><a href="#不要使用多余的变量" class="headerlink" title="不要使用多余的变量"></a>不要使用多余的变量</h3><p>如果一个表达式立刻被使用并且只会被使用一次，那就不要使用变量声明，直接在需要的地方使用好了。</p>
<p>错误示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模拟登录异步请求</span></span><br><span class="line"><span class="keyword">const</span> login = <span class="keyword">async</span> (&#123; username, password &#125;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> res = username === <span class="string">&quot;rx&quot;</span> &amp;&amp; password === <span class="string">&quot;rx&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>正确示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模拟登录异步请求</span></span><br><span class="line"><span class="keyword">const</span> login = <span class="keyword">async</span> (&#123; username, password &#125;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> username === <span class="string">&quot;rx&quot;</span> &amp;&amp; password === <span class="string">&quot;rx&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="不要使用嵌套-if"><a href="#不要使用嵌套-if" class="headerlink" title="不要使用嵌套 if"></a>不要使用嵌套 if</h3><p>不要使用多级的 <code>if</code> 嵌套，这会让代码变得丑陋且难以调试，应当优先使用 <strong>提前 return</strong> 的策略。</p>
<p>错误示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模拟登录异步请求</span></span><br><span class="line"><span class="keyword">const</span> login = <span class="keyword">async</span> (&#123; username, password &#125;) =&gt;</span><br><span class="line">  username === <span class="string">&quot;rx&quot;</span> &amp;&amp; password === <span class="string">&quot;rx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">submit</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; username, password &#125; = user;</span><br><span class="line">  <span class="keyword">if</span> (username) &#123;</span><br><span class="line">    <span class="keyword">if</span> (password) &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> login(user);</span><br><span class="line">      <span class="keyword">if</span> (res) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;登录成功，即将跳转到首页&quot;</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;登录失败，请检查用户名和密码&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;用户密码不能为空&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;用户名不能为空&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>正确示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模拟登录异步请求</span></span><br><span class="line"><span class="keyword">const</span> login = <span class="keyword">async</span> (&#123; username, password &#125;) =&gt;</span><br><span class="line">  username === <span class="string">&quot;rx&quot;</span> &amp;&amp; password === <span class="string">&quot;rx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">submit</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; username, password &#125; = user;</span><br><span class="line">  <span class="keyword">if</span> (!username) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;用户名不能为空&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!password) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;用户密码不能为空&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> login(user);</span><br><span class="line">  <span class="keyword">if</span> (!res) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;登录失败，请检查用户名和密码&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;登录成功，即将跳转到首页&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="不要先声明空对象然后一个个追加属性"><a href="#不要先声明空对象然后一个个追加属性" class="headerlink" title="不要先声明空对象然后一个个追加属性"></a>不要先声明空对象然后一个个追加属性</h3><p>有时候会碰到这种情况，先声明一个空对象，然后在下面一个个追加属性，为什么创建对象与初始化不放到一起做呢？</p>
<p>错误示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模拟登录异步请求</span></span><br><span class="line"><span class="keyword">const</span> login = <span class="keyword">async</span> (&#123; username, password &#125;) =&gt;</span><br><span class="line">  username === <span class="string">&quot;rx&quot;</span> &amp;&amp; password === <span class="string">&quot;rx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">submit</span>(<span class="params">username, password</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 数据格式校验处理。。。</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> user = &#123;&#125;;</span><br><span class="line">  user.username = username.trim();</span><br><span class="line">  user.password = password.trim();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> login(user);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 后续的错误处理。。。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>正确示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模拟登录异步请求</span></span><br><span class="line"><span class="keyword">const</span> login = <span class="keyword">async</span> (&#123; username, password &#125;) =&gt;</span><br><span class="line">  username === <span class="string">&quot;rx&quot;</span> &amp;&amp; password === <span class="string">&quot;rx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">submit</span>(<span class="params">username, password</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 数据格式校验处理。。。</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> user = &#123;</span><br><span class="line">    username: username.trim(),</span><br><span class="line">    password: password.trim(),</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> login(user);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 后续的错误处理。。。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="不要使用无意义的函数包裹"><a href="#不要使用无意义的函数包裹" class="headerlink" title="不要使用无意义的函数包裹"></a>不要使用无意义的函数包裹</h3><p>使用函数时，如果你想包裹的函数和原来函数的参数/返回值相同，那就直接应该使用函数作为参数，而非在包裹一层。给人的感觉就像是大夏天穿着棉袄吃雪糕 – 多此一举！</p>
<p>错误示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断是否是偶数的函数</span></span><br><span class="line"><span class="keyword">const</span> isEven = <span class="function">(<span class="params">i</span>) =&gt;</span> i % <span class="number">2</span> === <span class="number">0</span>;</span><br><span class="line"><span class="comment">//过滤出所有偶数</span></span><br><span class="line"><span class="keyword">const</span> res = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>].filter(<span class="function">(<span class="params">i</span>) =&gt;</span> isEven(i));</span><br></pre></td></tr></table></figure>
<p>正确示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断是否是偶数的函数</span></span><br><span class="line"><span class="keyword">const</span> isEven = <span class="function">(<span class="params">i</span>) =&gt;</span> i % <span class="number">2</span> === <span class="number">0</span>;</span><br><span class="line"><span class="comment">//过滤出所有偶数</span></span><br><span class="line"><span class="keyword">const</span> res = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>].filter(isEven);</span><br></pre></td></tr></table></figure>
<h3 id="不要使用三元运算符进行复杂的计算"><a href="#不要使用三元运算符进行复杂的计算" class="headerlink" title="不要使用三元运算符进行复杂的计算"></a>不要使用三元运算符进行复杂的计算</h3><p>三元运算符适合于替代简单的 <code>if-else</code> 的情况，如果碰到较为复杂的情况，请使用 <code>if + return</code> 或者解构/默认参数的方式解决。</p>
<p>错误示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatUser</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> user === <span class="literal">undefined</span></span><br><span class="line">    ? <span class="string">&quot;username: noname, password: blank&quot;</span></span><br><span class="line">    : <span class="string">&quot;username: &quot;</span> +</span><br><span class="line">        (user.username === <span class="literal">undefined</span> ? <span class="string">&quot;noname&quot;</span> : user.username) +</span><br><span class="line">        <span class="string">&quot;, password: &quot;</span> +</span><br><span class="line">        (user.password === <span class="literal">undefined</span> ? <span class="string">&quot;blank&quot;</span> : user.password);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到上面的代码就感觉到一股烂代码的味道扑面而来，这实在是太糟糕了！实际上只需要两行代码就好了！</p>
<p>正确示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatUser</span>(<span class="params">&#123; username = <span class="string">&quot;noname&quot;</span>, password = <span class="string">&quot;blank&quot;</span> &#125; = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`username: <span class="subst">$&#123;username&#125;</span>, password: <span class="subst">$&#123;password&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="如果变量有所关联则使用对象而非多个单独的变量"><a href="#如果变量有所关联则使用对象而非多个单独的变量" class="headerlink" title="如果变量有所关联则使用对象而非多个单独的变量"></a>如果变量有所关联则使用对象而非多个单独的变量</h3><p>如果变量有所关联，例如一个表单，存储的时候不要使用单独的变量，将之存储到一个表单变量中更好。</p>
<p>错误示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> username = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#username&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> password = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#password&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> remeberMe = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#remeberMe&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 一些校验。。。</span></span><br><span class="line">  <span class="keyword">if</span> (!validate(username, password, remeberMe)) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 请求后台</span></span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> userLogin.login(username, password, remeberMe)</span><br><span class="line">  <span class="comment">// 后处理。。。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>正确示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> user = &#123;</span><br><span class="line">    username : <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#username&#x27;</span>),</span><br><span class="line">    password : <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#password&#x27;</span>),</span><br><span class="line">    remeberMe : <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#remeberMe&#x27;</span>),</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 一些校验。。。</span></span><br><span class="line">  <span class="keyword">if</span> (!validate(user)) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 请求后台</span></span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> userLogin.login(user)</span><br><span class="line">  <span class="comment">// 后处理。。。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="应该尽量解决编辑器警告"><a href="#应该尽量解决编辑器警告" class="headerlink" title="应该尽量解决编辑器警告"></a>应该尽量解决编辑器警告</h3><p>如果编辑器对我们的代码发出警告，那么一般都是我们代码出现了问题（一般开发人员的能力并不足以比肩编辑器 #MS 那些 dalao 的能力）。所以，如果出现了警告，应该先去解决它 – 如果你确认发生了错误，则通过注释/配置禁用它！</p>
<h3 id="使用类型定义参数对象"><a href="#使用类型定义参数对象" class="headerlink" title="使用类型定义参数对象"></a>使用类型定义参数对象</h3><p>如果一个函数需要一个对象参数，最好专门定义一个类型，并在注释上说明，便于在使用时 IDE 进行提示，而不需要去查找文档手册。</p>
<p>错误示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 格式化用户</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>user 格式化的用户对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatUser</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; username, password &#125; = user || &#123;&#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`user, username: <span class="subst">$&#123;username&#125;</span>, password: <span class="subst">$&#123;password&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 此处别人并不知道 User 里面到底有什么属性，只能去查看文档</span></span><br><span class="line"><span class="keyword">const</span> str = formatUser(&#123; <span class="attr">username</span>: <span class="string">&quot;rx&quot;</span>, <span class="attr">password</span>: <span class="string">&quot;123456&quot;</span> &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(str);</span><br></pre></td></tr></table></figure>
<p>正确示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">username, password</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.username = username;</span><br><span class="line">    <span class="built_in">this</span>.password = password;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 格式化用户</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;User&#125;</span> </span>user 格式化的用户对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatUser</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; username, password &#125; = user || &#123;&#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`user, username: <span class="subst">$&#123;username&#125;</span>, password: <span class="subst">$&#123;password&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> str = formatUser(<span class="keyword">new</span> User(<span class="string">&quot;rx&quot;</span>, <span class="string">&quot;123456&quot;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(str);</span><br></pre></td></tr></table></figure>
<h3 id="尽量扁平化代码"><a href="#尽量扁平化代码" class="headerlink" title="尽量扁平化代码"></a>尽量扁平化代码</h3><p>尽量将 <code>a</code> 调用 <code>b</code>, <code>b</code> 调用 <code>c</code>，然后 <code>b</code> 调用 <code>d</code>，优化为依次调用 <code>a, b, c, d</code>。</p>
<blockquote>
<p>注意: 这里使用的是<strong>尽量</strong>而非<strong>不要</strong>，深层嵌套不可避免，但在局部上，应该采取扁平化的策略，<strong>提前 return</strong> 避免嵌套 if-else 是个很好的例子。</p>
</blockquote>
<h3 id="自执行函数前面必须加分号"><a href="#自执行函数前面必须加分号" class="headerlink" title="自执行函数前面必须加分号"></a>自执行函数前面必须加分号</h3><p>如果我们需要使用自执行函数，则开头必须加上 <code>;</code> 以避免可能出现的歧义。</p>
<p>错误示例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> returnItself(o) &#123;</span><br><span class="line">  <span class="built_in">return</span> o</span><br><span class="line">&#125;</span><br><span class="line">returnItself(() =&gt; console.log(1))</span><br><span class="line">(() =&gt; &#123;</span><br><span class="line">  console.log(2)</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
<p>上面这段代码是有问题的，因为后面的自执行函数会被认为是上一句的 <code>returnItself</code> 返回函数的参数，最后的括号会被认为又是一次调用，将会抛出错误</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">returnItself(...)(...) is not a <span class="function"><span class="keyword">function</span></span></span><br></pre></td></tr></table></figure>
<p>正确示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">returnItself</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line">returnItself(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="number">1</span>));</span><br><span class="line">(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>使用分号可以明确告诉 JavaScript 这是一行新的代码，上面的代码已经到此为止了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/95819eb091ac4dfbadbec0aa3eb5ad42/" data-id="ckmcqox5l00bx0kuv3xpy0xs1" data-title="JavaScript 规范整理" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">工程化</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-9970e725452b49e496324842a7e283dd" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/9970e725452b49e496324842a7e283dd/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/9970e725452b49e496324842a7e283dd/">2016 年里做前端是怎样一种体验</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>本文转载自 <a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000007083024">SegmentFault</a>，英文原文在 <a target="_blank" rel="noopener" href="https://hackernoon.com/how-it-feels-to-learn-JavaScript-in-2016-d3a717dd577f">How it feels to learn JavaScript in 2016</a><br>吾辈觉得颇为有趣，便转载了一下（也算是前端开发的悲哀之处了吧）<br>附：吾辈觉得至今为止，前端工具链仍然没有好太多，工具链过多导致配置复杂，入门难度极大。<br>附：现在都 2018 了，然而吾辈的公司现在还是用 <code>jQuery</code>，虽然吾辈目前在内部强推了 <code>VueJS</code> #笑哭<br>附：吾辈这里对内容添加了一些样式，便于阅读时不那么疲劳。</p>
</blockquote>
<p>问：最近我接手了一个新的 <code>Web</code> 项目，不过老实说我已经好久没碰过这方面的代码了。听说前端的技术栈已经发生了极大的变革，不知道你现在是不是仍然处于最前沿的开发者阵列？<br>答：准确来说，过去俗称的写网页的，现在应该叫做 <code>Front End Engineer</code>，我确实属于这所谓的前端工程师。并且我才从 <code>JSConf</code> 与 <code>ReactConf</code> 面基回来，因此我觉得我觉得我还是了解目前 <code>Web</code> 前端领域最新的面貌的。<br>问：不错不错，我的需求其实也不复杂，就是从后端提供的 <code>REST</code> 风格的 <code>EndPoint</code> 来获取用户活动数据并且将其展示在前端界面上。并且需要以列表形式展示，同时，列表要支持筛选排序等操作，对了，还要保证前端数据和服务端保持一致。按照我现在的理解，我打算用 <code>jQuery</code> 来抓取与展现数据，你觉得咋样？<br>答：不不不，现在估计已经没多少人使用 <code>jQuery</code> 了吧。你可以试试 <code>React</code>，毕竟这是 2016 年了啊。<br>问：额，好吧，那啥是 <code>React</code> 啊？<br>答：这是个非常不错的源自 <code>Facebook</code> 的前端库，它能够帮你便捷地响应界面事件，同时保证项目层级的可控性与还说得过去的性能。<br>问：不错不错，那我是不是就可以用 <code>React</code> 来展示数据了呢？<br>答：话是这么说没错，不过你需要添加 <code>React</code> 与 <code>React DOM</code> 依赖项到你的页面中去。<br>问：等等，<code>React</code> 不是一个库吗？为啥要添加两个依赖呢？<br>答：不要急，前者是 <code>React</code> 的核心库，后面呢算是 <code>Facebook</code> 操作的辅助库，这样就能让你用 <code>JSX</code> 来描述你的界面布局了。<br>问：<code>JSX</code>？啥是 <code>JSX</code>？<br>答：<code>JSX</code> 是一个类似于 <code>XML</code> 的 <code>JavaScript</code> 语法扩展，它是另一种描述 <code>Facebook</code> 的方式，可以认为是 <code>HTML</code> 的替代品。<br>问：等等，<code>HTML</code> 咋啦？<br>答：都 2016 了，直接用 <code>HTML</code> 早就过时了。<br>问：好吧，那是不是我把两个库添加到项目中我就可以使用 <code>React</code> 了？<br>答：额，还要一些小的工具，你需要添加 <code>Babel</code> 到你的项目中，这样你就能用了。<br>问：又是一个库？<code>Babel</code> 又是什么鬼？<br>答：你可以把 <code>Babel</code> 认为是一个转译工具，可以将某个特定版本的 <code>JavaScript</code> 转译为任意版本的 <code>JavaScript</code>。你可以选择不使用 <code>Babel</code>，不过那也就意味着你只能用烦人的 <code>ES5</code> 来编写你的项目了。不过既然都是 2016 了，我建议你还是使用最新的 <code>ES2016+</code> + 语法吧。<br>问：<code>ES5</code>？<code>ES2016+</code>+？我已经迷茫了，<code>ES5</code>，<code>ES2016+</code> + 又是啥？<br>答：<code>ES5</code> 是 <code>ECMAScript 2015</code> 的缩写，也是现在被绝大部分浏览器所支持的 <code>JavaScript</code> 语法。<br>问：<code>ECMAScript</code>？<br>答：是的，你应该知道 <code>JavaScript</code> 最早于 1995 年提出，而后在 1999 年第一个正式版本定稿。之后的十数年里 <code>JavaScript</code> 的发展一直很凌乱，不过经过七个版本之后已经逐步清晰了。<br>问：7 个版本？那么 <code>ES5</code> 与 <code>ES2016+</code> 又是第几个版本呢？<br>答：是的，分别指第五个版本与第七个版本。<br>问：等等，那第六个版本呢？<br>答：你说 <code>ES6</code>？估计我刚才没有讲明白，<code>ECMAScript</code> 的每个版本都是向前兼容的，当你使用 <code>ES2016+</code> + 的时候也就意味着你在使用之前所有版本的所有特性啦。<br>问：原来是这样啊，那为啥一定要用 <code>ES2016+</code> 而不是 <code>ES6</code> 呢？<br>答：是的，你可以使用 <code>ES6</code>，不过如果你要使用 <code>async</code> 与 <code>await</code> 这些特性，你就要去用 <code>ES2016+</code> 了。否则你就还不得不去使用 <code>ES6</code> 的 <code>Generator</code> 来编写异步代码了。<br>问：我现在彻底迷糊了，我只是想简单地从服务端加载些数据而已，之前只需要从 <code>CDN</code> 加载下 <code>jQuery</code> 的依赖库，然后用 <code>Ajax</code> 方法来获取数据即可，为啥我现在不能这么做呢？<br>答：别傻了，每个人都知道一味使用 <code>jQuery</code> 的后果就是让你的代码变得一团乱麻，这都 2016 了，没人再想去面对这种头疼的代码了。<br>问：你说的是有道理，那现在我是不是就把这三个库加载进来，然后用 <code>HTML</code> 的 <code>Table</code> 来展示这些数据？<br>答：嗯，你可以选择一个模块打包工具将这三个依赖库打包到一个文件中。<br>问：额，啥是模块打包工具啊？<br>答：这个名词在不同的环境下指代也不同，不过在 <code>Web</code> 开发中我们一般将支持 <code>AMD</code> 与 <code>CommonJS</code> 的工具称为模块打包工具。<br>问：<code>AMD</code> 与 <code>CommonJS</code> 又是？<br>答：它们是用于描述 <code>JavaScript</code> 库与类之间交互的接口标准，你有听过 exports 与 <code>requires</code> 吗？你可以根据 AMD 或者 CommonJS 的规范来定义多个 <code>JavaScript</code> 文件，然后用类似于 <code>Browserify</code> 的工具来打包它们。<br>问：原来是这样，那 <code>Browserify</code> 是啥呢？<br>答：<code>Browserify</code> 最早是为了避免人们把自己的依赖一股脑放到 <code>NPM Registry</code> 中构建的，它最主要的功能就是允许人们将遵循 <code>CommonJS</code> 规范的模块打包到一个文件中。<br>问：<code>NPM Registry</code>？<br>答：这是一个很大的在线仓库，允许人们将代码与依赖以模块方式打包发布。<br>问：就像 <code>CDN</code> 一样？<br>答：还是有很大差异的，它更像一个允许人们发布与下载依赖库的中心仓库。<br>问：哦，我懂了，就像 <code>Bower</code> 一样啊。<br>答：对哒，不过 2016 年了，同样没啥人用 <code>Bower</code> 了。<br>问：嗯嗯，那我这时候应该从 <code>npm</code> 库中下载依赖了是吧？<br>答：是的，譬如如果你要用 <code>React</code> 的话，你可以直接用 <code>Npm</code> 命令来安装 <code>React</code>，然后导入到你的项目中，现在绝大部分主流的 <code>JavaScript</code> 库都支持这种方式了。<br>问：嗯嗯，就像 <code>Angular</code> 一样啊。<br>答：不过 <code>Angular</code> 也是 2015 年的流行了，现在像 <code>VueJS</code> 或者 <code>RxJS</code> 这样的才是小鲜肉，你想去学习它们吗？<br>问：不急不急，我们还是先多聊聊 <code>React</code> 吧，贪多嚼不烂。我还想确定下，是不是我从 <code>npm</code> 下载了 <code>React</code> 然后用 <code>Browserify</code> 打包就可以了？<br>答：是的。<br>问：好的，不过每次都要下载一大堆依赖然后打包，看起来好麻烦啊。<br>答：是的，不过你可以使用像 <code>Grunt</code> 或者 <code>Gulp</code> 或者 <code>Broccoli</code> 这样的任务管理工具来自动运行 <code>Browserify</code>。对了，你还可以用 <code>Mimosa</code>。<br>问：<code>Grunt</code>？<code>Gulp</code>？<code>Broccoli</code>？<code>Mimosa</code>？我们到底在讨论啥？<br>答：不方，我们在讨论任务管理工具，不过同样的，这些工具也是属于 2015 年的弄潮儿。现在我们流行使用 <code>Webpack</code> 咯。<br>问：<code>Makefiles</code>? 听起来有点像是一个 <code>C</code> 或者 <code>C++</code> 项目啊。<br>答：没错，不过很明显 <code>Web</code> 的演变之路就是把所有事情弄复杂，然后再回归到最基础的方式。估计不出几年你就要在 <code>Web</code> 中写汇编代码了。<br>问：额，你刚才好像提到了 <code>Webpack</code>？<br>答：是的，这是一个兼顾了模块打包工具与任务运行器的打包工具，有点像 <code>Browserify</code> 的升级版本。<br>问：嗷嗷，这样啊，那你觉得哪个更好点呢？<br>答：这个因人而异了，不过我个人是更加偏好于 <code>Webpack</code>，毕竟它不仅仅支持 <code>CommonJS</code> 规范，还支持 <code>ES6</code> 的模块规范。<br>问：好吧，我已经被 <code>CommonJS/ES6</code> 这些东西彻底搞乱了。<br>答：很多人都是这样，多了，你可能还要去了解下 <code>SystemJS</code>。<br>问：天哪，又是一个新名词，啥是 <code>SystemJS</code> 呢？<br>答：不同于 <code>Browserify</code> 与 <code>Webpack 1.x</code>，<code>SystemJS</code> 是一个允许你将多个模块分封于多个文件的动态模块打包工具，而不是全部打包到一个大的文件中。<br>问：等等，不过我觉得按照网络优化规范我们应该将所有的库打包到一个文件中。<br>答：是的，不过 <code>HTTP/2</code> 快要来了，并发的 <code>HTTP</code> 请求已经不是梦。<br>问：额，那时候是不是就不需要添加 <code>React</code> 的依赖库了？<br>答：不一定，你可以将这些依赖库从 <code>CDN</code> 中加载进来，不过你还是需要引入 <code>Babel</code> 的吧。<br>问：额，我刚才好像说错了话。<br>答：是的，如果按照你所说的，你需要在生产环境下将所有的 <code>Babel-core</code> 引入，这样会无端端增加很多额外的性能消耗。<br>问：好吧，那我到底应该怎么做呢？<br>答：我个人建议是用 <code>TypeScript+Webpack+SystemJS+Babel</code> 这一个组合。<br>问：<code>TypeScript</code>？我一直以为我们在说的是 <code>JavaScript</code>！<br>答：是的，<code>TypeScript</code> 是 <code>JavaScript</code> 的超集，基于 ES6 版本的一些封装。你应该还没忘记 <code>ES6</code> 吧？<br>问：我以为我们刚才说到的 <code>ES2016+</code> + 就是 <code>ES6</code> 的超集了。为啥我们还需要 <code>TypeScript</code> 呢？<br>答：因为 <code>TypeScript</code> 允许我们以静态类型语言的方式编写 <code>JavaScript</code>，从而减少运行时错误。都 2016 了，添加些强类型不是坏事。<br>问：原来 <code>TypeScript</code> 是做这个的啊！<br>答：是的，还有一个就是 <code>Facebook</code> 出品的 <code>Flow</code>。<br>问：<code>Flow</code> 又是啥？<br>答：<code>Flow</code> 是 <code>Facebook</code> 出品的静态类型检测工具，基于函数式编程的 <code>OCaml</code> 构建。<br>问：<code>OCamel</code>？<code>函数式编程</code>？<br>答：你没听过吗？<code>函数式编程</code>？<code>高阶函数</code>？<code>Currying</code>? 纯函数？<br>问：我一无所知。<br>答：好吧，那你只需要记得函数式编程在某些方面是优于 <code>OOP</code> 的，并且我们在 2016 年应该多多使用呦。<br>问：等等，我在大学就学过了 <code>OOP</code>，我觉得挺好的啊。<br>答：是的，<code>OOP</code> 确实还有很多可圈可点的地方，不过大家已经认识到了可变的状态太容易引发未知问题了，因此慢慢的所有人都在转向不可变数据与函数式编程。在前端领域我们可以用 <code>Rambda</code> 这样的库来在 <code>JavaScript</code> 中使用函数式编程了。<br>问：你是不是专门一字排开名词来了？<code>Ramda</code> 又是啥？<br>答：当然不是啦，<code>Rambda</code> 是类似于 <code>Lambda</code> 的库，源自 <strong>David Chambers</strong>。<br>问：<strong>David Chambers</strong>？<br>答：<strong>David Chambers</strong> 是个很优秀的程序员，他是 <code>Rambda</code> 的核心贡献者之一。如果你要学习函数式编程的话，你还应该关注下 <strong>Erik Meijer</strong>。<br>问：<strong>Erik Meijer</strong>？<br>答：另一个函数式编程领域的大神与布道者。<br>问：好吧，还会让我们回到 <code>React</code> 的话题吧，我应该怎么使用 <code>React</code> 来抓取数据呢？<br>答：额，<code>React</code> 只是用于展示数据的，它并不能够帮你抓取数据。<br>问：我的天啊，那我怎么来抓取数据呢？<br>答：你应该使用 <code>fetch</code> 来从服务端获取数据。<br>问：<code>fetch</code>？<br>答：是的，<code>fetch</code> 是浏览器原生基于 <code>XMLHttpRequests</code> 的封装。<br>问：那就是 <code>AJAX</code> 咯？<br>答：<code>AJAX</code> 一般指仅仅使用 <code>XMLHttpRequests</code>，而 <code>fetch</code> 允许你基于 <code>Promise</code> 来使用 <code>AJAX</code>，这样就能够避免 <code>Callback hell</code> 了。<br>问：<code>Callback hell</code>?<br>答：是的，每次你向服务器发起某个异步请求的时候，你必须要添加一个异步回调函数来处理其响应，这样一层又一层地回调的嵌套就是所谓的 <code>Callback hell</code> 了。<br>问：好吧，那 <code>Promise</code> 就是专门处理这个哩？<br>答：没错，你可以用 <code>Promise</code> 来替换传统的基于回调的异步函数调用方式，从而编写出更容易理解与测试的代码。<br>问：那我现在是不是直接使用 <code>fetch</code> 就好了啊？<br>答：是啊，不过如果你想要在较老版本的浏览器中使用 <code>fetch</code>，你需要引入 <code>fetch</code> <code>Polyfill</code>，或者使用 <code>Request</code>、<code>Bluebird</code> 或者 <code>Axios</code>。<br>问：来啊，互相伤害吧，你还是直接告诉我我还需要了解多少个库吧！<br>答：这可是 <code>JavaScript</code> 啊，可是有成千上万个库的。而且不少库还很大呢，譬如那个嵌了一张 Guy Fieri 图片的库。<br>问：你是说 Guy Fieri? 我听说过，那 <code>Bluebird</code>、<code>Request</code>、<code>Axios</code> 又是啥呢？<br>答：它们可以帮你执行 <code>XMLHttpRequests</code> 然后返回 <code>Promise</code> 对象。<br>问：难道 <code>jQuery</code> 的 <code>AJAX</code> 方法不是返回 <code>Promise</code> 吗？<br>答：请忘掉 <code>jQuery</code> 吧，用 <code>fetch</code> 配合上 <code>Promise</code>，或者 <code>async/await</code> 能够帮你构造合适的控制流。<br>问：这是你第三次提到 <code>await</code> 了，这到底是个啥啊？<br>答：<code>await</code> 是 <code>ES7</code> 提供的关键字，能够帮你阻塞某个异步调用直到其返回，这样能够让你的控制流更加清晰，代码的可读性也能更上一层楼。你可以在 <code>Babel</code> 中添加 <code>stage-3 preset</code>，或者添加 <code>syntax-async-functions</code> 以及 <code>transform-async-to-generator</code> 这两个插件。<br>问：好麻烦啊。<br>答：是啊，不过更麻烦的是你必须先预编译 <code>TypeScript</code> 代码，然后用 <code>Babel</code> 来转译 <code>await</code>。<br>问：为啥？难道 <code>TypeScript</code> 中没有内置？<br>答：估计在下一个版本中会添加该支持，不过目前的 1.7 版本的 <code>TypeScript</code> 目标是 ES6，因此如果你还想在浏览器中使用 <code>await</code>，你必须要先把 <code>TypeScript</code> 编译为 ES6，然后使用 <code>Babel</code> 转译为 <code>ES5</code>。<br>问：我已经无话可说了。<br>答：好吧，其实你也不用想太多，首先你基于 <code>TypeScript</code> 进行编码，然后将所有使用 <code>fetch</code> 的模块转译为 <code>ES6</code>，然后再使用 <code>Babel</code> 的 <code>stage-3 preset</code> 来对 <code>await</code> 等进行 <code>Polyfill</code>，最后使用 <code>SystemJS</code> 来完成加载。如果你打算使用 <code>fetch</code> 的话，还可以使用 <code>Bluebird</code>、<code>Request</code> 或者 <code>Axios</code>。<br>问：好，这样说就清晰多了，是不是这样我就达到我的目标了？<br>答：额，你的应用需要处理任何的状态变更吗？<br>问：我觉得不要把，我只是想展示数据。<br>答：那还行，否则的话你还需要了解 <code>Flux</code>、<code>Redux</code> 等等一系列的东西。<br>问：我不想再纠结于这些名词了，再强调一遍，我只是想展示数据罢了。<br>答：好吧，其实如果你只是想展示数据的话，你并不需要 <code>React</code>，你只需要一个比较好的模板引擎罢了。<br>问：你在开玩笑？<br>答：不要着急，我只是告诉你你可以用到的东西。<br>问：停！<br>答：我的意思是，即使你仅仅打算用个模板引擎，还是建议使用下 <code>TypeScript</code>+<code>SystemJS</code>+<code>Babel</code>。<br>问：好吧，那你还是推荐一个模板引擎吧！<br>答：有很多啊，你有对哪种比较熟悉吗？<br>问：唔，好久之前用了，记不得了。<br>答：<code>jTemplates</code>?<code>jQote?PURE</code>?<br>问：没听过，还有吗？<br>答：<code>Transparency</code>？<code>JSRender</code>？<code>MarkupJS?KnockoutJS</code>?<br>问：还有吗？<br>答：<code>PlatesJS</code>?<code>jQuery-tmpl?Handlebars</code>?<br>问：好像最后一个有点印象。<br>答：<code>Mustache</code>?<code>underscore</code>？<br>问：好像更晚一点的。<br>答：<code>Jade</code>?<code>DustJS</code>?<br>问：不。<br>答：<code>DotJS</code>?<code>EJS</code>?<br>问：不。<br>答：<code>Nunjucks</code>?<code>ECT</code>?<br>问：不。<br>答：<code>Mah</code>?<code>Jade</code>?<br>问：额，还不是。<br>答？难道是 <code>ES6</code> 原生的字符串模板引擎。<br>问：我估计，这货也需要 <code>ES6</code> 吧。<br>答：是啊。<br>问：需要 <code>Babel</code>？<br>答：是啊。<br>问：是不是还要从 <code>npm</code> 下载核心模块？<br>答：是啊。<br>问：是不是还需要 <code>Browserify</code>、<code>Webpack</code> 或者类似于 <code>SystemJS</code> 这样的模块打包工具？<br>答：是啊。<br>问：除了 <code>Webpack</code>，还需要引入任务管理器。<br>答：是啊。<br>问：我是不是还需要某个函数式编程语言，或者强类型语言？<br>答：是啊。<br>问：然后如果用到 <code>await</code> 的话，还需要引入 <code>Babel</code>？<br>答：是啊。<br>问：然后就可以使用 <code>fetch</code>、<code>Promise</code> 了吧？<br>答：别忘了 <code>Polyfill</code> <code>fetch</code>，Safari 目前还不能原生支持 <code>fetch</code>。<br>问：是不是，学完这些，就 OK 了？<br>答：额，目前来看是的，不过估计过几年我们就需要用 <code>Elm</code> 或者 <code>WebAssembly</code> 咯～<br>问：我觉得，我还是乖乖去写后端的代码吧。<br>答：<code>Python</code> 大法好！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/9970e725452b49e496324842a7e283dd/" data-id="ckmcqox5m00bz0kuv6oenc3jr" data-title="2016 年里做前端是怎样一种体验" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9D%82%E8%B0%88/" rel="tag">杂谈</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-9a8a075106024e4c94211e779d6f39bd" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/9a8a075106024e4c94211e779d6f39bd/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/9a8a075106024e4c94211e779d6f39bd/">使用 GreaseMonkey 解除网页复制粘贴限制</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>吾辈发布了一个油猴脚本，可以直接安装 <a target="_blank" rel="noopener" href="https://greasyfork.org/zh-CN/scripts/391193">解除网页限制</a> 以获得更好的使用体验。</p>
</blockquote>
<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>在浏览网页时经常会出现的一件事，当吾辈想要复制，突然发现复制好像没用了？（<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/23994286">知乎禁止转载的文章</a>）亦或者是复制的最后多出了一点内容（<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0a85e4c7d3d3">简书</a>），或者干脆直接不能选中了（<a target="_blank" rel="noopener" href="http://www.360doc.cn/">360doc</a>）。粘贴时也有可能发现一直粘贴不了（<a target="_blank" rel="noopener" href="https://auth.alipay.com/login/index.htm">支付宝登录</a>）。</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>欲先制敌，必先惑敌。想要解除复制粘贴的限制，就必须要清楚它们是如何实现的。不管如何，浏览器上能够运行的都是 JavaScript，它们都是使用 JavaScript 实现的。实现方式大致都是监听相应的事件（例如 <code>onkeydown</code> 监听 <code>Ctrl-C</code>），然后做一些特别的操作。</p>
<p>例如屏蔽复制功能只需要一句代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.oncopy = <span class="function">(<span class="params">event</span>) =&gt;</span> <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>
<p>是的，只要返回了 false，那么 copy 就会失效。还有一个更讨厌的方式，直接在 <code>body</code> 元素上加行内事件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">oncopy</span>=<span class="string">&quot;javascript: return false&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>可以看出，一般都是使用 JavaScript 在相应事件中返回 false，来阻止对应事件。那么，既然事件都被阻止了，是否意味着我们就束手无策了呢？吾辈所能想到的解决方案大致有三种方向</p>
<ul>
<li>使用 JavaScript 监听事件并自行实现复制/剪切/粘贴功能<ul>
<li>优点：实现完成后不管是任何网站都能使用，并且不会影响到监听之外的事件，也不会删除监听的同类型事件，可以解除浏览器本身的限制（密码框禁止复制）</li>
<li>缺点：某些功能自行实现难度很大，例如选择文本</li>
</ul>
</li>
<li>重新实现 <code>addEventListener</code> 然后删除掉网站自定义的事件<ul>
<li>优点：事件生效范围广泛，通用性高，不仅 _复制/剪切/粘贴_，其他类型的事件也可以解除</li>
<li>缺点：实现起来需要替换 <code>addEventListener</code> 事件<strong>够早</strong>，对浏览器默认操作不会生效（密码框禁止复制），而且某些网站也无法破解</li>
</ul>
</li>
<li>替换元素并删除 DOM 上的事件属性<ul>
<li>优点：能够确保网站 js 的限制被解除，通用性高，事件生效范围广泛</li>
<li>缺点：可能影响到其他类型的事件，复制节点时不会复制使用 <code>addEventListener</code> 添加的事件<blockquote>
<p>注：此方法不予演示，缺陷实在过大</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<p>总之，如果真的想解除<strong>限制</strong>，恐怕需要两种方式并用才可以呢</p>
<h2 id="使用-JavaScript-监听事件并自行实现复制-剪切-粘贴功能"><a href="#使用-JavaScript-监听事件并自行实现复制-剪切-粘贴功能" class="headerlink" title="使用 JavaScript 监听事件并自行实现复制/剪切/粘贴功能"></a>使用 JavaScript 监听事件并自行实现复制/剪切/粘贴功能</h2><h3 id="实现强制复制"><a href="#实现强制复制" class="headerlink" title="实现强制复制"></a>实现强制复制</h3><p>思路</p>
<ol>
<li> 冒泡监听 <code>copy</code> 事件</li>
<li> 获取当前选中的内容</li>
<li> 设置剪切版的内容</li>
<li> 阻止默认事件处理</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 强制复制</span></span><br><span class="line"><span class="built_in">document</span>.addEventListener(</span><br><span class="line">  <span class="string">&quot;copy&quot;</span>,</span><br><span class="line">  (event) =&gt; &#123;</span><br><span class="line">    event.clipboardData.setData(</span><br><span class="line">      <span class="string">&quot;text/plain&quot;</span>,</span><br><span class="line">      <span class="built_in">document</span>.getSelection().toString()</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 阻止默认的事件处理</span></span><br><span class="line">    event.preventDefault();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">true</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="实现强制剪切"><a href="#实现强制剪切" class="headerlink" title="实现强制剪切"></a>实现强制剪切</h3><p>思路</p>
<ol>
<li> 冒泡监听 <code>cut</code> 事件</li>
<li> 获取当前选中的内容</li>
<li> 设置剪切版的内容</li>
<li> 如果是可编辑内容要删除选中部分</li>
<li> 阻止默认事件处理</li>
</ol>
<blockquote>
<p>可以看到唯一需要增加的就是需要额外处理可编辑内容了，然而代码量瞬间爆炸了哦</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 字符串安全的转换为小写</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>str 字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;String&#125;</span> </span>转换后得到的全小写字符串</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toLowerCase</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!str || <span class="keyword">typeof</span> str !== <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> str.toLowerCase();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断指定元素是否是可编辑元素</span></span><br><span class="line"><span class="comment"> * 注：可编辑元素并不一定能够进行编辑，例如只读的 input 元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Element&#125;</span> </span>el 需要进行判断的元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Boolean&#125;</span> </span>是否为可编辑元素</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isEditable</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> inputEls = [<span class="string">&quot;input&quot;</span>, <span class="string">&quot;date&quot;</span>, <span class="string">&quot;datetime&quot;</span>, <span class="string">&quot;select&quot;</span>, <span class="string">&quot;textarea&quot;</span>];</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    el &amp;&amp; (el.isContentEditable || inputEls.includes(toLowerCase(el.tagName)))</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取输入框中光标所在位置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param  <span class="type">&#123;Element&#125;</span> </span>el 需要获取的输入框元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Number&#125;</span> </span>光标所在位置的下标</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCusorPostion</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> el.selectionStart;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置输入框中选中的文本/光标所在位置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Element&#125;</span> </span>el 需要设置的输入框元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>start 光标所在位置的下标</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> <span class="type">&#123;end&#125;</span> </span>结束位置，默认为输入框结束</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setCusorPostion</span>(<span class="params">el, start, end = start</span>) </span>&#123;</span><br><span class="line">  el.focus();</span><br><span class="line">  el.setSelectionRange(start, end);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在指定范围内删除文本</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Element&#125;</span> </span>el 需要设置的输入框元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> <span class="type">&#123;start&#125;</span> </span>开始位置，默认为当前选中开始位置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> <span class="type">&#123;end&#125;</span> </span>结束位置，默认为当前选中结束位置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">removeText</span>(<span class="params">el, start = el.selectionStart, end = el.selectionEnd</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 删除之前必须要 [记住] 当前光标的位置</span></span><br><span class="line">  <span class="keyword">var</span> index = getCusorPostion(el);</span><br><span class="line">  <span class="keyword">var</span> value = el.value;</span><br><span class="line">  el.value = value.substr(<span class="number">0</span>, start) + value.substr(end, value.length);</span><br><span class="line">  setCusorPostion(el, index);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 强制剪切</span></span><br><span class="line"><span class="built_in">document</span>.addEventListener(</span><br><span class="line">  <span class="string">&quot;cut&quot;</span>,</span><br><span class="line">  (event) =&gt; &#123;</span><br><span class="line">    event.clipboardData.setData(</span><br><span class="line">      <span class="string">&quot;text/plain&quot;</span>,</span><br><span class="line">      <span class="built_in">document</span>.getSelection().toString()</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 如果是可编辑元素还要进行删除</span></span><br><span class="line">    <span class="keyword">if</span> (isEditable(event.target)) &#123;</span><br><span class="line">      removeText(event.target);</span><br><span class="line">    &#125;</span><br><span class="line">    event.preventDefault();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">true</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="实现强制粘贴"><a href="#实现强制粘贴" class="headerlink" title="实现强制粘贴"></a>实现强制粘贴</h3><ol>
<li> 冒泡监听 <code>focus/blur</code>，以获得最后一个获得焦点的可编辑元素</li>
<li> 冒泡监听 <code>paste</code> 事件</li>
<li> 获取剪切版的内容</li>
<li> 获取最后一个获得焦点的可编辑元素</li>
<li> 删除当前选中的文本</li>
<li> 在当前光标处插入文本</li>
<li> 阻止默认事件处理</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取到最后一个获得焦点的元素</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> getLastFocus = (<span class="function">(<span class="params">lastFocusEl</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">document</span>.addEventListener(</span><br><span class="line">    <span class="string">&quot;focus&quot;</span>,</span><br><span class="line">    (event) =&gt; &#123;</span><br><span class="line">      lastFocusEl = event.target;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="literal">true</span></span><br><span class="line">  );</span><br><span class="line">  <span class="built_in">document</span>.addEventListener(</span><br><span class="line">    <span class="string">&quot;blur&quot;</span>,</span><br><span class="line">    (event) =&gt; &#123;</span><br><span class="line">      lastFocusEl = <span class="literal">null</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="literal">true</span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> lastFocusEl;</span><br><span class="line">&#125;)(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 字符串安全的转换为小写</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>str 字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;String&#125;</span> </span>转换后得到的全小写字符串</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toLowerCase</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!str || <span class="keyword">typeof</span> str !== <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> str.toLowerCase();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断指定元素是否是可编辑元素</span></span><br><span class="line"><span class="comment"> * 注：可编辑元素并不一定能够进行编辑，例如只读的 input 元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Element&#125;</span> </span>el 需要进行判断的元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Boolean&#125;</span> </span>是否为可编辑元素</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isEditable</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> inputEls = [<span class="string">&quot;input&quot;</span>, <span class="string">&quot;date&quot;</span>, <span class="string">&quot;datetime&quot;</span>, <span class="string">&quot;select&quot;</span>, <span class="string">&quot;textarea&quot;</span>];</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    el &amp;&amp; (el.isContentEditable || inputEls.includes(toLowerCase(el.tagName)))</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取输入框中光标所在位置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param  <span class="type">&#123;Element&#125;</span> </span>el 需要获取的输入框元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Number&#125;</span> </span>光标所在位置的下标</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCusorPostion</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> el.selectionStart;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置输入框中选中的文本/光标所在位置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Element&#125;</span> </span>el 需要设置的输入框元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>start 光标所在位置的下标</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> <span class="type">&#123;end&#125;</span> </span>结束位置，默认为输入框结束</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setCusorPostion</span>(<span class="params">el, start, end = start</span>) </span>&#123;</span><br><span class="line">  el.focus();</span><br><span class="line">  el.setSelectionRange(start, end);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在指定位置后插入文本</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Element&#125;</span> </span>el 需要设置的输入框元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>value 要插入的值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> <span class="type">&#123;start&#125;</span> </span>开始位置，默认为当前光标处</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">insertText</span>(<span class="params">el, text, start = getCusorPostion(el)</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> value = el.value;</span><br><span class="line">  el.value = value.substr(<span class="number">0</span>, start) + text + value.substr(start);</span><br><span class="line">  setCusorPostion(el, start + text.length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在指定范围内删除文本</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Element&#125;</span> </span>el 需要设置的输入框元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> <span class="type">&#123;start&#125;</span> </span>开始位置，默认为当前选中开始位置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> <span class="type">&#123;end&#125;</span> </span>结束位置，默认为当前选中结束位置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">removeText</span>(<span class="params">el, start = el.selectionStart, end = el.selectionEnd</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 删除之前必须要 [记住] 当前光标的位置</span></span><br><span class="line">  <span class="keyword">var</span> index = getCusorPostion(el);</span><br><span class="line">  <span class="keyword">var</span> value = el.value;</span><br><span class="line">  el.value = value.substr(<span class="number">0</span>, start) + value.substr(end, value.length);</span><br><span class="line">  setCusorPostion(el, index);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 强制粘贴</span></span><br><span class="line"><span class="built_in">document</span>.addEventListener(</span><br><span class="line">  <span class="string">&quot;paste&quot;</span>,</span><br><span class="line">  (event) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 获取当前剪切板内容</span></span><br><span class="line">    <span class="keyword">var</span> clipboardData = event.clipboardData;</span><br><span class="line">    <span class="keyword">var</span> items = clipboardData.items;</span><br><span class="line">    <span class="keyword">var</span> item = items[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (item.kind !== <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> text = clipboardData.getData(item.type);</span><br><span class="line">    <span class="comment">// 获取当前焦点元素</span></span><br><span class="line">    <span class="comment">// 粘贴的时候获取不到焦点？</span></span><br><span class="line">    <span class="keyword">var</span> focusEl = getLastFocus();</span><br><span class="line">    <span class="comment">// input 居然不是 [可编辑] 的元素？</span></span><br><span class="line">    <span class="keyword">if</span> (isEditable(focusEl)) &#123;</span><br><span class="line">      removeText(focusEl);</span><br><span class="line">      insertText(focusEl, text);</span><br><span class="line">      event.preventDefault();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">true</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>脚本全貌</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">  &quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 两种思路：</span></span><br><span class="line"><span class="comment">   * 1. 自己实现</span></span><br><span class="line"><span class="comment">   * 2. 替换元素</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取到最后一个获得焦点的元素</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">var</span> getLastFocus = (<span class="function">(<span class="params">lastFocusEl</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.addEventListener(</span><br><span class="line">      <span class="string">&quot;focus&quot;</span>,</span><br><span class="line">      (event) =&gt; &#123;</span><br><span class="line">        lastFocusEl = event.target;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="literal">true</span></span><br><span class="line">    );</span><br><span class="line">    <span class="built_in">document</span>.addEventListener(</span><br><span class="line">      <span class="string">&quot;blur&quot;</span>,</span><br><span class="line">      (event) =&gt; &#123;</span><br><span class="line">        lastFocusEl = <span class="literal">null</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="literal">true</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> lastFocusEl;</span><br><span class="line">  &#125;)(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 字符串安全的转换为小写</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>str 字符串</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;String&#125;</span> </span>转换后得到的全小写字符串</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">toLowerCase</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!str || <span class="keyword">typeof</span> str !== <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str.toLowerCase();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 字符串安全的转换为大写</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>str 字符串</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;String&#125;</span> </span>转换后得到的全大写字符串</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">toUpperCase</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!str || <span class="keyword">typeof</span> str !== <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str.toUpperCase();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 判断指定元素是否是可编辑元素</span></span><br><span class="line"><span class="comment">   * 注：可编辑元素并不一定能够进行编辑，例如只读的 input 元素</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Element&#125;</span> </span>el 需要进行判断的元素</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;Boolean&#125;</span> </span>是否为可编辑元素</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isEditable</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> inputEls = [<span class="string">&quot;input&quot;</span>, <span class="string">&quot;date&quot;</span>, <span class="string">&quot;datetime&quot;</span>, <span class="string">&quot;select&quot;</span>, <span class="string">&quot;textarea&quot;</span>];</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      el &amp;&amp; (el.isContentEditable || inputEls.includes(toLowerCase(el.tagName)))</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取输入框中光标所在位置</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param  <span class="type">&#123;Element&#125;</span> </span>el 需要获取的输入框元素</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;Number&#125;</span> </span>光标所在位置的下标</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getCusorPostion</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> el.selectionStart;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 设置输入框中选中的文本/光标所在位置</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Element&#125;</span> </span>el 需要设置的输入框元素</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>start 光标所在位置的下标</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> <span class="type">&#123;end&#125;</span> </span>结束位置，默认为输入框结束</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setCusorPostion</span>(<span class="params">el, start, end = start</span>) </span>&#123;</span><br><span class="line">    el.focus();</span><br><span class="line">    el.setSelectionRange(start, end);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 在指定位置后插入文本</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Element&#125;</span> </span>el 需要设置的输入框元素</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>value 要插入的值</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> <span class="type">&#123;start&#125;</span> </span>开始位置，默认为当前光标处</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">insertText</span>(<span class="params">el, text, start = getCusorPostion(el)</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value = el.value;</span><br><span class="line">    el.value = value.substr(<span class="number">0</span>, start) + text + value.substr(start);</span><br><span class="line">    setCusorPostion(el, start + text.length);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 在指定范围内删除文本</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Element&#125;</span> </span>el 需要设置的输入框元素</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> <span class="type">&#123;start&#125;</span> </span>开始位置，默认为当前选中开始位置</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> <span class="type">&#123;end&#125;</span> </span>结束位置，默认为当前选中结束位置</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">removeText</span>(<span class="params">el, start = el.selectionStart, end = el.selectionEnd</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 删除之前必须要 [记住] 当前光标的位置</span></span><br><span class="line">    <span class="keyword">var</span> index = getCusorPostion(el);</span><br><span class="line">    <span class="keyword">var</span> value = el.value;</span><br><span class="line">    el.value = value.substr(<span class="number">0</span>, start) + value.substr(end, value.length);</span><br><span class="line">    setCusorPostion(el, index);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 强制复制</span></span><br><span class="line">  <span class="built_in">document</span>.addEventListener(</span><br><span class="line">    <span class="string">&quot;copy&quot;</span>,</span><br><span class="line">    (event) =&gt; &#123;</span><br><span class="line">      event.clipboardData.setData(</span><br><span class="line">        <span class="string">&quot;text/plain&quot;</span>,</span><br><span class="line">        <span class="built_in">document</span>.getSelection().toString()</span><br><span class="line">      );</span><br><span class="line">      event.preventDefault();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="literal">true</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 强制剪切</span></span><br><span class="line">  <span class="built_in">document</span>.addEventListener(</span><br><span class="line">    <span class="string">&quot;cut&quot;</span>,</span><br><span class="line">    (event) =&gt; &#123;</span><br><span class="line">      event.clipboardData.setData(</span><br><span class="line">        <span class="string">&quot;text/plain&quot;</span>,</span><br><span class="line">        <span class="built_in">document</span>.getSelection().toString()</span><br><span class="line">      );</span><br><span class="line">      <span class="comment">// 如果是可编辑元素还要进行删除</span></span><br><span class="line">      <span class="keyword">if</span> (isEditable(event.target)) &#123;</span><br><span class="line">        removeText(event.target);</span><br><span class="line">      &#125;</span><br><span class="line">      event.preventDefault();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="literal">true</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 强制粘贴</span></span><br><span class="line">  <span class="built_in">document</span>.addEventListener(</span><br><span class="line">    <span class="string">&quot;paste&quot;</span>,</span><br><span class="line">    (event) =&gt; &#123;</span><br><span class="line">      <span class="comment">// 获取当前剪切板内容</span></span><br><span class="line">      <span class="keyword">var</span> clipboardData = event.clipboardData;</span><br><span class="line">      <span class="keyword">var</span> items = clipboardData.items;</span><br><span class="line">      <span class="keyword">var</span> item = items[<span class="number">0</span>];</span><br><span class="line">      <span class="keyword">if</span> (item.kind !== <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">var</span> text = clipboardData.getData(item.type);</span><br><span class="line">      <span class="comment">// 获取当前焦点元素</span></span><br><span class="line">      <span class="comment">// 粘贴的时候获取不到焦点？</span></span><br><span class="line">      <span class="keyword">var</span> focusEl = getLastFocus();</span><br><span class="line">      <span class="comment">// input 居然不是 [可编辑] 的元素？</span></span><br><span class="line">      <span class="keyword">if</span> (isEditable(focusEl)) &#123;</span><br><span class="line">        removeText(focusEl);</span><br><span class="line">        insertText(focusEl, text);</span><br><span class="line">        event.preventDefault();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="literal">true</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">selection</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dom;</span><br><span class="line">    <span class="built_in">document</span>.onmousedown = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">      dom = event.target;</span><br><span class="line">      <span class="comment">// console.log(&#x27;点击: &#x27;, dom)</span></span><br><span class="line">      <span class="keyword">debugger</span>;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;光标所在处: &quot;</span>, getCusorPostion(dom));</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">document</span>.onmousemove = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;移动: &quot;</span>, dom);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">document</span>.onmouseup = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;松开: &quot;</span>, dom);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<h2 id="重新实现-addEventListener-然后删除掉网站自定义的事件"><a href="#重新实现-addEventListener-然后删除掉网站自定义的事件" class="headerlink" title="重新实现 addEventListener 然后删除掉网站自定义的事件"></a>重新实现 <code>addEventListener</code> 然后删除掉网站自定义的事件</h2><blockquote>
<p>该实现来灵感来源自 <a target="_blank" rel="noopener" href="https://greasyfork.org/en/scripts/41075">https://greasyfork.org/en/scripts/41075</a>，几乎完美实现了解除限制的功能</p>
</blockquote>
<p>原理很简单，修改原型，重新实现 <code>EventTarget</code> 和 <code>docuement</code> 的 <code>addEventListener</code> 函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         解除网页限制</span></span><br><span class="line"><span class="comment">// @namespace    http://github.com/rxliuli</span></span><br><span class="line"><span class="comment">// @version      1.0</span></span><br><span class="line"><span class="comment">// @description  破解禁止复制/剪切/粘贴/选择/右键菜单的网站</span></span><br><span class="line"><span class="comment">// @author       rxliuli</span></span><br><span class="line"><span class="comment">// @include      https://www.jianshu.com/*</span></span><br><span class="line"><span class="comment">// @grant        GM.getValue</span></span><br><span class="line"><span class="comment">// @grant        GM.setValue</span></span><br><span class="line"><span class="comment">// 这里的 @run-at 非常重要，设置在文档开始时就载入脚本</span></span><br><span class="line"><span class="comment">// @run-at       document-start</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line">(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 监听所有的 addEventListener, removeEventListener 事件</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">var</span> documentAddEventListener = <span class="built_in">document</span>.addEventListener;</span><br><span class="line">  <span class="keyword">var</span> eventTargetAddEventListener = EventTarget.prototype.addEventListener;</span><br><span class="line">  <span class="keyword">var</span> documentRemoveEventListener = <span class="built_in">document</span>.removeEventListener;</span><br><span class="line">  <span class="keyword">var</span> eventTargetRemoveEventListener =</span><br><span class="line">    EventTarget.prototype.removeEventListener;</span><br><span class="line">  <span class="keyword">var</span> events = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 用来保存监听到的事件信息</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Event</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">el, type, listener, useCapture</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.el = el;</span><br><span class="line">      <span class="built_in">this</span>.type = type;</span><br><span class="line">      <span class="built_in">this</span>.listener = listener;</span><br><span class="line">      <span class="built_in">this</span>.useCapture = useCapture;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 自定义的添加事件监听函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>type 事件类型</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;EventListener&#125;</span> </span>listener 事件监听函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Boolean&#125;</span> <span class="type">&#123;useCapture&#125;</span> </span>是否需要捕获事件冒泡，默认为 false</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">addEventListener</span>(<span class="params">type, listener, useCapture = <span class="literal">false</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="built_in">this</span>;</span><br><span class="line">    <span class="keyword">var</span> $addEventListener =</span><br><span class="line">      _this === <span class="built_in">document</span></span><br><span class="line">        ? documentAddEventListener</span><br><span class="line">        : eventTargetAddEventListener;</span><br><span class="line">    events.push(<span class="keyword">new</span> Event(_this, type, listener, useCapture));</span><br><span class="line">    $addEventListener.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 自定义的根据类型删除事件函数</span></span><br><span class="line"><span class="comment">   * 该方法会删除这个类型下面全部的监听函数，不管数量</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>type 事件类型</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">removeEventListenerByType</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="built_in">this</span>;</span><br><span class="line">    <span class="keyword">var</span> $removeEventListener =</span><br><span class="line">      _this === <span class="built_in">document</span></span><br><span class="line">        ? documentRemoveEventListener</span><br><span class="line">        : eventTargetRemoveEventListener;</span><br><span class="line">    <span class="keyword">var</span> removeIndexs = events</span><br><span class="line">      .map(<span class="function">(<span class="params">e, i</span>) =&gt;</span> (e.el === _this || e.type === <span class="built_in">arguments</span>[<span class="number">0</span>] ? i : -<span class="number">1</span>))</span><br><span class="line">      .filter(<span class="function">(<span class="params">i</span>) =&gt;</span> i !== -<span class="number">1</span>);</span><br><span class="line">    removeIndexs.forEach(<span class="function">(<span class="params">i</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> e = events[i];</span><br><span class="line">      $removeEventListener.apply(e.el, [e.type, e.listener, e.useCapture]);</span><br><span class="line">    &#125;);</span><br><span class="line">    removeIndexs.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> b - a).forEach(<span class="function">(<span class="params">i</span>) =&gt;</span> events.splice(i, <span class="number">1</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">clearEvent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> eventTypes = [</span><br><span class="line">      <span class="string">&quot;copy&quot;</span>,</span><br><span class="line">      <span class="string">&quot;cut&quot;</span>,</span><br><span class="line">      <span class="string">&quot;select&quot;</span>,</span><br><span class="line">      <span class="string">&quot;contextmenu&quot;</span>,</span><br><span class="line">      <span class="string">&quot;selectstart&quot;</span>,</span><br><span class="line">      <span class="string">&quot;dragstart&quot;</span>,</span><br><span class="line">    ];</span><br><span class="line">    <span class="built_in">document</span>.querySelectorAll(<span class="string">&quot;*&quot;</span>).forEach(<span class="function">(<span class="params">el</span>) =&gt;</span> &#123;</span><br><span class="line">      eventTypes.forEach(<span class="function">(<span class="params">type</span>) =&gt;</span> el.removeEventListenerByType(type));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">document</span>.addEventListener = EventTarget.prototype.addEventListener = addEventListener;</span><br><span class="line">    <span class="built_in">document</span>.removeEventListenerByType = EventTarget.prototype.removeEventListenerByType = removeEventListenerByType;</span><br><span class="line">  &#125;)();</span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    clearEvent();</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<hr>
<p>最后，JavaScript hook 技巧是真的很多，果然写 Greasemonkey 脚本这方面用得很多呢 (๑&gt;ᴗ&lt;๑)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/9a8a075106024e4c94211e779d6f39bd/" data-id="ckmcqox5m00c10kuvce3b4maw" data-title="使用 GreaseMonkey 解除网页复制粘贴限制" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BB%8F%E9%AA%8C/" rel="tag">经验</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-9b18e52888d44aa5905de808668217a8" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/9b18e52888d44aa5905de808668217a8/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/9b18e52888d44aa5905de808668217a8/">如何超过大多数人</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>转自 <a target="_blank" rel="noopener" href="https://coolshell.cn/articles/19464.html">https://coolshell.cn/articles/19464.html</a><br>对国内互联网的批判真的是相当尖锐啊 (ノ￣ ω ￣)ノ</p>
</blockquote>
<p>当你看到这篇文章的标题，你一定对这篇文章产生了巨大的兴趣，因为你的潜意识在告诉你，这是一本人生的 “武林秘籍”，而且还是左耳朵写的，一定有干货满满，只要读完，一定可以练就神功并找到超过大多数人的快车道和捷径…… 然而…… 当你看到我这样开篇时，你一定会觉得我马上就要有个转折，告诉你这是不可能的，一切都需要付出和努力…… 然而，你错了，这篇文章还真就是一篇 “秘籍”，只要你把这些 “秘籍” 用起来，你就一定可以超过大多数人。而且，这篇文章只有我这个 “人生导师” 可以写得好。毕竟，我的生命过到了十六进制 2B 的年纪，踏入这个社会已超过 20 年，舍我其谁呢？！</p>
<p>P.S. 这篇文章借鉴于《<a target="_blank" rel="noopener" href="https://coolshell.cn/articles/4758.html">如何写出无法维护的代码</a>》一文的风格…… 嘿嘿</p>
<h2 id="相关技巧和最佳实践"><a href="#相关技巧和最佳实践" class="headerlink" title="相关技巧和最佳实践"></a>相关技巧和最佳实践</h2><p>要超过别人其实还是比较简单的，尤其在今天的中国，更是简单。因为，你只看看中国的互联网，你就会发现，他们基本上全部都是在消费大众，让大众变得更为地愚蠢和傻瓜。<strong>所以，在今天的中国，你基本上不用做什么，只需要不使用中国互联网，你就很自然地超过大多数人了</strong>。当然，如果你还想跟他们彻底拉开，甩他们几个身位，把别人打到底层，下面的这些 “技巧” 你要多多了解一下。</p>
<p>在信息获取上，你要不断地向大众鼓吹下面的这些事：</p>
<ul>
<li>让大家都用百度搜索引擎查找信息，订阅微信公众号或是到知乎上学习知识…… 要做到这一步，你就需要把 “百度一下” 挂在嘴边，然后要经常在群或朋友圈中转发微信公众号的文章，并且转发知乎里的各种 “如何看待……” 这样的文章，让他们爱上八卦，爱上转发，爱上碎片。</li>
<li>让大家到微博或是知识星球上粉一些大咖，密切关注他们的言论和动向…… 是的，告诉大家，大咖的任何想法一言一行都可以在微博、朋友圈或是知识星球上获得，让大家相信，你的成长和大咖的见闻和闲扯非常有关系，你跟牛人在一个圈子里你也会变牛。</li>
<li>把今日头条和抖音这样的 APP 推荐给大家…… 你只需要让你有朋友成功地安装这两个 APP，他们就会花大量的时间在上面，而不能自拔，要让他们安装其实还是很容易的，你要不信你就装一个试玩一会看看（嘿嘿嘿）。</li>
<li>让大家热爱八卦，八卦并不一定是明星的八卦，还可以是你身边的人，比如，公司的同事，自己的同学，职场见闻，社会热点，争议话题，…… 这些东西总有一些东西会让人心态有很多微妙的变化，甚至花大量的时间去搜索和阅读大量的观点，以及花大量时间与人辩论争论，这个过程会让人上瘾，让人欲罢不能，然而这些事却和自己没有半毛钱关系。你要做的事就是转发其中一些 SB 或是很极端的观点，造成大家的一睦讨论后，就早早离场……</li>
<li>利用爱国主义，让大家觉得不用学英文，不要出国，不要翻墙，咱们已经是强国了…… 这点其实还是很容易做到的，因为学习是比较逆人性的，所以，只要你鼓吹那些英文无用论，出国活得更惨，国家和民族都变得很强大，就算自己过得很底层，也有大国人民的感觉。</li>
</ul>
<p>然后，在知识学习和技能训练上，让他们不得要领并产生幻觉</p>
<ul>
<li>让他们混淆认识和知识，以为开阔认知就是学习，让他们有学习和成长的幻觉……</li>
<li>培养他们要学会使用碎片时间学习。等他们习惯利用碎片时间吃快餐后，他们就会失去精读一本书的耐性……</li>
<li>不断地给他们各种各样 “有价值的学习资料”，让他们抓不住重点，成为一个微信公众号或电子书 “收藏家”……</li>
<li>让他们看一些枯燥无味的基础知识和硬核知识，这样让他们只会用 “死记硬背” 的方式来学习，甚至直接让他们失去信心，直接放弃……</li>
<li>玩具手枪是易用的，重武器是难以操控的，多给他们一些玩具，这样他们就会对玩具玩地得心应手，觉得玩玩具就是自己的专业……</li>
<li>让他们喜欢直接得到答案的工作和学习方式，成为一个伸手党，从此学习再也不思考……</li>
<li>告诉他们东西做出来就好了，不要追求做漂亮，做优雅，这样他们就会慢慢地变成劳动密集型……</li>
<li>让他们觉得自己已经很努力了，剩下的就是运气，并说服他们去‘及时行乐’，然后再也找不到高阶和高效率学习的感觉……</li>
<li>让他们觉得 “读完书”、“读过书” 就行了，不需要对书中的东西进行思考，进行总结，或是实践，只要囫囵吞枣尽快读完就等同于学好了……</li>
</ul>
<p>最后，在认知和格局上，彻底打垮他们，让他们变成韭菜。</p>
<ul>
<li>让他们不要看到大的形势，只看到眼前的一亩三分地，做好一个井底之蛙。其实这很简单，比如，你不要让他们看到整个计算机互联网技术改变人类社会的趋势，你要多让他看到，从事这一行业的人有多苦逼，然后再说一下其它行业或职业有多好……</li>
<li>宣扬一夜暴富以及快速挣钱的案例，最好让他们进入 “赌博类” 或是 “传销类” 的地方，比如：股市、数字货币…… 要让他们相信各种财富神话，相信他们就是那个幸运儿，他们也可以成为巴菲特，可以成为马云……</li>
<li>告诉他们，一些看上去很难的事都是有捷径的，比如：21 天就能学会机器学习，用区块链就能颠覆以及重构整个世界等等……</li>
<li>多跟他们讲一些小人物的励志的故事，这样让他们相信，不需要学习高级知识，不需要掌握高级技能，只需要用低等的知识和低级的技能，再加上持续不断拼命重复现有的工作，终有一天就会成功……</li>
<li>多让他们跟别人比较，人比人不会气死人，但是会让人变得浮躁，变得心急，变得焦虑，当一个人没有办法控制自己的情绪，没有办法让自己静下心来，人会失去耐性和坚持，开始好大喜欢功，开始装逼，开始歪门邪道剑走偏锋……</li>
<li>让他们到体制内的一些非常稳定的地方工作，这样他们拥有不思进取、怕承担责任、害怕犯错、喜欢偷懒、得过且过的素质……</li>
<li>让他们到体制外的那些喜欢拼命喜欢加班的地方工作，告诉他们爱拼才会赢，努力加班是一种福报，青春就是用来拼的，让他们喜欢上使蛮力的感觉……</li>
<li>告诉他们你的行业太累太辛苦，干不到 30 岁。让他们早点转行，不要耽误人生和青春……</li>
<li>当他们要做决定的时候，一定要让他们更多的关注自己会失去的东西，而不是会得到的东西。培养他们患得患失心态，让他们认识不到事物真正的价值，失去判断能力……（比如：让他们觉得跟对人拍领导的马屁忠于公司比自我的成长更有价值）</li>
<li>告诉他们，你现有的技能和知识不用更新，就能过好一辈子，新出来的东西没有生命力的…… 这样他们就会像我们再也不学习的父辈一样很快就会被时代所抛弃……</li>
<li>每个人都喜欢在一些自己做不到的事上找理由，这种能力不教就会，比如，事情太多没有时间，因为工作上没有用到，等等，你要做的就是帮他们为他们做不到的事找各种非常合理的理由，比如：没事的，一切都是最好的安排；你得不到的那个事没什么意思；你没有面好主要原因是那个面试官问的问题都是可以上网查得到的知识，而不没有问到你真正的能力上；这些东西学了不用很快会忘了，等有了环境再学也不迟……</li>
</ul>
<p><strong>最后友情提示一下，上述的这些 “最佳实践” 你要小心，是所谓，贩毒的人从来不吸毒，开赌场的人从来不赌博！所以，你要小心别自己也掉进去了！这就是 “欲练神功，必先自宫” 的道理。</strong></p>
<h2 id="相关原理和思维模型"><a href="#相关原理和思维模型" class="headerlink" title="相关原理和思维模型"></a>相关原理和思维模型</h2><p>对于上面的这些技巧还有很多很多，你自己也可以发明或是找到很多。所以，我来讲讲这其中的一些原理。</p>
<p>一般来说，超过别人一般来说就是两个维度：</p>
<ol>
<li> <strong>在认知、知识和技能上</strong>。这是一个人赖以立足社会的能力（参看《<a target="_blank" rel="noopener" href="https://coolshell.cn/articles/4235.html">程序员的荒谬之言还是至理名言？</a>》和《<a target="_blank" rel="noopener" href="https://coolshell.cn/articles/2250.html">21 天教你学会 C++</a>》）</li>
<li> <strong>在领导力上</strong>。所谓领导力就是你跑在别人前面，你得要有比别人更好的能力更高的标准（参看《<a target="_blank" rel="noopener" href="https://coolshell.cn/articles/17583.html">技术人员发展之路</a>》）</li>
</ol>
<p>首先，我们要明白，人的技能是从认识开始，然后通过学校、培训或是书本把 “零碎的认知” 转换成 “系统的知识”，而有要把知识转换成技能，就需要训练和实践，这样才能完成从：认识 -&gt; 知识 -&gt; 技能 的转换。这个转换过程是需要耗费很多时间和精力的，而且其中还需要有强大的学习能力和动手能力，这条路径上有很多的 “关卡”，每道关卡都会过滤掉一大部分人。比如：对于一些比较枯燥的硬核知识来说，90% 的人基本上就倒下来，不是因为他们没有智商，而是他们没有耐心。</p>
<h3 id="认知"><a href="#认知" class="headerlink" title="认知"></a>认知</h3><p>要在认知上超过别人，就要在下面几个方面上做足功夫：</p>
<ol>
<li><p> <strong>信息渠道</strong>。试想如果别人的信息源没有你的好，那么，这些看不见信息源的人，只能接触得到二手信息甚至三手信息，只能获得被别人解读过的信息，这些信息被三传两递后必定会有错误和失真，甚至会被传递信息的中间人 hack 其中的信息（也就是 “中间人攻击”），而这些找不出信息源的人，只能 “被人喂养”，于是，他们最终会被困在信息的底层，永世不得翻身。（比如：学习 C 语言，放着原作者 K&amp;R 的不用，硬要用错误百出谭浩强的书，能有什么好呢？）</p>
</li>
<li><p> <strong>信息质量</strong>。信息质量主要表现在两个方面，一个是信息中的燥音，另一个是信息中的质量等级，我们都知道，在大数据处理中有一句名言，叫 garbage in garbage out，你天天看的都是垃圾，你的思想和认识也只有垃圾。所以，如果你的信息质量并不好的话，你的认知也不会好，而且你还要花大量的时间来进行有价值信息的挖掘和处理。</p>
</li>
<li><p> <strong>信息密度</strong>。优质的信息，密度一般都很大，因为这种信息会逼着你去干这么几件事，a）搜索并学习其关联的知识，b）沉思和反省，c）亲手去推理、验证和实践…… 一般来说，经验性的文章会比知识性的文章会更有这样的功效。比如，类似于像 Effiective C++/Java，设计模式，Unix 编程艺术，算法导论等等这样的书就是属于这种密度很大的书，而像 <a target="_blank" rel="noopener" href="https://medium.com/netflix-techblog">Netflix 的官方 blog</a> 和 <a target="_blank" rel="noopener" href="https://www.allthingsdistributed.com/">AWS CTO 的 blog</a> 等等地方也会经常有一些这样的文章。</p>
</li>
</ol>
<h3 id="知识"><a href="#知识" class="headerlink" title="知识"></a>知识</h3><p>要在知识上超过别人，你就需要在下面几个方面上做足功夫：</p>
<ol>
<li><p> <strong>知识树（图）</strong>。任何知识，只在点上学习不够的，需要在面上学习，这叫系统地学习，这需要我们去总结并归纳知识树或知识图，一个知识面会有多个知识板块组成，一个板块又有各种知识点，一个知识点会导出另外的知识点，各种知识点又会交叉和依赖起来，学习就是要系统地学习整个知识树（图）。而我们都知道，<strong>对于一棵树来说，“根基” 是非常重要的，所以，学好基础知识也是非常重要的，对于一个陌生的地方，有一份地图是非常重要的，没有地图的你只会乱窜，只会迷路、练路、走冤枉路！</strong></p>
</li>
<li><p> <strong>知识缘由</strong>。任何知识都是有缘由的，了解一个知识的来龙去脉和前世今生，会让你对这个知识有非常强的掌握，而不再只是靠记忆去学习。靠记忆去学习是一件非常糟糕的事。而对于一些操作性的知识（不需要了解由来的），我把其叫操作知识，就像一些函数库一样，这样的知识只要学会查文档就好了。<strong>能够知其然，知其所以然的人自然会比识知识到表皮的人段位要高很多。</strong></p>
</li>
<li><p> <strong>方法套路</strong>。学习不是为了找到答案，而是找到方法。就像数学一样，你学的是方法，是解题思路，是套路，会用方程式解题的和不会用方程式解题的在解题效率上不可比较，而在微积分面前，其它的解题方法都变成了渣渣。<strong>你可以看到，掌握高级方法的人比别人的优势有多大，学习的目的就是为了掌握更为高级的方法和解题思路</strong>。</p>
</li>
</ol>
<h3 id="技能"><a href="#技能" class="headerlink" title="技能"></a>技能</h3><p>要在技能上超过别人，你就需要在下面几个方面做足功夫：</p>
<ol>
<li><p> <strong>精益求精</strong>。如果你想拥有专业的技能，你要做不仅仅是拼命地重复一遍又一遍的训练，而是在每一次重复训练时你都要找到更好的方法，总结经验，让新的一遍能够更好，更漂亮，更有效率，否则，用相同的方法重复，那你只不过在搬砖罢了。</p>
</li>
<li><p> <strong>让自己犯错</strong>。犯错是有利于成长的，这是因为出错会让人反思，反思更好的方法，反思更完美的方案，总结教训，寻求更好更完美的过程，是技能升级的最好的方式。尤其是当你在出错后，被人鄙视，被人嘲笑后，你会有更大的动力提升自己，这样的动力才是进步的源动力。当然，千万不要同一个错误重复地犯！</p>
</li>
<li><p> <strong>找高手切磋</strong>。下过棋，打个球的人都知道，你要想提升自己的技艺，你必需找高手切磋，在和高手切磋的过程中你会感受到高手的技能和方法，有时候你会情不自禁地哇地一下，我靠，还可以这么玩！</p>
</li>
</ol>
<h3 id="领导力"><a href="#领导力" class="headerlink" title="领导力"></a>领导力</h3><p>最后一个是领导力，要有领导力或是影响力这个事并不容易，这跟你的野心有多大，好胜心有多强 ，你愿意付出多少很有关系，因为一个人的领导力跟他的标准很有关系，因为有领导力的人的标准比绝大多数人都要高。</p>
<ol>
<li><p> <strong>识别自己的特长和天赋</strong>。首先，每个人 DNA 都可能或多或少都会有一些比大多数人 NB 的东西（当然，也可能没有），如果你有了，那么在你过去的人生中就一定会表现出来了，就是那种大家遇到这个事会来请教你的寻求你帮助的现象。那种，别人要非常努力，而且毫不费劲的事。一旦你有了这样的特长或天赋，那你就要大力地扩大你的领先优势，千万不要进到那些会限制你优势的地方。你是一条鱼，你就一定要把别人拉到水里来玩，绝对不要去陆地上跟别人拼，不断地在自己的特长和天赋上扩大自己的领先优势，彻底一骑绝尘。</p>
</li>
<li><p> <strong>识别自己的兴趣和事业</strong>。没有天赋也没有问题，还有兴趣点，都说兴趣是最好的老师，当年，Linus 就是在学校里对 minx 着迷了，于是整出个 Linux 来，这就是兴趣驱动出的东西，一般来说，兴趣驱动的事总是会比那些被动驱动的更好。但是，这里我想说明一下什么叫 “真 ∙ 兴趣”，真正的兴趣不是那种三天热度的东西，而是那种，你愿意为之付出一辈子的事，是那种无论有多大困难有多难受你都要死磕的事，这才是 “真 ∙ 兴趣”，这也就是你的 “野心” 和 “好胜心” 所在，其实上升到了你的事业。相信我，绝大多数人只有职业而没有事业的。</p>
</li>
<li><p> <strong>建立高级的习惯和方法</strong>。没有天赋没有野心，也还是可以跟别人拼习惯拼方法的，只要你有一些比较好的习惯和方法，那么你一样可以超过大多数人。对此，在习惯上你要做到比较大多数人更自律，更有计划性，更有目标性，比如，每年学习一门新的语言或技术，并可以参与相关的顶级开源项目，每个月训练一个类算法，掌握一种算法，每周阅读一篇英文论文，并把阅读笔记整理出来…… 自律的是非常可怕的。除此之外，你还需要在方法上超过别人，你需要满世界的找各种高级的方法，其中包括，思考的方法，学习的方法、时间管理的方法、沟通的方法这类软实力的，还有，解决问题的方法（trouble shooting 和 problem solving），设计的方法，工程的方法，代码的方法等等硬实力的，一开始照猫画虎，时间长了就可能会自己发明或推导新的方法。</p>
</li>
<li><p> **勤奋努力执着坚持 **。如果上面三件事你都没有也没有能力，那还有最后一件事了，那就是勤奋努力了，就是所谓的 “一万小时定律” 了（参看《<a target="_blank" rel="noopener" href="https://coolshell.cn/articles/2250.html">21 天教你学会 C++</a>》中的十年学编程一节），我见过很多不聪明的人，悟性也不够（比如我就是一个），别人学一个东西，一个月就好了，而我需要 1 年甚至更长，但是很多东西都是死的，只要肯花时间就有一天你会搞懂的，耐不住我坚持十年二十年，聪明的人发明个飞机飞过去了，笨一点的人愚公移山也过得去，因为更多的人是懒人，我不用拼过聪明人，我只用拼过那些懒人就好了。</p>
</li>
</ol>
<p>好了，就这么多，如果哪天你变得消极和不自信，你要来读读我的这篇文章，子曰：温故而知新。</p>
<p>（全文完）</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/9b18e52888d44aa5905de808668217a8/" data-id="ckmcqox5n00c30kuvg8xrfn8j" data-title="如何超过大多数人" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9D%82%E8%B0%88/" rel="tag">杂谈</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">转载</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-b11f3c6f1486497f9f07a08e885be6ec" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/b11f3c6f1486497f9f07a08e885be6ec/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/b11f3c6f1486497f9f07a08e885be6ec/">为什么要用现代前端</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>前端近两年来发展迅速，随着 <a target="_blank" rel="noopener" href="https://nodejs.org/">nodejs</a> 的广泛使用，大批 <a target="_blank" rel="noopener" href="https://npmjs.com/">npm</a> 的框架/库层出不穷，npm 上 JavaScript 库的数量甚至超过了 <a target="_blank" rel="noopener" href="https://mvnrepository.com/">Maven 中央仓库</a>。<br>然而即便如此，仍然有很多公司固守在传统的前端切 UI，后端通过模板视图填充视图的技术。一方面固然是为了避免新技术踩坑，另一方面，居然有人在 <a target="_blank" rel="noopener" href="https://github.com/denoland/deno">deno</a> 下说出了：<a target="_blank" rel="noopener" href="https://github.com/denoland/deno/issues/25">求不要更新了，老子学不动了</a>，并引发了大量讨论。</p>
<blockquote>
<p>deno 是 nodejs 的作者开发的下一代 JavaScript 运行时。</p>
</blockquote>
<h2 id="现代前端"><a href="#现代前端" class="headerlink" title="现代前端"></a>现代前端</h2><p>前端发展史</p>
<blockquote>
<ol>
<li> 1996 年，样式表标准 <code>CSS</code> 第一版发布。</li>
<li> 2001 年，微软公司时隔 5 年之后，发布了 IE 浏览器的下一个版本 <code>Internet Explorer 6</code>。这是当时最先进的浏览器，它后来统治了浏览器市场多年。</li>
<li> 2002 年，Mozilla 项目发布了它的浏览器的第一版，后来起名为 <code>Firefox</code>。</li>
<li> 2003 年，苹果公司发布了 <code>Safari</code> 浏览器的第一版。</li>
<li> 2004 年，Google 公司发布了 <code>Gmail</code>，促成了互联网应用程序（<code>Web Application</code>）这个概念的诞生。由于 Gmail 是在 4 月 1 日发布的，很多人起初以为这只是一个玩笑。</li>
<li> 2004 年，<code>WHATWG</code> 组织成立，致力于加速 HTML 语言的标准化进程。</li>
<li> 2005 年，<code>Ajax</code> 方法（Asynchronous JavaScript and XML）正式诞生，Jesse James Garrett 发明了这个词汇。它开始流行的标志是，2 月份发布的 Google Maps 项目大量采用该方法。它几乎成了新一代网站的标准做法，促成了 <code>Web 2.0</code> 时代的来临。</li>
<li> 2006 年，<code>jQuery</code> 函数库诞生，作者为 John Resig。jQuery 为操作网页 <code>DOM</code> 结构提供了非常强大易用的接口，成为了使用最广泛的函数库，并且让 JavaScript 语言的应用难度大大降低，推动了这种语言的流行。</li>
<li> 2008 年，<code>V8</code> 编译器诞生.</li>
<li> 2009 年，<code>Node.js</code> 项目诞生，创始人为 Ryan Dahl，它标志着 JavaScript 可以用于 <code>服务器端编程</code>，从此网站的前端和后端可以使用同一种语言开发。并且，Node.js 可以承受很大的并发流量，使得开发某些互联网大规模的实时应用变得容易。</li>
<li> 2013 年 5 月，Facebook 发布 UI 框架库 <code>React</code>，引入了新的 <code>JSX</code> 语法，使得 UI 层可以用组件开发。</li>
<li> 2015 年 3 月，Facebook 公司发布了 <code>React Native</code> 项目，将 React 框架移植到了手机端，可以用来开发手机 <code>App</code>。它会将 JavaScript 代码转为 <code>iOS</code> 平台的 <code>Objective-C</code> 代码，或者 <code>Android</code> 平台的 <code>Java</code> 代码，从而为 JavaScript 语言开发高性能的原生 App 打开了一条道路。</li>
<li> 2015 年 <code>vuejs</code> 发布 1.0 版本</li>
<li> 2016 年 <code>vuejs2.x</code> 版本发布</li>
<li> 新生事物仍在不断涌现…</li>
</ol>
</blockquote>
<p>上面就是前端的大概发展史，看完之后，不难发现，有一些关键的历史时刻，对前端开发产生了重大影响。例如 IE6 的发布（统治了浏览器市场很多年），JQuery 的诞生，Ajax 的流行。而现在，新的拐点出现了 – nodejs 的流行。现代前端仍然在快速发展中，前后端分离，SSR，PWA 都是近两年才出现的概念。如果没有上车，后面就再难追上了。例如像十年前不使用 Spring 开发的应用，在现代 Java Web 后端的环境中，没有 Spring 简直寸步难行。</p>
<p>上面说了一些现代前端的历史，那么使用它具体有什么好处呢？</p>
<h3 id="JavaScript-模块化"><a href="#JavaScript-模块化" class="headerlink" title="JavaScript 模块化"></a>JavaScript 模块化</h3><p>仔细想想，我们的 HTML, CSS 和 JavaScript 是如何结合使用的？</p>
<p>是的，我们按照规范分离了 HTML, CSS 和 JavaScript，并在 HTML 中使用 <code>&lt;link /&gt;</code> 和 <code>&lt;scirpt&gt;&lt;/script&gt;</code> 标签引入 CSS 和 JavaScript。那么，不同的 JavaScript 之间如何交互呢？我们只能通过暴露顶级变量（<code>window 作用域</code>）来进行交互。<br>是呀，稍有经验的 JavaScript 开发者都会 <strong>抽取函数</strong>，然而一个 JavaScript 中太多的函数仍然容易产生混乱。</p>
<p>例如下面这段代码，点击不同的按钮，显示不同的面板。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>JavaScript 避免使用 if-else<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;tab&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">data-index</span>=<span class="string">&quot;1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;form-tab-radio&quot;</span> /&gt;</span></span><br><span class="line">          第一个选项卡</span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">data-index</span>=<span class="string">&quot;2&quot;</span> <span class="attr">name</span>=<span class="string">&quot;form-tab-radio&quot;</span> /&gt;</span></span><br><span class="line">          第二个选项卡</span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">data-index</span>=<span class="string">&quot;3&quot;</span> <span class="attr">name</span>=<span class="string">&quot;form-tab-radio&quot;</span> /&gt;</span></span><br><span class="line">          第三个选项卡</span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;extends-form&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/if-else.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// js/if-else.js</span></span><br><span class="line"><span class="built_in">document</span>.querySelectorAll(<span class="string">&#x27;#tab input[name=&quot;form-tab-radio&quot;]&#x27;</span>).forEach(<span class="function">(<span class="params">el</span>) =&gt;</span> &#123;</span><br><span class="line">  el.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> index = el.dataset.index;</span><br><span class="line">    <span class="keyword">const</span> header = el.parentElement.innerText.trim();</span><br><span class="line">    <span class="comment">// 如果为 1 就添加一个文本表单</span></span><br><span class="line">    <span class="keyword">if</span> (index === <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">      <span class="built_in">document</span>.querySelector(<span class="string">&quot;#extends-form&quot;</span>).innerHTML = <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;header&gt;&lt;h2&gt;<span class="subst">$&#123;header&#125;</span>&lt;/h2&gt;&lt;/header&gt;</span></span><br><span class="line"><span class="string">            &lt;div&gt;</span></span><br><span class="line"><span class="string">              &lt;label for=&quot;name&quot;&gt;姓名&lt;/label&gt;</span></span><br><span class="line"><span class="string">              &lt;input type=&quot;text&quot; name=&quot;name&quot; id=&quot;name&quot; /&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;div&gt;</span></span><br><span class="line"><span class="string">              &lt;label for=&quot;age&quot;&gt;年龄&lt;/label&gt;</span></span><br><span class="line"><span class="string">              &lt;input type=&quot;number&quot; name=&quot;age&quot; id=&quot;age&quot; /&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;div&gt;</span></span><br><span class="line"><span class="string">              &lt;button type=&quot;submit&quot;&gt;提交&lt;/button&gt; &lt;button type=&quot;reset&quot;&gt;重置&lt;/button&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">          `</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (index === <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">      <span class="built_in">document</span>.querySelector(<span class="string">&quot;#extends-form&quot;</span>).innerHTML = <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;header&gt;&lt;h2&gt;<span class="subst">$&#123;header&#125;</span>&lt;/h2&gt;&lt;/header&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">          &lt;label for=&quot;avatar&quot;&gt;头像&lt;/label&gt;</span></span><br><span class="line"><span class="string">          &lt;input type=&quot;file&quot; name=&quot;avatar&quot; id=&quot;avatar&quot; /&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;&lt;img id=&quot;avatar-preview&quot; src=&quot;&quot; /&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">          &lt;button type=&quot;submit&quot;&gt;提交&lt;/button&gt; &lt;button type=&quot;reset&quot;&gt;重置&lt;/button&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">      `</span>;</span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">readLocalFile</span>(<span class="params">file</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> fr = <span class="keyword">new</span> FileReader();</span><br><span class="line">          fr.onload = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">            resolve(event.target.result);</span><br><span class="line">          &#125;;</span><br><span class="line">          fr.onerror = <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">            reject(error);</span><br><span class="line">          &#125;;</span><br><span class="line">          fr.readAsDataURL(file);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">document</span>.querySelector(<span class="string">&quot;#avatar&quot;</span>).addEventListener(<span class="string">&quot;change&quot;</span>, <span class="function">(<span class="params">evnet</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> file = evnet.target.files[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (!file) &#123;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!file.type.includes(<span class="string">&quot;image&quot;</span>)) &#123;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        readLocalFile(file).then(<span class="function">(<span class="params">link</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">document</span>.querySelector(<span class="string">&quot;#avatar-preview&quot;</span>).src = link;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (index === <span class="string">&quot;3&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> initData = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">100</span>).fill(<span class="number">0</span>).map(<span class="function">(<span class="params">v, i</span>) =&gt;</span> <span class="string">`第 <span class="subst">$&#123;i&#125;</span> 项内容`</span>);</span><br><span class="line">      <span class="built_in">document</span>.querySelector(<span class="string">&quot;#extends-form&quot;</span>).innerHTML = <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;header&gt;&lt;h2&gt;<span class="subst">$&#123;header&#125;</span>&lt;/h2&gt;&lt;/header&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">          &lt;label for=&quot;search-text&quot;&gt;搜索文本&lt;/label&gt;</span></span><br><span class="line"><span class="string">          &lt;input type=&quot;text&quot; name=&quot;search-text&quot; id=&quot;search-text&quot; /&gt;</span></span><br><span class="line"><span class="string">          &lt;ul id=&quot;search-result&quot;&gt;&lt;/ul&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">      `</span>;</span><br><span class="line">      <span class="built_in">document</span></span><br><span class="line">        .querySelector(<span class="string">&quot;#search-text&quot;</span>)</span><br><span class="line">        .addEventListener(<span class="string">&quot;input&quot;</span>, <span class="function">(<span class="params">evnet</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> searchText = event.target.value;</span><br><span class="line">          <span class="built_in">document</span>.querySelector(<span class="string">&quot;#search-result&quot;</span>).innerHTML = initData</span><br><span class="line">            .filter(<span class="function">(<span class="params">v</span>) =&gt;</span> v.includes(searchText))</span><br><span class="line">            .map(<span class="function">(<span class="params">v</span>) =&gt;</span> <span class="string">`&lt;li&gt;<span class="subst">$&#123;v&#125;</span>&lt;/li&gt;`</span>)</span><br><span class="line">            .join();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>使用现代前端的 JavaScript 模块化重构如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// common.js</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 状态机</span></span><br><span class="line"><span class="comment"> * 用于避免使用 if-else 的一种方式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StateMachine</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">getBuilder</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> clazzMap = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 状态注册器</span></span><br><span class="line"><span class="comment">     * 更好的有限状态机，分离子类与构建的关系，无论子类如何增删该都不影响基类及工厂类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line">      <span class="comment">// noinspection JSMethodCanBeStatic</span></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 注册一个 class，创建子类时调用，用于记录每一个 [状态 =&gt; 子类] 对应</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param </span>state 作为键的状态</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param </span>clazz 对应的子类型</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@returns <span class="type">&#123;*&#125;</span> </span>返回 clazz 本身</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="title">register</span>(<span class="params">state, clazz</span>)</span> &#123;</span><br><span class="line">        clazzMap.set(state, clazz)</span><br><span class="line">        <span class="keyword">return</span> clazz</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// noinspection JSMethodCanBeStatic</span></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取一个标签子类对象</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>state 状态索引</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@returns <span class="type">&#123;QuestionType&#125;</span> </span>子类对象</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="title">getInstance</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> clazz = clazzMap.get(state)</span><br><span class="line">        <span class="keyword">if</span> (!clazz) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//构造函数的参数</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> clazz(...Array.from(<span class="built_in">arguments</span>).slice(<span class="number">1</span>))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> StateMachine</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TabBuilder.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> StateMachine.getBuilder();</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Tab.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tab</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 基类里面的初始化方法放一些通用的操作</span></span><br><span class="line">  <span class="function"><span class="title">init</span>(<span class="params">header</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> html = <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;header&gt;&lt;h2&gt;<span class="subst">$&#123;header&#125;</span>&lt;/h2&gt;&lt;/header&gt;</span></span><br><span class="line"><span class="string">      <span class="subst">$&#123;<span class="built_in">this</span>.initHTML()&#125;</span></span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">    <span class="built_in">document</span>.querySelector(<span class="string">&quot;#extends-form&quot;</span>).innerHTML = html;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 给出一个方法让子类实现，以获得不同的 HTML 内容</span></span><br><span class="line">  <span class="function"><span class="title">initHTML</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Tab;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Tab1.js</span></span><br><span class="line"><span class="keyword">import</span> builder <span class="keyword">from</span> <span class="string">&quot;./TabBuilder.js&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Tab <span class="keyword">from</span> <span class="string">&quot;./Tab&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Tab1 = builder.register(</span><br><span class="line">  <span class="number">1</span>,</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Tab1</span> <span class="keyword">extends</span> <span class="title">Tab</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 实现 initHTML，获得选项卡对应的 HTML</span></span><br><span class="line">    <span class="function"><span class="title">initHTML</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">          &lt;label for=&quot;name&quot;&gt;姓名&lt;/label&gt;</span></span><br><span class="line"><span class="string">          &lt;input type=&quot;text&quot; name=&quot;name&quot; id=&quot;name&quot; /&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">          &lt;label for=&quot;age&quot;&gt;年龄&lt;/label&gt;</span></span><br><span class="line"><span class="string">          &lt;input type=&quot;number&quot; name=&quot;age&quot; id=&quot;age&quot; /&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">          &lt;button type=&quot;submit&quot;&gt;提交&lt;/button&gt; &lt;button type=&quot;reset&quot;&gt;重置&lt;/button&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">      `</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Tab2.js</span></span><br><span class="line"><span class="keyword">import</span> builder <span class="keyword">from</span> <span class="string">&quot;./TabBuilder.js&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Tab <span class="keyword">from</span> <span class="string">&quot;./Tab&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Tab2 = builder.register(</span><br><span class="line">  <span class="number">2</span>,</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Tab2</span> <span class="keyword">extends</span> <span class="title">Tab</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">initHTML</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;label for=&quot;avatar&quot;&gt;头像&lt;/label&gt;</span></span><br><span class="line"><span class="string">        &lt;input type=&quot;file&quot; name=&quot;avatar&quot; id=&quot;avatar&quot; /&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;div&gt;&lt;img id=&quot;avatar-preview&quot; src=&quot;&quot; /&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;button type=&quot;submit&quot;&gt;提交&lt;/button&gt; &lt;button type=&quot;reset&quot;&gt;重置&lt;/button&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">      `</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 重写 init 初始化方法，并首先调用基类通用初始化的方法</span></span><br><span class="line">    <span class="function"><span class="title">init</span>(<span class="params">header</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">super</span>.init(header);</span><br><span class="line">      <span class="built_in">document</span>.querySelector(<span class="string">&quot;#avatar&quot;</span>).addEventListener(<span class="string">&quot;change&quot;</span>, <span class="function">(<span class="params">evnet</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> file = evnet.target.files[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (!file) &#123;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!file.type.includes(<span class="string">&quot;image&quot;</span>)) &#123;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.readLocalFile(file).then(<span class="function">(<span class="params">link</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">document</span>.querySelector(<span class="string">&quot;#avatar-preview&quot;</span>).src = link;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 子类独有方法</span></span><br><span class="line">    <span class="function"><span class="title">readLocalFile</span>(<span class="params">file</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> fr = <span class="keyword">new</span> FileReader();</span><br><span class="line">        fr.onload = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">          resolve(event.target.result);</span><br><span class="line">        &#125;;</span><br><span class="line">        fr.onerror = <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">          reject(error);</span><br><span class="line">        &#125;;</span><br><span class="line">        fr.readAsDataURL(file);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Tab2.js</span></span><br><span class="line"><span class="keyword">import</span> builder <span class="keyword">from</span> <span class="string">&quot;./TabBuilder.js&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Tab <span class="keyword">from</span> <span class="string">&quot;./Tab&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Tab3 = builder.register(</span><br><span class="line">  <span class="number">3</span>,</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Tab3</span> <span class="keyword">extends</span> <span class="title">Tab</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">initHTML</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;label for=&quot;search-text&quot;&gt;搜索文本&lt;/label&gt;</span></span><br><span class="line"><span class="string">        &lt;input type=&quot;text&quot; name=&quot;search-text&quot; id=&quot;search-text&quot; /&gt;</span></span><br><span class="line"><span class="string">        &lt;ul id=&quot;search-result&quot; /&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">init</span>(<span class="params">header</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">super</span>.init(header);</span><br><span class="line">      <span class="keyword">const</span> initData = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">100</span>).fill(<span class="number">0</span>).map(<span class="function">(<span class="params">v, i</span>) =&gt;</span> <span class="string">`第 <span class="subst">$&#123;i&#125;</span> 项内容`</span>);</span><br><span class="line">      <span class="built_in">document</span></span><br><span class="line">        .querySelector(<span class="string">&quot;#search-text&quot;</span>)</span><br><span class="line">        .addEventListener(<span class="string">&quot;input&quot;</span>, <span class="function">(<span class="params">evnet</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> searchText = event.target.value;</span><br><span class="line">          <span class="built_in">document</span>.querySelector(<span class="string">&quot;#search-result&quot;</span>).innerHTML = initData</span><br><span class="line">            .filter(<span class="function">(<span class="params">v</span>) =&gt;</span> v.includes(searchText))</span><br><span class="line">            .map(<span class="function">(<span class="params">v</span>) =&gt;</span> <span class="string">`&lt;li&gt;<span class="subst">$&#123;v&#125;</span>&lt;/li&gt;`</span>)</span><br><span class="line">            .join();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> builder <span class="keyword">from</span> <span class="string">&quot;./TabBuilder.js&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./Tab1&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./Tab2&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./Tab3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.querySelectorAll(<span class="string">&#x27;#tab input[name=&quot;form-tab-radio&quot;]&#x27;</span>).forEach(<span class="function">(<span class="params">el</span>) =&gt;</span> &#123;</span><br><span class="line">  el.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span></span><br><span class="line">    <span class="comment">// 调用方式不变</span></span><br><span class="line">    builder</span><br><span class="line">      .getInstance(<span class="built_in">Number</span>.parseInt(el.dataset.index))</span><br><span class="line">      .init(el.parentElement.innerText.trim())</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>虽然看起来代码/文件变得更多了，然而实际上不同的状态区分更加明显，代码也更容易维护了。</p>
<h3 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h3><p>如果我们想要让传统前端项目兼容 <code>IE11</code>，那么恐怕不得不使用 <code>JQuery</code> 以及 <code>ES5</code> 以前的语法（ES5 也支持的不完全）。如果想要使用 <code>ES6/ES7/ES8</code> 的话恐怕不仅在 IE11 上无法保证兼容性，既便 Web 标准的前沿实现者 Google Chrome，它的旧版本对新特性的支持恐怕也不算好（Google Chrome 开发团队的实力毋庸置疑，然而如果一个标准是在浏览器发布之后才出现的话，旧版本浏览器却是不可能兼容了）。</p>
<blockquote>
<p>附: 最近两年 JavaScript 的标准几乎是一年一个版本，不过都没有再像 <code>ES6</code> 如此激进了</p>
</blockquote>
<p>那么，如果使用现代前端就能解决这个问题了么？是的，它现代前端项目基本上都会引入的一个库 – <a target="_blank" rel="noopener" href="https://babeljs.io/">Babel</a>。</p>
<p>Babel 官网首页用一句话说明了 Babel 的定位</p>
<blockquote>
<p>Babel is a JavaScript compiler.<br>Use next generation JavaScript, today.</p>
</blockquote>
<p>意为：<br><strong>Babel 是一个 JavaScript 编译器。</strong><br><strong>立刻使用下一代 JavaScript。</strong></p>
<p>是的，你没听错，Babel 给自身的定义是 JavaScript 编译器。众所周知，JavaScript 是运行在浏览器上（现在也可以运行在 NodeJS）的解释型弱类型的脚本语言，是没有编译器的。而 Babel 就是帮我们将 ES6 之后的 JavaScript 代码编译成 ES5 的代码，以兼容较旧版本的浏览器。</p>
<p>例如下面的代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(i), <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>会被转换成</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  (<span class="function">(<span class="params">_i</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(_i), <span class="number">0</span>);</span><br><span class="line">    i = _i;</span><br><span class="line">  &#125;)(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然，传统前端不能使用 Babel 了么？答案是可以的，然而因为是在浏览器端编译 JavaScript，所以速度比较慢，具体可以参考吾辈写的 <a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/e73e3322/">在传统项目中使用 babel 编译 ES6</a>。</p>
<h3 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-cn/MVVM">Wiki</a></p>
</blockquote>
<p><code>MVVM</code>（<code>Model–view–viewmodel</code>）是一种软件架构模式。</p>
<p>MVVM 有助于将图形用户界面的开发与业务逻辑或后端逻辑（数据模型）的开发分离开来，这是通过置标语言或 GUI 代码实现的。MVVM 的视图模型是一个值转换器，这意味着视图模型负责从模型中暴露（转换）数据对象，以便轻松管理和呈现对象。在这方面，视图模型比视图做得更多，并且处理大部分视图的显示逻辑。视图模型可以实现中介者模式，组织对视图所支持的用例集的后端逻辑的访问。</p>
<p>说人话就是 MVVM 能让我们不再关心 DOM 的更改，专注于操作数据，DOM 会根据数据自动渲染，我们不再需要关心它。</p>
<p>事实上，我们的不同的代码虽然分离了，但逻辑上却不然，JavaScript 仍然需要操作 DOM 和 Style，而这项工作是非常繁琐而且易错的。<br>曾经我们使用 JQuery 来进行 DOM 交互，同时保证兼容性，以及更好的 Ajax 工具。现在，现代前端的很多框架就是为了解决数据与 DOM 同步的，不管是 <code>React</code> 的 <code>JSX</code>，还是 <code>VueJS</code> 的 <code>单文件组件</code>。</p>
<p><code>JSX</code>：React 的理念是 既然 JavaScript 能够操作 HTML/CSS，那就把所有的控制权交给 JavaScript 就好了，在 React JSX 中，一切都是 JavaScript，即便是 JSX 的 DSL 也只是一个看起来像 HTML 的 JavaScript 代码而已。像下面的代码，事实上就是 JavaScript，直接写 <code>&lt;div&gt;Hello &#123;this.props.name&#125;&lt;/div&gt;</code> 只是语法糖，背后真正运行的还是 JavaScript。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloMessage</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">HelloMessage</span> <span class="attr">name</span>=<span class="string">&quot;Taylor&quot;</span> /&gt;</span></span>, mountNode);</span><br></pre></td></tr></table></figure>
<p>假如使用 vuejs 的话写起来大概是这样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;Hello &#123;name&#125;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#39;HelloWord&#39;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    name: &#123;</span><br><span class="line">      type: String</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> HelloMessage <span class="keyword">from</span> <span class="string">&quot;./HelloMessage&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&quot;#app&quot;</span>,</span><br><span class="line">  components: &#123; HelloMessage &#125;,</span><br><span class="line">  template: <span class="string">&quot;&lt;App/&gt;&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>它们之间的思想有许多共同之处，都推崇组件化开发，把 <code>HTML/CSS/JavaScript</code> 混合起来形成组件（类似于 Java 中将属性和函数封装为类），然后组合成更大的组件，形成组件树，并最终构成 WebApp。吾辈目前推荐先看 VueJS，毕竟是国人开发，中文文档最为完善，在三大前端框架中也属于最简单的一个（ReactJS 是最困难也是生态最好的一个）。</p>
<h3 id="生态丰富"><a href="#生态丰富" class="headerlink" title="生态丰富"></a>生态丰富</h3><p>NPM 的生态相当丰富，现代前端几乎所有的库都通过 NPM 发布。至今，NPM 上已经有超过 70W+ 的包，在数量上甚至远超了 Maven 中央仓库。正是因为 NPM 发布包相当简单（吾辈都发布了几个），造成了如今无比繁荣的生态（想想 Maven 感觉都是泪。。。）</p>
<blockquote>
<p>包管理器对比数据可以参考 <a target="_blank" rel="noopener" href="http://www.modulecounts.com/">http://www.modulecounts.com/</a></p>
</blockquote>
<p>使用 NPM 安装和使用包相当简单，使用 <code>npm i [package]</code> 就能直接安装一个包，使用 ES6 <code>import</code> 语法就能在自己的 JavaScript 文件中快速引用一个包。</p>
<p>下面列出一些常用的 NPM 库</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://yarnpkg.com/">yarn</a>: Facebook 家的前端包管理器</li>
<li><a target="_blank" rel="noopener" href="https://babeljs.io/">babel</a>: 现代前端的 JQuery，解决兼容性</li>
<li><a target="_blank" rel="noopener" href="https://vuejs.org/">vuejs</a>: 华人开发的前端 MVVM 框架</li>
<li><a target="_blank" rel="noopener" href="http://stylus-lang.com/">stylus</a>: CSS 预处理器</li>
<li><a target="_blank" rel="noopener" href="https://eslint.org/">eslint</a>: 前端代码规范检查</li>
<li><a target="_blank" rel="noopener" href="https://webpack.js.org/">webpack</a>: 现代前端必备的打包工具</li>
<li><a target="_blank" rel="noopener" href="https://www.rollupjs.com/">rollup</a>: JavaScript SDK 打包工具</li>
<li><a target="_blank" rel="noopener" href="https://lodash.com/">lodashjs</a>: 流行的函数式工具库</li>
<li><a target="_blank" rel="noopener" href="https://www.axios.com/">axios</a>: 符合 ES6 Promise 风格的 Ajax 库</li>
<li><a target="_blank" rel="noopener" href="https://vuetifyjs.com/">vuetify</a>: 基于 vuejs 的前端 <code>material</code> 风格的 UI 库</li>
<li><a target="_blank" rel="noopener" href="https://github.com/SheetJS/js-xlsx">js-xlsx</a>: 前端 Excel 处理工具</li>
<li><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/debug">debug</a>: debug 日志辅助工具</li>
<li><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/uglify-js">uglifyjs</a>: JavaScript 压缩工具</li>
<li><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/http-server">http-server</a>: 静态 http 服务器</li>
<li><a target="_blank" rel="noopener" href="https://hexo.io/">hexo</a>: 现代前端开发的博客系统</li>
<li><a target="_blank" rel="noopener" href="https://www.highcharts.com/">highcharts</a>: 丰富强大的图表库</li>
<li><a target="_blank" rel="noopener" href="https://masonry.desandro.com/">masonry</a>: 无限滚动瀑布流</li>
<li><a target="_blank" rel="noopener" href="https://highlightjs.org/">highlightjs</a>: 代码高亮</li>
<li><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/rx-util">rx-util</a>: 写 Greasemonkey 脚本时自定义的工具库</li>
<li>还有更多。。。</li>
</ul>
<h3 id="工程化"><a href="#工程化" class="headerlink" title="工程化"></a>工程化</h3><p>现代前端已经和后端类似，将原本混沌的 HTML/CSS/JavaScript 细分为了许多的内容。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">├── dist <span class="comment">// 打包后的静态文件</span></span><br><span class="line">├── .editorconfig <span class="comment">// 编辑器配置</span></span><br><span class="line">├── .eslintrc.js <span class="comment">// eslint 配置格式</span></span><br><span class="line">├── .git <span class="comment">// git 仓库</span></span><br><span class="line">├── .gitignore <span class="comment">// git 忽略文件</span></span><br><span class="line">├── babel.config.js <span class="comment">// babel 配置</span></span><br><span class="line">├── LICENSE <span class="comment">// 许可证</span></span><br><span class="line">├── node_module <span class="comment">// 项目依赖</span></span><br><span class="line">├── package.json <span class="comment">// npm 定义文件</span></span><br><span class="line">├── public <span class="comment">// 一些公共的资源</span></span><br><span class="line">│   ├── favicon.ico</span><br><span class="line">│   └── index.html</span><br><span class="line">├── README.md <span class="comment">// 项目说明</span></span><br><span class="line">├── src <span class="comment">// 源代码目录</span></span><br><span class="line">│   ├── App.vue <span class="comment">// 根组件</span></span><br><span class="line">│   ├── main.js <span class="comment">// 项目入口</span></span><br><span class="line">│   ├── api <span class="comment">// api 接口，和 views 中的文件夹对应</span></span><br><span class="line">│   ├── components <span class="comment">// 公共的组件</span></span><br><span class="line">│   ├── plugins <span class="comment">// vuejs 插件</span></span><br><span class="line">│   │   └── vuetify.js</span><br><span class="line">│   ├── router <span class="comment">// vuejs 路由管理</span></span><br><span class="line">│   │   └── index.js</span><br><span class="line">│   ├── store <span class="comment">// vuejs 状态管理</span></span><br><span class="line">│   │   └── index.js</span><br><span class="line">│   ├── utils <span class="comment">// 工具函数</span></span><br><span class="line">│   └── views <span class="comment">// 各个页面</span></span><br><span class="line">├── tests</span><br><span class="line">│   └── unit <span class="comment">// 单元测试</span></span><br><span class="line">│       ├── .eslintrc.js</span><br><span class="line">│       └── example.spec.js</span><br><span class="line">├── vue.config.js <span class="comment">// vuejs 的配置</span></span><br><span class="line">└── yarn.lock <span class="comment">// yarn 配置文件</span></span><br></pre></td></tr></table></figure>
<p>当初第一次看到这个目录时真是被吓到了，使用 <code>yarn</code> 一下子 20000 个依赖文件就下载下来了。然而其实这只是将传统前端分的更细一点而已，对后期维护的好处也是不言而喻的。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总而言之，现代前端流行之后，前后端分离已然是大势所趋，前端开发如果还仅仅是 <strong>切图仔</strong> 的话，迟早会因为跟不上时代而被淘汰。就吾辈而言，亦希望有更多人入坑现代前端，体会现代前端的强大!</p>
<blockquote>
<p>附：吾辈个人而言认为现代前端主要的优势 <a href="#JavaScript-%E6%A8%A1%E5%9D%97%E5%8C%96">模块化</a>/<a href="%E5%B7%A5%E7%A8%8B%E5%8C%96">工程化</a> 和 <a href="#MVVM">MVVM</a>。前者使大型 WebApp 的开发变成可能，后者则改变了数据与 DOM 之间的交互方式。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/b11f3c6f1486497f9f07a08e885be6ec/" data-id="ckmcqox5o00c70kuv7b7kfr29" data-title="为什么要用现代前端" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9D%82%E8%B0%88/" rel="tag">杂谈</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-b3d6d618a14348a5aa2542fcdf0a308a" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/b3d6d618a14348a5aa2542fcdf0a308a/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/b3d6d618a14348a5aa2542fcdf0a308a/">2018 React Redux 入门教程</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>吾辈已转 mobx，放弃使用 redux 了。<br><a target="_blank" rel="noopener" href="http://www.superbug.me/2018/02/06/react-redux-tutorial-for-beginners-learning-redux-in-2018/">译文链接</a>, <a target="_blank" rel="noopener" href="https://www.codementor.io/valentino/react-redux-tutorial-for-beginners-learning-redux-in-2018-fek71ojgh">原文链接</a><br>老实说学习 Redux 真的很有挫败感，虽然 Redux 的源码很小（&lt; 2kb），然而其文档却庞大无比，老实说让人害怕！即便吾辈看了阮一峰写的 <a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html">Redux 入门教程</a>，然而还是在第二篇就 GG 了。纵然了解了概念，然而却不知如何使用，便是如此了。。。这篇翻译过来的教程吾辈感觉还不错，所以也便是转发一下好啦<br>吾辈也跟着教程写了一个 <a target="_blank" rel="noopener" href="https://github.com/rxliuli/react-start/tree/dev/src/components/redux">Redux Demo</a>，仅供参考。</p>
</blockquote>
<p>我希望这是学习 React Redux 最简单的入门教程。</p>
<p>我一开始学习 Redux 的时候我想找到最浅显易懂的入门教程。</p>
<p>尽管有大量的资源，但是我对于 Redux 的一些概念依旧搞不清楚。</p>
<p>我知道什么是 state ，但是 actions， action creators 和 reducers 又是什么鬼？我被搞晕掉了。</p>
<p>然后我也搞不明白 React 和 Redux 是怎样结合起来的。</p>
<p>前端时间开始着手写 React Redux 教程的过程中我理解了许多。</p>
<p>我通过写这篇教程自学 Redux 的基本概念。我也希望这可以帮助所有正在学习 React 和 Redux 的人。</p>
<h2 id="适用人群"><a href="#适用人群" class="headerlink" title="适用人群"></a>适用人群</h2><p>如果满足下列条件，那么本教程正是你要找的：</p>
<ul>
<li>良好的 Javascript, ES6, React 基础</li>
<li>你希望以最简单的方式学习 Redux</li>
</ul>
<h2 id="你可以学到什么"><a href="#你可以学到什么" class="headerlink" title="你可以学到什么"></a>你可以学到什么</h2><p>通过这篇教程你可以学到：</p>
<ul>
<li>Redux 是什么</li>
<li>怎样结合 React 使用 Redux</li>
</ul>
<h2 id="搭建-React-开发环境"><a href="#搭建-React-开发环境" class="headerlink" title="搭建 React 开发环境"></a>搭建 React 开发环境</h2><p>看这篇教程你需要有扎实的 Javascript, ES6, React 基础。</p>
<p>开始之前，让我们来简单搭建一个 React 开发环境。</p>
<p>你可以选择 webpack 3 或者 Parcel。</p>
<p>如果选用 Parcel 你可以参考这个链接 Setting up React with Parcel ，或者从我的 Github 上克隆仓库：</p>
<p>git clone <a href="mailto:&#x67;&#x69;&#116;&#64;&#x67;&#105;&#x74;&#104;&#117;&#x62;&#46;&#x63;&#x6f;&#109;">&#x67;&#x69;&#116;&#64;&#x67;&#105;&#x74;&#104;&#117;&#x62;&#46;&#x63;&#x6f;&#109;</a>:valentinogagliardi/minimal-react-parcel.git</p>
<p>如果你想用 webpack 3 可以参考这个教程 How to set up React, Webpack 3, and Babel ，或者从我的 Github 上克隆仓库：</p>
<p><code>git clone git@github.com:valentinogagliardi/minimal-react-webpack.git</code></p>
<h2 id="什么是-state-？"><a href="#什么是-state-？" class="headerlink" title="什么是 state ？"></a>什么是 state ？</h2><p>理解 Redux 之前你首先需要理解什么是 state 。</p>
<p>如果你曾经写过 React 的 state , 应该不足为奇。</p>
<p>我猜你应该写过如下的 React 状态组件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExampleComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      articles: [</span><br><span class="line">        &#123; <span class="attr">title</span>: <span class="string">&quot;React Redux Tutorial for Beginners&quot;</span>, <span class="attr">id</span>: <span class="number">1</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">title</span>: <span class="string">&quot;Redux e React: cos&#x27;è Redux e come usarlo con React&quot;</span>, <span class="attr">id</span>: <span class="number">2</span> &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; articles &#125; = <span class="built_in">this</span>.state;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">        &#123;articles.map(<span class="function">(<span class="params">el</span>) =&gt;</span> (</span><br><span class="line">          &lt;li key=&#123;el.id&#125;&gt;&#123;el.title&#125;&lt;/li&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述组件是基于 Javascript ES6 class 的。</p>
<p>每个 React 状态组件持有自己的 state 。在 React 中 state 持有数据。组件渲染这组数据展示给用户。</p>
<p>React 提供了一个 setState 方法来更新组件内部的 state 。</p>
<p>我们通常这么用：</p>
<ol>
<li> 从组件内部持有的 state 中获取数据渲染</li>
<li> 通过 React 的 setState 方法更新 state</li>
</ol>
<h2 id="Redux-解决了什么问题-？"><a href="#Redux-解决了什么问题-？" class="headerlink" title="Redux 解决了什么问题 ？"></a>Redux 解决了什么问题 ？</h2><p>应用规模比较小的时候，在 React 组件内部维护 state 很方便。</p>
<p>但在复杂一点的业务场景下这么做就不太合适了。组件中会填满各种管理更新 state 的方法，臃肿不堪。前端不应该知道业务逻辑。</p>
<p>那么，有没有其它管理 state 的方式呢？Redux 就是其中的一个解决方案。</p>
<p>Redux 解决了一开始我们可能还不太清楚的问题：它为每一个 React 组件明确提供它所需要的 state 。</p>
<p>Redux 统一在一个地方维护 state 。</p>
<p>通过 Redux ，获取和管理 state 的逻辑也和 React 隔离开来。</p>
<p>这中方式的好处可能还不太明显。当你用上它后就会发现它的威力。</p>
<p>下一节内容我们聊一下为什么以及什么时候我们需要用 Redux。</p>
<h2 id="我要学-Redux-么-？"><a href="#我要学-Redux-么-？" class="headerlink" title="我要学 Redux 么 ？"></a>我要学 Redux 么 ？</h2><p>想学习 Redux 但是没搞定？</p>
<p>Redux 的确吓坏了许多初学者。但是不必因此而感到担心。</p>
<p>Redux 没有那么难。关键是：不要随波逐流地去使用它。</p>
<p>你开始学习 Redux 应该是出于自发的动机和热情。</p>
<p>我学习 Redux 是因为：</p>
<p>我 100% 地渴望知道 Redux 是怎么工作的<br>我想要提升我的 React 技能<br>我想成为更牛 X 的 React 开发者<br>React/Redux 当下是黄金组合<br>Redux 是一种思想，它和框架无关。学习了它可以在任何地方（比如 Vue JS，Angular 中）使用。</p>
<h2 id="我要用-Redux-么-？"><a href="#我要用-Redux-么-？" class="headerlink" title="我要用 Redux 么 ？"></a>我要用 Redux 么 ？</h2><p>没有 Redux 构建复杂的 React 应用也是可行的。只是有一些成本。</p>
<p>用 Redux 也是有一定成本的：它加入了另外一个抽象层。但是我我认为是利大于弊的。</p>
<p>另一个困惑初学者的问题是：我怎么判断什么时候我需要使用 Redux 呢？</p>
<p>如果你没有经验判定是否需要用 Redux 来管理 state ，我有如下建议使用的场景：</p>
<p>多个 React 组件需要访问同一个 state 但是又没有父子关系<br>需要通过 props 向下向多个组件传递 state</p>
<p>如果还是找不到感觉，别怕，我也一样。</p>
<p>Dan Abramov 说过『 Flux 就像眼镜：你需要的时候你自然会知道 』。</p>
<p>事实上对于我而言也正是如此。</p>
<p>Dan Abramov 写了篇很棒的文章来帮助我们理解： Redux 的使用场景</p>
<p>dev.to 上也有一篇 Dan 关于这一问题的 讨论</p>
<p>看一下 Mark Erikson 整理的 Redux 学习资源</p>
<p>顺便说下，Mark 的博客被视为 Redux 的最佳实践</p>
<p>Dave Ceddia 也分享过关于 Redux 干了什么？以及它的使用场景 的话题。</p>
<p>在深入学习之前，花些时间去搞明白 Redux 解决了什么问题。然后再决定要不要学。</p>
<p>要清楚在小型的应用中使用 Redux 没什么好处。只有在大型应用下才能发挥它的威力。但不管如此，学习 Redux 解决问题的思路总不是什么坏事。</p>
<p>下一节，我们介绍一下内容：</p>
<p>Redux 的基本原则<br>Redux 和 React 怎么结合</p>
<h2 id="了解-Redux-store"><a href="#了解-Redux-store" class="headerlink" title="了解 Redux store"></a>了解 Redux store</h2><p>Actions， Reducers 我都知道。但有件事我搞不明白：这些动态的片段是怎么结合到一起的？</p>
<p>有小黄人相助不成？</p>
<p>是 store 把所有流动的片段协调地结合到 Redux 中。在 Redux 中 store 就像人类的大脑：这是种魔法。</p>
<p>Redux store 是一切的基础：整个应用的 state 都在 store 中维护。</p>
<p>如果我们把 Redux 的工作模式想象成人类的大脑。 state 就相当于存在于大脑（store）中的一段回忆。</p>
<p>所以开始使用 Redux 的时候我们需要创建一个 store 来存放 state。</p>
<p>切换到你的开发目录，安装 Redux：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> minimal-react-webpack/</span><br><span class="line"></span><br><span class="line">npm i redux --save-dev</span><br></pre></td></tr></table></figure>
<p>创建一个目录来存放 store 相关逻辑：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p src/js/store</span><br></pre></td></tr></table></figure>
<p>在 src/js/store 中创建 index.js 并初始化：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/js/store/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&quot;redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> rootReducer <span class="keyword">from</span> <span class="string">&quot;../reducers/index&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(rootReducer);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>
<p>createStore 就是创建 Redux store 的方法。</p>
<p>createStore 接收一个 reducer 作为第一个参数，就是代码中的 rootReducer。</p>
<p>你也可以传递一个初始 state 进 createStore。 但是大多数时候你不必这么做。传递初始 state 在服务端渲染时比较有用。当然，state 来自 reducers。</p>
<p>现在我们知道 reducer 做了啥了。reducer 生成了 state 。 state 并不是手动创建的。</p>
<p>带着这些概念我们继续我们第一个 Redux reducer。</p>
<h2 id="了解-Redux-reducers"><a href="#了解-Redux-reducers" class="headerlink" title="了解 Redux reducers"></a>了解 Redux reducers</h2><p>初始 state 在 服务端渲染 中很有用，它必须完全从 reducers 中产生。</p>
<p>reducer 是个什么鬼？</p>
<p>reducer 就是个 javascript 函数。它接收两个参数：当前的 state 和 action 。</p>
<p>Redux 的第三条原则中强调：state 必须是不可变的。这也是为什么 reducer 必须是一个纯函数。纯函数就是指给有明确的输入输出的函数。</p>
<p>在传统的 React 应用中我们通过 setState 方法来改变 state 。 在 Redux 中不可以这么做。</p>
<p>创建一个 reducer 不难，就是个包含两个参数的 javascript 普通函数。</p>
<p>在我们的例子中，我们将创建一个简单的 reducer， 并向他传递初始 state 作为第一个参数。第二个参数我们将提供一个 action 。到目前为止 reducer 除了返回初始状态什么都不会做。</p>
<p>创建 reducer 根目录</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p src/js/reducers</span><br></pre></td></tr></table></figure>
<p>然后在 src/js/reducers 创建一个名为 index.js 的新文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/js/reducers/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  articles: [],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootReducer = <span class="function">(<span class="params">state = initialState, action</span>) =&gt;</span> state;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducer;</span><br></pre></td></tr></table></figure>
<p>我承诺这是篇尽可能简明的教程。所以我们仅有一个 reducer ：它除了返回初始 state 什么都不处理。</p>
<p>注意下初始 state 是怎样作为 默认参数 传递的。</p>
<p>下一节我们将结合一个 action 来让这个应用更加有趣。</p>
<h2 id="了解-Redux-actions"><a href="#了解-Redux-actions" class="headerlink" title="了解 Redux actions"></a>了解 Redux actions</h2><p>reducers 无疑是 Redux 中最重要的概念。reducers 用来生产应用的 state 。</p>
<p>但是 reducers 怎么知道什么时候去生产下一个 state 呢？</p>
<p>Redux 的第二条原则中说：改变 state 的唯一方式就是向 store 发送一个信号 。 这个 信号 指的就是 action 。</p>
<p>怎么改变这个不可更改的状态呢？你不能。返回的 state 是当前 state 的副本结合新数据后的一个全新的 state 。这点必须要明确。</p>
<p>比较欣慰的是 actions 就是简单的 javascript 对象。它长这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type: ‘ADD_ARTICLE’,</span><br><span class="line"></span><br><span class="line">payload: &#123; <span class="attr">name</span>: ‘React Redux Tutorial <span class="keyword">for</span> Beginners’, <span class="attr">id</span>: <span class="number">1</span> &#125;</span><br></pre></td></tr></table></figure>
<p>每一个 action 都要有一个 type 属性来描述要对 state 做怎样的改变。</p>
<p>你也可以指定一个叫 payload 的属性。在上面的例子中， payload 指代一篇新的文章。reducer 接下来将把这篇新文章加到 state 中去。</p>
<p>最佳实践是将每一个 action 都通过函数包裹起来。这个函数就是 action creator。</p>
<p>让我们来把这些都串起来创建一个简单的 action 。</p>
<p>创建 actions 目录：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p src/js/actions</span><br></pre></td></tr></table></figure>
<p>在 src/js/actions 目录中创建名为 index.js 的文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/js/actions/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addArticle = <span class="function">(<span class="params">article</span>) =&gt;</span> (&#123;</span><br><span class="line">  type: <span class="string">&quot;ADD_ARTICLE&quot;</span>,</span><br><span class="line">  payload: article,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>type 属性就是个简单的字符串。reducer 将根据这个字符串决定怎么处理生成下一个 state 。</p>
<p>由于字符串很容易重复产生冲突，所以最好在常量中统一定义 action types 。</p>
<p>这个方法可以避免一些很难排查的错误。</p>
<p>创建一个新目录：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p src/js/constants</span><br></pre></td></tr></table></figure>
<p>然后在 src/js/constants 目录下创建名为 action-types.js 的文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/js/constants/action-types.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ADD_ARTICLE = <span class="string">&quot;ADD_ARTICLE&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>然后打开 src/js/actions/index.js 用常量来替换字符串：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/js/actions/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; ADD_ARTICLE &#125; <span class="keyword">from</span> <span class="string">&quot;../constants/action-types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addArticle = <span class="function">(<span class="params">article</span>) =&gt;</span> (&#123;</span><br><span class="line">  type: ADD_ARTICLE,</span><br><span class="line"></span><br><span class="line">  payload: article,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>我们进一步完成了一个可运行的 Redux 应用。 接下来让我们重构下我们的 reducer 吧！</p>
<h2 id="重构-reducer"><a href="#重构-reducer" class="headerlink" title="重构 reducer"></a>重构 reducer</h2><p>进入下一步之前，让我们总结一下 Redux 的主要概念：</p>
<p>Redux store 就像大脑：它负责将所有流动的片段有机地整合进 Redux 中<br>应用中的 state 在 store 中以唯一且不可变对象的形式存在<br>一旦 store 接收到一个 action 他就会触发一个 reducer<br>reducer 返回下一个 state</p>
<p>reducer 是怎样构成的？</p>
<p>reducer 是一个 javascript 函数，它接收两个参数：state 和 action。</p>
<p>reducer 一般会包含一个 switch 语句（傻一点的话也可以用：if /else）。</p>
<p>reducer 根据 action type 产生下一个 state 。此外，当没有匹配到 action type 时它至少也要返回初始 state 。</p>
<p>当 action type 匹配到一个 case 分支的时候， reducer 将计算下一个 state 并返回一个全新的对象。下面是个例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// …</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">  <span class="keyword">case</span> ADD_ARTICLE:</span><br><span class="line">    <span class="keyword">return</span> &#123; ...state, <span class="attr">articles</span>: [...state.articles, action.payload] &#125;;</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// …</span></span><br></pre></td></tr></table></figure>
<p>我们之前创建的 reducer 只返回了初始 state 什么都没做。让我们做点什么。</p>
<p>打开 src/js/reducers/index.js 按如下例子更新 reducer:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ADD_ARTICLE &#125; <span class="keyword">from</span> <span class="string">&quot;../constants/action-types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  articles: [],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootReducer = <span class="function">(<span class="params">state = initialState, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> ADD_ARTICLE:</span><br><span class="line">      <span class="keyword">return</span> &#123; ...state, <span class="attr">articles</span>: state.articles.push(action.payload) &#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducer;</span><br></pre></td></tr></table></figure>
<p>发现了什么？</p>
<p>尽管代码逻辑没有错，但这违背了 Redux 的主要原则： 不可变 。</p>
<p><code>Array.prototype.push</code> 不是一个纯函数，它改变了原来的数组。</p>
<p>解决的方式很简单。用 <code>Array.prototype.concat</code> 替换 <code>Array.prototype.push</code> 来保持原始数组是不可变的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ADD_ARTICLE &#125; <span class="keyword">from</span> <span class="string">&quot;../constants/action-types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  articles: [],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootReducer = <span class="function">(<span class="params">state = initialState, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> ADD_ARTICLE:</span><br><span class="line">      <span class="keyword">return</span> &#123; ...state, <span class="attr">articles</span>: state.articles.concat(action.payload) &#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducer;</span><br></pre></td></tr></table></figure>
<p>还不够！可以用 扩展运算符 优化一下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ADD_ARTICLE &#125; <span class="keyword">from</span> <span class="string">&quot;../constants/action-types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  articles: [],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootReducer = <span class="function">(<span class="params">state = initialState, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> ADD_ARTICLE:</span><br><span class="line">      <span class="keyword">return</span> &#123; ...state, <span class="attr">articles</span>: [...state.articles, action.payload] &#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducer;</span><br></pre></td></tr></table></figure>
<p>上述例子中初始 state 完全没受干扰。</p>
<p>最初的文章数组并没有改变。</p>
<p>初始 state 对象也没有改变。返回的 state 是初始 state 的一个副本。</p>
<p>在 Redux 中有两个关键点来防止类似的改变。</p>
<p>针对数组可以用 concat (), slice (), 和 … 操作符<br>针对对象可以用 Object.assign () and … 操作符</p>
<p>扩展运算符 在 webpack 3 中还是个实验性功能。需要安装一个 babel 插件来防止语法错误：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i —save-dev babel-plugin-transform-object-rest-spread</span><br></pre></td></tr></table></figure>
<p>打开 .babelrc 更改配置：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;presets&quot;</span>: [<span class="string">&quot;env&quot;</span>, <span class="string">&quot;react&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;plugins&quot;</span>: [<span class="string">&quot;transform-object-rest-spread&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>小贴士： reducer 随着应用的增长会变得臃肿。你可以拆分 reducer 进不同的函数，然后通过 combineReducers 将他们结合起来。</p>
<p>下一节我们将通过 console 控制台把玩一下 Redux 。搞起！</p>
<h2 id="Redux-store-中的方法"><a href="#Redux-store-中的方法" class="headerlink" title="Redux store 中的方法"></a>Redux store 中的方法</h2><p>这节内容将会很快过完，我保证。</p>
<p>我想借助浏览器的控制台让你快速理解下 Redux 是怎样工作的。</p>
<p>Redux 本身是一个很小的类库 （2KB）。它暴露了 一些简单的 API 让我们来管理 state 。其中最重要的方法就是：</p>
<ul>
<li>getState 用于获取应用的 state</li>
<li>dispatch 用于触发一个 action</li>
<li>subscribe 用于监听 state 的变化</li>
</ul>
<p>我们将借助浏览器的管理控制台试验上述方法。</p>
<p>我们需要创建全局变量将我们先前创建的 store 和 action 暴露出来。</p>
<p>打开 src/js/index.js 按如下所示更新代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;../js/store/index&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; addArticle &#125; <span class="keyword">from</span> <span class="string">&quot;../js/actions/index&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.store = store;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.addArticle = addArticle;</span><br></pre></td></tr></table></figure>
<p>然后运行一下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure>
<p>在浏览器中打开 <a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080/</a> 并按 F12 打开管理控制台。</p>
<p>由于我们全局暴露了 store ， 所以我们可以进入它的方法。试一下！</p>
<p>首先访问当前 state:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">store.getState();</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;articles: Array(0)&#125;</span><br></pre></td></tr></table></figure>
<p>没有文章。事实上我们还没有更新初始 state 。</p>
<p>让这变得更有趣些我们可以通过 subscribe 方法监听 state 的变化。</p>
<p>subscribe 方法接收一个回调函数，当 action 触发的时候该回调函数就会执行。触发 action 就意味着通知 store 我们想改变 state 。</p>
<p>通过如下操作注册回调函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">store.subscribe(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;Look ma, Redux!!&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>要想改变 state 我们需要触发一个 action 。要触发一个 action 我们就需要调用 dispatch 方法 。</p>
<p>我们已经有了一个 action ：addArticle 用来向 state 中新增文章。</p>
<p>让我们触发一下这个 action ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">store.dispatch( addArticle(&#123; <span class="attr">name</span>: ‘React Redux Tutorial <span class="keyword">for</span> Beginners’, <span class="attr">id</span>: <span class="number">1</span> &#125;))</span><br></pre></td></tr></table></figure>
<p>执行上述代码后你将看到：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Look ma, Redux!!</span><br></pre></td></tr></table></figure>
<p>验证一下 state 有没有变：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">store.getState();</span><br></pre></td></tr></table></figure>
<p>输出会是：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;articles: Array(1)&#125;</span><br></pre></td></tr></table></figure>
<p>这就是个最简单的 Redux 原型。</p>
<p>难么？</p>
<p>稍微花点时间练习一下 Redux 的三个方法。在控制台中玩一把：</p>
<ul>
<li>getState 用于获取应用的 state</li>
<li>dispatch 用于触发一个 action</li>
<li>subscribe 用于监听 state 的变化</li>
</ul>
<p>这就是开始入坑所需要知道的全部内容。</p>
<p>有信心进入下一步了么？让我们把 React 和 Redux 串起来吧。</p>
<h2 id="把-React-和-Redux-结合起来"><a href="#把-React-和-Redux-结合起来" class="headerlink" title="把 React 和 Redux 结合起来"></a>把 React 和 Redux 结合起来</h2><p>学习了 Redux 后我发现它并没有想象中那么复杂。</p>
<p>我知道我可以通过 getState 方法获取当前 state ；通过 dispatch 触发一个 action ； 通过 subscribe 监听 state 的变化。</p>
<p>目前我还不知道怎么将 React 和 Redux 组合起来使用。</p>
<p>我问自己：我需要在 React component 中调用 getState 方法么？ 在 React component 我怎么去触发 action ？ 等等一些列问题。</p>
<p>Redux 是框架无关的。你可以在纯 Javascript 中使用它。或者结合 Angular，Redux 一起使用。 有许多第三方库可以实现把 Redux 和任何你喜欢的框架结合起来使用。</p>
<p>对于 React 而言， react-redux 就是这么一个第三方库。</p>
<p>首先让我们通过下面的命令安装一下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i react-redux —save-dev</span><br></pre></td></tr></table></figure>
<p>为了演示 React 和 Redux 是如何协同工作的，我们将构建一个超级简单的应用。这个应用由如下组件组成：</p>
<ul>
<li>一个 App 组件</li>
<li>一个展示文章的 List 组件</li>
<li>一个新增文章的 Form 组件</li>
</ul>
<p>（这是个玩具应用，仅仅用来展示文章列表，新增文章条目。但是可以算一个学习 Redux 不错的开端。）</p>
<h2 id="react-redux"><a href="#react-redux" class="headerlink" title="react-redux"></a>react-redux</h2><p>react-redux 是一个 React 和 Redux 绑定库。这个类库将 React 和 Redux 高效地连接起来。</p>
<p>react-redux 的 connect 方法做了什么呢？ 毫无疑问是将 React 的组件和 Redux 的 store 连接起来了。</p>
<p>你可以根据需要向 connect 方法传递两个或者三个参数。需要知道的最基本的东西就是：</p>
<ul>
<li>mapStateToProps 函数</li>
<li>mapDispatchToProps 函数</li>
</ul>
<p>react-redux 中 mapStateToProps 做了什么呢？就像它的名字一样：它将部分 Redux state 和 React 组件中的 Props 连接了起来。通过这层连接，React 组件就可以从 store 中获取它所需要的 state 了。</p>
<p>react-redux 中 mapDispatchToProps 又做了什么呢？和 mapStateToProps 类似，只不过它是连接的 actions 。它将 部分 Redux action 和 React 组件中的 Props 连接了起来。通过这层连接，React 组件就可以从触发 actions 了。</p>
<p>都清楚了么？如果没有，停下来重读一遍。我知道许多内容需要时间消化。我要着急，早晚会搞明白的。</p>
<p>接下来的部分我们就要大显生手了！</p>
<h2 id="App-组件-和-Redux-store"><a href="#App-组件-和-Redux-store" class="headerlink" title="App 组件 和 Redux store"></a>App 组件 和 Redux store</h2><p>我们知道 mapStateToProps 将部分 Redux state 和 React 组件中的 Props 连接了起来。你可能想问：连接 React 和 Redux 这么做就够了吗？不，还不够。</p>
<p>要连接 React 和 Redux 我们还要用到 Provider。</p>
<p>Provider 是 react-redux 提供的一个高阶组件。</p>
<p>直白地说，就是 Provider 将整个 React 应用封装起来，是它能够感知到整个 Redux store 的存在。</p>
<p>为什么这么做？我们知道在 Redux 中 store 管理着一切。React 必须通过 store 来访问 state ， 触发 actions 。</p>
<p>了解了以上这些，就打开 src/js/index.js ，修改如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;../js/store/index&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;../js/components/App&quot;</span>;</span><br><span class="line">render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;/Provider&gt;,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>看到没有？Provider 将整个应用包裹起来。并将 store 作为属性传入。</p>
<p>现在让我们创建一个 App 组件。没什么特别的：App 组件导入一个 List 组件并渲染。</p>
<p>创建一个目录来存放组件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p src/js/components</span><br></pre></td></tr></table></figure>
<p>在 src/js/components 目录下创建名为 App.js 的文件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/js/components/App.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> List <span class="keyword">from</span> <span class="string">&quot;./List&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> Articles;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p>花时间看下组件的构成：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> List <span class="keyword">from</span> <span class="string">&quot;./List&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">List</span> /&gt;</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p>然后继续创建 List 组件。</p>
<p>List 组件 和 Redux state</p>
<p>目前为止我们没做特殊的操作。</p>
<p>但是 List 组件需要和 Redux store 产生交互。</p>
<p>简单总结一下：连接 React 组件 和 Redux 的关键就是 connect 方法。</p>
<p>Connect 方法接收至少一个参数。</p>
<p>由于我们想让 List 获取文章列表，因此我们需要让 state.articles 和组件连接起来。怎么做呢？用 mapStateToProps 参数来实现。</p>
<p>在 src/js/components 目录下创建名为 List.js 的文件。写入如下内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/js/components/List.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">articles</span>: state.articles &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> ConnectedList = <span class="function">(<span class="params">&#123; articles &#125;</span>) =&gt;</span> (</span><br><span class="line">  &lt;ul className=<span class="string">&quot;list-group list-group-flush&quot;</span>&gt;</span><br><span class="line">    &#123;articles.map(<span class="function">(<span class="params">el</span>) =&gt;</span> (</span><br><span class="line">      &lt;li className=<span class="string">&quot;list-group-item&quot;</span> key=&#123;el.id&#125;&gt;</span><br><span class="line">        &#123;el.title&#125;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">    ))&#125;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">);</span><br><span class="line"><span class="keyword">const</span> List = connect(mapStateToProps)(ConnectedList);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> List;</span><br></pre></td></tr></table></figure>
<p>List 组件接收一个名为 articles 的属性， 它是一个 articles 数组的副本。这个数组寄生于我们之前创建的 Redux state 内。它来自 reducer :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  articles: [],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootReducer = <span class="function">(<span class="params">state = initialState, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> ADD_ARTICLE:</span><br><span class="line">      <span class="keyword">return</span> &#123; ...state, <span class="attr">articles</span>: [...state.articles, action.payload] &#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>然后我们就可以用这个属性在 JSX 中生成一个文章列表了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  articles.map(<span class="function">(<span class="params">el</span>) =&gt;</span> (</span><br><span class="line">    &lt;li className=<span class="string">&quot;list-group-item&quot;</span> key=&#123;el.id&#125;&gt;</span><br><span class="line">      &#123;el.title&#125;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  ));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>小提示</strong> 可以用 React PropTypes 对属性进行校验。</p>
<p>最后组件被导出为 List。List 是无状态组件和 Redux store 连接之后的产物。</p>
<p>无状态组件没有内部 state 。数据是通过属性传入的。</p>
<p>依旧很困惑？我也是。理解 connect 的工作原理需要花点时间。别害怕，慢慢来。</p>
<p>我建议你停下来花点时间看下 connect 和 mapStateToProps 。</p>
<p>搞懂了我们就进入下一章的学习。</p>
<h2 id="Form-组件-和-Redux-actions"><a href="#Form-组件-和-Redux-actions" class="headerlink" title="Form 组件 和 Redux actions"></a>Form 组件 和 Redux actions</h2><p>Form 组件比 List 组件稍微复杂一点。它是用于创建文章的表单。</p>
<p>另外它是一个状态组件。</p>
<p>状态组件是指在组件内部维护自身 state 的组件 。</p>
<p>状态组件？我们一直说要用 Redux 来管理 state 。 为什么现在又说要让 Form 自己去维护 state ?</p>
<p>即使在使用 Redux 的时候，使用有状态的组件也是完全可以的，两者并不冲突。</p>
<p>并不是所有的 state 都必须在 Redux 中管理。</p>
<p>在这个例子中我不想其他任何组件知道 Form 组件内部的 state 。</p>
<p>这么做很好。</p>
<p>这个组件做什么事呢？</p>
<p>该组件包含了一些在表单提交时更新本地 state 的逻辑。</p>
<p>另外它接收一个 Redux action 作为属性传入其中。用这种方式它可以通过触发 addArticle action 来更新全局的 state。</p>
<p>在 src/js/components 下建一个名为 Form.js 的文件。它看起来像下面这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/js/components/Form.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> uuidv1 <span class="keyword">from</span> <span class="string">&quot;uuid&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; addArticle &#125; <span class="keyword">from</span> <span class="string">&quot;../actions/index&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    addArticle: <span class="function">(<span class="params">article</span>) =&gt;</span> dispatch(addArticle(article)),</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConnectedForm</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      title: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">this</span>.handleChange = <span class="built_in">this</span>.handleChange.bind(<span class="built_in">this</span>);</span><br><span class="line">    <span class="built_in">this</span>.handleSubmit = <span class="built_in">this</span>.handleSubmit.bind(<span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">handleChange</span>(<span class="params">event</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123; [event.target.id]: event.target.value &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">handleSubmit</span>(<span class="params">event</span>)</span> &#123;</span><br><span class="line">    event.preventDefault();</span><br><span class="line">    <span class="keyword">const</span> &#123; title &#125; = <span class="built_in">this</span>.state;</span><br><span class="line">    <span class="keyword">const</span> id = uuidv1();</span><br><span class="line">    <span class="built_in">this</span>.props.addArticle(&#123; title, id &#125;);</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123; <span class="attr">title</span>: <span class="string">&quot;&quot;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; title &#125; = <span class="built_in">this</span>.state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;form onSubmit=&#123;<span class="built_in">this</span>.handleSubmit&#125;&gt;</span><br><span class="line">        &lt;div className=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">          &lt;label htmlFor=<span class="string">&quot;title&quot;</span>&gt;Title&lt;/label&gt;</span><br><span class="line"></span><br><span class="line">          &lt;input</span><br><span class="line">            type=<span class="string">&quot;text&quot;</span></span><br><span class="line">            className=<span class="string">&quot;form-control&quot;</span></span><br><span class="line">            id=<span class="string">&quot;title&quot;</span></span><br><span class="line">            value=&#123;title&#125;</span><br><span class="line">            onChange=&#123;<span class="built_in">this</span>.handleChange&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;button type=<span class="string">&quot;submit&quot;</span> className=<span class="string">&quot;btn btn-success btn-lg&quot;</span>&gt;</span><br><span class="line">          SAVE</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/form&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Form = connect(<span class="literal">null</span>, mapDispatchToProps)(ConnectedForm);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Form;</span><br></pre></td></tr></table></figure>
<p>怎么描述这个组件呢？除了 mapDispatchToProps 和 connect 它就是标准的 React 的那套东西。</p>
<p>mapDispatchToProps 将 Redux actions 和 React 属性 连接起来。这样组件就可以向外发送 action 了。</p>
<p>你可以看下 action 是怎样在 handleSubmit 方法中被触发的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">  <span class="function"><span class="title">handleSubmit</span>(<span class="params">event</span>)</span> &#123;</span><br><span class="line">    event.preventDefault();</span><br><span class="line">    <span class="keyword">const</span> &#123; title &#125; = <span class="built_in">this</span>.state;</span><br><span class="line">    <span class="keyword">const</span> id = uuidv1();</span><br><span class="line">    <span class="built_in">this</span>.props.addArticle(&#123; title, id &#125;); <span class="comment">// Relevant Redux part!!</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<p>最后组件被导出为 Form 。 Form 就是组件和 Redux store 连接之后的产物。</p>
<p>注意：当 mapStateToProps 不存在的时候，connect 的第一个参数必须为 null，就像例子中的 Form 一样。 否则，你会得到 TypeError: dispatch is not a function. 的警告。</p>
<p>我们的组件部分就都结束了。</p>
<p>更新下 App , 把 Form 组件加进来：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> List <span class="keyword">from</span> <span class="string">&quot;./List&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Form <span class="keyword">from</span> <span class="string">&quot;./Form&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> (</span><br><span class="line">  &lt;div className=<span class="string">&quot;row mt-5&quot;</span>&gt;</span><br><span class="line">    &lt;div className=<span class="string">&quot;col-md-4 offset-md-1&quot;</span>&gt;</span><br><span class="line">      &lt;h2&gt;Articles&lt;/h2&gt;</span><br><span class="line">      &lt;List /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div className=<span class="string">&quot;col-md-4 offset-md-1&quot;</span>&gt;</span><br><span class="line">      &lt;h2&gt;Add a <span class="keyword">new</span> article&lt;/h2&gt;</span><br><span class="line">      &lt;Form /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p>运行一下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure>
<p>打开 <a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080</a></p>
<p>你将看到如下界面：</p>
<p>没什么特别的，但可以展示 React 和 Redux 是如何工作的。</p>
<p>左边的 List 组件和 Redux store 相连。它将在你新建文章的时候刷新渲染。</p>
<p>哈哈！</p>
<p>你可以在 这里 查看源码。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>我希望你可以从这篇教程中学到一些东西。我尽力把例子写的足够简单。我希望可以在下面的评论中倾听你的反馈。</p>
<p>Redux 有许多模板和移动部件。别灰心。拿起来把玩，花点时间去吸收它所有的概念。</p>
<p>我逐步从零开始慢慢地理解了 Redux 。相信你也可以做到。</p>
<p>当然，也请花点时间想清楚为什么需要在你的项目中引用 Redux。</p>
<p>无论怎样：学习 Redux 都是 100% 值得的。</p>
<p>Redux 并不是状态管理的唯一方式。<a href="Mobx">Mobx</a> 是另一个有趣的可选方案。我也在关注 Apollo Client。谁将胜出？只有时间知道答案。</p>
<h2 id="函数式编程的一些资源"><a href="#函数式编程的一些资源" class="headerlink" title="函数式编程的一些资源"></a>函数式编程的一些资源</h2><p>Redux 使大多数初学者感到害怕，是因为它是围绕函数式编程和纯函数展开的。</p>
<p>我只能是推荐一些资源给大家，因为函数式编程超出了本指南的范围。 下面是一些函数式编程和纯函数相关的资源：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://drboolean.gitbooks.io/mostly-adequate-guide-old/content/ch1.html">Professor Frisby’s Mostly Adequate Guide to Functional Programming</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/getify/Functional-Light-JS">Functional-Light-JS</a></li>
</ul>
<h2 id="Redux-中的异步-actions"><a href="#Redux-中的异步-actions" class="headerlink" title="Redux 中的异步 actions"></a>Redux 中的异步 actions</h2><p>我不确定谈论异步 actions 是否合适。</p>
<p>大多数 Redux 初学者都很难仅学习纯粹的 Redux。 在 Redux 中处理复杂的异步 action 还是比较费劲的。</p>
<p>当你了解了 Redux 的核心概念后可以去读一下 Matt Stow 写的 <a target="_blank" rel="noopener" href="https://medium.com/@stowball/a-dummys-guide-to-redux-and-thunk-in-react-d8904a7005d3">A Dummy’s Guide to Redux and Thunk in React</a>。这是篇关于 Redux 怎样用 redux-thunk 处理 API 请求的非常不错的介绍。</p>
<p>谢谢阅读，码得愉快～</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/b3d6d618a14348a5aa2542fcdf0a308a/" data-id="ckmcqox5o00c90kuvbzgt0hkp" data-title="2018 React Redux 入门教程" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react/" rel="tag">react</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-dd7f934b4f984d66b60d603896747363" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/dd7f934b4f984d66b60d603896747363/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:37.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/dd7f934b4f984d66b60d603896747363/">程序员对 996 的反抗引来全球关注，它是如何以程序员自己的方式建立起来？</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>转自: <a target="_blank" rel="noopener" href="https://m.douban.com/note/712945658/?dt_dapp=1">https://m.douban.com/note/712945658/?dt_dapp=1</a>，原文应该来自 <a target="_blank" rel="noopener" href="https://www.qdaily.com/">好奇心日报</a>，但目前已被删除。<br>国内的各大互联网公司争相屏蔽 <a target="_blank" rel="noopener" href="https://996.icu/">996.ICU</a> 及其 <a target="_blank" rel="noopener" href="https://github.com/996icu/996.ICU">GitHub</a>，甚至在 <a target="_blank" rel="noopener" href="https://github.com/996icu/996.ICU/issues">GitHub Issues</a> 大肆雇佣水军发布乱七八糟的东西导致 Issues 被关闭。<br>包括百度上无法搜索到官网，中文搜索结果中甚至搜索不到 GitHub。QQ/360/百度/UC 这些常见的国内浏览器直接添加本地规则禁止访问，但 Chrome/Firefox 则安然无恙（所以真的无法理解程序员为什么会用 360？）</p>
</blockquote>
<p>一场关于劳工权益的抗议在过去一周里爆发，让中国互联网公司习惯的 996（早九点、晚九点、一周六天）加班时间成为中国乃至全球关注的焦点。</p>
<p>有程序员发起了一个抵制 996 工作制的项目 <a target="_blank" rel="noopener" href="https://996.icu/">996.ICU</a>。讨论从技术社区开始，在互联网公司的微信群流传开来，蔓延到豆瓣、知乎，很快上了微博热搜，在百度的搜索热度达到平日的十倍。《中国青年报》、《南方日报》的报道被项目发起人标注进了项目的说明页面。</p>
<p>一周下来，事件的影响在海外逐渐升温。最早跟进报道的英文媒体是关注中国的《南华早报》，它在 3 月 29 日对此事的报道被 Python 之父 <a target="_blank" rel="noopener" href="https://twitter.com/gvanrossum">Guido van Rossum</a> 转发并附上一句评论：“<strong>996 工作制是不人道的。</strong>”</p>
<p>全球程序员聚集讨论区 Hacker News 和相应 Reddit 论坛，996 也成了一个热门话题。The Verge、Financial Times 分别在 4 月 2 日和 4 月 3 日跟进，《连线》等媒体也已经在采访参与者。</p>
<p>和前两年以悲剧方式获得全球关注的中国制造业从业者不同，程序员看起来是最不容易为工作环境走向对抗的一个群体。外界对他们的印象主要是收入高、习惯天天加班、办公室放着行军床、生活简单就想着买房结婚。一个典型的中产阶级行业，而中产阶级往往被认为是革命中重要但同时也是阻力最大的阶层。</p>
<p>但不同于其它也要日常加班，强度更大收入更少的行业，程序员有一个说话的渠道。</p>
<h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><p>996.icu 网站的域名最早由一个年轻的程序员注册。</p>
<p>在技术论坛 V2EX 上，这位用户曾在一个关于工作薪酬讨论的帖子里提到自己毕业于北京一所 211 大学，在一家与百度、阿里、腾讯同级的大型互联网公司工作，刚转正没多久，每月薪酬在一万多元。</p>
<p>之前，他都在论坛里发帖讨论技术，讨论同一个公司不同的团队之间为什么薪资会有差别。但最近，他所在的公司开始实行 996 工作制。</p>
<p>3 月 20 日，他在论坛的域名推广版宣布注册了一个域名 <a target="_blank" rel="noopener" href="http://996.icu/">http://996.icu</a>，口号是：“工作 996，生病 ICU。”</p>
<p>3 月 26 日后，他在一个职场话题下回复道：“我才感到 996 多么毁人，除了工作就是休息，跟家人沟通都少了。”在那个回帖里，他再次推荐了 996.ICU 网站。</p>
<p><a target="_blank" rel="noopener" href="http://996.icu/">996.ICU</a> 就是一个网站，自上而下分成 996 介绍、十七条劳动权益相关法规和相关事件报道三个部分。这三部分自第一天就在，虽然内容在过去一周日渐丰富起来。</p>
<p><a target="_blank" rel="noopener" href="http://996.icu/"><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190407205931.png" alt="996 icu"></a></p>
<p>网站作者还在介绍后面加上了一句“Developers’ Lives Matter”（开发者的命也是命），模仿美国对抗种族不平等运动的“Black Lives Matter”（黑人的命也是命）。</p>
<p>它的影响力并不来自这个网页。而是来自同样在 3 月 26 日上线的 <a target="_blank" rel="noopener" href="https://github.com/996icu/996.ICU">GitHub</a> 项目。</p>
<p>项目由一个叫 996icu 的匿名 ID 发起，和域名持有者的关系不得而知。但从每天对最多 260 个建议的快速处理来看，这个账号即便是那位年轻程序员创建，现在很可能也不是他一个人在用。</p>
<p>今天，软件开发已经不需要凡事都重新发明一个轮子，用开源的代码可以快速完成一个功能。</p>
<p>而 GitHub 就是存放这些代码的最大平台。程序员们在 GitHub 上管理自己的项目，发起讨论、提交修改建议。</p>
<p>目前 GitHub 有<a target="_blank" rel="noopener" href="http://www.sohu.com/a/276484595_671058">三千万程序员用户</a>，托管了大约 8000 万个代码仓库，平均每秒创建的存储库就有 1.6 个。2018 年，<a target="_blank" rel="noopener" href="https://techcrunch.com/2012/07/14/what-exactly-is-github-anyway/">微软宣布 75 亿美元收购 GitHub</a>。</p>
<p>GitHub 上之前也有关于中国互联网公司加班问题的项目，两个月前一个主题是 <a target="_blank" rel="noopener" href="https://github.com/shengxinjing/programmer-job-blacklist">“程序员找工作黑名单”</a> 的项目上线，这个黑名单在两个月内获得了超过 18000 次“加星点赞”（Star）。</p>
<p>但这看起来更像是程序员在找工作时的一份操作指南。而 996.ICU 则更直接、更简单，从一开始就是一份反 996 工作制的宣言。</p>
<p>这让它迅速引起共鸣。</p>
<p>996 一直没有好名声。最早可以追溯到 <a target="_blank" rel="noopener" href="http://it.sohu.com/20140405/n397797427.shtml">2014 阿里巴巴怀孕员工加班回家后大出血去世</a> 的新闻报道。2016 年，<a target="_blank" rel="noopener" href="http://finance.cnr.cn/gs/20160901/t20160901_523105136.shtml">58 同城就因为对 2 万多员工强制 996</a> 遭到不少抵制。</p>
<p>今年 1 月，<a target="_blank" rel="noopener" href="http://www.linkshop.com.cn/web/archives/2019/418163.shtml">杭州有赞 CEO</a> 在公司年会上突然宣布全公司强制执行 996，有赞高管表示如果工作家庭不好平衡，可以选择离婚。</p>
<p>更近的，京东 3 月初开始执行 995 工作制度。面对质疑，<a target="_blank" rel="noopener" href="http://tech.163.com/19/0312/13/EA2QGIOK00097U7R.html">京东公关总监刘力回应不会强制要求，但鼓励员工全情投入</a>。</p>
<p>中国互联网公司加班不被认为是特例，但以往有高回报盼头。2017 年，软件业平均薪资 13.3 万，连续两年超过金融业成为全国最赚钱的行业。阿里巴巴纽交所挂牌上市，一夜之间产生了 1 万多名千万富翁。</p>
<p>2018 年开始的上市潮没能重现另一个阿里巴巴。小米 2014 年估值达到 450 亿美元，2018 年上市前预期公司市值能有 800 - 1000 亿美元，四年老员工手中股票价值有望翻倍。但等到 2019 年年初员工可以卖股票的时候，小米市值缩水至 315 亿美元，股票价值也比 2014 年缩水 30%。</p>
<p>而小米已经是过去一年上市公司里表现很好的。<a target="_blank" rel="noopener" href="https://www.jiemian.com/article/2703824.html">蘑菇街直接以稀释员工股权的手段将员工持股价值缩水为 1/25</a>。蘑菇街挂牌价为 14 美元，1 万股理应价值 96.6 万元，但稀释 25 倍后只有 4 万元。</p>
<p>甚至工作也不一定能保证。互联网行业早几年处于风口，大量风险投资涌入。创业公司不在乎利润，可以开更高薪水来挖人。</p>
<p>但现在形势变了。2018 年，中国 VC/PE 募资规模 341.12 亿美元，<a target="_blank" rel="noopener" href="https://36kr.com/p/5150552">同比骤降 74.59%</a>。靠烧钱做大规模的互联网公司上市后也面对盈利问题。缺乏资金来源，为了减少亏损，裁员成为一个普遍的做法。</p>
<p>去年 8 月，美图、拉勾网各裁员 20%。10 月，锤子科技解散成都分公司，为它从北京搬去成都的程序员也失去工作。11 月，趣店裁员 200 人，不从北京搬去杭州也得走，同月斗鱼裁员 70 人。12 月，知乎裁员 20%，300 人被要求当天离开公司；科大讯飞裁员 20%，回应为末位淘汰；摩拜裁员 30%，称为正常调整。今年 2 月，滴滴裁员 15%，2000 人离职；京东先裁员 20% 员工，2 月又裁员 10% 副总裁级别高管。3 月，腾讯中层裁去 20%，<a target="_blank" rel="noopener" href="http://m.kanshangjie.com/Index/Show?id=161549">腾讯总裁刘炽平称</a> 为年轻化主动革新。</p>
<p>高强度的工作变得强度更高、曾经可以指望的上市故事愈加渺茫，甚至能工作多少年也在大裁员背景下变得难以确定。</p>
<p>在这样的背景之下，996.ICU 项目上线一小时内就收获了超过 2000 颗星星，一天内加星数超过一万，登上了 GitHub 实时热门榜。</p>
<p>更多人注意到了。</p>
<h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2><p>Anony 就是在 3 月 26 日 996.ICU 上线一小时的时候开始关注的。他自称是一个普通的码农，平时喜欢逛 GitHub。他说自己平时逛 GitHub 就“类似于你们刷微博”。</p>
<p>尽管 Anony 所在公司没有实行 996 工作制，他还是持续对这个项目的进展保持关注，也参与了修改措辞的工作。</p>
<p>在 996.ICU 的讨论区（Issues 区）里，加星即将破十万前，有人留言说，没想到以这种方式参与了大型开源项目。</p>
<p>在社交网络上人们分享自己关于 996 工作的经历、见解以及解决方案。但在程序员社区里，一切都按照程序员们开发开源软件的方式推进着。</p>
<p>想象一栋充满无数会议室的大楼，每间会议室里的白板上写着一项软件的所有代码。GitHub 可以让程序员走入其中开放的会议室，观看白板上的代码（Watch），点赞（Star），并按自己的想法进行修改。</p>
<p>但随意修改会扰乱白板上的代码，Github 方便用户将白板上的代码库整体复制到自己账户下，修改不影响项目代码。修改完成后，程序员可以提交“拉回请求”（Pull Request）给项目维护者进行合并，将自己的修改加入项目。</p>
<p>这是目前开源软件在线协作的工作方法，而 996.ICU 的进化过程完全遵照此方法进行。</p>
<p>GitHub 上最初的 996.ICU 项目很简单：一段 26 行的 Markdown 格式网页文档。</p>
<p>一段段劳动法摘录、五一国际劳动节的由来、国际歌歌词、英文版本是最早的一批更新。</p>
<p>996.ICU 项目的补充、完善，都是由参与者以提交“拉回”请求的方式推进，逐渐成为今天的样子。</p>
<p>这和在论坛留言不一样，如果一个人看到代码就产生不适感，那就无法在这里提出修改请求。</p>
<p>各种细节被快速完善。有人提交请求，称主页面上的案例之一京东的英文版本如果直译 JINGDONG 无法让外国投资者理解，要改成 <a href="jd.com">JD.COM</a>。</p>
<p>大小写、空格、错误链接、全角半角符号错用等问题都被更新，放进 Markdown 格式的文档里，还有人上传了自制的 Logo。</p>
<p>法语、德语、意大利语、日语、韩语、葡萄牙语、巴西葡萄牙语、泰语、繁体中文、越南语、俄语、希腊语等主要语言版本翻译都在项目上线第二天提交。还有人写了<a target="_blank" rel="noopener" href="https://github.com/996icu/996.ICU/pull/16430/files%E3%80%81">颇正式的文言文版本</a>：“996”事制，即日早九至岗，直至晚九点事，每周工作六日。2016 年九初起，续有网爆料称，58 同城行全员 996 事制，且周末加班无文……</p>
<p>3 月 28 日是进展飞快第一天，项目有了两个关联项目：<a target="_blank" rel="noopener" href="https://github.com/fengT-T/996_list">996 公司黑名单</a> 和 <a target="_blank" rel="noopener" href="https://github.com/formulahendry/955.WLB">955 公司白名单</a>。</p>
<p>黑名单上都是实行了 996 或过度加班的公司，国内的大互联网公司基本在列，京东以超过 1200 票遥遥领先。作者还提出建议，希望在提名的时候加上部门、省区、工资范围，总之给出的信息越详细越好。</p>
<p>黑名单的作者原先将投票设置在一个论坛上，并没有考虑到会有那么多人参与投票，以至于网站太卡，人们只关注到了排名在前面的大公司。目前，这位作者正在建设新的网站，他在项目说明里写道：“因为太卡大家都只关注到了前面的大公司，希望大家能够注意到 996 的群体实际上很大，不仅仅有 BAT ，还有很多小公司。”</p>
<p>而白名单上的公司更多是外企。</p>
<p>955 公司白名单作者 formulahendry 在上海一家大外企做程序员，他的 GitHub 页面有超过 600 个关注者，还坚持用英文写过一段时间技术博客。</p>
<p>像几乎所有外企一样，formulahendry 并不需要 996。他对《好奇心日报》称，996 就完全没有个人的生活时间，最近这个现象越来越普遍，并不是一个好的趋势，他反对 996 的理由与许多人类似：比起一周工作 40 小时，一周工作 72 小时的 996 单位时间的产出不高。</p>
<p>注意到 996.ICU 之后，他觉得与其吐槽 996，不如看看有哪些公司实行 955（一周工作五天，朝九晚五） 的公司。</p>
<p>项目上线第二天，他创建白名单投票，项目的名字 WLB 是他自创的缩写，意思是 Work Life balance，即生活与工作的平衡。WLB 一天内加星数超过了 1000，上线第二天上了 GitHub 实时热门榜。</p>
<p>投票的雏形是基于 formulahendry 对上海 IT 公司的了解，在接下来的几天里，他利用下班在班车上的时间以及周末的时间维护着项目更新。</p>
<p>虽然 formulahendry 建了白名单，但是项目被创建出来之后就不再是他一个人能决定的事：一切都得按照 GitHub 的方式来。</p>
<p>996 公司黑名单则吸引了更多的参与：一个公司被添加到黑名单的方式与开源项目代码审核没什么太大区别，每个人都可以提交论据，只是提交论据的方式对非程序员来说有一定门槛。论据包括媒体报道、知乎讨论、公司官网公告等。</p>
<p>华为 和 <a target="_blank" rel="noopener" href="https://github.com/formulahendry/955.WLB">字节跳动等公司</a> 是否能够上榜都引发了众多讨论。在要求“删除黑名单字节跳动”的请求下有 51 组对话，要求删除的人和不同意删除的人各自举证。</p>
<p>发起删除请求的用户给出了两点理由：</p>
<ol>
<li> 公司虽然下班晚，上班也晚，算上午饭、晚饭后的休息时间，实际工作时长并没有一天 12 小时；公司实行大小周，但是小周周日加班给加班费；</li>
<li> 猝死事件的程序员是刚从腾讯跳槽到字节跳动不久，不能武断归咎于字节跳动加班。</li>
</ol>
<p>反驳方指出“说的好像 955 的公司不午休不吃饭一样。”接着还有反驳者给出加班费计算方法的猫腻，比如周日加班按 1.2 倍工资而不是 2 倍工资计算。</p>
<p>一个请求能否通过，实际上是以一种简单的投票实现的。删除字节跳动的请求有 8 人支持，269 人反对。最后 996.ICU 项目负责人拒绝了删除字节跳动的请求。</p>
<p>虽然项目负责账号可以对请求作出判断，但由于开源项目的可复制性，如果项目发起人背离社区大多数人的诉求，程序员们可以很容易转而支持另一个在这个基础上分出来的项目。</p>
<p>从一个个人项目，演变为社区项目之后，决定项目发展的就不再是发起人，而是所有参与贡献的人共同决定的结果。这些都是开源软件开发的基本方式。</p>
<p>就像比如 Linux 系统最早是 Linus 一个人的作品。但随着全球开发者的加入，有 1.5 万开发者和超过 1400 家公司添砖加瓦。现在 Linux 远不是 Linus 所能控制的，它的管理由一个专门的基金会所负责。</p>
<p>996.ICU 也没什么区别。不论是谁启动了这个项目，现在它已经不再是一个人决定的事。</p>
<h2 id="3"><a href="#3" class="headerlink" title="3"></a>3</h2><p>讨论变得敏感，是从 3 月 29 日项目的 issues 被关闭开始。</p>
<p>仓库下的讨论区（Issues）突然被关闭，也引发了不少讨论，比如 issues 太多（过了十万）、太多广告，还有人贴出白宫请愿的号召截图怀疑是政治原因。几小时后，作者贴出解释称是主动选择关闭。</p>
<p>不过这对讨论没有太大影响。项目上线之初，有人发出各地微信群的二维码，与此同时就有人回应说程序员应该用程序员的工具，而不是用 QQ、微信来沟通。于是程序员常用的即时通信工具 Slack、游戏即时通信工具 Discord 都被用起来、国内不能直接访问的通讯工具 Telegram 上也出现了 996.ICU 讨论组。</p>
<p>996.ICU 的 Slack 讨论频道在五天内吸引了 1000 多名成员，成员自发将 Slack 群组划分成了公告、招聘、讨论、中文、英文、城市等数个频道。在 Slack 频道里讨论最多的，是劳动权益受到侵害之后如何维权。</p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/317847010/answer/636013957">一名拥有二十年经验的程序员陈皓</a> 在知乎回答了问题：“如果想抵制 996，除了利用 GitHub 发起抗议，还有哪些巧妙的方案？”，提出通过法律手段、政府信访、集体抗议等途径。</p>
<p>在 Slack 群组讨论中，他的解决方案遇到了不少阻力，一些成员质疑劳动仲裁的效率，还有一些成员则担忧信访手段可能招致政府机关的强制手段。</p>
<p>在完善了措辞、不同语言版本和黑名单、白名单之后。996.ICU 从上周末开始的最大进展是“反 996 软件授权协议”从想法到落地。</p>
<p>3 月 27 日，<a target="_blank" rel="noopener" href="https://github.com/996icu/996.ICU/pull/15642">一个想法被热切讨论后采用</a>：设计一种关于劳动保护的软件授权协议——996ICU 协议，如果这个协议被兼容进各个开源项目的授权协议，实行 996 工作制的公司不得使用该开源项目，就可能给公司带来实际的约束作用。</p>
<p>劳动法一直在，但执行是问题。大互联网公司往往为一个城市解决数万就业，有些还提供数十甚至上百亿利税。理论上地方法院，比如深圳当地法院应该公平对待腾讯、华为和它们的员工，但这是理论上。</p>
<p>而软件授权协议是软件行业内的一个约束。简单来说，软件授权协议就像是一本书的版权声明。在项目开发中开源软件的使用不可避免，使用开源软软件不需要付费，但是需要遵守作者写在授权协议中的条款，如果公司或个人使用了开源代码，但是没有遵守条款，作者可以据此提起诉讼，要求赔偿、停止使用代码。</p>
<p>这个想法被上千人点赞，400 多人参与了该协议的讨论。</p>
<p>但协议怎么写还没人想好，一开始只有这样三行：</p>
<p>The 996ICU License (996ICU)Copyright © 2019 3 月 30 日晚间，伊利诺伊大学厄巴纳 - 香槟分校法学博士 Katt Gu 花了一夜时间起草了授权协议。这个版本在常用的 <a target="_blank" rel="noopener" href="https://github.com/kattgu7/Anti-996-License/wiki">MIT 开源授权协议基础之上</a> 改编。协议一共三条，在所有协议都会有的惯例版权声明条款，Katt Gu 增加了两条内容：</p>
<ul>
<li><p>个人或法人实体必须严格遵守与个人实际所在地或个人出生地或归化地、或法人实体注册地或经营地（以较严格者为准）的司法管辖区所有适用的与劳动和就业相关法律、法规、规则和标准。如果该司法管辖区没有此类法律、法规、规章和标准或其法律、法规、规章和标准不可执行，则个人或法人实体必须遵守国际劳工标准的核心公约。</p>
</li>
<li><p>个人或法人不得以任何方式诱导或强迫其全职或兼职员工或其独立承包人以口头或书面形式同意直接或间接限制、削弱或放弃其所拥有的，受相关与劳动和就业有关的法律、法规、规则和标准保护的权利或补救措施，无论该等书面或口头协议是否被该司法管辖区的法律所承认，该等个人或法人实体也不得以任何方法限制其雇员或独立承包人向版权持有人或监督许可证合规情况的有关当局报告或投诉上述违反许可证的行为的权利。</p>
</li>
</ul>
<p>Katt Gu 关注新技术立法，也著有关于 <a target="_blank" rel="noopener" href="https://scholar.google.com/citations?user=PTcpQwcAAAAJ&hl=en&oi=ao">中国特定领域法律与实践鸿沟</a> 的论文。</p>
<p>3 月 29 日晚上，Katt Gu 的丈夫，一直关注软件版权演进的创业者 Suji Yan 在看到 996.ICU 之后催促她起草一份协议。Gu 回忆说最初她并不愿意。</p>
<p>“因为我本人是一个工作狂，但是仔细想想这是一个关乎自愿选择的事。”Gu 对《好奇心日报》表示，她的顾虑还来源于专业，这份协议起草涉及 IP 法、劳动法以及国际公约等领域的研究，她从未有过相关经验。</p>
<p>起草协议之前，一位律师告诉她，要做好这份协议，得先研究十年劳动法、再研究十年 IP 法，或者在几个涉及的领域各找十个专家来讨论、研究，再拟定草稿。</p>
<p>但是 Katt Gu 觉得协议的实用效果远小于宣传效果，今天最重要的那些开源协议一开始也不是以那样的立法方式做出来的。</p>
<p>经过一夜研究，她决定以最简单的通用法（Common Law）为基础，草拟一份协议草案。而起草的模版则是简单且应用广泛的 MIT 开源协议。</p>
<p>这份协议以及协议期待产生的效果，都是相当理想化的。</p>
<p>根据 Suji Yan 所设想的最理想状态，协议可以对中国互联网公司有一个约束。他的逻辑是今天软件开发基本上已经不可能不用开源代码——微软一度都是开源软件的最大贡献者。当足够多的开源项目用了 996ICU 协议，企业强制 996 就等于自己的产品违反协议，开源代码拥有者就可以起诉该公司。哪怕在中国大陆起诉艰难，这些公司基本都在香港或美国上市，也可以在其它地区发起诉讼。</p>
<p>不过解释完之后，他自己也说“这当然是一个极其理想化的设想”。</p>
<p>“本来觉得我们不做会有别人做，但是现在觉得还是需要更多人关注。”Katt Gu 说协议公布之后收到一封感谢邮件，“感觉就像看医生收到那种‘妙手回春’的锦旗。”</p>
<p>对协议约束力持怀疑态度的人很普遍，而反对者也不少。比如目前 GitHub 上第三大项目的创作者尤雨溪在微博上表示自己个人反对和谴责 996，但是也反对在开源项目许可证中包含 Discriminatory Clause（禁止部分用户使用的条款），或是利用开源项目做任何形式的政治博弈。</p>
<p>“我个人有个人的看法，但项目是中立的。Vue 的许可证不会禁止任何人使用，现在不会，以后也不会。”他在微博上写道。Vue.js 是一个开发网页用户界面的框架。</p>
<p>但添加反 996 许可证的项目 <a target="_blank" rel="noopener" href="https://github.com/996icu/996.ICU/blob/master/awesomelist/projects.md">在不断增多</a>。目前已经有 75 个开源项目添加了许可证，其中大部分是个人开发者维护的项目，但也有多个点赞数在四五千以上，有一定规模、被很多公司使用的开源软件项目加入。而和 Vue 相关的数个插件项目也加入了反 996 许可协议——任何项目开源扩大之后，就不再是作者一个人决定的了。</p>
<p>Katt Gu 称接下来自己的协议修改要它与更多的主流开源软件协议兼容，这样才有希望被更多开源项目所接纳。</p>
<p>“我自己只想把这个协议写好，写好估计就没有我啥事了，如果要写细，可能要花两三年。”Katt Gu 说做完这个应该就不会管了。Suji Yan 则补充了一句：“还给社区。”</p>
<p>社区有一个大目标。4 月 1 日，有人号召把反 996 协议加入 GitHub <a target="_blank" rel="noopener" href="http://choosealicense.com/">官方收录协议</a> 当中，这样新开源项目就可以很容易把协议加入项目。</p>
<p>更长远的目标是让它被 GitHub 高亮显示，这样任何项目在创建选择协议时都有机会看到它。</p>
<p>这些都不容易，尤其是在主页高亮，需要超过 1000 个公开项目使用该协议，3 个明星项目使用、OSI 和 GNU 批准。</p>
<p>作为开源软件的推动力量，理查德·斯托曼（ Richard Stallman）在 1985 年发表《GNU 宣言》，提出所有软件都应该贯彻自由软件的精神——运行、复制、发布、研究、修改和改进该软件的自由。</p>
<p>但从一开始，这个运动就没有停留在技术或者免费用软件的层面，发起者认为大众都能接触到的应用都应完全掌控在用户自己手中。如果 996.ICU 的贡献者们计划成功，这将是开源软件届第一个被认可的约定劳动权益的协议。</p>
<p>一周不到，对 996.ICU 的反击已经来了。</p>
<p>没有公司敢直接攻击 GitHub。2015 年的持续攻击 <a target="_blank" rel="noopener" href="http://choosealicense.com/">没有成功</a>。现在它是微软的财产，商业公司攻击它就更不明智。</p>
<p>攻击者们用了自己最习惯的手段，屏蔽。</p>
<p>3 月 30 日开始，Slack 讨论群组中开始有人报错：北京地区微信内无法打开 996.ICU 的 GitHub 页面，更多的测试显示，这不是孤例。</p>
<p>QQ 浏览器称这个唯一公开诉求就是让公司遵守劳动法的网站包含欺诈信息。微信显示的理由则是“该网页包含违法或违规内容，为维护绿色上网环境，已停止访问”。阿里巴巴旗下的 UC 浏览器和 360 浏览器都将该页面认定为包含违法信息的网站。最独特的猎豹浏览器打开这个页面会弹出提示称“网站含有大量淫秽色情信息”。</p>
<p>使用百度搜索 996，中文版搜索结果里找不到 996.icu 网站和对应 GitHub 页面的链接。</p>
<p>和以往不同的是，这一次它们并不能直接封杀 996.ICU 的存在，也没法让讨论它的渠道消失。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/dd7f934b4f984d66b60d603896747363/" data-id="ckmcqox5q00cf0kuvac7p1koa" data-title="程序员对 996 的反抗引来全球关注，它是如何以程序员自己的方式建立起来？" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9D%82%E8%B0%88/" rel="tag">杂谈</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">转载</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/18/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="page-number" href="/page/18/">18</a><span class="page-number current">19</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/20/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/electron/" rel="tag">electron</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grid/" rel="tag">grid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jetbrains/" rel="tag">jetbrains</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/" rel="tag">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/" rel="tag">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/" rel="tag">sql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typescript/" rel="tag">typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vscode/" rel="tag">vscode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webstorm/" rel="tag">webstorm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AA%E4%BA%BA/" rel="tag">个人</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%AC%E5%8F%B8/" rel="tag">公司</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%91%A8%E6%8A%A5/" rel="tag">周报</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%A3%E5%91%8A/" rel="tag">宣告</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">工程化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E6%BA%90/" rel="tag">开源</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%82%E6%AD%A5/" rel="tag">异步</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%85%E6%9B%B4%E6%96%B0/" rel="tag">待更新</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82%E8%B0%88/" rel="tag">杂谈</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BB%8F%E9%AA%8C/" rel="tag">经验</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6/" rel="tag">读书</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">转载</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/css/" style="font-size: 12.14px;">css</a> <a href="/tags/electron/" style="font-size: 15.71px;">electron</a> <a href="/tags/git/" style="font-size: 12.86px;">git</a> <a href="/tags/grid/" style="font-size: 10.71px;">grid</a> <a href="/tags/java/" style="font-size: 19.29px;">java</a> <a href="/tags/javascript/" style="font-size: 20px;">javascript</a> <a href="/tags/jetbrains/" style="font-size: 12.14px;">jetbrains</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/markdown/" style="font-size: 10.71px;">markdown</a> <a href="/tags/react/" style="font-size: 14.29px;">react</a> <a href="/tags/sql/" style="font-size: 14.29px;">sql</a> <a href="/tags/typescript/" style="font-size: 12.14px;">typescript</a> <a href="/tags/vscode/" style="font-size: 12.86px;">vscode</a> <a href="/tags/vue/" style="font-size: 16.43px;">vue</a> <a href="/tags/webstorm/" style="font-size: 10px;">webstorm</a> <a href="/tags/windows/" style="font-size: 17.14px;">windows</a> <a href="/tags/%E4%B8%AA%E4%BA%BA/" style="font-size: 12.86px;">个人</a> <a href="/tags/%E5%85%AC%E5%8F%B8/" style="font-size: 10px;">公司</a> <a href="/tags/%E5%91%A8%E6%8A%A5/" style="font-size: 10px;">周报</a> <a href="/tags/%E5%AE%A3%E5%91%8A/" style="font-size: 10px;">宣告</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 13.57px;">工具</a> <a href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" style="font-size: 17.86px;">工程化</a> <a href="/tags/%E5%BC%80%E6%BA%90/" style="font-size: 10px;">开源</a> <a href="/tags/%E5%BC%82%E6%AD%A5/" style="font-size: 15px;">异步</a> <a href="/tags/%E5%BE%85%E6%9B%B4%E6%96%B0/" style="font-size: 10.71px;">待更新</a> <a href="/tags/%E6%9D%82%E8%B0%88/" style="font-size: 18.57px;">杂谈</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a> <a href="/tags/%E7%BB%8F%E9%AA%8C/" style="font-size: 11.43px;">经验</a> <a href="/tags/%E8%AF%BB%E4%B9%A6/" style="font-size: 12.14px;">读书</a> <a href="/tags/%E8%BD%AC%E8%BD%BD/" style="font-size: 11.43px;">转载</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/14/8fb2d58463ae4191ac064a76e15bffbd/">2021 第十周</a>
          </li>
        
          <li>
            <a href="/2021/03/12/7e7131c07c984d928ba3fefa7a9cef06/">读书-[颓废与沉默：透视犬儒文化]</a>
          </li>
        
          <li>
            <a href="/2021/03/02/db74e6e5d2444bc3b6e185a7b338bbf6/">electron 开发经验之谈系列-在渲染、主进程间共享数据</a>
          </li>
        
          <li>
            <a href="/2021/02/27/06cb464179cf45c598208534705aae3c/">2020 吾辈在公司推动的前端技术演进</a>
          </li>
        
          <li>
            <a href="/2021/02/23/cd66150d2b86448590fcc9bb2419c0b2/">实践 lerna monorepo</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>