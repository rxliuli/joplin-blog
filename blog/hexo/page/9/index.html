<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/9/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-22dfbce551e24b8b8c1cf4c1d836b47c" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/18/22dfbce551e24b8b8c1cf4c1d836b47c/" class="article-date">
  <time class="dt-published" datetime="2020-04-18T02:14:09.000Z" itemprop="datePublished">2020-04-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/18/22dfbce551e24b8b8c1cf4c1d836b47c/">成为 Java 高级程序员需要掌握哪些？</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>转自 <a target="_blank" rel="noopener" href="https://blog.csdn.net/zhibuguonicuo/article/details/60345715">https://blog.csdn.net/zhibuguonicuo/article/details/60345715</a>，吾辈只修改了部分排版/错字以更好的阅读。</p>
</blockquote>
<h2 id="Section-1"><a href="#Section-1" class="headerlink" title="Section 1"></a>Section 1</h2><ol>
<li><p> Core Java，就是 Java 基础、JDK 的类库，很多童鞋都会说，JDK 我懂，但是懂还不足够，知其然还要知其所以然，JDK 的源代码写的非常好，要经常查看，对使用频繁的类，比如 String，集合类（List，Map，Set）等数据结构要知道它们的实现，不同的集合类有什么区别，然后才能知道在一个具体的场合下使用哪个集合类更适合、更高效，这些内容直接看源代码就 OK 了</p>
</li>
<li><p> 多线程并发编程，现在并发几乎是写服务端程序必须的技术，那对 Java 中的多线程就要有足够的熟悉，包括对象锁机制、synchronized 关键字，concurrent 包都要非常熟悉，这部分推荐你看看《Java 并发编程实践》这本书，讲解的很详细</p>
</li>
<li><p> I/O，Socket 编程，首先要熟悉 Java 中 Socket 编程，以及 I/O 包，再深入下去就是 Java NIO, 再深入下去是操作系统底层的 Socket 实现, 了解 Windows 和 Linux 中是怎么实现 socket 的</p>
</li>
<li><p> JVM 的一些知识，不需要熟悉，但是需要了解，这是 Java 的本质，可以说是 Java 的母体, 了解之后眼界会更宽阔，比如 Java 内存模型（会对理解 Java 锁、多线程有帮助）、字节码、JVM 的模型、各种垃圾收集器以及选择、JVM 的执行参数（优化 JVM）等等, 这些知识在《深入 Java 虚拟机》这本书中都有详尽的解释, 或者去 oracle 网站上查看具体版本的 JVM 规范.</p>
</li>
<li><p> 一些常用的设计模式，比如单例、模板方法、代理、适配器等等，以及在 Core Java 和一些 Java 框架里的具体场景的实现，这个可能需要慢慢积累，先了解有哪些使用场景，见得多了，自己就自然而然会去用。</p>
</li>
<li><p> 常用数据库（Oracle、MySQL 等）、SQL 语句以及一般的优化</p>
</li>
<li><p> JavaWeb 开发的框架，比如 Spring、iBatis 等框架，同样他们的原理才是最重要的，至少要知道他们的大致原理。</p>
</li>
<li><p> 其他一些有名的用的比较多的开源框架和包，Netty 网络框架，Apache common 的 N 多包，Google 的 Guava 等等，也可以经常去 Github 上找一些代码看看。</p>
</li>
</ol>
<h2 id="section-2"><a href="#section-2" class="headerlink" title="section 2"></a>section 2</h2><p>每逢长假都会有很多程序员跳槽，十一、过年是跳槽黄金时刻，尤其是过年。过年的时候年终奖到手，没有了多少牵挂，年终同学同事聚会比较多，沟通的就多，各种工作机会的消息也相应会多，所以跳槽的机会也就会多。跳槽就必不可少的要经过面试，那么作为一个 Java 程序员需要准备哪些面试知识呢？下面就给大家说说。</p>
<ol>
<li><p>集合框架<br> <img src="https://img.rxliuli.com/20181126223446.png" alt="集合框架"><br> 从上图可以看到主要是 Collection 和 Map 的继承类和 Iterator 的实现类，重点掌握 ArrayList、LinkedList、Vector、Stack、PriorityQueue、HashSet、LinkedHashSet、TreeSet、HashMap、LinkedHashMap、TreeMap、WeakHashMap、EnumMap、TreeMap、HashTable 的特点和实现原理，还有多线程使用场景和插入多还是删除多的时候使用什么样的集合类效率会更高。</p>
</li>
<li><p>IO 框架<br> <img src="https://img.rxliuli.com/20181126223616.png" alt="IO 框架"><br> 主要掌握 Reader、Writer、InputStream、OutputStream 的继承类，重点掌握字节流 (FileInputStream、FileOutputSteam、BufferedInputStream、BufferedOutputStream、DataInputStream、DataOutputStream) 和字符流(FileReader、FileWriter、BufferedReader、BufferedWriter、InputStreamReader、OutputStreamWriter)，并熟练运用。还有就是 NIO 的工作原理要知道。</p>
</li>
<li><p>String 相关<br> 主要考察对 String 的处理，顺带考察多线程和算法，大公司就是喜欢考察字符串的算法，主要是字符串查找或者剔除，多线程打印字符串，超大字符串处理。</p>
</li>
<li><p>异常处理<br> <img src="https://img.rxliuli.com/20181126223820.png" alt="异常处理"><br> 掌握 Throwable 继承类，理解 Error 和 Exception 的区别，理解运行时异常和编译异常的区别，掌握异常的处理方法，掌握 try、catch、finally、throw、throws 关键字的意义，掌握 try-catch-finally 语句的执行顺序，掌握异常的工作原理，知道常见的异常有哪些。</p>
</li>
<li><p>多线程<br> 如何创建和启动一个线程，有哪些方法？多线程如何交互，线程之间的调度、让步、合并，如何同步？生产和消费者模型。还有就是掌握线程安全、线程池，死锁。</p>
</li>
<li><p>JVM 知识<br> 掌握常见的垃圾回收机制，掌握程序计数器、堆、栈、方法区的作用，掌握类的加载机制。掌握内存分代模型和工作原理。掌握 JVM 启动参数常见配置，了解 JVM 调优。</p>
</li>
<li><p>数据结构与算法：<br> 掌握常见查找和排序算法实现及其时间、空间复杂度。掌握常见数据结构如链表、队列、栈的基本原理和实现。</p>
</li>
</ol>
<h2 id="section-3"><a href="#section-3" class="headerlink" title="section 3"></a>section 3</h2><p>经常主持对高级工程师和中基层 Tech Leader 的面试，一年下来总有百八十场，我给大家分享一下我对于高级工程师的定位吧，虽然我主要负责. Net 团队，但是对于其他语言应该也是适用的。</p>
<p><strong>一、理论基础：</strong> 高级工程师必须有较好的理论基础，既包含一些基础的学科知识，也要包含个人专攻方向的前沿理论。我遇到过形形色色的求职者，有人自称精通领域模式，却不明白什么是聚合根（领域根）。甚至有人无法列举常用的非线性结构，更别提伪码实现和应用场景分析了。这些人普遍振振有词地说， 我有丰富的开发经验，项目需要实现的功能我都能做出来，我只是没有去记那些术语名词。抱歉，你不是没有记术语名词，你是根本没有潜心看技术文章的心态，你所谓的学习就是看一些诸如《21 天精通 Java》，《7 天，从菜鸟到专家》之类的垃圾书，或者看点视频。那么你这个高工，比别人高在哪里呢？当单位需要你代表团队和合作机构沟通，甚至发表专栏的时候，你是不是也准备跟大家讲” 这个东西我不知道该怎么讲，大家可以看一下我的代码 “。只有代码可秀的人是码农，不是高工，所以我给这类求职者的综评是中 + 封顶。</p>
<p><strong>二、工作经验：</strong> 高级工程师必须有过在项目中担心核心模块开发或者整体架构设计的经验，并且项目越高大上越好，比如你在互联网企业搞过读写分离的实现，你在电商搞过秒杀算法，你在电信行业做过网络层，我必定会高看一眼。如果你就仅仅只是一个人全栈搞过几个小网站，啪啪啪一大堆成熟框架用得倍溜，那么你只是一个装配工。我给这类求职者的综评是中 + 封顶。</p>
<p><strong>三、培养潜力：</strong> 高级工程师必须有全局思维，如果在你过往的工作历程中，你对你兄弟团队或者部门的工作情形一问三不知，甚至于一个项目中，你只懂自己的模块，其他同事负责的模块你就只会 call 个 API，那么你就是一个很难再进一步的人。对于企业来说，有你不多，无你不少，所以我给这类求职者的综评是中 + 封顶。</p>
<p><strong>四、沟通能力：</strong> 高级工程师在技术团队中是绝对的核心人中，小项目中你就是负责人，大项目中你也要负责带新人，那么良好的沟通能力必不可少，如果你仅仅是自己一个人心里亮堂，你对企业的价值就要大打折扣。这类求职者，我也有录用过不少，因为程序员木讷可以说是一种共性，在这方面没法太挑剔，但是我给他们的综评是高 - 封顶。</p>
<h2 id="section-4"><a href="#section-4" class="headerlink" title="section 4"></a>section 4</h2><p>如果要应聘高级开发工程师职务，仅仅懂得 Java 的基础知识是远远不够的，还必须懂得常用数据结构、算法、网 络、操作系统等知识。因此本文不会讲解具体的技术，笔者综合自己应聘各大公司的经历，整理了一份大公司对 Java 高级开发工程师职位的考核纲要，希望可以帮助到需要的人。</p>
<h3 id="1、Java-基础"><a href="#1、Java-基础" class="headerlink" title="1、Java 基础"></a>1、Java 基础</h3><h4 id="1-1-Collection-和-Map"><a href="#1-1-Collection-和-Map" class="headerlink" title="1.1 Collection 和 Map"></a>1.1 Collection 和 Map</h4><ol>
<li> 掌握 Collection 和 Map 的继承体系。</li>
<li> 掌握 ArrayList、LinkedList、Vector、Stack、PriorityQueue、HashSet、 LinkedHashSet、TreeSet、HashMap、LinkedHashMap、TreeMap、WeakHashMap、EnumMap、 TreeMap、HashTable 的特点和实现原理。</li>
<li> 掌握 CopyOnWriteArrayList、CopyOnWriteArraySet、ConcurrentHashMap 的实现原理和适用场景。</li>
</ol>
<h4 id="1-2-IO"><a href="#1-2-IO" class="headerlink" title="1.2 IO"></a>1.2 IO</h4><ol>
<li> 掌握 InputStream、OutputStream、Reader、Writer 的继承体系。</li>
<li> 掌握字节流 (FileInputStream、DataInputStream、BufferedInputStream、 FileOutputSteam、DataOutputStream、BufferedOutputStream) 和字符流 (BufferedReader、InputStreamReader、FileReader、BufferedWriter、 OutputStreamWriter、PrintWriter、FileWriter)，并熟练运用。</li>
<li> 掌握 NIO 实现原理及使用方法。</li>
</ol>
<h4 id="1-3-异常"><a href="#1-3-异常" class="headerlink" title="1.3 异常"></a>1.3 异常</h4><ol>
<li> 掌握 Throwable 继承体系。</li>
<li> 掌握异常工作原理。</li>
<li> 了解常见受检异常 (比如 FileNotFoundException)、非受检异常(比如 NullPointerException) 和错误(比如 IOError)。</li>
</ol>
<h4 id="1-4-多线程"><a href="#1-4-多线程" class="headerlink" title="1.4 多线程"></a>1.4 多线程</h4><ol>
<li> 掌握 Executors 可以创建的三种 (JAVA8 增加了一种，共四种) 线程池的特点及适用范围。</li>
<li> 掌握多线程同步机制，并熟练运用。</li>
</ol>
<h4 id="1-5-Socket"><a href="#1-5-Socket" class="headerlink" title="1.5 Socket"></a>1.5 Socket</h4><ol>
<li> 掌握 Socket 通信原理。</li>
<li> 熟练使用多线程结合 Socket 进行编程。</li>
</ol>
<h3 id="2、Java-虚拟机"><a href="#2、Java-虚拟机" class="headerlink" title="2、Java 虚拟机"></a>2、Java 虚拟机</h3><h4 id="2-1-JVM-内存区域划分"><a href="#2-1-JVM-内存区域划分" class="headerlink" title="2.1 JVM 内存区域划分"></a>2.1 JVM 内存区域划分</h4><ol>
<li> 掌握程序计数器、堆、虚拟机栈、本地方法栈、方法区（JAVA8 已移除）、元空间（JAVA8 新增）的作用及基本原理。</li>
<li> 掌握堆的划分：新生代（Eden、Survivor1、Survivor2）和老年代的作用及工作原理。</li>
<li> 掌握 JVM 内存参数设置及调优。</li>
</ol>
<h4 id="2-2-类加载"><a href="#2-2-类加载" class="headerlink" title="2.2 类加载"></a>2.2 类加载</h4><ol>
<li> 掌握类的加载阶段：加载、链接（验证、准备、解析）、初始化、使用、卸载。</li>
<li> 掌握类加载器分类及其应用：启动类加载器、扩展类加载器、应用程序类加载器、自定义加载器。</li>
</ol>
<h4 id="3、J2EE"><a href="#3、J2EE" class="headerlink" title="3、J2EE"></a>3、J2EE</h4><ol>
<li> 掌握 JSP 内置对象、动作及相关特点和工作原理。</li>
<li> 掌握 Servlet 的特点和工作原理。</li>
<li> 掌握 Spring 框架的 IOC 和 AOP 实现原理（反射和动态代理）。</li>
<li> 至少掌握一个 MVC 框架（Spring MVC，Struts 等）的工作原理，并熟练运用。</li>
<li> 至少掌握一个 ORM 框架 (Hibernate，MyBatis 等) 的工作原理，并熟练运用。</li>
</ol>
<h4 id="4、数据结构与算法"><a href="#4、数据结构与算法" class="headerlink" title="4、数据结构与算法"></a>4、数据结构与算法</h4><ol>
<li> 掌握线性表和树的特点并熟练运用。</li>
<li> 掌握常用排序和查找算法：插入排序 (直接插入排序、希尔排序)、选择排序 (直接选择排序、堆排序)、交换排序 (冒泡排序、快速排序)、归并排序，顺序查找、二分查找、哈希查找。</li>
<li> 熟练运用常见排序和查找算法思想解决编程问题。</li>
<li> 了解几大基本算法：贪心算法、分治策略、动态规划。</li>
</ol>
<h4 id="5、计算机网络"><a href="#5、计算机网络" class="headerlink" title="5、计算机网络"></a>5、计算机网络</h4><ol>
<li> 掌握网络的分层结构，及每层的功能特点。</li>
<li> 掌握 TCP/IP 的通信原理 (三次握手、四次挥手)</li>
</ol>
<h4 id="6、数据库"><a href="#6、数据库" class="headerlink" title="6、数据库"></a>6、数据库</h4><ol>
<li> 掌握复杂的 SQL 语句编写。</li>
<li> 掌握数据库的优化（SQL 层面和表设计层面）。</li>
<li> 至少掌握一款数据库产品。</li>
<li> 熟悉高并发、大数据情况下的数据库开发。</li>
</ol>
<h4 id="7、Web-技术"><a href="#7、Web-技术" class="headerlink" title="7、Web 技术"></a>7、Web 技术</h4><ol>
<li> 掌握 AJAX 的工作原理。</li>
<li> 至少熟悉一款 JS 框架 (比如 JQuery)。</li>
</ol>
<h4 id="8、设计模式"><a href="#8、设计模式" class="headerlink" title="8、设计模式"></a>8、设计模式</h4><ol>
<li> 熟悉常见的设计模式。</li>
<li> 会将设计模式理论应用到实际开发中。</li>
</ol>
<h4 id="9、Linux"><a href="#9、Linux" class="headerlink" title="9、Linux"></a>9、Linux</h4><ol>
<li> 熟练运用 Linux 常见命令。</li>
<li> 熟悉 Linux 操作系统基本概念及特点。</li>
<li> 熟悉 Shell 脚本。</li>
</ol>
<h4 id="10、操作系统"><a href="#10、操作系统" class="headerlink" title="10、操作系统"></a>10、操作系统</h4><ol>
<li> 掌握操作系统的进程管理。</li>
<li> 了解操作系统的 I/O。</li>
</ol>
<h4 id="11、正则表达式"><a href="#11、正则表达式" class="headerlink" title="11、正则表达式"></a>11、正则表达式</h4><ol>
<li> 掌握常见正则表达式符号。</li>
<li> 熟练运用正则表达式解决实际问题 (比如匹配电话号码、邮箱、域名等)。</li>
</ol>
<h2 id="Section-5"><a href="#Section-5" class="headerlink" title="Section 5"></a>Section 5</h2><ul>
<li>h5edu 的源码</li>
<li>pure– 响应式 css 框架</li>
<li>Hadoop 大数据</li>
<li>ERP 系统开发</li>
<li>linux</li>
<li>freemarker</li>
<li>weblogic/jobss</li>
<li>webwhpere</li>
<li>webservice <a target="_blank" rel="noopener" href="http://www.iteye.com/topic/1135747">http://www.iteye.com/topic/1135747</a></li>
<li>bootstrap</li>
<li>HTML5</li>
<li>android</li>
<li>css/jslever</li>
<li>spring aop ssh ssm 徒手搭建</li>
<li>jquery 源码分析融汇</li>
<li>缓存 echacge</li>
<li>并发</li>
<li>页面静态化</li>
<li>UML</li>
<li>shell</li>
<li>pathy</li>
<li>github</li>
<li>网络编程</li>
<li>ExtJS</li>
<li>网络爬虫</li>
<li>设计模式</li>
<li>多线程与并发</li>
<li>第三方支付 / 登录</li>
</ul>
<h2 id="高级工程"><a href="#高级工程" class="headerlink" title="============= 高级工程 ============="></a>============= 高级工程 =============</h2><h3 id="1、Core-Java-部分"><a href="#1、Core-Java-部分" class="headerlink" title="1、Core Java 部分"></a>1、Core Java 部分</h3><p>这是最基础的, 对于一个 java 高级开发 / 设计人员, 你需要对这一部分达到精通的水平, 重点内容如下:</p>
<ol>
<li> 面向对象编程思想 (封装继承多态接口)</li>
<li> 字符串处理</li>
<li> java.lang 包, java.util 包等常用包</li>
<li> java 异常处理</li>
</ol>
<h3 id="2、Java-高级部分"><a href="#2、Java-高级部分" class="headerlink" title="2、Java 高级部分"></a>2、Java 高级部分</h3><ol>
<li> Java I/O 流</li>
<li> Java 多线程技术</li>
<li> Java 网络编程</li>
<li> Java Swing</li>
</ol>
<blockquote>
<p>后两项可以了解即可, 如果项目需要可以深入研究</p>
</blockquote>
<h3 id="3、前端基本技能"><a href="#3、前端基本技能" class="headerlink" title="3、前端基本技能"></a>3、前端基本技能</h3><ul>
<li>HTML + CSS 网页开发</li>
<li>JavaScript</li>
<li>Jquery</li>
<li>浏览器兼容性 CSS hack(了解)</li>
</ul>
<h3 id="4、熟练使用-JSP-Servlet-进行开发"><a href="#4、熟练使用-JSP-Servlet-进行开发" class="headerlink" title="4、熟练使用 JSP + Servlet 进行开发"></a>4、熟练使用 JSP + Servlet 进行开发</h3><h3 id="5、MVC-设计模式-原理-以及相关框架-如-Struts"><a href="#5、MVC-设计模式-原理-以及相关框架-如-Struts" class="headerlink" title="5、MVC 设计模式, 原理, 以及相关框架, 如 Struts"></a>5、MVC 设计模式, 原理, 以及相关框架, 如 Struts</h3><h3 id="6、SSH-框架"><a href="#6、SSH-框架" class="headerlink" title="6、SSH 框架"></a>6、SSH 框架</h3><h3 id="7、缓存技术-session-amp-cookie"><a href="#7、缓存技术-session-amp-cookie" class="headerlink" title="7、缓存技术 session &amp; cookie"></a>7、缓存技术 session &amp; cookie</h3><h3 id="8、熟练使用一种以上-Java-开发工具"><a href="#8、熟练使用一种以上-Java-开发工具" class="headerlink" title="8、熟练使用一种以上 Java 开发工具"></a>8、熟练使用一种以上 Java 开发工具</h3><p>Eclipse/MyEclipse/Jbuilder/Jcreator</p>
<h3 id="9、熟练使用-XML"><a href="#9、熟练使用-XML" class="headerlink" title="9、熟练使用 XML"></a>9、熟练使用 XML</h3><p>JDOM w3c.dom SAX</p>
<h3 id="10、Java-设计模式"><a href="#10、Java-设计模式" class="headerlink" title="10、Java 设计模式"></a>10、Java 设计模式</h3><p>工厂模式, 单例模式 ==</p>
<h3 id="11、Java-反射机制"><a href="#11、Java-反射机制" class="headerlink" title="11、Java 反射机制"></a>11、Java 反射机制</h3><p>反射的各种用法</p>
<h3 id="12、了解或熟悉-C-C-NET"><a href="#12、了解或熟悉-C-C-NET" class="headerlink" title="12、了解或熟悉 C, C++, .NET"></a>12、了解或熟悉 C, C++, .NET</h3><h3 id="13、熟悉-JDK-的配置-环境变量"><a href="#13、熟悉-JDK-的配置-环境变量" class="headerlink" title="13、熟悉 JDK 的配置, 环境变量"></a>13、熟悉 JDK 的配置, 环境变量</h3><h3 id="14、数据库-oracle-必学-其他最好了解一种以上-mysql-sql-server-access"><a href="#14、数据库-oracle-必学-其他最好了解一种以上-mysql-sql-server-access" class="headerlink" title="14、数据库 oracle 必学, 其他最好了解一种以上 (mysql,sql server,access==)"></a>14、数据库 oracle 必学, 其他最好了解一种以上 (mysql,sql server,access==)</h3><p>oracle: 视图, 索引, 存储过程, 触发器, 游标, 包, 常用函数 ==</p>
<h3 id="15、数据库原理"><a href="#15、数据库原理" class="headerlink" title="15、数据库原理"></a>15、数据库原理</h3><p>事务的原理, 锁机制, 表连接, 复杂查询语句 (工作经验), 性能调优, 锁表以及解决方案 ==</p>
<h3 id="16、JDBC-连接池"><a href="#16、JDBC-连接池" class="headerlink" title="16、JDBC, 连接池"></a>16、JDBC, 连接池</h3><h3 id="17、Ajax-反向-Ajax"><a href="#17、Ajax-反向-Ajax" class="headerlink" title="17、Ajax, 反向 Ajax"></a>17、Ajax, 反向 Ajax</h3><h3 id="18、HTTP-协议-request-和-response-的原理-HTTP-status-了解常用的-Https-原理"><a href="#18、HTTP-协议-request-和-response-的原理-HTTP-status-了解常用的-Https-原理" class="headerlink" title="18、HTTP 协议, request 和 response 的原理, HTTP status(了解常用的),Https 原理"></a>18、HTTP 协议, request 和 response 的原理, HTTP status(了解常用的),Https 原理</h3><h3 id="19、熟悉-Linux-基本命令-使用过-Linux-Unix-系统-可以编写-shell-脚本-可以在-Linux-上部署项目"><a href="#19、熟悉-Linux-基本命令-使用过-Linux-Unix-系统-可以编写-shell-脚本-可以在-Linux-上部署项目" class="headerlink" title="19、熟悉 Linux 基本命令, 使用过 Linux/Unix 系统, 可以编写 shell 脚本, 可以在 Linux 上部署项目"></a>19、熟悉 Linux 基本命令, 使用过 Linux/Unix 系统, 可以编写 shell 脚本, 可以在 Linux 上部署项目</h3><h3 id="20、了解-windows-系统批处理脚本-bat"><a href="#20、了解-windows-系统批处理脚本-bat" class="headerlink" title="20、了解 windows 系统批处理脚本 bat"></a>20、了解 windows 系统批处理脚本 bat</h3><h3 id="21、了解-HTML5-最好学习过"><a href="#21、了解-HTML5-最好学习过" class="headerlink" title="21、了解 HTML5, 最好学习过"></a>21、了解 HTML5, 最好学习过</h3><h3 id="22、熟悉一种-JS-框架-如-Prototype"><a href="#22、熟悉一种-JS-框架-如-Prototype" class="headerlink" title="22、熟悉一种 JS 框架, 如 Prototype"></a>22、熟悉一种 JS 框架, 如 Prototype</h3><h3 id="23、J2EE-原理-熟悉一种以上-web-容器如-Tomcat-JBoss-websphere-weblogic"><a href="#23、J2EE-原理-熟悉一种以上-web-容器如-Tomcat-JBoss-websphere-weblogic" class="headerlink" title="23、J2EE 原理 熟悉一种以上 web 容器如 Tomcat,JBoss,websphere,weblogic=="></a>23、J2EE 原理 熟悉一种以上 web 容器如 Tomcat,JBoss,websphere,weblogic==</h3><h3 id="24、熟悉-ant-或-maven"><a href="#24、熟悉-ant-或-maven" class="headerlink" title="24、熟悉 ant 或 maven"></a>24、熟悉 ant 或 maven</h3><h3 id="25、熟悉一门脚本语言-如-python-ruby"><a href="#25、熟悉一门脚本语言-如-python-ruby" class="headerlink" title="25、熟悉一门脚本语言, 如 python ,ruby"></a>25、熟悉一门脚本语言, 如 python ,ruby</h3><ol start="26">
<li>了解 php/ asp</li>
</ol>
<h3 id="27、了解-ftp-协议及原理"><a href="#27、了解-ftp-协议及原理" class="headerlink" title="27、了解 ftp 协议及原理"></a>27、了解 ftp 协议及原理</h3><h3 id="28、熟练使用-Junit-测试-熟悉-Mockito-等测试工具"><a href="#28、熟练使用-Junit-测试-熟悉-Mockito-等测试工具" class="headerlink" title="28、熟练使用 Junit 测试, 熟悉 Mockito 等测试工具"></a>28、熟练使用 Junit 测试, 熟悉 Mockito 等测试工具</h3><h3 id="29、熟悉-javac-javadoc-native-native2ascii-等常用命令"><a href="#29、熟悉-javac-javadoc-native-native2ascii-等常用命令" class="headerlink" title="29、熟悉 javac,javadoc,native,native2ascii 等常用命令"></a>29、熟悉 javac,javadoc,native,native2ascii 等常用命令</h3><h3 id="30、熟悉常用的排序算法-如冒泡排序-快速排序等-最好自己研究过一些的算法-下面的这个就是我曾经研究过的一个"><a href="#30、熟悉常用的排序算法-如冒泡排序-快速排序等-最好自己研究过一些的算法-下面的这个就是我曾经研究过的一个" class="headerlink" title="30、熟悉常用的排序算法, 如冒泡排序, 快速排序等, 最好自己研究过一些的算法, 下面的这个就是我曾经研究过的一个:"></a>30、熟悉常用的排序算法, 如冒泡排序, 快速排序等, 最好自己研究过一些的算法, 下面的这个就是我曾经研究过的一个:</h3><p>http wenku baidu com /view/391db3f0941ea76e58fa04e9 点 html<br><a target="_blank" rel="noopener" href="http://wenku.baidu.com/view.391db3f0941ea76e58fa04e9.html">http://wenku.baidu.com/view.391db3f0941ea76e58fa04e9.html</a></p>
<h3 id="31、了解-Flex-不学也没关系"><a href="#31、了解-Flex-不学也没关系" class="headerlink" title="31、了解 Flex(不学也没关系)"></a>31、了解 Flex(不学也没关系)</h3><h3 id="32、了解敏捷开发模式"><a href="#32、了解敏捷开发模式" class="headerlink" title="32、了解敏捷开发模式"></a>32、了解敏捷开发模式</h3><h3 id="33、工作流-workflow-至少用过一种-如-OSworkflow-了解原理"><a href="#33、工作流-workflow-至少用过一种-如-OSworkflow-了解原理" class="headerlink" title="33、工作流 workflow 至少用过一种, 如 OSworkflow, 了解原理"></a>33、工作流 workflow 至少用过一种, 如 OSworkflow, 了解原理</h3><h3 id="34、使用过-VPN-了解其原理"><a href="#34、使用过-VPN-了解其原理" class="headerlink" title="34、使用过 VPN 了解其原理"></a>34、使用过 VPN 了解其原理</h3><h3 id="35、熟悉-jstl-表达式和-el-表达式"><a href="#35、熟悉-jstl-表达式和-el-表达式" class="headerlink" title="35、熟悉 jstl 表达式和 el 表达式"></a>35、熟悉 jstl 表达式和 el 表达式</h3><h3 id="36、熟悉-webservice-WSDL-SOAP"><a href="#36、熟悉-webservice-WSDL-SOAP" class="headerlink" title="36、熟悉 webservice,WSDL,SOAP"></a>36、熟悉 webservice,WSDL,SOAP</h3><h3 id="37、图片处理-如图片上传-预览-限制大小等-下面共享一-垃圾勿喷"><a href="#37、图片处理-如图片上传-预览-限制大小等-下面共享一-垃圾勿喷" class="headerlink" title="37、图片处理, 如图片上传, 预览, 限制大小等, 下面共享一 (垃圾勿喷):"></a>37、图片处理, 如图片上传, 预览, 限制大小等, 下面共享一 (垃圾勿喷):</h3><p>http wenku baidu com/view/05337bfc770bf78a6529541b 点 html</p>
<h3 id="38、版本控制工具-CVS-VSS-SVN"><a href="#38、版本控制工具-CVS-VSS-SVN" class="headerlink" title="38、版本控制工具, CVS VSS SVN"></a>38、版本控制工具, CVS VSS SVN</h3><h3 id="39、JSON-技术-JSON-AJAX"><a href="#39、JSON-技术-JSON-AJAX" class="headerlink" title="39、JSON 技术, JSON+AJAX"></a>39、JSON 技术, JSON+AJAX</h3><h3 id="40、分页技术-最好自己实现过不仅仅是用过要知道原理"><a href="#40、分页技术-最好自己实现过不仅仅是用过要知道原理" class="headerlink" title="40、分页技术, 最好自己实现过不仅仅是用过要知道原理"></a>40、分页技术, 最好自己实现过不仅仅是用过要知道原理</h3><h3 id="41、Java-Mail"><a href="#41、Java-Mail" class="headerlink" title="41、Java Mail"></a>41、Java Mail</h3><h3 id="42、Java-读写-txt-excel"><a href="#42、Java-读写-txt-excel" class="headerlink" title="42、Java 读写 txt,excel"></a>42、Java 读写 txt,excel</h3><p>JXL 技术</p>
<h3 id="43、JVM-原理-JVM-内存管理-GC-Java-堆栈池"><a href="#43、JVM-原理-JVM-内存管理-GC-Java-堆栈池" class="headerlink" title="43、JVM 原理, JVM 内存管理, GC,Java 堆栈池"></a>43、JVM 原理, JVM 内存管理, GC,Java 堆栈池</h3><h3 id="44、熟练使用下面的工具"><a href="#44、熟练使用下面的工具" class="headerlink" title="44、熟练使用下面的工具:"></a>44、熟练使用下面的工具:</h3><ul>
<li>office 办公软件, word,excel,ppt 等</li>
<li>plsql,sqldevelop 数据库开发工具</li>
<li>outlook 大公司都用</li>
<li>ue 编辑器</li>
<li>浏览器控制台, 调试</li>
<li>SHH/PUTTY 远程</li>
</ul>
<h3 id="45、UML-建模工具-Rational-Rose-等"><a href="#45、UML-建模工具-Rational-Rose-等" class="headerlink" title="45、UML 建模工具 Rational Rose 等"></a>45、UML 建模工具 Rational Rose 等</h3><h3 id="46、使用-log4j"><a href="#46、使用-log4j" class="headerlink" title="46、使用 log4j"></a>46、使用 log4j</h3><h3 id="47、使用过开放-API-如百度地图-腾讯街景-新浪微博等"><a href="#47、使用过开放-API-如百度地图-腾讯街景-新浪微博等" class="headerlink" title="47、使用过开放 API 如百度地图, 腾讯街景, 新浪微博等"></a>47、使用过开放 API 如百度地图, 腾讯街景, 新浪微博等</h3><h3 id="48、页面静态化技术-伪静态页面-UrlRwriter"><a href="#48、页面静态化技术-伪静态页面-UrlRwriter" class="headerlink" title="48、页面静态化技术 (伪静态页面)UrlRwriter"></a>48、页面静态化技术 (伪静态页面)UrlRwriter</h3><h3 id="49、报表技术-使用过报表制作工具-如水晶易表"><a href="#49、报表技术-使用过报表制作工具-如水晶易表" class="headerlink" title="49、报表技术, 使用过报表制作工具, 如水晶易表"></a>49、报表技术, 使用过报表制作工具, 如水晶易表</h3><h3 id="50、定时任务-如-Spring-batch-学会自定义-batch-任务-不适用第三方工具"><a href="#50、定时任务-如-Spring-batch-学会自定义-batch-任务-不适用第三方工具" class="headerlink" title="50、定时任务, 如 Spring batch, 学会自定义 batch 任务 (不适用第三方工具)"></a>50、定时任务, 如 Spring batch, 学会自定义 batch 任务 (不适用第三方工具)</h3><h3 id="51、了解-uuid"><a href="#51、了解-uuid" class="headerlink" title="51、了解 uuid"></a>51、了解 uuid</h3><h3 id="52、B-s-和-C-s-架构"><a href="#52、B-s-和-C-s-架构" class="headerlink" title="52、B/s 和 C/s 架构"></a>52、B/s 和 C/s 架构</h3><h3 id="53、正则表达式"><a href="#53、正则表达式" class="headerlink" title="53、正则表达式"></a>53、正则表达式</h3><h3 id="54、了解-JNDI-JMS"><a href="#54、了解-JNDI-JMS" class="headerlink" title="54、了解 JNDI JMS"></a>54、了解 JNDI JMS</h3><h3 id="55、ERP"><a href="#55、ERP" class="headerlink" title="55、ERP"></a>55、ERP</h3><h3 id="56、unicode-编码-乱码的解决"><a href="#56、unicode-编码-乱码的解决" class="headerlink" title="56、unicode 编码, 乱码的解决"></a>56、unicode 编码, 乱码的解决</h3><h3 id="57、开源网络编辑器-如-ckEditor"><a href="#57、开源网络编辑器-如-ckEditor" class="headerlink" title="57、开源网络编辑器, 如 ckEditor"></a>57、开源网络编辑器, 如 ckEditor</h3><h3 id="58、二进制原理"><a href="#58、二进制原理" class="headerlink" title="58、二进制原理"></a>58、二进制原理</h3><h3 id="59、使用过-了解开源论坛框架-如-discuzz"><a href="#59、使用过-了解开源论坛框架-如-discuzz" class="headerlink" title="59、使用过, 了解开源论坛框架, 如 discuzz"></a>59、使用过, 了解开源论坛框架, 如 discuzz</h3><h3 id="60、GWT-Closure-框架"><a href="#60、GWT-Closure-框架" class="headerlink" title="60、GWT ,Closure 框架"></a>60、GWT ,Closure 框架</h3><h3 id="61、了解-大数据-云计算"><a href="#61、了解-大数据-云计算" class="headerlink" title="61、了解 大数据, 云计算"></a>61、了解 大数据, 云计算</h3><h3 id="62、搜索引擎搜索技术"><a href="#62、搜索引擎搜索技术" class="headerlink" title="62、搜索引擎搜索技术"></a>62、搜索引擎搜索技术</h3><h3 id="63、软件工程-项目管理"><a href="#63、软件工程-项目管理" class="headerlink" title="63、软件工程, 项目管理"></a>63、软件工程, 项目管理</h3><p><img src="https://img.rxliuli.com/20181126225820.png" alt="软件工程, 项目管理"></p>
<ol>
<li> 你需要精通面向对象分析与设计 (OOA/OOD)、涉及模式(GOF，J2EEDP) 以及综合模式。你应该十分了解 UML，尤其是 class，object，interaction 以及 statediagrams。</li>
<li> 你需要学习 JAVA 语言的基础知识以及它的核心类库 (collections，serialization，streams，networking， multithreading，reflection，event，handling，NIO，localization，以及其他)。</li>
<li> 你应该了解 JVM，classloaders，classreflect，以及垃圾回收的基本工作机制等。你应该有能力反编译一个类文件并且明白一些基本的汇编指令。</li>
<li>如果你将要写客户端程序，你需要学习 WEB 的小应用程序 (applet)，必需掌握 GUI 设计的思想和方法，以及桌面程序的 SWING，AWT， SWT。你还应该对 UI 部件的 JAVABEAN 组件模式有所了解。<br> JAVABEANS 也被应用在 JSP 中以把业务逻辑从表现层中分离出来。</li>
<li> 你需要学习 java 数据库技术，如 JDBCAPI 并且会使用至少一种 persistence/ORM 构架，例如 Hibernate，JDO， CocoBase，TopLink，InsideLiberator(国产 JDO 红工厂软件) 或者 iBatis。</li>
<li> 你还应该了解对象关系的阻抗失配的含义，以及它是如何影响业务对象的与关系型数据库的交互，和它的运行结果，还需要掌握不同的数据库产品运用，比如: oracle，mysql，mssqlserver。</li>
<li>你需要学习 JAVA 的沙盒安全模式 (classloaders，bytecodeverification，managers，policyandpermissions，<br> codesigning， digitalsignatures，cryptography，certification，Kerberos，以及其他) 还有不同的安全 / 认证 API，例如 JAAS(JavaAuthenticationandAuthorizationService)，<br> JCE (JavaCryptographyExtension)，JSSE(JavaSecureSocketExtension)，以及 JGSS (JavaGeneralSecurityService)。</li>
<li> 你需要学习 Servlets，JSP，以及 JSTL(StandardTagLibraries) 和可以选择的第三方 TagLibraries。</li>
<li> 你需要熟悉主流的网页框架，例如 JSF，Struts，Tapestry，Cocoon，WebWork，以及他们下面的涉及模式，如 MVC/MODEL2。</li>
<li> 你需要学习如何使用及管理 WEB 服务器，例如 tomcat，resin，Jrun，并且知道如何在其基础上扩展和维护 WEB 程序。</li>
<li> 你需要学习分布式对象以及远程 API，例如 RMI 和 RMI/IIOP。</li>
<li> 你需要掌握各种流行中间件技术标准和与 java 结合实现，比如 Tuxedo、CROBA，当然也包括 javaEE 本身。</li>
<li> 你需要学习最少一种的 XMLAPI，例如 JAXP(JavaAPIforXMLProcessing)，JDOM(JavaforXMLDocumentObjectModel)，DOM4J，或 JAXR(JavaAPIforXMLRegistries)。</li>
<li>你应该学习如何利用 JAVAAPI 和工具来构建 WebService。例如 JAX-RPC(JavaAPIforXML/RPC)，SAAJ (SOAPwithAttachmentsAPIforJava)，JAXB(JavaArchitectureforXMLBinding)，<br> JAXM(JavaAPIforXMLMessaging)， JAXR(JavaAPIforXMLRegistries)，或者 JWSDP(JavaWebServicesDeveloperPack)。</li>
<li> 你需要学习一门轻量级应用程序框架，例如 Spring，PicoContainer，Avalon，以及它们的 IoC/DI 风格 (setter，constructor，interfaceinjection)。</li>
<li> 你需要熟悉不同的 J2EE 技术，例如 JNDI(JavaNamingandDirectoryInterface)，JMS (JavaMessageService)，JTA/JTS(JavaTransactionAPI/JavaTransactionService)</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/04/18/22dfbce551e24b8b8c1cf4c1d836b47c/" data-id="ckmcqox5k00bq0kuvhp2a9yjg" data-title="成为 Java 高级程序员需要掌握哪些？" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">转载</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-6886ab3897dd418bb78f2f884df97ad1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/18/6886ab3897dd418bb78f2f884df97ad1/" class="article-date">
  <time class="dt-published" datetime="2020-04-18T02:14:09.000Z" itemprop="datePublished">2020-04-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/18/6886ab3897dd418bb78f2f884df97ad1/">SpringBoot 集成 WebSocket</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li><a href="#springboot-%E9%9B%86%E6%88%90-websocket">SpringBoot 集成 WebSocket</a><ul>
<li><a href="#%E5%9C%BA%E6%99%AF--%E9%9C%80%E6%B1%82">场景 &amp; 需求</a></li>
<li><a href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86">前置知识</a></li>
<li><a href="#%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96">引入依赖</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE-springboot-websocket-%E6%94%AF%E6%8C%81">配置 <code>SpringBoot WebSocket</code> 支持</a></li>
<li><a href="#%E5%8F%8C%E5%90%91%E5%B9%BF%E6%92%AD%E6%9C%8D%E5%8A%A1%E7%AB%AF">双向广播服务端</a></li>
<li><a href="#%E5%8F%8C%E5%90%91%E5%B9%BF%E6%92%AD%E5%AE%A2%E6%88%B7%E7%AB%AF">双向广播客户端</a></li>
<li><a href="#%E5%8D%95%E5%90%91%E5%B9%BF%E6%92%AD%E6%9C%8D%E5%8A%A1%E7%AB%AF">单向广播服务端</a></li>
<li><a href="#%E5%8D%95%E5%90%91%E5%B9%BF%E6%92%AD%E5%AE%A2%E6%88%B7%E7%AB%AF">单向广播客户端</a></li>
<li><a href="#%E7%82%B9%E5%AF%B9%E7%82%B9%E6%8E%A8%E9%80%81%E6%9C%8D%E5%8A%A1%E7%AB%AF">点对点推送服务端</a></li>
<li><a href="#%E7%82%B9%E5%AF%B9%E7%82%B9%E6%8E%A8%E9%80%81%E5%AE%A2%E6%88%B7%E7%AB%AF">点对点推送客户端</a></li>
<li><a href="#%E5%8D%95%E5%90%91%E7%82%B9%E5%AF%B9%E7%82%B9%E6%8E%A8%E9%80%81%E6%9C%8D%E5%8A%A1%E7%AB%AF">单向点对点推送服务端</a></li>
<li><a href="#%E5%8D%95%E5%90%91%E7%82%B9%E5%AF%B9%E7%82%B9%E6%8E%A8%E9%80%81%E5%AE%A2%E6%88%B7%E7%AB%AF">单向点对点推送客户端</a></li>
<li><a href="#%E8%AE%B0%E5%BD%95-user---socket-%E4%BC%9A%E8%AF%9D%E5%AF%B9%E5%BA%94%E7%9A%84%E6%98%A0%E5%B0%84%E8%A1%A8">记录 user -&gt; Socket 会话对应的映射表</a></li>
<li><a href="#%E6%8E%A5%E5%8F%97%E8%BF%94%E5%9B%9E%E5%A4%8D%E6%9D%82%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%B6%88%E6%81%AF%E6%9C%8D%E5%8A%A1%E7%AB%AF">接受/返回复杂类型的消息（服务端）</a></li>
<li><a href="#%E5%8F%91%E9%80%81%E8%AE%A2%E9%98%85%E5%A4%8D%E6%9D%82%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%B6%88%E6%81%AF%E5%AE%A2%E6%88%B7%E7%AB%AF">发送/订阅复杂类型的消息（客户端）</a></li>
<li><a href="#websocket-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%B0%81%E8%A3%85">WebSocket 客户端封装</a></li>
</ul>
</li>
</ul>
<h2 id="场景-amp-需求"><a href="#场景-amp-需求" class="headerlink" title="场景 &amp; 需求"></a>场景 &amp; 需求</h2><ol>
<li> 客户端发送请求后，服务端进行处理后可以对所有的客户端进行 <strong>广播</strong></li>
<li> 服务端可以在任何时候主动对所有客户端进行 <strong>广播</strong></li>
<li> 客户端发送请求后，服务端进行处理后可以对指定客户端进行 <strong>点对点推送</strong></li>
<li> 服务端可以在任何时候主动对指定客户端进行 <strong>点对点推送</strong></li>
<li> 服务端可以在任何时候主动对指定某些客户端进行 <strong>广播</strong></li>
<li> 服务端可以识别客户端（状态），并以此进行 <strong>点对点推送</strong></li>
</ol>
<h2 id="前置要求"><a href="#前置要求" class="headerlink" title="前置要求"></a>前置要求</h2><p>本文假设你已经了解或知道以下技能，尤其而且是勾选的内容。</p>
<ul>
<li>[x] Java</li>
<li>[x] Maven</li>
<li>[x] SpringBoot</li>
</ul>
<h2 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h2><p>创建一个 <code>SpringBoot</code> 项目，并添加 <code>spring-boot-starter-websocket</code> 依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring boot web socket--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="配置-SpringBoot-WebSocket-支持"><a href="#配置-SpringBoot-WebSocket-支持" class="headerlink" title="配置 SpringBoot WebSocket 支持"></a>配置 <code>SpringBoot WebSocket</code> 支持</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 配置 SpringBoot WebSocket 支持</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSocketMessageBroker</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringWebSocketConfig</span> <span class="keyword">extends</span> <span class="title">AbstractWebSocketMessageBrokerConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册一个 Socket 端点</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> stompEndpointRegistry stomp 端点注册表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerStompEndpoints</span><span class="params">(StompEndpointRegistry stompEndpointRegistry)</span> </span>&#123;</span><br><span class="line">        stompEndpointRegistry.addEndpoint(<span class="string">&quot;/endpoint&quot;</span>)</span><br><span class="line">                <span class="comment">//设置允许所有源请求（跨域）</span></span><br><span class="line">                .setAllowedOrigins(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                .withSockJS();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册一些广播消息代理</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry 消息代理注册对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageBroker</span><span class="params">(MessageBrokerRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//注册简单代理（里面是前缀）</span></span><br><span class="line">        <span class="comment">//注：默认 topic 是主题（广播），user 则是用户（点对点）</span></span><br><span class="line">        registry.enableSimpleBroker(<span class="string">&quot;/topic&quot;</span>, <span class="string">&quot;/user&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="双向广播服务端"><a href="#双向广播服务端" class="headerlink" title="双向广播服务端"></a>双向广播服务端</h2><p>客户端发送请求后，服务端进行处理后可以对所有的客户端进行 <strong>广播</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 双向广播控制器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BilateralBroadcastingSocket</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 广播推送</span></span><br><span class="line"><span class="comment">     * 注解 <span class="doctag">@Payload</span> 是为了绑定消息到参数 text 上</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text      简单的文本信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sessionId 当前请求 socket 会话 id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 会话 id 和消息内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@MessageMapping(value = &quot;/talk&quot;)</span></span><br><span class="line">    <span class="meta">@SendTo(&quot;/topic/broadcasting/bilateral/allClient&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">talk</span><span class="params">(<span class="meta">@Payload</span> String text, <span class="meta">@Header(&quot;simpSessionId&quot;)</span> String sessionId)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//模拟处理其他事情</span></span><br><span class="line">        Thread.sleep(<span class="number">1000L</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;[ &quot;</span> + sessionId + <span class="string">&quot;] 说: [&quot;</span> + text + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="双向广播客户端"><a href="#双向广播客户端" class="headerlink" title="双向广播客户端"></a>双向广播客户端</h2><p>向服务端发送消息，并监听服务端的广播。客户端发送消息与监听是分离的，也可以只向服务端发送消息而不监听广播，或者只接收广播不发送消息。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    &lt;script</span><br><span class="line">      type=&quot;application/javascript&quot;</span><br><span class="line">      src=&quot;https://cdn.bootcss.com/sockjs-client/1.1.4/sockjs.min.js&quot;</span><br><span class="line">    &gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    &lt;script</span><br><span class="line">      type=&quot;application/javascript&quot;</span><br><span class="line">      src=&quot;https://cdn.bootcss.com/stomp.js/2.3.3/stomp.min.js&quot;</span><br><span class="line">    &gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> socket = <span class="keyword">new</span> SockJS(<span class="string">&quot;http://127.0.0.1:8080/endpoint&quot;</span>);</span></span><br><span class="line">      stompClient = Stomp.over(socket);</span><br><span class="line">      stompClient.connect(</span><br><span class="line">        &#123;&#125;,</span><br><span class="line"><span class="javascript">        <span class="comment">// 连接成功回调函数</span></span></span><br><span class="line">        (frame) =&gt; &#123;</span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="string">&quot;服务端 Socket 连接建立&quot;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">          <span class="comment">// 获取 websocket 连接的 sessionId</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> sessionId = <span class="regexp">/\/([^\/]+)\/websocket/</span>.exec(</span></span><br><span class="line">            socket._transport.url</span><br><span class="line">          )[1];</span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="string">&quot;connected, session id: &quot;</span> + sessionId);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">          <span class="comment">// 订阅广播消息（双向通信）</span></span></span><br><span class="line"><span class="javascript">          <span class="comment">// 这里是关键（订阅了服务端的 topic）</span></span></span><br><span class="line">          stompClient.subscribe(</span><br><span class="line"><span class="javascript">            <span class="string">&quot;/topic/broadcasting/bilateral/allClient&quot;</span>,</span></span><br><span class="line">            (res) =&gt; &#123;</span><br><span class="line"><span class="javascript">              <span class="built_in">console</span>.log(<span class="string">`[广播（双向通信）]: <span class="subst">$&#123;res.body&#125;</span>`</span>);</span></span><br><span class="line">            &#125;</span><br><span class="line">          );</span><br><span class="line"></span><br><span class="line"><span class="javascript">          <span class="comment">// 发送请求</span></span></span><br><span class="line">          send();</span><br><span class="line">        &#125;,</span><br><span class="line">        (error) =&gt; &#123;</span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="string">&quot;Socket 连接失败&quot;</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">send</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 发送一个消息到服务端</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 发送消息到服务端</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> headers = &#123;&#125;;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> body = &#123;</span></span><br><span class="line"><span class="javascript">          message: <span class="string">&quot;消息内容&quot;</span>,</span></span><br><span class="line">        &#125;;</span><br><span class="line"><span class="javascript">        stompClient.send(<span class="string">&quot;/talk&quot;</span>, headers, <span class="built_in">JSON</span>.stringify(body));</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      /**</span><br><span class="line">       * 监听窗口关闭事件，窗口关闭前，主动关闭连接，防止连接还没断开就关闭窗口，server 端会抛异常</span><br><span class="line">       */</span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.onbeforeunload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (stompClient !== <span class="literal">null</span>) &#123;</span></span><br><span class="line">          stompClient.disconnect();</span><br><span class="line">          socket.close();</span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;断开连接&quot;</span>);</span></span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="单向广播服务端"><a href="#单向广播服务端" class="headerlink" title="单向广播服务端"></a>单向广播服务端</h2><p>从服务端推送消息到所有客户端，是单向推送到客户端的，不接受从客户端的输入。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 单向广播控制器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnidirectionalBroadcastingSocket</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从服务端推送消息到所有客户端</span></span><br><span class="line"><span class="comment">     * 这是单向推送到客户端的，不接受从客户端的输入</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SendTo(&quot;/topic/broadcasting/unidirectional/allClient&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">broadcasting</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用 Scheduled 不停的推送信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledRefreshJob</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SimpMessagingTemplate simpMessagingTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 不停地推送消息到客户端</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Scheduled(fixedDelay = 10 * 1000)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scheduledBroadcasting</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        simpMessagingTemplate.convertAndSend(<span class="string">&quot;/topic/broadcasting/unidirectional/allClient&quot;</span>, <span class="keyword">new</span> Person(<span class="number">1L</span>, <span class="string">&quot;rx&quot;</span>, <span class="keyword">false</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="单向广播客户端"><a href="#单向广播客户端" class="headerlink" title="单向广播客户端"></a>单向广播客户端</h2><p>客户端只需要添加一个监听器就好了，不需要也不能向服务端发送消息。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订阅广播消息（服务端单向推送）</span></span><br><span class="line"><span class="keyword">const</span> subscription_broadcast = stompClient.subscribe(</span><br><span class="line">  <span class="string">&quot;/topic/broadcasting/unidirectional/allClient&quot;</span>,</span><br><span class="line">  (response) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`[广播（服务端单向推送）]: <span class="subst">$&#123;response.body&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="点对点推送服务端"><a href="#点对点推送服务端" class="headerlink" title="点对点推送服务端"></a>点对点推送服务端</h2><p>服务端使用 <code>@SendToUser(path)</code> 向单个客户端推送消息，这里的 <code>@Header(&quot;simpSessionId&quot;)</code> 指的是从客户端的请求头中的 <code>simpSessionId</code> 参数赋值给 <code>sessionId</code>（<code>WebSocket</code> 会话 <code>ID</code>，和用户 <code>Session</code> 不同，是每一个 <code>WebSocket</code> 唯一的 #即和用户不是一一对应）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 双向点对点推送控制器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BilateralPushSocket</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 点对点推送（双向通信）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text      消息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sessionId 会话 id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 推送到当前会话的消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@MessageMapping(&quot;/speak&quot;)</span></span><br><span class="line">    <span class="meta">@SendToUser(&quot;/push/bilateral/thisClient&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">speak</span><span class="params">(<span class="meta">@Payload</span> String text, <span class="meta">@Header(&quot;simpSessionId&quot;)</span> String sessionId)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//模拟处理其他事情</span></span><br><span class="line">        Thread.sleep(<span class="number">1000L</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;[ &quot;</span> + sessionId + <span class="string">&quot;] send: [&quot;</span> + text + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="点对点推送客户端"><a href="#点对点推送客户端" class="headerlink" title="点对点推送客户端"></a>点对点推送客户端</h2><p>客户端请求的路径需要注意一下，是以 <code>/user/$&#123;sessionId&#125;</code> 开头，后面才是 <code>@SendToUser(path)</code> 中设置的 <code>path</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订阅私人消息（双向通信）</span></span><br><span class="line">stompClient.subscribe(<span class="string">`/user/<span class="subst">$&#123;sessionId&#125;</span>/push/bilateral/thisClient`</span>, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`[点对点推送（双向通信）]: <span class="subst">$&#123;res.body&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="单向点对点推送服务端"><a href="#单向点对点推送服务端" class="headerlink" title="单向点对点推送服务端"></a>单向点对点推送服务端</h2><p>其实和上面双向的点对点推送没什么太大的差别，就是只用 <code>@SendToUser(path)</code> 而不用 <code>@MessageMapping(path)</code> 了而已</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 单向点对点推送服务端</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnidirectionalPushSocket</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从服务端推送消息到所有客户端</span></span><br><span class="line"><span class="comment">     * 这是单向推送到客户端的，不接受从客户端的输入</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SendToUser(&quot;/push/unidirectional/thisClient&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">push</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用 Scheduled 不停的推送信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledRefreshJob</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SimpMessagingTemplate simpMessagingTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 不停推送消息到某个指定的客户端</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Scheduled(fixedDelay = 10 * 1000)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scheduledPush</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        simpMessagingTemplate.convertAndSendToUser(<span class="string">&quot;r2qspi4s&quot;</span>, <span class="string">&quot;/push/unidirectional/thisClient&quot;</span>, <span class="keyword">new</span> Person(<span class="number">2L</span>, <span class="string">&quot;琉璃&quot;</span>, <span class="keyword">false</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="单向点对点推送客户端"><a href="#单向点对点推送客户端" class="headerlink" title="单向点对点推送客户端"></a>单向点对点推送客户端</h2><p>客户端和上面的双向点对点推送基本一致（完全一样好么？！）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订阅私人消息（单向通信）</span></span><br><span class="line">stompClient.subscribe(</span><br><span class="line">  <span class="string">`/user/<span class="subst">$&#123;sessionId&#125;</span>/push/unidirectional/thisClient`</span>,</span><br><span class="line">  (res) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`[点对点推送（单向通信）]：<span class="subst">$&#123;res.body&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="记录-user-gt-Socket-会话对应的映射表"><a href="#记录-user-gt-Socket-会话对应的映射表" class="headerlink" title="记录 user -&gt; Socket 会话对应的映射表"></a>记录 user -&gt; Socket 会话对应的映射表</h2><p>上面的点对点推送客户端几乎是没什么用处的（尤其而且是 <a href="#%E5%8D%95%E5%90%91%E7%82%B9%E5%AF%B9%E7%82%B9%E6%8E%A8%E9%80%81%E6%9C%8D%E5%8A%A1%E7%AB%AF">单向点对点推送</a>），因为每次创建的 <code>Socket</code> 连接都会变化，而没有与用户建立对应关系的话怎无法知道哪个用户对应的哪个人，也就不能发送消息给指定的用户（非 <code>Socket Session Id</code>）了<br>。</p>
<ol>
<li> 首先需要一个记录用户 <code>Socket Session Id</code> 的类，并注册为 SpringBoot 的组件。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 用户 session 记录类</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SocketSessionRegistry</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 未登录的用户默认存储的 user id</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DIRECT_TOURIST = <span class="string">&quot;DIRECT_TOURIST&quot;</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 这个集合存储 用户 id -&gt; session 列表</span></span><br><span class="line"><span class="comment">    * 单个用户可能打开多个页面，就会出现多个 Socket 会话</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConcurrentMap&lt;String, Set&lt;String&gt;&gt; userSessionIds = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object lock = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 根据 user id 获取 sessionId</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> user 用户 id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> 用户关联的 sessionId</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">getSessionIds</span><span class="params">(String user)</span> </span>&#123;</span><br><span class="line">        Set&lt;String&gt; set = <span class="keyword">this</span>.userSessionIds.get(user);</span><br><span class="line">        <span class="keyword">return</span> set != <span class="keyword">null</span> ? set : Collections.emptySet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 获取所有 session</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> 所有的 用户 id -&gt; session 列表</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> ConcurrentMap&lt;String, Set&lt;String&gt;&gt; getAllSessionIds() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userSessionIds;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 根据用户 id 注册一个 session</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> user      用户 id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> sessionId Socket 会话 id</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerSessionId</span><span class="params">(String user, String sessionId)</span> </span>&#123;</span><br><span class="line">        Assert.notNull(user, <span class="string">&quot;User must not be null&quot;</span>);</span><br><span class="line">        Assert.notNull(sessionId, <span class="string">&quot;Session ID must not be null&quot;</span>);</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>.lock) &#123;</span><br><span class="line">            Set&lt;String&gt; set = <span class="keyword">this</span>.userSessionIds.get(user);</span><br><span class="line">            <span class="keyword">if</span> (set == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.userSessionIds.put(user, <span class="keyword">new</span> CopyOnWriteArraySet&lt;&gt;());</span><br><span class="line">            &#125;</span><br><span class="line">            set.add(sessionId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 根据用户 id 删除一个 session</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> user      用户 id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> sessionId Socket 会话 id</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unregisterSessionId</span><span class="params">(String user, String sessionId)</span> </span>&#123;</span><br><span class="line">        Assert.notNull(user, <span class="string">&quot;User Name must not be null&quot;</span>);</span><br><span class="line">        Assert.notNull(sessionId, <span class="string">&quot;Session ID must not be null&quot;</span>);</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>.lock) &#123;</span><br><span class="line">            Set set = <span class="keyword">this</span>.userSessionIds.get(user);</span><br><span class="line">            <span class="keyword">if</span> (set != <span class="keyword">null</span> &amp;&amp; set.remove(sessionId) &amp;&amp; set.isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">this</span>.userSessionIds.remove(user);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li> 监听 <code>WebSocket</code> 连接建立和关闭事件</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 会话事件监听基类</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseSessionEventListener</span>&lt;<span class="title">Event</span> <span class="keyword">extends</span> <span class="title">AbstractSubProtocolEvent</span>&gt; <span class="keyword">implements</span> <span class="title">ApplicationListener</span>&lt;<span class="title">Event</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(getClass());</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">protected</span> SocketSessionRegistry webAgentSessionRegistry;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 计算出 user id 和 session id 并传入到自定义的函数中</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> event      事件</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> biConsumer 自定义的操作</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">using</span><span class="params">(Event event, BiConsumer&lt;String, String&gt; biConsumer)</span> </span>&#123;</span><br><span class="line">        StompHeaderAccessor sha = StompHeaderAccessor.wrap(event.getMessage());</span><br><span class="line">        <span class="comment">//login get from browser</span></span><br><span class="line">        List&lt;String&gt; shaNativeHeader = sha.getNativeHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        String user;</span><br><span class="line">        <span class="keyword">if</span> (shaNativeHeader == <span class="keyword">null</span> || shaNativeHeader.isEmpty()) &#123;</span><br><span class="line">            user = <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            user = shaNativeHeader.get(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果当前用户没有登录（没有认证信息），就添加到游客里面</span></span><br><span class="line">        <span class="keyword">if</span> (user == <span class="keyword">null</span> || <span class="string">&quot;&quot;</span>.equals(user) || <span class="string">&quot;undefined&quot;</span>.equals(user) || <span class="string">&quot;null&quot;</span>.equals(user)) &#123;</span><br><span class="line">            user = SocketSessionRegistry.DIRECT_TOURIST;</span><br><span class="line">        &#125;</span><br><span class="line">        String sessionId = sha.getSessionId();</span><br><span class="line">        biConsumer.accept(user, sessionId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Socket 连接建立监听</span></span><br><span class="line"><span class="comment">* 用于 session 注册 以及 key 值获取</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionConnectEventListener</span> <span class="keyword">extends</span> <span class="title">BaseSessionEventListener</span>&lt;<span class="title">SessionConnectEvent</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(SessionConnectEvent event)</span> </span>&#123;</span><br><span class="line">        using(event, (user, sessionId) -&gt; webAgentSessionRegistry.registerSessionId(user, sessionId));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Socket 会话断开监听</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionDisconnectEventListener</span> <span class="keyword">extends</span> <span class="title">BaseSessionEventListener</span>&lt;<span class="title">SessionDisconnectEvent</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(SessionDisconnectEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//这里先根据 session id 查询出 user，然后删除对应的会话 id</span></span><br><span class="line">        <span class="comment">//前端无法传递 token 到这里却是只能出此下策了</span></span><br><span class="line">        using(event, (user, sessionId) -&gt; webAgentSessionRegistry.getAllSessionIds().entrySet().stream()</span><br><span class="line">                .filter(sse -&gt; sse.getValue().contains(sessionId))</span><br><span class="line">                .findFirst()</span><br><span class="line">                .ifPresent(sse -&gt; &#123;</span><br><span class="line">                    webAgentSessionRegistry.unregisterSessionId(sse.getKey(), sessionId);</span><br><span class="line">                    log.info(<span class="string">&quot;Socket 连接断开，用户：&#123;&#125;，会话：&#123;&#125;&quot;</span>, sse.getKey(), sessionId);</span><br><span class="line">                &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li> 客户端在打开和关闭连接的时候需要发送 user 给服务端</li>
</ol>
<p>这里使用 <code>headers</code> 存放用户认证信息（唯一标识），所以在连接和关闭时要带上请求头</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">stompClient.connect(getHeaders(), function()&#123;</span><br><span class="line">    console.log(<span class="string">&#x27;打开 Socket 连接&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// TODO 这里还有一些问题，无法带上 headers 到后端</span></span><br><span class="line">stompClient.disconnect(function () &#123;</span><br><span class="line">    console.log(<span class="string">&#x27;断开连接&#x27;</span>);</span><br><span class="line">&#125;, getHeaders());</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取一个认证的 headers 信息</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> &#123;&#123;&quot;X-Requested-With&quot;: string, Authorization: any&#125;&#125; 含有认证信息的 headers 对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function">function <span class="title">getHeaders</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">          <span class="string">&#x27;X-Requested-With&#x27;</span>: <span class="string">&#x27;X-Requested-With&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;Authorization&#x27;</span>: localStorage.token</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li> 使用记录的 <code>user -&gt; session id</code> 发送消息给指定的用户</li>
</ol>
<p>下面是获取到所有已经登录的用户的 <code>WebSocket</code> 连接并发送一条消息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">socketSessionRegistry.getAllSessionIds().entrySet().stream()</span><br><span class="line">        .filter(kv -&gt; !SocketSessionRegistry.DIRECT_TOURIST.equals(kv.getKey()))</span><br><span class="line">        .forEach(kv -&gt; kv.getValue().forEach(sessionId -&gt; simpMessagingTemplate.convertAndSendToUser(sessionId, <span class="string">&quot;/push/unidirectional/thisClient&quot;</span>, <span class="keyword">new</span> Person(<span class="number">2L</span>, <span class="string">&quot;琉璃&quot;</span>, <span class="keyword">false</span>))));</span><br></pre></td></tr></table></figure>
<h2 id="接受-返回复杂类型的消息（服务端）"><a href="#接受-返回复杂类型的消息（服务端）" class="headerlink" title="接受/返回复杂类型的消息（服务端）"></a>接受/返回复杂类型的消息（服务端）</h2><p>其实看起来和刚才是没什么区别的，但 <code>SpringBoot WebSocket</code> 原本就对消息进行了解析/封装，所以我们不需要再去手动转换了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 接受和发送复杂类型的消息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ComplexMessageSocket</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 接收/返回复杂类型 Person 的对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> person Person 类对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Person 类对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@MessageMapping(&quot;/complexMessage&quot;)</span></span><br><span class="line">    <span class="meta">@SendTo(&quot;/topic/complexMessage/allClient&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">complexMessage</span><span class="params">(Person person)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Person().setName(<span class="string">&quot;Mr. &quot;</span> + person.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="发送-订阅复杂类型的消息（客户端）"><a href="#发送-订阅复杂类型的消息（客户端）" class="headerlink" title="发送/订阅复杂类型的消息（客户端）"></a>发送/订阅复杂类型的消息（客户端）</h2><p>客户端和之前的也差不多，需要注意的就是无论是发送/接受都需要将复杂类型的对象序列化为字符串（<code>JavaScript</code> 原生支持）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订阅返回复杂类型的消息</span></span><br><span class="line">stompClient.subscribe(<span class="string">&quot;/topic/complexMessage/allClient&quot;</span>, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;订阅复杂类型类型的返回消息：&#123;&#125;&quot;</span>, <span class="built_in">JSON</span>.parse(res.body));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送一个复杂类型的消息</span></span><br><span class="line">stompClient.send(</span><br><span class="line">  <span class="string">&quot;/complexMessage&quot;</span>,</span><br><span class="line">  headers,</span><br><span class="line">  <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">    id: <span class="number">17</span>,</span><br><span class="line">    name: <span class="string">&quot;rxliuli&quot;</span>,</span><br><span class="line">    sex: <span class="literal">false</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="WebSocket-客户端封装"><a href="#WebSocket-客户端封装" class="headerlink" title="WebSocket 客户端封装"></a>WebSocket 客户端封装</h2><p>每次这么一大堆的代码可以封装一下，吾辈也封装了一个 <code>StopmClient</code> 的客户端工具类，如果有什么不好的地方欢迎提出！</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * websocket 连接的工具类</span></span><br><span class="line"><span class="comment"> * 该工具类依赖于 sockjs-client 与 webstomp-client 两个类库</span></span><br><span class="line"><span class="comment"> * 使用方法：</span></span><br><span class="line"><span class="comment"> * 1. 设定 endpoint 属性</span></span><br><span class="line"><span class="comment"> * 2. 添加连接成功 / 失败的回调函数进行连接</span></span><br><span class="line"><span class="comment"> * 3. 订阅 / 发送消息</span></span><br><span class="line"><span class="comment"> * 4. 断开连接</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> socketUtil = &#123;</span><br><span class="line">  <span class="comment">//最大重连次数</span></span><br><span class="line">  maxLen: <span class="number">10</span>,</span><br><span class="line">  <span class="comment">//当前重连次数</span></span><br><span class="line">  currentLen: <span class="number">0</span>,</span><br><span class="line">  <span class="comment">// 每次连接的时间间隔</span></span><br><span class="line">  timeInterval: <span class="number">3000</span>,</span><br><span class="line">  <span class="comment">// 连接的 Socket 节点</span></span><br><span class="line">  endpoint: <span class="literal">undefined</span>,</span><br><span class="line">  <span class="comment">// Socket 连接信息</span></span><br><span class="line">  stompClient: <span class="literal">undefined</span>,</span><br><span class="line">  socket: <span class="literal">undefined</span>,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Socket 连接的方法</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">connectWebSocket</span>(<span class="params">successFn, errorFn</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.socket = <span class="keyword">new</span> SockJS(<span class="built_in">this</span>.endpoint);</span><br><span class="line">    <span class="built_in">this</span>.stompClient = Stomp.over(<span class="built_in">this</span>.socket);</span><br><span class="line">    <span class="built_in">this</span>.stompClient.connect(<span class="built_in">this</span>.getHeaders(), successFn, <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.currentLen++ &lt; <span class="built_in">this</span>.maxLen) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(</span><br><span class="line">          <span class="string">`Socket 连接失败，将在 <span class="subst">$&#123;<span class="built_in">this</span>.timeInterval / <span class="number">1000</span>&#125;</span>s 后重试`</span></span><br><span class="line">        );</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="built_in">this</span>.connectWebSocket(), <span class="number">3000</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Socket 连接失败次数过多，将不再重试&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      errorFn(error);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 断开连接的方法</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">disconnectWebSocket</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.stompClient) &#123;</span><br><span class="line">      <span class="built_in">this</span>.stompClient.disconnect(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;断开连接&quot;</span>);</span><br><span class="line">      &#125;, <span class="built_in">this</span>.getHeaders());</span><br><span class="line">      <span class="built_in">this</span>.socket.close();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取当前 Socket 连接的 session id</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">getSessionId</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="regexp">/\/([^\/]+)\/websocket/</span>.exec(<span class="built_in">this</span>.socket._transport.url)[<span class="number">1</span>];</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取一个认证的 headers 信息</span></span><br><span class="line"><span class="comment">   * 该方法可以被覆盖</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return <span class="type">&#123;&#123;&quot;X-Requested-With&quot;: string, Authorization: any&#125;</span></span>&#125; 含有认证信息的 headers 对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">getHeaders</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="string">&quot;X-Requested-With&quot;</span>: <span class="string">&quot;X-Requested-With&quot;</span>,</span><br><span class="line">      Authorization: <span class="built_in">localStorage</span>.token,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 发送简单文本类型的消息</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">sendText</span>(<span class="params">url, body, headers = &#123;&#125;</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.stompClient.send(url, headers, body);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 发送 json 类型的消息</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">sendJSON</span>(<span class="params">url, body, headers = &#123;&#125;</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.stompClient.send(url, headers, <span class="built_in">JSON</span>.stringify(body));</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 订阅简单文本类型的消息</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">subscribeText</span>(<span class="params">url, successFn</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.stompClient.subscribe(url, <span class="function">(<span class="params">res</span>) =&gt;</span> successFn(res));</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 订阅 json 类型的消息</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">subscribeJSON</span>(<span class="params">url, successFn</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.stompClient.subscribe(url, <span class="function">(<span class="params">res</span>) =&gt;</span></span><br><span class="line">      successFn(<span class="built_in">JSON</span>.parse(res.body))</span><br><span class="line">    );</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 取消订阅</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>obj 订阅对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">unsubscribe</span>(<span class="params">obj</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj &amp;&amp; obj.unsubscribe) &#123;</span><br><span class="line">      obj.unsubscribe();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/04/18/6886ab3897dd418bb78f2f884df97ad1/" data-id="ckmcqox5k00bs0kuv5p06hwjs" data-title="SpringBoot 集成 WebSocket" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-d5187232899b475982b26e999ed4f2a9" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/18/d5187232899b475982b26e999ed4f2a9/" class="article-date">
  <time class="dt-published" datetime="2020-04-18T02:14:09.000Z" itemprop="datePublished">2020-04-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/18/d5187232899b475982b26e999ed4f2a9/">使用 Spring 时进行测试</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li><a href="#%E4%BD%BF%E7%94%A8-spring-%E6%97%B6%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95">使用 Spring 时进行测试</a><ul>
<li><a href="#%E5%89%8D%E7%BD%AE%E8%A6%81%E6%B1%82">前置要求</a></li>
<li><a href="#%E6%A6%82%E7%95%A5">概略</a></li>
<li><a href="#%E6%99%AE%E9%80%9A%E6%B5%8B%E8%AF%95">普通测试</a></li>
<li><a href="#daoservice-%E5%B1%82%E6%B5%8B%E8%AF%95">Dao/Service 层测试</a><ul>
<li><a href="#%E6%89%8B%E5%8A%A8%E4%BD%BF%E7%94%A8-applicationcontext-%E5%8E%BB%E8%8E%B7%E5%8F%96-bean-%E7%84%B6%E5%90%8E%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95">手动使用 <code>ApplicationContext</code> 去获取 Bean 然后进行测试</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E8%87%AA%E5%8A%A8%E5%8A%A0%E8%BD%BD-spring-%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83">使用注解自动加载 Spring 测试环境</a></li>
</ul>
</li>
<li><a href="#web-%E5%B1%82%E6%B5%8B%E8%AF%95">Web 层测试</a><ul>
<li><a href="#%E7%8B%AC%E7%AB%8B%E5%AE%89%E8%A3%85%E6%B5%8B%E8%AF%95">独立安装测试</a></li>
<li><a href="#%E9%9B%86%E6%88%90-web-%E7%8E%AF%E5%A2%83%E6%B5%8B%E8%AF%95">集成 Web 环境测试</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="前置要求"><a href="#前置要求" class="headerlink" title="前置要求"></a>前置要求</h2><ul>
<li>Java</li>
<li>Spring/SpringMVC</li>
<li>Maven</li>
</ul>
<h2 id="概略"><a href="#概略" class="headerlink" title="概略"></a>概略</h2><p>单元测试/集成测试是软件开发时重要的一项流程，而 Spring 对于测试提供了非常强大的支持。</p>
<ul>
<li>支持主流测试框架 <code>Junit</code>/<code>TestNG</code></li>
<li>支持在测试中使用依赖注入</li>
<li>支持在测试中事物自动回滚</li>
<li>支持使用各种注解增强功能</li>
</ul>
<p>那么，测试基本上按照场景分为三种情况：</p>
<ul>
<li>普通测试：不需要使用 Spring 容器的测试（工具类）</li>
<li>Dao/Service 层测试：需要使用 Spring 容器的依赖注入</li>
<li>Web 层测试：测试对外部提供的接口</li>
</ul>
<p>这里新建一个用来测试的项目，吾辈将之丢到了 GitHub 上面</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/rxliuli/springtest">项目链接</a></p>
</blockquote>
<p>你也可以自己创建一个基础的 Maven 项目，项目结构应当如下：</p>
<ul>
<li>/<ul>
<li>src/<ul>
<li>main/<ul>
<li>java/</li>
<li>resources/</li>
</ul>
</li>
<li>test/<ul>
<li>java/</li>
</ul>
</li>
</ul>
</li>
<li>pom.xml</li>
</ul>
</li>
</ul>
<h2 id="普通测试"><a href="#普通测试" class="headerlink" title="普通测试"></a>普通测试</h2><p>假设吾辈有一个 <code>SpringUtil</code>（路径是 <code>/src/main/java/com/rxliuli/study/springtest/util/SpringUtil.java</code>） 工具类，想要测试怎么办呢？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用于测试的字符串工具类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringUtil</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断是否为空</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string 要进行判断的字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否为 null 或者空字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">(String string)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> string == <span class="keyword">null</span> || string.isEmpty();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断是否为空</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string 要进行判断的字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否为 null 或者空字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isNotEmpty</span><span class="params">(String string)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> !isEmpty(string);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断是否有字符串为空</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> strings 要进行判断的一个或多个字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否有 null 或者空字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isAnyEmpty</span><span class="params">(String... strings)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(strings)</span><br><span class="line">                .anyMatch(StringUtil::isEmpty);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断字符串是否全部为空</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> strings 要进行判断的一个或多个字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否全部为 null 或者空字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isAllEmpty</span><span class="params">(String... strings)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(strings)</span><br><span class="line">                .allMatch(StringUtil::isEmpty);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先需要引入以下依赖</p>
<ul>
<li><code>Junit4</code>：流行的 Java 测试框架。虽然吾辈个人更喜欢 <code>TestNG</code>，但 <code>Junit</code> 的流行度要更高一点，<code>SpringBoot</code> 甚至将之默认引入了，所以这里使用 <code>Junit</code> 框架。</li>
<li><code>AssertJ</code>：流行的 Java 流畅式断言框架。<code>Junit</code> 也有自己的断言方法，但和 <code>AssertJ</code> 相比就是小巫见大巫了。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.assertj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>assertj-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：生产环境中 <strong>version</strong> 应该放到 <strong>properties</strong> 节点下，这里只做演示。<br>此篇不对 <code>Junit</code> 和 <code>AssertJ</code> 进行详细的讲解，如果想要入门了解参考 <a target="_blank" rel="noopener" href="http://wiki.jikexueyuan.com/project/junit/">Junit</a>, <a target="_blank" rel="noopener" href="http://hao.jobbole.com/assertj/">AssertJ</a></p>
</blockquote>
<p>然后创建一个对应的测试类 <code>StringUtilTest</code>（<code>/src/test/java/com/rxliuli/study/springtest/util/SpringUtilTest.java</code>）直接进行测试即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringUtilTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String strNull = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> String strEmpty = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String strSome = <span class="string">&quot;str&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//测试 null</span></span><br><span class="line">        assertThat(StringUtil.isEmpty(strNull))</span><br><span class="line">                .isTrue();</span><br><span class="line">        <span class="comment">//测试 empty</span></span><br><span class="line">        assertThat(StringUtil.isEmpty(strEmpty))</span><br><span class="line">                .isTrue();</span><br><span class="line">        <span class="comment">//测试 some</span></span><br><span class="line">        assertThat(StringUtil.isEmpty(strSome))</span><br><span class="line">                .isFalse();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">isNotEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//测试 null</span></span><br><span class="line">        assertThat(StringUtil.isNotEmpty(strNull))</span><br><span class="line">                .isFalse();</span><br><span class="line">        <span class="comment">//测试 empty</span></span><br><span class="line">        assertThat(StringUtil.isNotEmpty(strEmpty))</span><br><span class="line">                .isFalse();</span><br><span class="line">        <span class="comment">//测试 some</span></span><br><span class="line">        assertThat(StringUtil.isNotEmpty(strSome))</span><br><span class="line">                .isTrue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">isAnyEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertThat(StringUtil.isAnyEmpty(strNull, strEmpty, strSome))</span><br><span class="line">                .isTrue();</span><br><span class="line">        assertThat(StringUtil.isAnyEmpty())</span><br><span class="line">                .isFalse();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">isAllEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertThat(StringUtil.isAllEmpty(strNull, strEmpty, strSome))</span><br><span class="line">                .isFalse();</span><br><span class="line">        assertThat(StringUtil.isAnyEmpty(strNull, strEmpty))</span><br><span class="line">                .isTrue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面测试流程基本如下：</p>
<ul>
<li>构建出测试需要的参数（非必需）</li>
<li>调用需要测试的方法</li>
<li>使用 AssertJ 对得到的结果进行断言</li>
</ul>
<h2 id="Dao-Service-层测试"><a href="#Dao-Service-层测试" class="headerlink" title="Dao/Service 层测试"></a>Dao/Service 层测试</h2><p>准确的说是需要使用 Spring 容器的测试，测试方法有 2 种。</p>
<ol>
<li> 手动使用 <code>ApplicationContext</code> 去获取 Bean 然后进行测试</li>
<li> 使用注解自动加载 Spring 测试环境</li>
</ol>
<h3 id="手动使用-ApplicationContext-去获取-Bean-然后进行测试"><a href="#手动使用-ApplicationContext-去获取-Bean-然后进行测试" class="headerlink" title="手动使用 ApplicationContext 去获取 Bean 然后进行测试"></a>手动使用 <code>ApplicationContext</code> 去获取 Bean 然后进行测试</h3><p>这里先演示手动使用 <code>ApplicationContext</code> 的做法进行测试，为了简化测试，这里直接使用 <code>H2DB</code> 和 <code>SpringJdbcTemplate</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.14.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.14.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--h2 db--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.196<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>创建初始化 sql 文件 <code>hsqldb/initDatabase.sql</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span> (</span><br><span class="line">  id   <span class="type">int</span> auto_increment <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  comment <span class="string">&#x27;编号&#x27;</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">20</span>)        <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  comment <span class="string">&#x27;名字&#x27;</span>,</span><br><span class="line">  sex  <span class="type">boolean</span>            <span class="keyword">null</span></span><br><span class="line">  comment <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">  age  <span class="type">int</span>                <span class="keyword">null</span></span><br><span class="line">  comment <span class="string">&#x27;年龄&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> (id, name, sex, age)</span><br><span class="line"><span class="keyword">values</span></span><br><span class="line">  (<span class="number">1</span>, <span class="string">&#x27;琉璃&#x27;</span>, <span class="literal">false</span>, <span class="number">17</span>),</span><br><span class="line">  (<span class="number">2</span>, <span class="string">&#x27;月姬&#x27;</span>, <span class="literal">false</span>, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<p>Spring 配置文件 <code>spring/spring-context.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:jdbc</span>=<span class="string">&quot;http://www.springframework.org/schema/jdbc&quot;</span> <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc-4.0.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--自动扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.rxliuli.study.springtest&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">jdbc:embedded-database</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">type</span>=<span class="string">&quot;H2&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--初始化 db--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbc:script</span> <span class="attr">location</span>=<span class="string">&quot;classpath:hsqldb/initDatabase.sql&quot;</span> <span class="attr">encoding</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">jdbc:embedded-database</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置 Spring JdbcTemplate--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">p:dataSource-ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>接下来我们可以编写实体类 <code>com.rxliuli.study.springtest.entity.User</code>，dao 层 <code>com.rxliuli.study.springtest.dao.UserDao</code> 和 dao 对应的测试类 <code>com.rxliuli.study.springtest.dao.UserDaoTest</code>。</p>
<ul>
<li>User</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/7/31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Boolean sex;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name, Boolean sex, Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(Integer id, String name, Boolean sex, Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">setSex</span><span class="params">(Boolean sex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>UserDao</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/7/31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RowMapper&lt;User&gt; userRowMapper = (rs, rowNum) -&gt; <span class="keyword">new</span> User(</span><br><span class="line">            rs.getInt(<span class="string">&quot;id&quot;</span>),</span><br><span class="line">            rs.getString(<span class="string">&quot;name&quot;</span>),</span><br><span class="line">            rs.getBoolean(<span class="string">&quot;sex&quot;</span>),</span><br><span class="line">            rs.getInt(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据 id 获取一个对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 根据 id 查询到的对象，如果没有查到则为 null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">get</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.queryForObject(<span class="string">&quot;select * from user where id = ?&quot;</span>, userRowMapper, id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询全部用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 全部用户列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">listForAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.query(<span class="string">&quot;select * from user&quot;</span>, userRowMapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：这里直接使用了 Dao 类，生产过程中最好使用接口。</p>
</blockquote>
<ul>
<li>UserDaoTest</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/7/31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//使用 spring xml 配置文件初始化 ApplicationContext</span></span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;classpath:/spring/spring-context.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//然后使用 ApplicationContext 获取 UserDao 的对象</span></span><br><span class="line">        userDao = context.getBean(UserDao.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = <span class="number">1</span>;</span><br><span class="line">        User result = userDao.get(id);</span><br><span class="line">        <span class="comment">//断言 id 和 get id 相同</span></span><br><span class="line">        assertThat(result)</span><br><span class="line">                .extracting(User::getId)</span><br><span class="line">                .contains(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listForAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; userList = userDao.listForAll();</span><br><span class="line">        <span class="comment">//断言不为空</span></span><br><span class="line">        assertThat(userList)</span><br><span class="line">                .isNotEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>手动加载的基本思路就是：</p>
<ul>
<li>先加载 ApplicationContext 初始化 Spring 环境<br>注：这一步实际上就已经加载了 Spring 容器，并且使用 <code>initDatabase.sql</code> 初始化 h2 DB 了</li>
<li>使用 ApplicationContext 对象获得 UserDao 实例</li>
<li>调用被测试的方法</li>
<li>对结果进行断言</li>
</ul>
<p>但这里实际上，ApplicationContext 是会被初始化两次的，所以会造成浪费和麻烦（例如初始化 sql 脚本也会被执行两次，当然这里吾辈先把 user 表删除后再创建的所以没事）。其实 Spring 早已想到了这一切，并为我们准备了解决方案。</p>
<p>使用 <code>SpringTest</code> 整合测试！</p>
<h3 id="使用注解自动加载-Spring-测试环境"><a href="#使用注解自动加载-Spring-测试环境" class="headerlink" title="使用注解自动加载 Spring 测试环境"></a>使用注解自动加载 Spring 测试环境</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.14.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用 SpringTest 进行测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/7/31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//加载 Spring 配置文件</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:/spring/spring-context.xml&quot;)</span></span><br><span class="line"><span class="comment">//使用 SpringJUnit4ClassRunner 来运行 test</span></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoSpringTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 直接注入 UserDao 就好了</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = <span class="number">1</span>;</span><br><span class="line">        User result = userDao.get(id);</span><br><span class="line">        <span class="comment">//断言 id 和 get id 相同</span></span><br><span class="line">        assertThat(result)</span><br><span class="line">                .extracting(User::getId)</span><br><span class="line">                .contains(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listForAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; userList = userDao.listForAll();</span><br><span class="line">        <span class="comment">//断言不为空</span></span><br><span class="line">        assertThat(userList)</span><br><span class="line">                .isNotEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，这里我们甚至可以使用 Spring 的自动注入注解 <code>@Autowired</code> 了</p>
<p>当然，现在还有一个问题就是现在测试对数据库的影响是持久的，也就是说不能重复的测试。<br>例如删除了一个为 id 为 1 的用户，返回值应当是 1，但第二次删除时，因为 id 为 1 的用户已经不存在了，所以返回值是 0，然后就报错了 23333</p>
<p>我们可以测试一下</p>
<ol>
<li> 在 UserDao 中新增方法 <code>deleteById</code></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据 id 删除用户</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 用户 id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 受影响行数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> jdbcTemplate.update(<span class="string">&quot;delete from user where id = ?&quot;</span>, id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在测试类 <code>UserDaoSpringTest</code> 中添加两个删除测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = userDao.deleteById(<span class="number">1</span>);</span><br><span class="line">    assertThat(result)</span><br><span class="line">            .isGreaterThan(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteByIdForTransaction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//这个仅仅是为了测试事物与自动回滚是否生效</span></span><br><span class="line">    <span class="keyword">int</span> result = userDao.deleteById(<span class="number">1</span>);</span><br><span class="line">    assertThat(result)</span><br><span class="line">            .isGreaterThan(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后运行测试类，你会得到一个错误</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java.lang.AssertionError:</span><br><span class="line">Expecting:</span><br><span class="line"> &lt;<span class="number">0</span>&gt;</span><br><span class="line">to be greater than:</span><br><span class="line"> &lt;<span class="number">0</span>&gt;</span><br></pre></td></tr></table></figure>
<p>所以我们需要让所有测试的操作都不影响到数据库，即 <strong>全局事物</strong> + <strong>默认回滚</strong>。</p>
<p>首先需要在 <code>spring-context.xml</code> 中添加数据库事务管理的配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置数据库事务并开启注解支持--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dataSourceTransactionManager&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">p:dataSource-ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;dataSourceTransactionManager&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>在 <code>UserDaoSpringTest</code> 测试类上添加两个注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//为这个测试类开启事物</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="comment">//默认回滚所有数据库操作</span></span><br><span class="line"><span class="meta">@Rollback</span></span><br></pre></td></tr></table></figure>
<p>再次运行，一切便都正常了，是不是感觉很棒！但每个测试类头上都加那么一大堆注解也很麻烦，所以我们需要将之抽出一个父类直接继承就好了</p>
<p>以下是一个最简单的测试基类 <code>BaseTest</code>(common.test.BaseTest)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 简单的测试基类</span></span><br><span class="line"><span class="comment"> * &lt;BaseBean&gt; 需要自动注入的 Bean 类型</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/7/31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:/spring/spring-context*.xml&quot;)</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Rollback</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseTest</span>&lt;<span class="title">BaseBean</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自动注入的 Bean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;SpringJavaInjectionPointsAutowiringInspection&quot;)</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BaseBean base;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后创建测试类 <code>UserDaoBaseTest</code>(com.rxliuli.study.springtest.dao.UserDaoBaseTest) 继承 <code>BaseTest</code> 进行测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/7/31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoBaseTest</span> <span class="keyword">extends</span> <span class="title">BaseTest</span>&lt;<span class="title">UserDao</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = <span class="number">1</span>;</span><br><span class="line">        User result = base.get(id);</span><br><span class="line">        <span class="comment">//断言 id 和 get id 相同</span></span><br><span class="line">        assertThat(result)</span><br><span class="line">                .extracting(User::getId)</span><br><span class="line">                .contains(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listForAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; userList = base.listForAll();</span><br><span class="line">        <span class="comment">//断言不为空</span></span><br><span class="line">        assertThat(userList)</span><br><span class="line">                .isNotEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = base.deleteById(<span class="number">1</span>);</span><br><span class="line">        assertThat(result)</span><br><span class="line">                .isGreaterThan(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteByIdForTransaction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//这个仅仅是为了测试事物与自动回滚是否生效</span></span><br><span class="line">        <span class="keyword">int</span> result = base.deleteById(<span class="number">1</span>);</span><br><span class="line">        assertThat(result)</span><br><span class="line">                .isGreaterThan(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果也是一切正常呢，对 Dao/Service 需要加载 Spring 容器的测试暂且到这里便结束了。。。</p>
<h2 id="Web-层测试"><a href="#Web-层测试" class="headerlink" title="Web 层测试"></a>Web 层测试</h2><p>绝大部分时候，很多人喜欢写完代码就到前台页面直接看效果。但人眼是不一定准确的，而且可重复性/可靠性不足。如果是 API，大部分人或许会选择诸如 <strong>Postman</strong>, <strong>IDEA HttpClient</strong> 这一类的工具吧，但实际上，SpringTest 已经考虑到了对 Web 层的测试并集成了这些。</p>
<p>首先还是需要添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.14.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.module<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-module-jaxb-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--json-path-assert 对 MockMvc response 中返回的 json 数据进行断言--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jayway.jsonpath<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>json-path-assert<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>设置 maven 打包时为 <code>war</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>添加配置文件 <code>spring/spring-mvc.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置支持注解并自动扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.rxliuli.study.springtest&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.web.bind.annotation.RestController&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>添加 web 的根目录 <code>/src/main/webapp</code> 并在 webapp 目录下创建 <code>web.xml</code>(WEB-INF/web.xml)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--context configLocation --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath*:/spring/spring-context*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.request.RequestContextListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--encoding filter--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--MVC Servlet--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath*:/spring/spring-mvc*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>至此，项目中便添加了 web 环境支持。</p>
<p>下面开始编写要测试的接口 <code>UserController</code>(com.rxliuli.study.springtest.web.UserController)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/7/31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 用户 id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户对象信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">get</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.get(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取全部的用户列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 全部的用户列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/user/listForAll&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">listForAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.listForAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这时候启动 web 项目在浏览器中访问 <code>localhost:8080/&#123;上下文&#125;/user/1</code> 应当会得到一个 User 对象。</p>
<blockquote>
<p>注：上下文 IDEA 默认为空，Eclipse 默认为项目名</p>
</blockquote>
<p>然而测试却是有两种方法：</p>
<ol>
<li>独立安装测试<br> 手动加载单个 Controller，所以测试其他 Controller 中的接口会发生异常。但测试速度上较快，所以应当优先选择。</li>
<li>集成 Web 环境测试<br> 将启动并且加载所有的 Controller, 所以效率上之于 BaseWebUnitTest 来说非常低下, 仅适用于集成测试多个 Controller 时使用。</li>
</ol>
<h3 id="独立安装测试"><a href="#独立安装测试" class="headerlink" title="独立安装测试"></a>独立安装测试</h3><p>简单的独立安装测试类 <code>UserControllerUnitTest</code>(com.rxliuli.study.springtest.web.UserControllerUnitTest)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/7/31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:/spring/spring-*.xml&quot;)</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Rollback</span></span><br><span class="line"><span class="meta">@WebAppConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserControllerUnitTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserController userController;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用于测试 API 的模拟请求对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//模拟一个 Mvc 测试环境，获取一个 MockMvc 实例</span></span><br><span class="line">        mockMvc = MockMvcBuilders.standaloneSetup(userController)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//测试能够正常获取</span></span><br><span class="line">        Integer id = <span class="number">1</span>;</span><br><span class="line">        mockMvc.perform(</span><br><span class="line">                <span class="comment">//发起 get 请求</span></span><br><span class="line">                get(<span class="string">&quot;/user/&quot;</span> + id)</span><br><span class="line">        )</span><br><span class="line">                <span class="comment">//断言请求的状态是成功的(200)</span></span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                <span class="comment">//断言返回对象的 id 和请求的 id 相同</span></span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;$.id&quot;</span>).value(id));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listForAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//测试正常获取</span></span><br><span class="line">        mockMvc.perform(</span><br><span class="line">                <span class="comment">//发起 post 请求</span></span><br><span class="line">                post(<span class="string">&quot;/user/listForAll&quot;</span>)</span><br><span class="line">        )</span><br><span class="line">                <span class="comment">//断言请求状态</span></span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                <span class="comment">//断言返回结果是数组</span></span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;$&quot;</span>).isArray())</span><br><span class="line">                <span class="comment">//断言返回数组不是空的</span></span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;$&quot;</span>).isNotEmpty());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="集成-Web-环境测试"><a href="#集成-Web-环境测试" class="headerlink" title="集成 Web 环境测试"></a>集成 Web 环境测试</h3><p>简单的独立安装测试类 <code>UserControllerIntegratedTest</code>(com.rxliuli.study.springtest.web.UserControllerIntegratedTest)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/7/31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:/spring/spring-*.xml&quot;)</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Rollback</span></span><br><span class="line"><span class="meta">@WebAppConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserControllerIntegratedTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WebApplicationContext context;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用于测试 API 的模拟请求对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//这里把整个 WebApplicationContext 上下文都丢进去了，所以可以测试所有的 Controller</span></span><br><span class="line">        mockMvc = MockMvcBuilders.webAppContextSetup(context)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//测试能够正常获取</span></span><br><span class="line">        Integer id = <span class="number">1</span>;</span><br><span class="line">        mockMvc.perform(</span><br><span class="line">                <span class="comment">//发起 get 请求</span></span><br><span class="line">                get(<span class="string">&quot;/user/&quot;</span> + id)</span><br><span class="line">        )</span><br><span class="line">                <span class="comment">//断言请求的状态是成功的(200)</span></span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                <span class="comment">//断言返回对象的 id 和请求的 id 相同</span></span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;$.id&quot;</span>).value(id));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listForAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//测试正常获取</span></span><br><span class="line">        mockMvc.perform(</span><br><span class="line">                <span class="comment">//发起 post 请求</span></span><br><span class="line">                post(<span class="string">&quot;/user/listForAll&quot;</span>)</span><br><span class="line">        )</span><br><span class="line">                <span class="comment">//断言请求状态</span></span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                <span class="comment">//断言返回结果是数组</span></span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;$&quot;</span>).isArray())</span><br><span class="line">                <span class="comment">//断言返回数组不是空的</span></span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;$&quot;</span>).isNotEmpty());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>其实从上面可以看出来主要就是获得 MockMvc 的方式不同，所以其实也可以抽出来公共的测试父类。这里就不再赘述，具体的做法可以参考 <a target="_blank" rel="noopener" href="https://github.com/rxliuli/springtest/tree/master/src/test/java/common">测试基类</a></p>
<p>那么，有关使用 Spring 进行测试的问题就像说到这里啦</p>
<blockquote>
<p>附：用了 SpringBoot 之后才觉得 Spring 的各种配置好麻烦。。。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/04/18/d5187232899b475982b26e999ed4f2a9/" data-id="ckmcqox5p00cd0kuv0ntf2w6m" data-title="使用 Spring 时进行测试" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ee1c7fa2f4a24d8c86089bdb440f9df6" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/18/ee1c7fa2f4a24d8c86089bdb440f9df6/" class="article-date">
  <time class="dt-published" datetime="2020-04-18T02:14:09.000Z" itemprop="datePublished">2020-04-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/18/ee1c7fa2f4a24d8c86089bdb440f9df6/">Java 优雅的拷贝对象属性</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>在 Java 项目中，经常遇到需要在对象之间拷贝属性的问题。然而，除了直接使用 <code>Getter/Stter</code> 方法，我们还有其他的方法么？<br>当然有，例如 <code>Apache Common Lang3</code> 的 <code>BeanUtils</code>，然而 <code>BeanUtils</code> 却无法完全满足吾辈的需求，所以吾辈便自己封装了一个，这里分享出来以供参考。</p>
<ul>
<li>需要大量复制对象的属性</li>
<li>对象之间的属性名可能是不同的</li>
<li>对象之间的属性类型可能是不同的</li>
</ul>
<h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>简单易用的 API</p>
<ul>
<li><code>copy</code>: 指定需要拷贝的源对象和目标对象</li>
<li><code>prop</code>: 拷贝指定对象的字段</li>
<li><code>props</code>: 拷贝指定对象的多个字段</li>
<li><code>exec</code>: 执行真正的拷贝操作</li>
<li><code>from</code>: 重新开始添加其他对象的属性</li>
<li><code>get</code>: 返回当前的目标对象</li>
<li><code>config</code>: 配置拷贝的一些策略</li>
</ul>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ol>
<li> 定义门面类 <code>BeanCopyUtil</code> 用以暴露出一些 API</li>
<li> 定义每个字段的操作类 <code>BeanCopyField</code>，保存对每个字段的操作</li>
<li> 定义 <code>BeanCopyConfig</code>，用于配置拷贝属性的策略</li>
<li> 定义 <code>BeanCopyOperator</code> 作为拷贝的真正实现</li>
</ol>
<p>图解</p>
<p><img src="https://img.rxliuli.com/20190227215703.png" alt="图解"></p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><blockquote>
<p>注：反射部分依赖于 <a target="_blank" rel="noopener" href="https://github.com/jOOQ/jOOR">joor</a>, JDK1.8 请使用 <a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/org.jooq/joor-java-8/0.9.7">joor-java-8</a></p>
</blockquote>
<h3 id="定义门面类-BeanCopyUtil-用以暴露出一些-API"><a href="#定义门面类-BeanCopyUtil-用以暴露出一些-API" class="headerlink" title="定义门面类 BeanCopyUtil 用以暴露出一些 API"></a>定义门面类 <code>BeanCopyUtil</code> 用以暴露出一些 API</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * java bean 复制操作的工具类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanCopyUtil</span>&lt;<span class="title">F</span>, <span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 源对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> F from;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 目标对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> T to;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拷贝的字段信息列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;BeanCopyField&gt; copyFieldList = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> BeanCopyConfig config = <span class="keyword">new</span> BeanCopyConfig();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">BeanCopyUtil</span><span class="params">(F from, T to)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.from = from;</span><br><span class="line">        <span class="keyword">this</span>.to = to;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定需要拷贝的源对象和目标对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> from 源对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> to   目标对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;F&gt;  源对象类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;  目标对象类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 一个 &#123;<span class="doctag">@link</span> BeanCopyUtil&#125; 对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;F, T&gt; <span class="function">BeanCopyUtil&lt;F, T&gt; <span class="title">copy</span><span class="params">(F from, T to)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BeanCopyUtil&lt;&gt;(from, to);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拷贝指定对象的字段</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fromField 源对象中的字段名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> toField   目标对象中的字段名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> converter 将源对象中字段转换为目标对象字段类型的转换器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回 &#123;<span class="doctag">@code</span> this&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanCopyUtil&lt;F, T&gt; <span class="title">prop</span><span class="params">(String fromField, String toField, Function&lt;? <span class="keyword">super</span> Object, ? <span class="keyword">super</span> Object&gt; converter)</span> </span>&#123;</span><br><span class="line">        copyFieldList.add(<span class="keyword">new</span> BeanCopyField(fromField, toField, converter));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拷贝指定对象的字段</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fromField 源对象中的字段名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> toField   目标对象中的字段名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回 &#123;<span class="doctag">@code</span> this&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanCopyUtil&lt;F, T&gt; <span class="title">prop</span><span class="params">(String fromField, String toField)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> prop(fromField, toField, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拷贝指定对象的字段</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> field     源对象中与目标对象中的字段名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> converter 将源对象中字段转换为目标对象字段类型的转换器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回 &#123;<span class="doctag">@code</span> this&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanCopyUtil&lt;F, T&gt; <span class="title">prop</span><span class="params">(String field, Function&lt;? <span class="keyword">super</span> Object, ? <span class="keyword">super</span> Object&gt; converter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> prop(field, field, converter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拷贝指定对象的字段</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> field 源对象中与目标对象中的字段名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回 &#123;<span class="doctag">@code</span> this&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanCopyUtil&lt;F, T&gt; <span class="title">prop</span><span class="params">(String field)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> prop(field, field, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拷贝指定对象的多个字段</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fields 源对象中与目标对象中的多个字段名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回 &#123;<span class="doctag">@code</span> this&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanCopyUtil&lt;F, T&gt; <span class="title">props</span><span class="params">(String... fields)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (String field : fields) &#123;</span><br><span class="line">            prop(field);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行真正的拷贝操作</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回 &#123;<span class="doctag">@code</span> this&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanCopyUtil&lt;F, T&gt; <span class="title">exec</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> BeanCopyOperator&lt;&gt;(from, to, copyFieldList, config).copy();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重新开始添加其他对象的属性</span></span><br><span class="line"><span class="comment">     * 用于在执行完 &#123;<span class="doctag">@link</span> #exec()&#125; 之后还想复制其它对象的属性</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> from 源对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;R&gt;  源对象类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 一个新的 &#123;<span class="doctag">@link</span> BeanCopyUtil&#125; 对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;R&gt; <span class="function">BeanCopyUtil&lt;R, T&gt; <span class="title">from</span><span class="params">(R from)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BeanCopyUtil&lt;&gt;(from, to);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回当前的目标对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 当前的目标对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> to;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置拷贝的一些策略</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> config 拷贝配置对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回 &#123;<span class="doctag">@code</span> this&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanCopyUtil&lt;F, T&gt; <span class="title">config</span><span class="params">(BeanCopyConfig config)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.config = config;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="定义每个字段的操作类-BeanCopyField，保存对每个字段的操作"><a href="#定义每个字段的操作类-BeanCopyField，保存对每个字段的操作" class="headerlink" title="定义每个字段的操作类 BeanCopyField，保存对每个字段的操作"></a>定义每个字段的操作类 <code>BeanCopyField</code>，保存对每个字段的操作</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 拷贝属性的每一个字段的选项</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanCopyField</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String from;</span><br><span class="line">    <span class="keyword">private</span> String to;</span><br><span class="line">    <span class="keyword">private</span> Function&lt;? <span class="keyword">super</span> Object, ? <span class="keyword">super</span> Object&gt; converter;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanCopyField</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanCopyField</span><span class="params">(String from, String to, Function&lt;? <span class="keyword">super</span> Object, ? <span class="keyword">super</span> Object&gt; converter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.from = from;</span><br><span class="line">        <span class="keyword">this</span>.to = to;</span><br><span class="line">        <span class="keyword">this</span>.converter = converter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFrom</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> from;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanCopyField <span class="title">setFrom</span><span class="params">(String from)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.from = from;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> to;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanCopyField <span class="title">setTo</span><span class="params">(String to)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.to = to;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Function&lt;? <span class="keyword">super</span> Object, ? <span class="keyword">super</span> Object&gt; getConverter() &#123;</span><br><span class="line">        <span class="keyword">return</span> converter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanCopyField <span class="title">setConverter</span><span class="params">(Function&lt;? <span class="keyword">super</span> Object, ? <span class="keyword">super</span> Object&gt; converter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.converter = converter;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="定义-BeanCopyConfig，用于配置拷贝属性的策略"><a href="#定义-BeanCopyConfig，用于配置拷贝属性的策略" class="headerlink" title="定义 BeanCopyConfig，用于配置拷贝属性的策略"></a>定义 <code>BeanCopyConfig</code>，用于配置拷贝属性的策略</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 拷贝属性的配置</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanCopyConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 同名的字段自动复制</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> same = <span class="keyword">true</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 覆盖同名的字段</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> override = <span class="keyword">true</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 忽略 &#123;<span class="doctag">@code</span> null&#125; 的源对象属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> ignoreNull = <span class="keyword">true</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 尝试进行自动转换</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> converter = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanCopyConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanCopyConfig</span><span class="params">(<span class="keyword">boolean</span> same, <span class="keyword">boolean</span> override, <span class="keyword">boolean</span> ignoreNull, <span class="keyword">boolean</span> converter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.same = same;</span><br><span class="line">        <span class="keyword">this</span>.override = override;</span><br><span class="line">        <span class="keyword">this</span>.ignoreNull = ignoreNull;</span><br><span class="line">        <span class="keyword">this</span>.converter = converter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSame</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> same;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanCopyConfig <span class="title">setSame</span><span class="params">(<span class="keyword">boolean</span> same)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.same = same;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isOverride</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> override;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanCopyConfig <span class="title">setOverride</span><span class="params">(<span class="keyword">boolean</span> override)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.override = override;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isIgnoreNull</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ignoreNull;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanCopyConfig <span class="title">setIgnoreNull</span><span class="params">(<span class="keyword">boolean</span> ignoreNull)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ignoreNull = ignoreNull;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isConverter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> converter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanCopyConfig <span class="title">setConverter</span><span class="params">(<span class="keyword">boolean</span> converter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.converter = converter;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="定义-BeanCopyOperator-作为拷贝的真正实现"><a href="#定义-BeanCopyOperator-作为拷贝的真正实现" class="headerlink" title="定义 BeanCopyOperator 作为拷贝的真正实现"></a>定义 <code>BeanCopyOperator</code> 作为拷贝的真正实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 真正执行 copy 属性的类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> rxliuli</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanCopyOperator</span>&lt;<span class="title">F</span>, <span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(BeanCopyUtil.class);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> F from;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> T to;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BeanCopyConfig config;</span><br><span class="line">    <span class="keyword">private</span> List&lt;BeanCopyField&gt; copyFieldList;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanCopyOperator</span><span class="params">(F from, T to, List&lt;BeanCopyField&gt; copyFieldList, BeanCopyConfig config)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.from = from;</span><br><span class="line">        <span class="keyword">this</span>.to = to;</span><br><span class="line">        <span class="keyword">this</span>.copyFieldList = copyFieldList;</span><br><span class="line">        <span class="keyword">this</span>.config = config;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">copy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取到两个对象所有的属性</span></span><br><span class="line">        <span class="keyword">final</span> Map&lt;String, Reflect&gt; fromFields = Reflect.on(from).fields();</span><br><span class="line">        <span class="keyword">final</span> Reflect to = Reflect.on(<span class="keyword">this</span>.to);</span><br><span class="line">        <span class="keyword">final</span> Map&lt;String, Reflect&gt; toFields = to.fields();</span><br><span class="line">        <span class="comment">//过滤出所有相同字段名的字段并进行拷贝</span></span><br><span class="line">        <span class="keyword">if</span> (config.isSame()) &#123;</span><br><span class="line">            <span class="keyword">final</span> Map&lt;ListUtil.ListDiffState, List&lt;String&gt;&gt; different = ListUtil.different(<span class="keyword">new</span> ArrayList&lt;&gt;(fromFields.keySet()), <span class="keyword">new</span> ArrayList&lt;&gt;(toFields.keySet()));</span><br><span class="line">            copyFieldList = Stream.concat(different.get(ListUtil.ListDiffState.common).stream()</span><br><span class="line">                    .map(s -&gt; <span class="keyword">new</span> BeanCopyField(s, s, <span class="keyword">null</span>)), copyFieldList.stream())</span><br><span class="line">                    .collect(Collectors.toList());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//根据拷贝字段列表进行拷贝</span></span><br><span class="line">        copyFieldList.stream()</span><br><span class="line">                <span class="comment">//忽略空值</span></span><br><span class="line">                .filter(beanCopyField -&gt; !config.isIgnoreNull() || fromFields.get(beanCopyField.getFrom()).get() != <span class="keyword">null</span>)</span><br><span class="line">                <span class="comment">//覆盖属性</span></span><br><span class="line">                .filter(beanCopyField -&gt; config.isOverride() || toFields.get(beanCopyField.getTo()).get() == <span class="keyword">null</span>)</span><br><span class="line">                <span class="comment">//如果没有转换器，则使用默认的转换器</span></span><br><span class="line">                .peek(beanCopyField -&gt; &#123;</span><br><span class="line">                    <span class="keyword">if</span> (beanCopyField.getConverter() == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        beanCopyField.setConverter(Function.identity());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .forEach(beanCopyField -&gt; &#123;</span><br><span class="line">                    <span class="keyword">final</span> String fromField = beanCopyField.getFrom();</span><br><span class="line">                    <span class="keyword">final</span> F from = fromFields.get(fromField).get();</span><br><span class="line">                    <span class="keyword">final</span> String toField = beanCopyField.getTo();</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        to.set(toField, beanCopyField.getConverter().apply(from));</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (ReflectException e) &#123;</span><br><span class="line">                        log.warn(<span class="string">&quot;Copy field failed, from &#123;&#125; to &#123;&#125;, exception is &#123;&#125;&quot;</span>, fromField, toField, e.getMessage());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="使用流程图"><a href="#使用流程图" class="headerlink" title="使用流程图"></a>使用流程图</h3><p><img src="https://img.rxliuli.com/20190228000845.png" alt="使用流程图"></p>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>代码写完了，让我们测试一下！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanCopyUtilTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(getClass());</span><br><span class="line">    <span class="keyword">private</span> Student student;</span><br><span class="line">    <span class="keyword">private</span> Teacher teacher;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        student = <span class="keyword">new</span> Student(<span class="string">&quot;琉璃&quot;</span>, <span class="number">10</span>, <span class="string">&quot;女&quot;</span>, <span class="number">4</span>);</span><br><span class="line">        teacher = <span class="keyword">new</span> Teacher();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">copy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//简单的复制（类似于 BeanUtils.copyProperties）</span></span><br><span class="line">        BeanCopyUtil.copy(student, teacher).exec();</span><br><span class="line">        log.info(<span class="string">&quot;teacher: &#123;&#125;&quot;</span>, teacher);</span><br><span class="line">        assertThat(teacher)</span><br><span class="line">                .extracting(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">                .containsOnlyOnce(student.getAge());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//不同名字的属性</span></span><br><span class="line">        BeanCopyUtil.copy(student, teacher)</span><br><span class="line">                .prop(<span class="string">&quot;sex&quot;</span>, <span class="string">&quot;sex&quot;</span>, sex -&gt; Objects.equals(sex, <span class="string">&quot;男&quot;</span>))</span><br><span class="line">                .prop(<span class="string">&quot;realname&quot;</span>, <span class="string">&quot;name&quot;</span>)</span><br><span class="line">                .exec();</span><br><span class="line">        assertThat(teacher)</span><br><span class="line">                .extracting(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;sex&quot;</span>)</span><br><span class="line">                .containsOnlyOnce(student.getRealname(), student.getAge(), <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prop1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//不存的属性</span></span><br><span class="line">        assertThat(BeanCopyUtil.copy(student, teacher)</span><br><span class="line">                .prop(<span class="string">&quot;sex&quot;</span>, <span class="string">&quot;sex&quot;</span>, sex -&gt; Objects.equals(sex, <span class="string">&quot;男&quot;</span>))</span><br><span class="line">                .prop(<span class="string">&quot;realname&quot;</span>, <span class="string">&quot;name2&quot;</span>)</span><br><span class="line">                .exec()</span><br><span class="line">                .get())</span><br><span class="line">                .extracting(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;sex&quot;</span>)</span><br><span class="line">                .containsOnlyOnce(student.getAge(), <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">from</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Teacher lingMeng = <span class="keyword">new</span> Teacher()</span><br><span class="line">                .setName(<span class="string">&quot;灵梦&quot;</span>)</span><br><span class="line">                .setAge(<span class="number">17</span>);</span><br><span class="line">        <span class="comment">//测试 from 是否覆盖</span></span><br><span class="line">        assertThat(BeanCopyUtil.copy(student, teacher)</span><br><span class="line">                .prop(<span class="string">&quot;sex&quot;</span>, <span class="string">&quot;sex&quot;</span>, sex -&gt; Objects.equals(sex, <span class="string">&quot;男&quot;</span>))</span><br><span class="line">                .prop(<span class="string">&quot;realname&quot;</span>, <span class="string">&quot;name&quot;</span>)</span><br><span class="line">                .exec()</span><br><span class="line">                .from(lingMeng)</span><br><span class="line">                .exec()</span><br><span class="line">                .get())</span><br><span class="line">                .extracting(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;sex&quot;</span>)</span><br><span class="line">                .containsOnlyOnce(lingMeng.getName(), lingMeng.getAge(), <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//测试 get 是否有效</span></span><br><span class="line">        assertThat(BeanCopyUtil.copy(student, teacher)</span><br><span class="line">                .prop(<span class="string">&quot;sex&quot;</span>, <span class="string">&quot;sex&quot;</span>, sex -&gt; Objects.equals(sex, <span class="string">&quot;男&quot;</span>))</span><br><span class="line">                .prop(<span class="string">&quot;realname&quot;</span>, <span class="string">&quot;name&quot;</span>)</span><br><span class="line">                .exec()</span><br><span class="line">                .get())</span><br><span class="line">                .extracting(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;sex&quot;</span>)</span><br><span class="line">                .containsOnlyOnce(student.getRealname(), student.getAge(), <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">config</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//不自动复制同名属性</span></span><br><span class="line">        assertThat(BeanCopyUtil.copy(<span class="keyword">new</span> Student().setAge(<span class="number">15</span>), <span class="keyword">new</span> Teacher())</span><br><span class="line">                .config(<span class="keyword">new</span> BeanCopyConfig().setSame(<span class="keyword">false</span>))</span><br><span class="line">                .exec()</span><br><span class="line">                .get())</span><br><span class="line">                .extracting(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">                .containsOnlyNulls();</span><br><span class="line">        <span class="comment">//不覆盖不为空的属性</span></span><br><span class="line">        assertThat(BeanCopyUtil.copy(<span class="keyword">new</span> Student().setAge(<span class="number">15</span>), <span class="keyword">new</span> Teacher().setAge(<span class="number">10</span>))</span><br><span class="line">                .config(<span class="keyword">new</span> BeanCopyConfig().setOverride(<span class="keyword">false</span>))</span><br><span class="line">                .exec()</span><br><span class="line">                .get())</span><br><span class="line">                .extracting(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">                .containsOnlyOnce(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">//不忽略源对象不为空的属性</span></span><br><span class="line">        assertThat(BeanCopyUtil.copy(<span class="keyword">new</span> Student(), student)</span><br><span class="line">                .config(<span class="keyword">new</span> BeanCopyConfig().setIgnoreNull(<span class="keyword">false</span>))</span><br><span class="line">                .exec()</span><br><span class="line">                .get())</span><br><span class="line">                .extracting(<span class="string">&quot;realname&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;sex&quot;</span>, <span class="string">&quot;grade&quot;</span>)</span><br><span class="line">                .containsOnlyNulls();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试学生类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 姓名</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> String realname;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 年龄</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> Integer age;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 性别，男/女</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> String sex;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 年级，1 - 6</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> Integer grade;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String realname, Integer age, String sex, Integer grade)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.realname = realname;</span><br><span class="line">            <span class="keyword">this</span>.age = age;</span><br><span class="line">            <span class="keyword">this</span>.sex = sex;</span><br><span class="line">            <span class="keyword">this</span>.grade = grade;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getRealname</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> realname;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Student <span class="title">setRealname</span><span class="params">(String realname)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.realname = realname;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> age;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Student <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.age = age;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> sex;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Student <span class="title">setSex</span><span class="params">(String sex)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.sex = sex;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">getGrade</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> grade;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Student <span class="title">setGrade</span><span class="params">(Integer grade)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.grade = grade;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> ToStringBuilder.reflectionToString(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试教师类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 姓名</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 年龄</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> Integer age;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 性别，true 男，false 女</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> Boolean sex;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 职位</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> String post;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Teacher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Teacher</span><span class="params">(String name, Integer age, Boolean sex, String post)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">            <span class="keyword">this</span>.age = age;</span><br><span class="line">            <span class="keyword">this</span>.sex = sex;</span><br><span class="line">            <span class="keyword">this</span>.post = post;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Teacher <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> age;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Teacher <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.age = age;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Boolean <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> sex;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Teacher <span class="title">setSex</span><span class="params">(Boolean sex)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.sex = sex;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getPost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> post;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Teacher <span class="title">setPost</span><span class="params">(String post)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.post = post;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> ToStringBuilder.reflectionToString(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果没有发生什么意外，那么一切将能够正常运行！</p>
<hr>
<p>好了，那么关于在 Java 中优雅的拷贝对象属性就到这里啦</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/04/18/ee1c7fa2f4a24d8c86089bdb440f9df6/" data-id="ckmcqox5q00ch0kuvbn3pd3e6" data-title="Java 优雅的拷贝对象属性" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-f2c9b4e1b70a4f218216a521698989be" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/15/f2c9b4e1b70a4f218216a521698989be/" class="article-date">
  <time class="dt-published" datetime="2020-04-14T21:51:07.000Z" itemprop="datePublished">2020-04-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/15/f2c9b4e1b70a4f218216a521698989be/">在现代前端中使用 Worker</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>由于需要在 Browser 进行大量的计算，所以吾辈开始尝试使用 webworker 分离 CPU 密集型的计算操作，最终找到了 comlink 这个库，但之前在 vue 中使用时发生了错误，目前看起来已经得到了解决，所以在此记录一下。</p>
<h2 id="调研方案"><a href="#调研方案" class="headerlink" title="调研方案"></a>调研方案</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/satya164/web-worker-proxy">web-worker-proxy</a>：结合了 proxy/promise/webworker 的强大工具库，但如何在 ts 中使用却是个问题</li>
<li><a target="_blank" rel="noopener" href="https://github.com/miozzz/sandbox/tree/master/orc">Orc.js</a>：一个简单的 worker 封装</li>
<li><a target="_blank" rel="noopener" href="https://github.com/israelss/vue-worker">VueWorker</a>：结合 vue 的 worker 封装，无法理解，难道真的会有人在 vue 组件中进行大量计算么？</li>
<li><a target="_blank" rel="noopener" href="https://github.com/GoogleChromeLabs/comlink">comlink</a>：Chrome 的一个基于 proxy/promise/webworker 的封装库</li>
<li><a target="_blank" rel="noopener" href="https://github.com/GoogleChromeLabs/worker-plugin">worker-plugin</a>：和上面的同属 chrome 实验室的一个 webpack 插件</li>
</ul>
<p>最后决定使用 comlink 结合 worker-plugin 实现简单的 worker 使用。</p>
<blockquote>
<p>相关问题：<a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000022359546">comlink-loader 工作不正常</a></p>
</blockquote>
<h2 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h2><p>添加相关依赖</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add comlink</span><br><span class="line">yarn add -D worker-plugin</span><br></pre></td></tr></table></figure>
<p>在 webpack 中添加插件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  plugins: [<span class="keyword">new</span> WorkerPlugin()];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里一般不需要配置，如果需要，可以参考：<a target="_blank" rel="noopener" href="https://github.com/GoogleChromeLabs/worker-plugin">worker-plugin</a></p>
</blockquote>
<p>添加一个简单的 <em>hello.worker.ts</em></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; expose &#125; <span class="keyword">from</span> <span class="string">&quot;comlink&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; HelloWorker &#125; <span class="keyword">from</span> <span class="string">&quot;./hello.worker.type&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  counter: <span class="number">0</span>,</span><br><span class="line">  <span class="function"><span class="title">inc</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.counter++;</span><br><span class="line">  &#125;,</span><br><span class="line">  info: &#123; <span class="attr">city</span>: <span class="string">&quot;GZ&quot;</span> &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">expose(obj);</span><br></pre></td></tr></table></figure>
<p>在 <code>main.ts</code> 中使用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = wrap(<span class="keyword">new</span> Worker(<span class="string">&quot;./hello.worker.ts&quot;</span>, &#123; <span class="attr">type</span>: <span class="string">&quot;module&quot;</span> &#125;)) <span class="keyword">as</span> <span class="built_in">any</span>;</span><br><span class="line">alert(<span class="string">`Counter: <span class="subst">$&#123;<span class="keyword">await</span> obj.counter&#125;</span>`</span>);</span><br><span class="line"><span class="keyword">await</span> obj.inc();</span><br><span class="line">alert(<span class="string">`Counter: <span class="subst">$&#123;<span class="keyword">await</span> obj.counter&#125;</span>`</span>);</span><br></pre></td></tr></table></figure>
<p>但这里并不是类型安全的，所以我们可以实现正确的类型。</p>
<p>添加一个 <em>hello.worker.ts</em> 暴露出来的类型 <code>HelloWorkerType</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> HelloWorker = &#123;</span><br><span class="line">  counter: <span class="built_in">number</span>;</span><br><span class="line">  inc(): <span class="built_in">void</span>;</span><br><span class="line">  info: &#123;</span><br><span class="line">    city: <span class="built_in">string</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>同时为了支持在 <em>main.ts</em> 中使用正确的类型，需要使用泛型</p>
<p><em>main.ts</em> 修改如下</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = wrap&lt;HelloWorker&gt;(</span><br><span class="line">  <span class="keyword">new</span> Worker(<span class="string">&quot;./hello.worker.ts&quot;</span>, &#123; <span class="attr">type</span>: <span class="string">&quot;module&quot;</span> &#125;)</span><br><span class="line">);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`Counter: <span class="subst">$&#123;<span class="keyword">await</span> obj.counter&#125;</span>`</span>);</span><br><span class="line"><span class="keyword">await</span> obj.inc();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`Counter: <span class="subst">$&#123;<span class="keyword">await</span> obj.counter&#125;</span>`</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`Counter: <span class="subst">$&#123;<span class="keyword">await</span> obj.info.city&#125;</span>`</span>);</span><br></pre></td></tr></table></figure>
<p>本质上这里使用 <code>.</code> 的方式访问 worker 中的内容依赖于 <code>Proxy</code>，所以不需要使用类似于 <code>await (await obj.info).city</code> 这种奇怪的代码。</p>
<blockquote>
<p>参考：<a target="_blank" rel="noopener" href="https://juejin.im/post/5b5fdb185188251aa01656d7">web workers 简介（二）动态创建 worker</a></p>
</blockquote>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://blog.logrocket.com/integrating-web-workers-in-a-react-app-with-comlink/">Integrating web workers in a React app with Comlink</a></li>
<li><a target="_blank" rel="noopener" href="https://lorefnon.tech/2019/03/24/using-comlink-with-typescript-and-worker-loader/">Using comlink with typescript and worker-loader</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/lacolaco-blog/an-issue-around-angular-cli-comlink-workerplugin-585be1c8d087">An issue around Angular CLI + Comlink + WorkerPlugin</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/04/15/f2c9b4e1b70a4f218216a521698989be/" data-id="ckmcqox5b00a50kuvbwtc6ied" data-title="在现代前端中使用 Worker" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">工程化</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-68f77629c640450983935d2ebcd6adbd" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/02/68f77629c640450983935d2ebcd6adbd/" class="article-date">
  <time class="dt-published" datetime="2020-04-02T01:30:59.000Z" itemprop="datePublished">2020-04-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/02/68f77629c640450983935d2ebcd6adbd/">TypeScript 函数根据第一个参数推导后面参数的类型</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>在编写一个重载函数时，吾辈发现了 ts 的方法签名问题。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">enum</span> TypeEnum &#123;</span><br><span class="line">  A,</span><br><span class="line">  B,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> A = &#123;</span><br><span class="line">  a: <span class="built_in">string</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">type</span> B = &#123;</span><br><span class="line">  b: <span class="built_in">number</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//region 普通参数</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"><span class="keyword">type</span>: TypeEnum.A, obj: A</span>): <span class="title">void</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"><span class="keyword">type</span>: TypeEnum.B, obj: B</span>): <span class="title">void</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"><span class="keyword">type</span>: TypeEnum, obj: A | B</span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//endregion</span></span><br></pre></td></tr></table></figure>
<p>上面是一个简单的重载函数，吾辈希望在输入第一个参数 <code>type</code> 之后，ts 就能匹配到正确的参数，然而事实上，ts 并没能完全做到。</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20200402140820.png" alt="ts 类型提示"></p>
<p>当然，如果真的这样写 ts 的类型检查仍然能正确地抛出错误消息，然而未能推导终究是有点问题的。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TS2769: No overload matches this call.   Overload 1 of 2, &#x27;(type: TypeEnum.A, obj: A): void&#x27;, gave the following error.     Argument of type &#x27;&#123; a: string; b: number; &#125;&#x27; is not assignable to parameter of type &#x27;A&#x27;.       Object literal may only specify known properties, and &#x27;b&#x27; does not exist in type &#x27;A&#x27;.   Overload 2 of 2, &#x27;(type: TypeEnum.B, obj: B): void&#x27;, gave the following error.     Argument of type &#x27;TypeEnum.A&#x27; is not assignable to parameter of type &#x27;TypeEnum.B&#x27;</span></span><br><span class="line">fn1(TypeEnum.A, &#123;</span><br><span class="line">  a: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  b: <span class="number">1</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>然后，吾辈想到了几种方式可以尝试解决。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p>尝试使用继承限制字段的类型。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//region 对象参数</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params">arg: &#123; <span class="keyword">type</span>: TypeEnum.A; obj: A &#125;</span>): <span class="title">void</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params">arg: &#123; <span class="keyword">type</span>: TypeEnum.B; obj: B &#125;</span>): <span class="title">void</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params">arg: &#123; <span class="keyword">type</span>: TypeEnum; obj: A | B &#125;</span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">fn2(&#123;</span><br><span class="line">  <span class="keyword">type</span>: TypeEnum.A,</span><br><span class="line">  obj: &#123;</span><br><span class="line">    a: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//endregion</span></span><br></pre></td></tr></table></figure>
<p>很遗憾的是，这是行不通的，即便是下面的这种变体，仍然是不可行的。</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20200402145908.png" alt="继承"></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Base&lt;T <span class="keyword">extends</span> TypeEnum&gt; &#123;</span><br><span class="line">  <span class="keyword">type</span>: T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> IA <span class="keyword">extends</span> Base&lt;TypeEnum.A&gt; &#123;</span><br><span class="line">  obj: A;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> IB <span class="keyword">extends</span> Base&lt;TypeEnum.B&gt; &#123;</span><br><span class="line">  obj: B;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params">arg: IA | IB</span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h3><p>事实上，使用泛型确实可以做到让 ts 的类型更加 <strong>正确</strong>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20200402145745.png" alt="泛型"></p>
<p>缺点：</p>
<ul>
<li>不能使用 ts 的重载</li>
<li>需要函数的作者改变思维</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//region 泛型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> EnumTypeMapGen&lt;T <span class="keyword">extends</span> <span class="built_in">string</span>[], M <span class="keyword">extends</span> &#123; [P <span class="keyword">in</span> TypeEnum]: <span class="built_in">any</span> &#125;&gt; = [</span><br><span class="line"></span><br><span class="line">];</span><br><span class="line"><span class="keyword">type</span> TypeMap = &#123;</span><br><span class="line">  [TypeEnum.A]: A;</span><br><span class="line">  [TypeEnum.B]: B;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn3</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">TypeEnum</span>, <span class="title">Arg</span> <span class="title">extends</span> <span class="title">TypeMap</span>[<span class="title">T</span>]&gt;(<span class="params"><span class="keyword">type</span>: T, obj: Arg</span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">fn3(TypeEnum.A, &#123;</span><br><span class="line">  a: <span class="string">&quot;&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//endregion</span></span><br></pre></td></tr></table></figure>
<h3 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h3><p>最后，高阶函数可以简单的解决这个问题，它将一次调用更改为两次调用，第一次调用返回的函数便已经确认了类型。</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20200402145633.png" alt="高阶函数"></p>
<p>缺点：</p>
<ul>
<li>需要使用者接收这种 <strong>函数式</strong> 的调用方式</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//region 高阶函数</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn4</span>(<span class="params"><span class="keyword">type</span>: TypeEnum.A</span>): (<span class="params">obj: A</span>) =&gt; <span class="title">void</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn4</span>(<span class="params"><span class="keyword">type</span>: TypeEnum.B</span>): (<span class="params">obj: B</span>) =&gt; <span class="title">void</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn4</span>(<span class="params"><span class="keyword">type</span>: TypeEnum</span>): <span class="title">any</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">fn4(TypeEnum.A)(&#123;</span><br><span class="line">  a: <span class="string">&quot;&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//endregion</span></span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总的而言，泛型和高阶函数都能解决这个问题，吾辈个人倾向于泛型，因为它并未改变调用者的使用方式，而是让作者去改变，避免改变函数的接口本身。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/04/02/68f77629c640450983935d2ebcd6adbd/" data-id="ckmcqox3m004i0kuvfwpj3dwy" data-title="TypeScript 函数根据第一个参数推导后面参数的类型" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/typescript/" rel="tag">typescript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-5443e970161e4079985109abd12153c1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/03/30/5443e970161e4079985109abd12153c1/" class="article-date">
  <time class="dt-published" datetime="2020-03-30T01:06:17.000Z" itemprop="datePublished">2020-03-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/03/30/5443e970161e4079985109abd12153c1/">Windows 使用技巧</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h2><h3 id="系统"><a href="#系统" class="headerlink" title="系统"></a>系统</h3><ul>
<li><code>Win-E</code>：打开系统文件浏览器</li>
<li><code>Win-Tab</code>：打开程序网格面板，类似于 <code>C-Tab</code>，但默认不会切换，而是展开全屏面板选择一个正在运行的程序切换过去</li>
<li><code>Win-R</code>：打开<strong>运行</strong></li>
<li><code>Win-S</code>：搜索任何东西</li>
<li><code>Win-A</code>：展开右侧通知面板</li>
<li><code>C-Tab</code>：切换程序</li>
<li><code>CS-Esc</code>：打开任务管理器</li>
<li><code>C-F</code>：在当前页内容中搜索关键字<ul>
<li><code>Enter</code>：下一个匹配关键字</li>
<li><code>S-Enter</code>：上一个匹配关键字</li>
</ul>
</li>
</ul>
<h3 id="非常见"><a href="#非常见" class="headerlink" title="非常见"></a>非常见</h3><ul>
<li><code>C-空格</code>：切换半角/全角标点符号</li>
<li><code>C-.</code>：切换中英文标点符号（隐藏的很深。。。）</li>
<li><code>Win-长按</code>: 显示快捷键指南</li>
<li><code>Win-Top</code>: 最大化</li>
<li><code>Win-Down</code>: 最小化</li>
<li><code>Win-Left</code>: 左侧贴靠</li>
<li><code>Win-Left</code>: 右侧贴靠</li>
</ul>
<h2 id="高级功能"><a href="#高级功能" class="headerlink" title="高级功能"></a>高级功能</h2><h3 id="定时关机"><a href="#定时关机" class="headerlink" title="定时关机"></a>定时关机</h3><p>使用以下命令会在指定时间后关机</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutdown –s –t [second time]</span><br></pre></td></tr></table></figure>
<p>例如以下命令指的是在 1h 后关机</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutdown –s –t 3600</span><br></pre></td></tr></table></figure>
<blockquote>
<p>参考: <a target="_blank" rel="noopener" href="https://jingyan.baidu.com/article/93f9803f06bb90e0e46f55ec.html">百度 win10 怎么定时关机？</a></p>
</blockquote>
<h3 id="PowerToys-使用"><a href="#PowerToys-使用" class="headerlink" title="PowerToys 使用"></a><a href="/p/0bfcb8d2846a4c37ad37d7f0f7ff709a">PowerToys 使用</a></h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/03/30/5443e970161e4079985109abd12153c1/" data-id="ckmcqox3c003r0kuvgf5bburt" data-title="Windows 使用技巧" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-964e8ddc28dc41c3888f53c7f8f01af9" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/03/14/964e8ddc28dc41c3888f53c7f8f01af9/" class="article-date">
  <time class="dt-published" datetime="2020-03-13T18:25:00.000Z" itemprop="datePublished">2020-03-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/03/14/964e8ddc28dc41c3888f53c7f8f01af9/">工具网站</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h2><ul>
<li><a target="_blank" rel="noopener" href="https://frontendmasters.com/books/front-end-handbook/2019/">2019 前端开发者学习路线汇总</a></li>
</ul>
<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><ul>
<li><a target="_blank" rel="noopener" href="https://i18ns.com/">i18ns</a>: 国际化 i18n 全语言翻译</li>
<li><a target="_blank" rel="noopener" href="https://codepen.io/">codepen</a>: 前端页面代码分享(<code>HTML/CSS/JavaScript</code>)</li>
<li><a target="_blank" rel="noopener" href="https://www.appsgeyser.com/">appsgeyser</a>: 封装前端/网站为 App</li>
<li><a target="_blank" rel="noopener" href="https://www.cloudflare.com/">cloudflare</a>: CDN/免费的 HTTPS</li>
<li><a target="_blank" rel="noopener" href="https://www.netlify.com/">netlify</a>: 前端免费 CI(持续集成)</li>
<li><a target="_blank" rel="noopener" href="https://sm.ms/">smms</a>: 免费稳定的图床(国内)</li>
<li><a target="_blank" rel="noopener" href="https://cn.office-converter.com/Online-Document-Converter">office-converter</a>: 文档在线转换</li>
<li><a target="_blank" rel="noopener" href="https://msdn.itellyou.cn/">I tell you</a>: 微软相关资源下载</li>
<li><a target="_blank" rel="noopener" href="https://vectormagic.com/">vectormagic</a>: 图像类型在线转换</li>
<li><a target="_blank" rel="noopener" href="https://send.firefox.com/">Firefox Send</a>: 安全的分享文件</li>
<li><a target="_blank" rel="noopener" href="https://www.draw.io/">draw</a>: 画图工具</li>
<li><a target="_blank" rel="noopener" href="https://www.flaticon.com/">flaticon</a>: 矢量图标库</li>
<li><a target="_blank" rel="noopener" href="https://www.iconfont.cn/">iconfont</a>: 阿里矢量图标库</li>
<li><a target="_blank" rel="noopener" href="https://colorhunt.co/">colorhunt</a>: CSS 颜色搭配</li>
<li><a target="_blank" rel="noopener" href="https://uigradients.com/">uigradients</a>: 渐变颜色推荐</li>
<li><a target="_blank" rel="noopener" href="https://www.cssfontstack.com/">cssfontstack</a>: 查看字体在各个系统的预装概率</li>
<li><a target="_blank" rel="noopener" href="https://tb.rg-adguard.net/">rg-adguard</a>: Windows 第三方下载站（实际调用 MS 的链接）</li>
<li><a target="_blank" rel="noopener" href="https://picsum.photos/">Picsum</a>: 图片占位网站</li>
<li><a target="_blank" rel="noopener" href="http://patorjk.com/software/taag/">taag</a>: 文字转字符画</li>
<li><a target="_blank" rel="noopener" href="http://asciiflow.com/">asciiflow</a>: 手绘字符画</li>
<li><a target="_blank" rel="noopener" href="https://www.geogebra.org/">GeoGebra</a>: 数学作图工具</li>
<li><a target="_blank" rel="noopener" href="https://send-anywhere.com/">send anywhere</a>: 文件共享</li>
</ul>
<h2 id="网站"><a href="#网站" class="headerlink" title="网站"></a>网站</h2><ul>
<li><a target="_blank" rel="noopener" href="https://codepen.io/pens/">Explore Pens on CodePen</a>: CSS/Canvas/SVG 创意分享</li>
<li><a target="_blank" rel="noopener" href="https://www.namesilo.com/">namesilo</a>: 域名服务</li>
<li><a target="_blank" rel="noopener" href="https://www.vultr.com/">vultr</a>: VPS 服务</li>
<li><a target="_blank" rel="noopener" href="https://www.inoreader.com/">inoreader</a>: RSS 订阅/管理/阅读</li>
<li><a target="_blank" rel="noopener" href="https://leetcode.com/problemset/all/">leetcode</a>: 算法刷题</li>
<li><a target="_blank" rel="noopener" href="https://www.owllook.net/">owllook</a>: 在线开源小说阅读</li>
<li><a target="_blank" rel="noopener" href="https://unbug.github.io/codelf/">codelf</a>: 变量命名神器</li>
<li><a target="_blank" rel="noopener" href="https://sourceforge.net/projects/crportable/files/">旧版 Chromium 下载</a>: 便于调试之用</li>
<li><a target="_blank" rel="noopener" href="https://www.picdiet.com/zh-cn">picdiet</a>: 图片在线本地压缩</li>
<li><a target="_blank" rel="noopener" href="https://www.aconvert.com/">aconvert</a>：在线常用工具网站，包括图像转换（<code>png &lt;=&gt; ico</code>），文档转换等等</li>
<li><a target="_blank" rel="noopener" href="https://zhongzisc.blogspot.com/">种子书城</a>：一个有趣的 epub 书籍分享/下载网站</li>
<li><a target="_blank" rel="noopener" href="https://www.deepl.com/translator">DeepL 深度翻译</a></li>
</ul>
<h2 id="论坛"><a href="#论坛" class="headerlink" title="论坛"></a>论坛</h2><ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/">SegmentFault</a>: 国内前端问答论坛</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/">MDN 开发者网站</a>: 世界上最好的前端文档（详尽的本地化）</li>
<li><a target="_blank" rel="noopener" href="https://developers.google.com/web/">Google Web</a>: Google Web 的开发者文档(包含最新但不一定实用的知识)</li>
</ul>
<h2 id="教程"><a href="#教程" class="headerlink" title="教程"></a>教程</h2><ul>
<li><a target="_blank" rel="noopener" href="https://git-scm.com/book/zh/v1">Pro Git</a>: Git 功能详述</li>
<li><a target="_blank" rel="noopener" href="http://es6.ruanyifeng.com/">ES6 教程</a>: 通俗易懂的 ES6 入门教程</li>
<li><a target="_blank" rel="noopener" href="https://material.io/design/">material desgin</a>: materail 主题设计原则</li>
</ul>
<h2 id="博客"><a href="#博客" class="headerlink" title="博客"></a>博客</h2><ul>
<li><a target="_blank" rel="noopener" href="http://ru23.com/">Frank’s Blog/前端迷</a>: 前端底层知识</li>
<li><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/">阮一峰的网络博客</a>: 通俗易懂的博客</li>
<li><a target="_blank" rel="noopener" href="http://xbeta.info/">善用佳软</a>: 精品的软件评测系列（很久没更新了）</li>
<li><a target="_blank" rel="noopener" href="https://liqi.io/">利器</a>: 分享创造者和他们的工具（不一定是编程领域）</li>
<li><a target="_blank" rel="noopener" href="https://colachan.com/">可乐橙</a>：有着奇思妙想的 UI 设计师</li>
</ul>
<h2 id="库"><a href="#库" class="headerlink" title="库"></a>库</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.chartjs.org/">chartjs</a>: JavaScript 图表</li>
<li><a target="_blank" rel="noopener" href="https://jquery.com/">jquery</a>: 上个世代最流行的前端库</li>
<li><a target="_blank" rel="noopener" href="https://github.com/tj/commander.js/blob/master/Readme_zh-CN.md">Commander.js</a>: nodejs 命令行解析工具</li>
</ul>
<h2 id="优秀文章"><a href="#优秀文章" class="headerlink" title="优秀文章"></a>优秀文章</h2><ul>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5aa0d65a5188251880387b01">程序员跳槽时，如何高效地准备面试？</a></li>
</ul>
<h2 id="学习"><a href="#学习" class="headerlink" title="学习"></a>学习</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.freecodecamp.org/learn/front-end-libraries/react/create-a-simple-jsx-element">freecodecamp 免费学习认证网站</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/03/14/964e8ddc28dc41c3888f53c7f8f01af9/" data-id="ckmcqox45006g0kuv1dwp20oq" data-title="工具网站" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-1a9c52f7628f4d39af4b3d074ba06d63" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/23/1a9c52f7628f4d39af4b3d074ba06d63/" class="article-date">
  <time class="dt-published" datetime="2020-02-22T19:51:06.000Z" itemprop="datePublished">2020-02-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/23/1a9c52f7628f4d39af4b3d074ba06d63/">liuli-cli TS JS SDK CLI 工具</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>吾辈最初尝试写 JS SDK 发布到 NPM 上，过程中遇到了很多问题，也因此消耗了大量的时间。<br>包括但不限于以下这些</p>
<ul>
<li>折腾 Rollup 打包</li>
<li>折腾 JS 的模块（umd/esm）</li>
<li>折腾单元测试</li>
<li>折腾 ES6 怎么通过 Babel 编译</li>
<li>使用 JS 编写，没有提供类型定义</li>
<li>没有进行打包</li>
<li>没有编译成 ES5</li>
<li>没有单元测试</li>
<li>没有 API 文档</li>
<li>没有 Linter 和 Prettier 统一格式化</li>
</ul>
<blockquote>
<p>具体的过程可以参考 <a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/c30dd206/">使用 rollup 打包 JavaScript SDK</a></p>
</blockquote>
<p>吾辈在过程中遇到的一些问题</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000018386874/">使用 Rollup + Babel 打包出错</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000018914964">npm 发布后的包安装后无法引用？</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000019587945">为什么上传到 GitHub Pages 的静态资源会 404 了呢？有人遇到过么？</a></li>
</ul>
<p>吾辈目前所在的公司中的 NPM 库也存在这些问题，内部的 npm 库几乎不能称为一个合格的库，以上的问题基本都存在。所以为了重构公司的 npm 包（主要是为了提供类型定义），就想是否能够把这部分单独抽离成一个脚手架，因而便开发了 SDK cli 供公司的前端 dev 创建一个标准（包含打包、编译、测试、文档、发布）的 SDK，并希望以此抹平不同 NPM 库配置的不一致性。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>所以吾辈后来创造了 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/liuli-cli">liuli-cli</a>，用于简化和统一创建 JS/TS SDK 的步骤。</p>
<p>目前实现的功能如下</p>
<ul>
<li>[x] 基本打包支持</li>
<li>[x] 模块化 umd/es</li>
<li>[x] jest 单元测试支持</li>
<li>[x] 代码压缩支持</li>
<li>[x] babel 支持</li>
<li>[x] ts 支持</li>
<li>[x] linter 支持</li>
<li>[x] prettier 格式化支持</li>
<li>[x] git 钩子支持</li>
<li>[x] esdoc</li>
<li>[x] typedoc</li>
<li>[x] 许可证选择支持</li>
</ul>
<p>使用的话也很简单</p>
<p>全局安装 liuli-cli</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g liuli-cli</span><br></pre></td></tr></table></figure>
<p>然后便可以使用命令 <code>li</code> 创建项目</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">li create &lt;project-name&gt;</span><br></pre></td></tr></table></figure>
<p>目前支持以下三种类型（强烈推荐库的作者使用 TypeScript）</p>
<ul>
<li><code>JavaScript 模板</code></li>
<li><code>TypeScript 模板</code></li>
<li><code>命令行工具模板</code></li>
</ul>
<p>之后根据引导即可创建一个开箱即用的项目了</p>
<h2 id="反例"><a href="#反例" class="headerlink" title="反例"></a>反例</h2><p>让我们看看那些大公司云服务的 JS SDK 是怎样的。</p>
<p>腾讯：提供的 SDK 大多是一个 JS 文件，需要在项目里手动引入，甚至有些是依赖了开源依赖，导致开源依赖使用 npm 管理，而私有服务的 SDK 仍然使用 JS 的方式引入。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/436">对象存储</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/266">腾讯云点播</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/269">即时通信 IM</a></li>
</ul>
<p>讯飞：web 版 demo 明明有 package.json 这种版本控制工具，但却仍然是在一个 HTML 里直接 script 脚本引入，而非使用 npm/yarn 进行依赖管理，而 package.json 里面只是一个 http-server 用以开启一个静态服务器看 demo 罢了。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.xfyun.cn/doc/asr/voicedictation/API.html">语音听写</a></li>
<li><a target="_blank" rel="noopener" href="https://www.xfyun.cn/doc/asr/lfasr/API.html">语音转写</a></li>
<li><a target="_blank" rel="noopener" href="https://www.xfyun.cn/doc/asr/rtasr/API.html">实时语音转写</a></li>
</ul>
<p>或许在大公司的这些 SDK 的开发者看来，会使用他们这些服务的公司都是小公司，以及一些没有接触过现代前端的开发者，所以都以这种方式提供 SDK。更不要说文档与类型定义，这两项几乎是 JS SDK 标准的需求，他们都没有做好。而且，明明他们的 SDK 也有版本号，甚至给出的 JS SDK 本身便是 umd 的，但实际上却未发布在 npm 或是其他公开的仓库中（作为库的使用者吾辈没有找到）。这些开发者宁愿用户提工单询问，并浪费了大量的沟通时间解决问题也不愿意最开始就将这些做的好一点。</p>
<blockquote>
<p>Pass1：文档可能过时，但 Demo 一定是最新的。<br>Pass2：这行代码不知道做什么的，但没有了就会出错，先放在这里。</p>
</blockquote>
<p>当然，或许创建第三方组织可以解决部分这个问题，像是 <a target="_blank" rel="noopener" href="https://github.com/DefinitelyTyped/DefinitelyTyped">DefinitelyTyped</a> 那个 ts 的开源项目一样，但问题仍然很多</p>
<ol>
<li> 目标对象不同：DefinitelyTyped 的目标是为了没有 types 的 js 库定义类型，它的目标对象也是开源（大多数时候也是）免费的库。而像是腾讯这些内部服务的 SDK 是收费、不开源的，很难让人免费为其做贡献。</li>
<li> 各家都有类似的云服务：提供这种云服务的公司并不止一家，难道要为每一家都添加创建类似的组织么？</li>
<li> 安全性问题：第三方组织不能保证每一行贡献的内容一定就和官方的一模一样，就算引入了恶意代码也很难立刻发现。</li>
<li> 法律风险：这样做的话是否会被官方发律师函也是未知之数。</li>
</ol>
<p>当然，也有一些个人为某些云服务创建的 NPM 库</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/xunfeisdk">https://www.npmjs.com/package/xunfeisdk</a></li>
<li><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/xfy-node">https://www.npmjs.com/package/xfy-node</a></li>
</ul>
<p>但更多的服务是没有的，而且个人创建的这些库很难保证一直不过时（大多数都是某个项目用了一下罢了）。如果能简化项目的初始化流程，不知是否能让官方发布到 NPM 组织下。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>关于使用 CLI 会阻碍人接触更<strong>底层</strong>的知识这点，属于仁者见仁智者见智的事情。毕竟，CLI 能够简化重复的劳动自然是会受到欢迎，前端三大框架也都有自己的 CLI 用于快速创建项目，降低框架的使用门槛，避免接触到一些琐碎的细节而专注于自己的需求开发。</p>
<blockquote>
<p>webpack/babel 真的不能说底层，尤其是 webpack，复杂性太高、知识的时效性太短导致现在它的风评并不好。。。</p>
</blockquote>
<p>最后，这个项目才写出来没多久，欢迎任何人使用、批评和建议！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/23/1a9c52f7628f4d39af4b3d074ba06d63/" data-id="ckmcqox2h001f0kuv62uba6l6" data-title="liuli-cli TS JS SDK CLI 工具" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">工程化</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-0162e7b886294d45bb509a30861dfb0b" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/02/0162e7b886294d45bb509a30861dfb0b/" class="article-date">
  <time class="dt-published" datetime="2020-02-02T02:15:38.000Z" itemprop="datePublished">2020-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/02/0162e7b886294d45bb509a30861dfb0b/">Markdown 图片粘贴工具 PicGo</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>使用 Markdown 的人都知道，想要在 Markdown 文件中插入图片并不是特别容易，因为你必须要先把图片上传到图床才行，一个好的图床能够节省很多时间。吾辈之前使用的是 smms，后来切换到了 GitHub，毕竟 GitHub 作为国外流行的托管网站，但事实上 GitHub 上传图片麻烦一点也不少。_add -&gt; commit -&gt; push -&gt; browser -&gt; copy url_，实在麻烦。直到，遇到了 PicGo。</p>
<p>PicGo 对于吾辈而言主要解决了下面的问题：</p>
<ul>
<li>上传之前重命名</li>
<li>上传一键就好</li>
<li>上传后图片管理</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://molunerfinn.com/PicGo/">官网</a>, <a target="_blank" rel="noopener" href="https://github.com/rxliuli/PicGo">GitHub</a></p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20181016231008.png" alt="官网首页截图"></p>
<h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><p>在 <a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/picgo/releases">GitHub Releases</a> 下载最新版，然后安装一下即可开箱即用啦！</p>
<blockquote>
<p>注：上传图床默认是 <a target="_blank" rel="noopener" href="https://sm.ms/">smms</a>，速度很快，也很稳定</p>
</blockquote>
<p>启动之后会看到一个上传页，将图片拖到这里就可以自动上传，并在完成之后自动将链接复制到剪切板上。<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190205233313.png" alt="图片上传页"></p>
<p>在相册里可以对图片进行管理，方便浏览，复制 <code>URL</code>，删除本地记录等操作！<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190205233906.png" alt="上传图片管理"></p>
<h2 id="GitHub-设置"><a href="#GitHub-设置" class="headerlink" title="GitHub 设置"></a>GitHub 设置</h2><blockquote>
<p>如果你不玩 GitHub，可以跳过这一节</p>
</blockquote>
<p>这里可以参考 PicGo 的 <a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/PicGo/wiki/%E8%AF%A6%E7%BB%86%E7%AA%97%E5%8F%A3%E7%9A%84%E4%BD%BF%E7%94%A8#github%E5%9B%BE%E5%BA%8A">官方教程</a></p>
<p>基本上就是需要以下三个配置</p>
<ul>
<li>仓库名：准确地说是 [用户名/仓库名]，例如吾辈的 GitHub 帐户名是 rxliuli，作为图床的仓库名是 img-bed，那么这里应该设置为 <strong>rxliuli/img-bed</strong></li>
<li>分支名：默认就是 master 分支，如果没什么特别的需求应该不用修改</li>
<li>Token：用来操作 GitHub 的钥匙，你可以在 <a target="_blank" rel="noopener" href="https://github.com/settings/tokens">Token 设置</a> 中任意生成，但需要留意权限，默认选择第一个 repo 然后点击 <strong>Generator Token</strong> 按钮生成就行了</li>
</ul>
<p>吾辈的配置</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20181016232104.png" alt="PicGo 配置"></p>
<h2 id="VSCode-插件"><a href="#VSCode-插件" class="headerlink" title="VSCode 插件"></a>VSCode 插件</h2><blockquote>
<p>如果你不玩 VSCode，也可以跳过这一节了</p>
</blockquote>
<p>如果你使用的编辑器是 VSCode 并且不需要管理图片的话，便可以使用 VSCode 插件 <a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=Spades.vs-picgo">PicGo</a></p>
<p>基本上安装完成之后就可以直接使用了，默认使用 <a target="_blank" rel="noopener" href="https://sm.ms/">SMMS 图床</a>。</p>
<p>常用操作只有三个：</p>
<ul>
<li>截图上传 <code>Ctrl-Alt-U</code><br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20181205102050.gif" alt="截图上传"></li>
<li>文件管理器选择上传 <code>Ctrl-Alt-E</code><br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20181205102356.gif" alt="文件管理器选择上传"></li>
<li>输入文件路径上传 <code>Ctrl-Alt-O</code><br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20181205102418.gif" alt="输入文件路径上传"></li>
</ul>
<blockquote>
<p>如果你不想使用 SMMS 图床，也可以配置 GitHub 或者其他的图床，具体参考 <a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=Spades.vs-picgo">官方文档</a>。</p>
</blockquote>
<hr>
<p>那么，关于 Markdown 图片粘贴工具到这里便结束了，愉快的使用 Markdown 写作吧 <code>o(〃＾▽＾〃)o</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/02/0162e7b886294d45bb509a30861dfb0b/" data-id="ckmcqox1v00010kuv9aei5mit" data-title="Markdown 图片粘贴工具 PicGo" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/windows/" rel="tag">windows</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/8/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/10/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/electron/" rel="tag">electron</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grid/" rel="tag">grid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jetbrains/" rel="tag">jetbrains</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/" rel="tag">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/" rel="tag">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/" rel="tag">sql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typescript/" rel="tag">typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vscode/" rel="tag">vscode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webstorm/" rel="tag">webstorm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AA%E4%BA%BA/" rel="tag">个人</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%AC%E5%8F%B8/" rel="tag">公司</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%91%A8%E6%8A%A5/" rel="tag">周报</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%A3%E5%91%8A/" rel="tag">宣告</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">工程化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E6%BA%90/" rel="tag">开源</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%82%E6%AD%A5/" rel="tag">异步</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%85%E6%9B%B4%E6%96%B0/" rel="tag">待更新</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82%E8%B0%88/" rel="tag">杂谈</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BB%8F%E9%AA%8C/" rel="tag">经验</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6/" rel="tag">读书</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">转载</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/css/" style="font-size: 12.14px;">css</a> <a href="/tags/electron/" style="font-size: 15.71px;">electron</a> <a href="/tags/git/" style="font-size: 12.86px;">git</a> <a href="/tags/grid/" style="font-size: 10.71px;">grid</a> <a href="/tags/java/" style="font-size: 19.29px;">java</a> <a href="/tags/javascript/" style="font-size: 20px;">javascript</a> <a href="/tags/jetbrains/" style="font-size: 12.14px;">jetbrains</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/markdown/" style="font-size: 10.71px;">markdown</a> <a href="/tags/react/" style="font-size: 14.29px;">react</a> <a href="/tags/sql/" style="font-size: 14.29px;">sql</a> <a href="/tags/typescript/" style="font-size: 12.14px;">typescript</a> <a href="/tags/vscode/" style="font-size: 12.86px;">vscode</a> <a href="/tags/vue/" style="font-size: 16.43px;">vue</a> <a href="/tags/webstorm/" style="font-size: 10px;">webstorm</a> <a href="/tags/windows/" style="font-size: 17.14px;">windows</a> <a href="/tags/%E4%B8%AA%E4%BA%BA/" style="font-size: 12.86px;">个人</a> <a href="/tags/%E5%85%AC%E5%8F%B8/" style="font-size: 10px;">公司</a> <a href="/tags/%E5%91%A8%E6%8A%A5/" style="font-size: 10px;">周报</a> <a href="/tags/%E5%AE%A3%E5%91%8A/" style="font-size: 10px;">宣告</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 13.57px;">工具</a> <a href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" style="font-size: 17.86px;">工程化</a> <a href="/tags/%E5%BC%80%E6%BA%90/" style="font-size: 10px;">开源</a> <a href="/tags/%E5%BC%82%E6%AD%A5/" style="font-size: 15px;">异步</a> <a href="/tags/%E5%BE%85%E6%9B%B4%E6%96%B0/" style="font-size: 10.71px;">待更新</a> <a href="/tags/%E6%9D%82%E8%B0%88/" style="font-size: 18.57px;">杂谈</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a> <a href="/tags/%E7%BB%8F%E9%AA%8C/" style="font-size: 11.43px;">经验</a> <a href="/tags/%E8%AF%BB%E4%B9%A6/" style="font-size: 12.14px;">读书</a> <a href="/tags/%E8%BD%AC%E8%BD%BD/" style="font-size: 11.43px;">转载</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/14/8fb2d58463ae4191ac064a76e15bffbd/">2021 第十周</a>
          </li>
        
          <li>
            <a href="/2021/03/12/7e7131c07c984d928ba3fefa7a9cef06/">读书-[颓废与沉默：透视犬儒文化]</a>
          </li>
        
          <li>
            <a href="/2021/03/02/db74e6e5d2444bc3b6e185a7b338bbf6/">electron 开发经验之谈系列-在渲染、主进程间共享数据</a>
          </li>
        
          <li>
            <a href="/2021/02/27/06cb464179cf45c598208534705aae3c/">2020 吾辈在公司推动的前端技术演进</a>
          </li>
        
          <li>
            <a href="/2021/02/23/cd66150d2b86448590fcc9bb2419c0b2/">实践 lerna monorepo</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>